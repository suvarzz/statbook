<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>R statistics</title>
  <meta name="description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown #bookdown:version# and GitBook 2.6.7" />

  <meta property="og:title" content="R statistics" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="R statistics" />
  
  <meta name="twitter:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="Mark Goldberg" />


<meta name="date" content="2021-05-06" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



<!--bookdown:title:start-->
<div id="header">
<h1 class="title">R statistics</h1>
<p class="author"><em>Mark Goldberg</em></p>
<p class="date"><em>2021-05-06</em></p>
</div>
<!--bookdown:title:end-->

<!--bookdown:toc:start-->
  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">
<!--bookdown:toc2:start-->
<ul>
<li><a href="#introduction"><span class="toc-section-number">1</span> Introduction</a></li>
<li><a href="#statistics-r-functions-reference"><span class="toc-section-number">2</span> Statistics R functions reference</a>
<ul>
<li><a href="#get-data"><span class="toc-section-number">2.1</span> Get data</a></li>
<li><a href="#data-inspection"><span class="toc-section-number">2.2</span> Data inspection</a></li>
<li><a href="#plots"><span class="toc-section-number">2.3</span> Plots</a></li>
<li><a href="#analysis-of-the-distribution"><span class="toc-section-number">2.4</span> Analysis of the distribution</a></li>
<li><a href="#distributions"><span class="toc-section-number">2.5</span> Distributions</a></li>
<li><a href="#t-test"><span class="toc-section-number">2.6</span> t-Test</a></li>
<li><a href="#anova"><span class="toc-section-number">2.7</span> ANOVA</a></li>
</ul></li>
<li><a href="#basic-statistics"><span class="toc-section-number">3</span> Basic Statistics</a>
<ul>
<li><a href="#definitions"><span class="toc-section-number">3.1</span> Definitions</a></li>
<li><a href="#probability"><span class="toc-section-number">3.2</span> Probability</a></li>
<li><a href="#analysis-of-sample-distribution"><span class="toc-section-number">3.3</span> Analysis of sample distribution</a>
<ul>
<li><a href="#histogram"><span class="toc-section-number">3.3.1</span> Histogram</a></li>
<li><a href="#outliers"><span class="toc-section-number">3.3.2</span> Outliers</a></li>
<li><a href="#normality"><span class="toc-section-number">3.3.3</span> Normality</a></li>
</ul></li>
<li><a href="#confidence-interval"><span class="toc-section-number">3.4</span> Confidence interval</a></li>
</ul></li>
<li><a href="#primary-data-analysis---case-studies"><span class="toc-section-number">4</span> Primary data analysis - Case studies</a></li>
<li><a href="#primary-data-analysis"><span class="toc-section-number">5</span> Primary data analysis</a>
<ul>
<li><a href="#handling-missing-data"><span class="toc-section-number">5.1</span> Handling missing data</a></li>
<li><a href="#dealing-with-outliers"><span class="toc-section-number">5.2</span> Dealing with outliers</a></li>
</ul></li>
<li><a href="#data-normalization"><span class="toc-section-number">6</span> Data normalization</a></li>
<li><a href="#statistical-distributions"><span class="toc-section-number">7</span> Statistical distributions</a>
<ul>
<li><a href="#normal-distribution"><span class="toc-section-number">7.1</span> Normal Distribution</a></li>
<li><a href="#bernoulli-distribution"><span class="toc-section-number">7.2</span> Bernoulli Distribution</a></li>
<li><a href="#binomial-distribution"><span class="toc-section-number">7.3</span> Binomial Distribution</a></li>
<li><a href="#beta-distribution"><span class="toc-section-number">7.4</span> Beta distribution</a></li>
<li><a href="#geometric-distribution"><span class="toc-section-number">7.5</span> Geometric Distribution</a></li>
<li><a href="#uniform-distributions"><span class="toc-section-number">7.6</span> Uniform Distributions</a></li>
<li><a href="#poisson-distribution"><span class="toc-section-number">7.7</span> Poisson Distribution</a></li>
<li><a href="#exponential-distribution"><span class="toc-section-number">7.8</span> Exponential Distribution</a></li>
<li><a href="#chi-squared-distribution"><span class="toc-section-number">7.9</span> Chi-squared Distribution</a></li>
</ul></li>
<li><a href="#hypothesis-testing"><span class="toc-section-number">8</span> Hypothesis testing</a>
<ul>
<li><a href="#hypothesis-testing-theory"><span class="toc-section-number">8.1</span> Hypothesis testing theory</a></li>
<li><a href="#hypothesis-test-practice"><span class="toc-section-number">8.2</span> Hypothesis test (Practice)</a></li>
</ul></li>
<li><a href="#t-procedures"><span class="toc-section-number">9</span> t-Procedures</a>
<ul>
<li><a href="#t-test-and-normal-distribution"><span class="toc-section-number">9.1</span> t-test and normal distribution</a></li>
<li><a href="#one-sample-t-test"><span class="toc-section-number">9.2</span> One-sample t-test</a></li>
<li><a href="#practical-example-t-test-in-r"><span class="toc-section-number">9.3</span> Practical example: t-test in R</a></li>
<li><a href="#two-samples-t-test"><span class="toc-section-number">9.4</span> Two samples t-test</a></li>
<li><a href="#compare-students-t-and-normal-distributions"><span class="toc-section-number">9.5</span> Compare Student’s t and normal distributions</a></li>
<li><a href="#non-parametric-tests"><span class="toc-section-number">9.6</span> Non-parametric tests</a></li>
<li><a href="#mann-whitney-u-rank-sum-test"><span class="toc-section-number">9.7</span> Mann-Whitney U Rank Sum Test</a></li>
<li><a href="#wilcoxon-test"><span class="toc-section-number">9.8</span> Wilcoxon test</a></li>
</ul></li>
<li><a href="#tests-for-categorical-variables"><span class="toc-section-number">10</span> Tests for categorical variables</a>
<ul>
<li><a href="#chi-squared-tests"><span class="toc-section-number">10.1</span> Chi-squared tests</a></li>
</ul></li>
<li><a href="#multiple-testing"><span class="toc-section-number">11</span> Multiple testing</a>
<ul>
<li><a href="#the-bonferroni-correction"><span class="toc-section-number">11.1</span> The Bonferroni correction</a></li>
</ul></li>
<li><a href="#sources"><span class="toc-section-number">12</span> Sources</a>
<ul>
<li><a href="#t-test-1"><span class="toc-section-number">12.1</span> t-test</a>
<ul>
<li><a href="#two-tailed-test"><span class="toc-section-number">12.1.1</span> Two-tailed test</a></li>
</ul></li>
</ul></li>
<li><a href="#analysis-of-variance-anova"><span class="toc-section-number">13</span> Analysis of Variance (ANOVA)</a>
<ul>
<li><a href="#one-way-anova"><span class="toc-section-number">13.1</span> One-way ANOVA</a></li>
<li><a href="#sources-1"><span class="toc-section-number">13.2</span> Sources</a></li>
</ul></li>
<li><a href="#t-test-anova-difference"><span class="toc-section-number">14</span> t-test ANOVA difference</a></li>
<li><a href="#chi-squared-test"><span class="toc-section-number">15</span> Chi-squared test</a>
<ul>
<li><a href="#multinomial-goodness-of-fit"><span class="toc-section-number">15.1</span> Multinomial Goodness of Fit</a></li>
</ul></li>
<li><a href="#non-parametric-methods"><span class="toc-section-number">16</span> Non-parametric Methods</a>
<ul>
<li><a href="#sign-test"><span class="toc-section-number">16.1</span> Sign Test</a></li>
<li><a href="#wilcoxon-signed-rank-test"><span class="toc-section-number">16.2</span> Wilcoxon Signed-Rank Test</a></li>
<li><a href="#mann-whitney-wilcoxon-test"><span class="toc-section-number">16.3</span> Mann-Whitney-Wilcoxon Test</a></li>
<li><a href="#kruskal-wallis-test"><span class="toc-section-number">16.4</span> Kruskal-Wallis Test</a></li>
</ul></li>
<li><a href="#wilcoxon-signed-rank-test-1"><span class="toc-section-number">17</span> Wilcoxon signed-rank test</a></li>
<li><a href="#support-vector-machine"><span class="toc-section-number">18</span> Support Vector Machine</a></li>
<li><a href="#correlation"><span class="toc-section-number">19</span> Correlation</a></li>
<li><a href="#methods-and-algorithms-of-machine-learning"><span class="toc-section-number">20</span> Methods and algorithms of machine learning</a></li>
<li><a href="#machine-learning-functions-reference"><span class="toc-section-number">21</span> Machine Learning Functions Reference</a>
<ul>
<li><a href="#linear-regression"><span class="toc-section-number">21.1</span> Linear Regression</a></li>
</ul></li>
<li><a href="#split-data-into-train-and-test-subsets"><span class="toc-section-number">22</span> Split data into train and test subsets</a></li>
<li><a href="#linear-regression-1"><span class="toc-section-number">23</span> Linear Regression</a>
<ul>
<li><a href="#linear-regression---theory"><span class="toc-section-number">23.1</span> Linear regression - theory</a></li>
<li><a href="#generate-random-data-set-for-the-linear-model"><span class="toc-section-number">23.2</span> Generate random data set for the linear model</a></li>
<li><a href="#practical-example"><span class="toc-section-number">23.3</span> Practical example</a></li>
<li><a href="#mean-squared-error-mse"><span class="toc-section-number">23.4</span> Mean squared error (MSE)</a></li>
<li><a href="#linear-model-in-r"><span class="toc-section-number">23.5</span> Linear model in R</a></li>
<li><a href="#linear-regression-model-for-multiple-parameters"><span class="toc-section-number">23.6</span> Linear regression model for multiple parameters</a></li>
<li><a href="#choosing-explanatory-variables-for-the-model"><span class="toc-section-number">23.7</span> Choosing explanatory variables for the model</a></li>
<li><a href="#assessment-of-model-performance-for-categorical-data."><span class="toc-section-number">23.8</span> Assessment of model performance for categorical data.</a></li>
<li><a href="#confidence-intervals-for-linear-model"><span class="toc-section-number">23.9</span> Confidence intervals for linear model</a></li>
<li><a href="#practical-examples-for-linear-model-regression"><span class="toc-section-number">23.10</span> Practical examples for linear model regression</a></li>
</ul></li>
<li><a href="#linear-regression-complex-cases"><span class="toc-section-number">24</span> Linear regression complex cases</a>
<ul>
<li><a href="#cars"><span class="toc-section-number">24.1</span> Cars</a></li>
<li><a href="#linear-regression-modeling-compair-with-knn"><span class="toc-section-number">24.2</span> Linear regression modeling, compair with kNN</a></li>
<li><a href="#more-complex-example"><span class="toc-section-number">24.3</span> More complex example</a></li>
<li><a href="#next-part"><span class="toc-section-number">24.4</span> NEXT part</a></li>
<li><a href="#next-part-1"><span class="toc-section-number">24.5</span> NEXT Part</a></li>
</ul></li>
<li><a href="#nonlinear-regression"><span class="toc-section-number">25</span> Nonlinear regression</a></li>
<li><a href="#multiple-linear-regression"><span class="toc-section-number">26</span> Multiple linear regression</a></li>
<li><a href="#spline-model"><span class="toc-section-number">27</span> Spline model</a>
<ul>
<li><a href="#generate-dataset-from-a-given-function"><span class="toc-section-number">27.1</span> Generate dataset from a given function</a></li>
<li><a href="#split-data-for-train-and-test"><span class="toc-section-number">27.2</span> Split data for train and test</a></li>
<li><a href="#diagram-of-the-given-function-and-generated-datasets"><span class="toc-section-number">27.3</span> Diagram of the given function and generated datasets</a></li>
<li><a href="#build-a-model-using-splines"><span class="toc-section-number">27.4</span> Build a model using splines</a></li>
<li><a href="#diagram-of-mse-for-train-and-test-data"><span class="toc-section-number">27.5</span> Diagram of MSE for train and test data</a></li>
<li><a href="#build-optimal-model-and-plot-for-the-model"><span class="toc-section-number">27.6</span> Build optimal model and plot for the model</a></li>
<li><a href="#bibliograpy"><span class="toc-section-number">27.7</span> Bibliograpy</a></li>
</ul></li>
<li><a href="#logistic-regression"><span class="toc-section-number">28</span> Logistic Regression</a>
<ul>
<li><a href="#confusion-matrix"><span class="toc-section-number">28.1</span> Confusion matrix</a></li>
<li><a href="#next-part-2"><span class="toc-section-number">28.2</span> Next part</a></li>
<li><a href="#next-part-3"><span class="toc-section-number">28.3</span> NExt part</a></li>
</ul></li>
<li><a href="#clustering"><span class="toc-section-number">29</span> Clustering</a>
<ul>
<li><a href="#next-part-4"><span class="toc-section-number">29.1</span> Next part</a></li>
<li><a href="#example"><span class="toc-section-number">29.2</span> Example</a></li>
<li><a href="#next-part-5"><span class="toc-section-number">29.3</span> NEXT PART</a></li>
</ul></li>
<li><a href="#learning-vector-quantization"><span class="toc-section-number">30</span> Learning Vector Quantization</a></li>
<li><a href="#bayesian-inference"><span class="toc-section-number">31</span> Bayesian inference</a>
<ul>
<li><a href="#simple-model-with-one-binary-parameter"><span class="toc-section-number">31.1</span> Simple model with one binary parameter</a></li>
<li><a href="#grid-approximation"><span class="toc-section-number">31.2</span> Grid approximation</a></li>
<li><a href="#grid-approximation-1"><span class="toc-section-number">31.3</span> Grid approximation</a></li>
<li><a href="#model-of-birth-weights-using-normal-distribution"><span class="toc-section-number">31.4</span> Model of birth weights using normal distribution</a></li>
<li><a href="#a-bayesian-model-of-zombie-iq"><span class="toc-section-number">31.5</span> A Bayesian model of Zombie IQ</a></li>
<li><a href="#the-best-models"><span class="toc-section-number">31.6</span> The BEST models</a></li>
</ul></li>
<li><a href="#naive-bayes-classifiers"><span class="toc-section-number">32</span> Naive Bayes classifiers</a></li>
<li><a href="#markov-chain-monte-carlo-mcmc"><span class="toc-section-number">33</span> Markov Chain Monte Carlo (MCMC)</a></li>
<li><a href="#simple-markov-process"><span class="toc-section-number">34</span> Simple Markov process</a>
<ul>
<li><a href="#sources-2"><span class="toc-section-number">34.0.1</span> Sources</a></li>
</ul></li>
<li><a href="#tree-based-models"><span class="toc-section-number">35</span> Tree-based models</a>
<ul>
<li><a href="#classification-tree-example"><span class="toc-section-number">35.1</span> Classification Tree example</a></li>
<li><a href="#regression-tree-example"><span class="toc-section-number">35.2</span> Regression Tree example</a></li>
</ul></li>
</ul>
<!--bookdown:toc2:end-->
      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R statistics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<!--bookdown:toc:end-->
<!--bookdown:body:start-->
<div id="introduction" class="section level1" number="1">
<h1 number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>This is the collection of statistical methods in R.</p>
<!--chapter:end:index.Rmd-->
</div>
<div id="statistics-r-functions-reference" class="section level1" number="2">
<h1 number="2"><span class="header-section-number">2</span> Statistics R functions reference</h1>
<div id="get-data" class="section level2" number="2.1">
<h2 number="2.1"><span class="header-section-number">2.1</span> Get data</h2>
</div>
<div id="data-inspection" class="section level2" number="2.2">
<h2 number="2.2"><span class="header-section-number">2.2</span> Data inspection</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(df)  <span class="co"># data type</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(df)     <span class="co"># dimention</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(df)    <span class="co"># number of rows</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ncol</span>(df)    <span class="co"># number of columns</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(df)     <span class="co"># data structure</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(df) <span class="co"># data summary</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(df)   <span class="co"># names of columns</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df) <span class="co"># also column names</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(df)   <span class="co"># frequency of categorical data</span></span></code></pre></div>
</div>
<div id="plots" class="section level2" number="2.3">
<h2 number="2.3"><span class="header-section-number">2.3</span> Plots</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x <span class="sc">~</span> y)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(df)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(v)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(x)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">pie</span>(groupsize, labels, col, ...)</span></code></pre></div>
</div>
<div id="analysis-of-the-distribution" class="section level2" number="2.4">
<h2 number="2.4"><span class="header-section-number">2.4</span> Analysis of the distribution</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mode</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>getmode <span class="ot">&lt;-</span> <span class="cf">function</span>(v) {</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>   uniqv <span class="ot">&lt;-</span> <span class="fu">unique</span>(v)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>   uniqv[<span class="fu">which.max</span>(<span class="fu">tabulate</span>(<span class="fu">match</span>(v, uniqv)))]</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">getmode</span>(v)        <span class="co"># mode</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(v)           <span class="co"># mean</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(v, <span class="at">trim=</span><span class="fl">0.1</span>) <span class="co"># trimmed mean</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="fu">median</span>(v)         <span class="co"># median</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="fu">min</span>(v)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(v)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(v)          <span class="co"># c(mun(v), max(v))</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(v)<span class="sc">-</span><span class="fu">min</span>(v)   <span class="co"># range</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(v)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="fu">rank</span>(v)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(v)        <span class="co"># subsample</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(v, size)</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(v)            <span class="co"># variance</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(v)             <span class="co"># standard deviation</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(v)            <span class="co"># correlation</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="fu">cov</span>(v)            <span class="co"># covariation</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="fu">scale</span>(v)          <span class="co"># z-scores</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(v)</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="fu">IQR</span>(v)            <span class="co"># interquantile range: IQR = Q3 – Q1</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(v)         <span class="co"># normal probability plot</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(v)         <span class="co"># adds a line to a normal probability plot passing through 1Q and 3Q</span></span></code></pre></div>
</div>
<div id="distributions" class="section level2" number="2.5">
<h2 number="2.5"><span class="header-section-number">2.5</span> Distributions</h2>
<p><strong>d</strong> - probability density<br />
<strong>p</strong> - cumulative distribution<br />
<strong>q</strong> - quantile function (inverse cumulative distribution)<br />
<strong>r</strong> - random variables from distribution</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Normal distribution</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dnorm</span>(x, mean, sd)     <span class="co"># Probability Density Function (PDF)</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">pnorm</span>(q, mean, sd)     <span class="co"># Cumulative Distribution Function (CDF)</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">qnorm</span>(p, mean, sd)     <span class="co"># quantile function - inverse of pnorm</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rnorm</span>(n, mean, sd)     <span class="co"># random numbers from normal distribution</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Binomial</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="fu">dbinom</span>(x)     <span class="co"># Probability Density Function (PDF)</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="fu">pbinom</span>(q)     <span class="co"># Cumulative Distribution Function (CDF)</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="fu">qbinom</span>(p)     <span class="co"># quantile function - inverse of pnorm</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="fu">rbinom</span>(n)     <span class="co"># random numbers from normal distribution</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Poisson</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="fu">dpois</span>()</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ppois</span>()</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="fu">qpois</span>()</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="fu">rpois</span>()</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Exponential</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="fu">dexp</span>()</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="fu">pexp</span>()</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="fu">qexp</span>()</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="fu">rexp</span>()</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Chi-squared distribution</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="fu">dchisq</span>(v, df)     <span class="co"># density of the interval</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="fu">pchisq</span>()          <span class="co"># distribution of the interval (AUC)</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="fu">qchisq</span>()          <span class="co"># quantiles</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="fu">rchisq</span>()          <span class="co"># random deviates</span></span></code></pre></div>
</div>
<div id="t-test" class="section level2" number="2.6">
<h2 number="2.6"><span class="header-section-number">2.6</span> t-Test</h2>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(x, <span class="at">mu =</span> <span class="dv">0</span>, <span class="at">alternative =</span> <span class="fu">c</span>(<span class="st">&quot;two.sided&quot;</span>, <span class="st">&quot;less&quot;</span>, <span class="st">&quot;greater&quot;</span>), </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">paired =</span> <span class="cn">FALSE</span>, <span class="at">var.equal =</span> <span class="cn">FALSE</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(v, mu)     <span class="co"># one-sample t-test, mu - null hypothesized value</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(v1, v2)    <span class="co"># two-sample t-test</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(v1, v2, <span class="at">var.equal=</span>T)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(var1, var2, <span class="at">paired=</span>T)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">wilcox.test</span>(v1, v2, <span class="at">paired=</span>T)</span></code></pre></div>
</div>
<div id="anova" class="section level2" number="2.7">
<h2 number="2.7"><span class="header-section-number">2.7</span> ANOVA</h2>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># One way ANOVA</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">oneway.test</span>(x <span class="sc">~</span> f)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(x <span class="sc">~</span> f)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(m1, m2)      <span class="co"># compair two models</span></span></code></pre></div>
<!--chapter:end:02_stat_fun_ref.Rmd-->
</div>
</div>
<div id="basic-statistics" class="section level1" number="3">
<h1 number="3"><span class="header-section-number">3</span> Basic Statistics</h1>
<div id="definitions" class="section level2" number="3.1">
<h2 number="3.1"><span class="header-section-number">3.1</span> Definitions</h2>
<p><strong>population</strong> - all existing samples<br />
<strong>sample</strong> - subset of statistical population<br />
<strong>simple random sample</strong> - random subset<br />
<strong>stratified sample</strong> - fist clustering, than random sample from<br />
<strong>cluster sample</strong> - random choosing from several existing clusters<br />
<strong>variables</strong> - discret, continuous, ordinal (ранговая)</p>
</div>
<div id="probability" class="section level2" number="3.2">
<h2 number="3.2"><span class="header-section-number">3.2</span> Probability</h2>
<p>A standard French-suited deck of playing cards contains 52 cards; 13 each of hearts (♥), spades (♠), clubs (♦), and diamonds (♣). Assuming that you have a well-shuffled deck in front of you, the probability of drawing any given card is 1/52 ≈ 1.92%.<br />
Calculate the probability of drawing any of the four aces! That is, calculate the probability of drawing 🂡 or 🂱 or 🃁 or 🃑 using the sum rule and assign it to prob_to_draw_ace.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the probability of drawing any of the four aces</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>prob_to_draw_ace <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">52</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">52</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">52</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">52</span></span></code></pre></div>
<p>Cards and the product rule
Again, assuming that you have a well-shuffled deck in front of you, the probability of drawing any given card is 1/52 ≈ 1.92% . The probability of drawing any of the four aces is 1/52 + 1/52 + 1/52 + 1/52 = 4/52. Once an ace has been drawn, the probability of picking any of the remaining three is 3/51. If another ace is drawn the probability of picking any of the remaining two is 2/50, and so on.<br />
Use the product rule to calculate the probability of picking the four aces in a row from the top of a well-shuffled deck and assign it to prob_to_draw_four_aces.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the probability of picking four aces in a row</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>prob_to_draw_four_aces <span class="ot">&lt;-</span> <span class="dv">4</span><span class="sc">/</span><span class="dv">52</span> <span class="sc">*</span> <span class="dv">3</span><span class="sc">/</span><span class="dv">51</span> <span class="sc">*</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">50</span> <span class="sc">*</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">49</span></span></code></pre></div>
</div>
<div id="analysis-of-sample-distribution" class="section level2" number="3.3">
<h2 number="3.3"><span class="header-section-number">3.3</span> Analysis of sample distribution</h2>
<div id="histogram" class="section level3" number="3.3.1">
<h3 number="3.3.1"><span class="header-section-number">3.3.1</span> Histogram</h3>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># sample of random integers</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">rnorm</span>(<span class="at">n=</span><span class="dv">50</span>, <span class="at">sd=</span><span class="dv">5</span>, <span class="at">mean=</span><span class="dv">100</span>))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">stripchart</span>(v, <span class="at">method =</span> <span class="st">&quot;stack&quot;</span>, <span class="at">pch=</span><span class="dv">19</span>, <span class="at">cex=</span><span class="dv">2</span>, <span class="at">offset=</span>.<span class="dv">5</span>, <span class="at">at=</span>.<span class="dv">15</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">main =</span> <span class="st">&quot;Dotplot of random value&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Random value&quot;</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(v)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co"># add density</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">density</span>(v)<span class="sc">$</span>x</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> (<span class="dv">10</span><span class="sc">/</span><span class="fu">max</span>(<span class="fu">density</span>(v)<span class="sc">$</span>y))<span class="sc">*</span><span class="fu">density</span>(v)<span class="sc">$</span>y  <span class="co"># scale y to plot with histogram</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, y, <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
</div>
<div id="outliers" class="section level3" number="3.3.2">
<h3 number="3.3.2"><span class="header-section-number">3.3.2</span> Outliers</h3>
<p>Outliers are rare values that appear far away from the majority of the data.
Outliers can bias the results and potentially lead to incorrect conclusions if not handled properly.
One method for dealing with outliers is to simply remove them.
However, removing data points can introduce other types of bias into the results, and potentially result in losing critical information.
If outliers seem to have a lot of influence on the results, a nonparametric test such as the <strong>Wilcoxon Signed Rank Test</strong> may be appropriate to use instead.
Outliers can be identified visually using a boxplot.</p>
</div>
<div id="normality" class="section level3" number="3.3.3">
<h3 number="3.3.3"><span class="header-section-number">3.3.3</span> Normality</h3>
<p>It is possible to use histogram to estimate normality of the distribution.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># QQ-plot - fit normal distibution</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(v); <span class="fu">qqline</span>(v)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(v)     <span class="co"># variance: sd = sqrt(var)</span></span></code></pre></div>
<pre><code>## [1] 23.94653</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(v)      <span class="co"># standard deviation</span></span></code></pre></div>
<pre><code>## [1] 4.893519</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(v)<span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">length</span>(v))  <span class="co"># standard error sd/sqrt(n)</span></span></code></pre></div>
<pre><code>## [1] 0.6920481</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Z-score (standartization)</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># transform distribution to mean=0, variance=1</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># z = (x - mean(n))/sd</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>vs <span class="ot">&lt;-</span> <span class="fu">scale</span>(v)[,<span class="dv">1</span>]</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>vs</span></code></pre></div>
<pre><code>##  [1] -0.64983907 -1.26289480 -0.44548716  0.57627238 -1.67159862  1.39368002  0.37192047  0.16756857 -0.24113525  1.59803193 -0.85419098  0.37192047 -0.03678334 -0.44548716
## [15]  1.59803193 -0.44548716  0.57627238 -1.05854289 -1.46724671  1.59803193  0.16756857  0.37192047 -0.03678334 -2.48900625 -0.03678334 -0.03678334  1.39368002 -0.85419098
## [29] -1.05854289  0.78062429 -0.03678334  1.18932811  0.98497620 -1.26289480  0.16756857  0.37192047  1.59803193  0.16756857  1.80238384 -0.64983907 -0.03678334 -1.67159862
## [43] -1.26289480 -0.44548716  0.16756857  1.18932811 -0.03678334  0.16756857 -1.05854289  0.78062429</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(v, <span class="at">breaks=</span><span class="dv">10</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(vs, <span class="at">breaks=</span><span class="dv">10</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-10-2.png" width="672" /></p>
</div>
</div>
<div id="confidence-interval" class="section level2" number="3.4">
<h2 number="3.4"><span class="header-section-number">3.4</span> Confidence interval</h2>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># sample of random integers</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">rnorm</span>(<span class="at">n=</span><span class="dv">50</span>, <span class="at">sd=</span><span class="dv">5</span>, <span class="at">mean=</span><span class="dv">100</span>))</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Confidence interval for normal distribution with p=0.95</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">mean</span>(x)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">sd</span>(x)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.95</span>)<span class="sc">*</span>s<span class="sc">/</span><span class="fu">sqrt</span>(n)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>confidence <span class="ot">&lt;-</span> <span class="fu">c</span>(m<span class="sc">-</span>error, m<span class="sc">+</span>error)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>confidence</span></code></pre></div>
<pre><code>## [1]  98.58989 100.97011</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Confidence interval for t-distribution with p=0.95</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">qt</span>(<span class="fl">0.975</span>,<span class="at">df=</span>n<span class="dv">-1</span>)<span class="sc">*</span>s<span class="sc">/</span><span class="fu">sqrt</span>(n)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co"># confidence interval</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="at">left=</span>a<span class="sc">-</span>error, <span class="at">right=</span>a<span class="sc">+</span>error)</span></code></pre></div>
<pre><code>##     left    right 
## 4.063971 5.936029</code></pre>
<!--chapter:end:03_basic_statistics.Rmd-->
</div>
</div>
<div id="primary-data-analysis---case-studies" class="section level1" number="4">
<h1 number="4"><span class="header-section-number">4</span> Primary data analysis - Case studies</h1>
<p>Abbakumov, 2016, lectures</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># GET DATA</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;./DATA/Swiss_Bank_Notes.csv&quot;</span>, <span class="at">header=</span>T, <span class="at">sep=</span><span class="st">&quot; &quot;</span>, <span class="at">dec=</span><span class="st">&quot;,&quot;</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Data explanation: parameters of Swiss Banknotes</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Size of data: 200 (100 are real, 100 are false)</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Length - length</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="co"># H_l - height left</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="co"># H_r - height right</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="co"># dist_l - border left</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="co"># dist_up - border up</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Diag - diagonal</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="co"># ? Find false banknotes</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Let&#39;s add a column with 100 filled 0 and 100 filled with 1.</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>origin <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(df, origin)</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>origin[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>] <span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Set origin as factor - binary data (0,1)</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>origin <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(df<span class="sc">$</span>origin)</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a><span class="fu">is.factor</span>(df<span class="sc">$</span>origin)</span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. HISTORGRAM</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="fu">length</span>(<span class="fu">colnames</span>(df))<span class="sc">/</span><span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(<span class="fu">colnames</span>(df))) { <span class="fu">hist</span>(df[,i], <span class="at">main =</span> <span class="fu">paste</span>(<span class="fu">colnames</span>(df)[i])) }</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Histogram for Diagonals</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(df<span class="sc">$</span>Diag, <span class="at">breaks=</span><span class="dv">18</span>, <span class="at">probability=</span><span class="cn">TRUE</span>)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Barplot</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(VADeaths, <span class="at">beside=</span><span class="cn">TRUE</span>, <span class="at">legend=</span><span class="cn">TRUE</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>),</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab=</span><span class="st">&quot;Deaths per 1000&quot;</span>, <span class="at">main=</span><span class="st">&quot;Death rates in Virginia&quot;</span>)</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Pieplot</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>groupsize <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">18</span>, <span class="dv">30</span>, <span class="dv">32</span>, <span class="dv">10</span>, <span class="dv">10</span>)</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>, <span class="st">&quot;D&quot;</span>, <span class="st">&quot;F&quot;</span>)</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="fu">pie</span>(groupsize, labels, <span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;white&quot;</span>, <span class="st">&quot;grey&quot;</span>, <span class="st">&quot;black&quot;</span>, <span class="st">&quot;blue&quot;</span>))</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="co"># All pairs of data scatter plot</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(df)</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Length ~ Dial</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(df<span class="sc">$</span>Length, df<span class="sc">$</span>Diag)</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a><span class="co"># true notes</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(df<span class="sc">$</span>Length[df<span class="sc">$</span>origin<span class="sc">==</span><span class="dv">1</span>],</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>       df<span class="sc">$</span>Length[df<span class="sc">$</span>origin<span class="sc">==</span><span class="dv">0</span>], <span class="at">pch=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">&quot;green&quot;</span>)</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a><span class="co"># false notes</span></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(df<span class="sc">$</span>Length[df<span class="sc">$</span>origin<span class="sc">==</span><span class="dv">1</span>],</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>       df<span class="sc">$</span>Length[df<span class="sc">$</span>origin<span class="sc">==</span><span class="dv">0</span>], <span class="at">pch=</span><span class="dv">1</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a><span class="co"># If factors are given, plot makes boxplot</span></span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(df<span class="sc">$</span>origin, df<span class="sc">$</span>Diag)</span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">&quot;Swiss Bank Notes&quot;</span>)</span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a><span class="co"># GET DATA - TOWNS</span></span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>town <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;DATA/town_1959_2.csv&quot;</span>, <span class="at">header=</span>T, <span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>, <span class="at">dec=</span><span class="st">&quot;.&quot;</span>)</span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>town</span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(town)</span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Median is more stable to outliers</span></span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(town[,<span class="dv">3</span>])</span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a><span class="co"># lets remove 2 first towns from the data</span></span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(town[<span class="dv">3</span><span class="sc">:</span><span class="dv">1004</span>,<span class="dv">3</span>])</span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(town[,<span class="dv">3</span>])</span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a><span class="co"># log scale allows us to see outliers better</span></span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">log</span>(town[,<span class="dv">3</span>]), <span class="at">breaks=</span><span class="dv">50</span>)</span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Truncated mean is better than mean</span></span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(town[,<span class="dv">3</span>], <span class="at">trim=</span><span class="fl">0.05</span>)</span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true" tabindex="-1"></a><span class="co"># GET DATA - BASKETBALL</span></span>
<span id="cb25-51"><a href="#cb25-51" aria-hidden="true" tabindex="-1"></a>bb <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;DATA/basketball.csv&quot;</span>, <span class="at">header=</span>F, <span class="at">sep=</span><span class="st">&quot;;&quot;</span>, <span class="at">dec=</span><span class="st">&quot;.&quot;</span>)</span>
<span id="cb25-52"><a href="#cb25-52" aria-hidden="true" tabindex="-1"></a>bb</span>
<span id="cb25-53"><a href="#cb25-53" aria-hidden="true" tabindex="-1"></a><span class="co"># NBA Player characteristics:</span></span>
<span id="cb25-54"><a href="#cb25-54" aria-hidden="true" tabindex="-1"></a><span class="co"># percent of positives vs:</span></span>
<span id="cb25-55"><a href="#cb25-55" aria-hidden="true" tabindex="-1"></a><span class="co"># SF - light forvard</span></span>
<span id="cb25-56"><a href="#cb25-56" aria-hidden="true" tabindex="-1"></a><span class="co"># PF - heavy forvard</span></span>
<span id="cb25-57"><a href="#cb25-57" aria-hidden="true" tabindex="-1"></a><span class="co"># C - center</span></span>
<span id="cb25-58"><a href="#cb25-58" aria-hidden="true" tabindex="-1"></a><span class="co"># G - defender</span></span>
<span id="cb25-59"><a href="#cb25-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-60"><a href="#cb25-60" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(bb[,<span class="dv">1</span>])</span>
<span id="cb25-61"><a href="#cb25-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-62"><a href="#cb25-62" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb25-63"><a href="#cb25-63" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bb[,<span class="dv">1</span>]<span class="sc">~</span>bb[,<span class="dv">2</span>])</span>
<span id="cb25-64"><a href="#cb25-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-65"><a href="#cb25-65" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb25-66"><a href="#cb25-66" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>) { <span class="fu">hist</span>(bb[,<span class="dv">1</span>], <span class="at">breaks=</span><span class="dv">5</span><span class="sc">*</span>i, <span class="at">main=</span><span class="fu">paste</span>(<span class="st">&quot;Breaks&quot;</span>, <span class="dv">5</span><span class="sc">*</span>i), <span class="at">ylab=</span><span class="st">&quot;&quot;</span>) }</span>
<span id="cb25-67"><a href="#cb25-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-68"><a href="#cb25-68" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">unique</span>(bb[,<span class="dv">2</span>])) {</span>
<span id="cb25-69"><a href="#cb25-69" aria-hidden="true" tabindex="-1"></a>     <span class="fu">hist</span>(bb[bb[,<span class="dv">2</span>]<span class="sc">==</span>i ,<span class="dv">1</span>],  <span class="at">breaks=</span><span class="dv">6</span>, </span>
<span id="cb25-70"><a href="#cb25-70" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim=</span><span class="fu">c</span>(<span class="fu">min</span>(bb[,<span class="dv">1</span>])<span class="sc">-</span><span class="dv">5</span>, <span class="fu">max</span>(bb[,<span class="dv">1</span>]<span class="sc">+</span><span class="dv">5</span>)), <span class="at">col=</span><span class="st">&quot;white&quot;</span>, <span class="at">main=</span>i, <span class="at">ylab=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb25-71"><a href="#cb25-71" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-72"><a href="#cb25-72" aria-hidden="true" tabindex="-1"></a><span class="co"># Conclusion: for several groups of data boxplots may be more informative than histograms</span></span></code></pre></div>
<!--chapter:end:04_primary_analysis_cases.Rmd-->
</div>
<div id="primary-data-analysis" class="section level1" number="5">
<h1 number="5"><span class="header-section-number">5</span> Primary data analysis</h1>
<div id="handling-missing-data" class="section level2" number="5.1">
<h2 number="5.1"><span class="header-section-number">5.1</span> Handling missing data</h2>
<ul>
<li><strong>Ignore</strong>: Discard samples with missing values.<br />
</li>
<li><strong>Impute</strong>: ‘Fill in’ the missing values with other values.<br />
</li>
<li><strong>Accept</strong>: Apply methods that are unaffected by the missing data.</li>
</ul>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(naniar)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>mammographic <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&#39;./DATA/mammographic.data&#39;</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="fu">any_na</span>(mammographic)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace ? with NAs: bands</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>mammographic <span class="ot">&lt;-</span> <span class="fu">replace_with_na_all</span>(mammographic, <span class="sc">~</span>.x <span class="sc">==</span> <span class="st">&#39;?&#39;</span>)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="fu">any_na</span>(mammographic)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="fu">miss_var_summary</span>(mammographic)</span></code></pre></div>
<p><strong>Vizualysing missing data</strong></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">vis_miss</span>(mammographic)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># comulative</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">vis_miss</span>(mammographic, <span class="at">cluster=</span><span class="cn">TRUE</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="fu">gg_miss_case</span>(mammographic)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(a, b, c <span class="sc">+</span> <span class="fu">rremove</span>(<span class="st">&quot;x.text&quot;</span>), </span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;frame view&quot;</span>, <span class="st">&quot;cumulative&quot;</span>, <span class="st">&quot;missing&quot;</span>),</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">nrow =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><strong>Missing data types</strong><br />
- <strong>MCAR</strong>: Missing Completely At Random<br />
- <strong>MAR</strong>: Missing At Random<br />
- <strong>MNAR</strong>: Missing Not At Random</p>
<table>
<colgroup>
<col width="7%" />
<col width="14%" />
<col width="17%" />
<col width="60%" />
</colgroup>
<thead>
<tr class="header">
<th><strong>Type</strong></th>
<th><strong>Imputation</strong></th>
<th><strong>Deletion</strong></th>
<th><strong>Visual cues</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>MCAR</strong></td>
<td>Recommended</td>
<td>Will not lead to bias</td>
<td>Random or noisy patterns in missingness clusters</td>
</tr>
<tr class="even">
<td><strong>MAR</strong></td>
<td>Recommended</td>
<td>May lead to bias</td>
<td>Well-defined missingness clusters when arrangin for a particular variable(s)</td>
</tr>
<tr class="odd">
<td><strong>MNAR</strong></td>
<td>Will lead to bias</td>
<td>Will lead to bias</td>
<td>Neither visual pattern above holds</td>
</tr>
</tbody>
</table>
<p>It can be difficult to ascertain the missingness type using visual inspection!</p>
<p><strong>Internal evaluation</strong><br />
Compair distributions with/without imputed values:</p>
<ul>
<li>Mean<br />
</li>
<li>Variance<br />
</li>
<li>Scale</li>
</ul>
<p><strong>Exterlan evaluation</strong>
Build ML models with/without imputated values and evaluate impact of imputation method on ML model performance:</p>
<ul>
<li>Classification<br />
</li>
<li>Regression<br />
</li>
<li>Clustering<br />
</li>
<li>etc.</li>
</ul>
<p>Ideally imputation should not bring big differences.</p>
<p><strong>Mean and linear imputations</strong></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(naniar)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(simputation)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Impute with the mean</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>imp_mean <span class="ot">&lt;-</span> bands <span class="sc">%&gt;%</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_shadow</span>(<span class="at">only_miss =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_label_shadow</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">impute_mean_all</span>()</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Impute with lm</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>imp_lm <span class="ot">&lt;-</span> bands <span class="sc">%&gt;%</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_shadow</span>(<span class="at">only_miss =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_label_shadow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">impute_lm</span>(Blade_pressure <span class="sc">~</span> Ink_temperature) <span class="sc">%&gt;%</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">impute_lm</span>(Roughness <span class="sc">~</span> Ink_temperature) <span class="sc">%&gt;%</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">impute_lm</span>(Ink_pct <span class="sc">~</span> Ink_temperature)</span></code></pre></div>
<p><strong>Combining multiple imputation models</strong></p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate the imputation models</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>imp_models <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(<span class="at">mean =</span> imp_mean,</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">lm =</span> lmp_lm,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">.id =</span> <span class="st">&quot;imp_model&quot;</span>)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(imp_models)</span></code></pre></div>
</div>
<div id="dealing-with-outliers" class="section level2" number="5.2">
<h2 number="5.2"><span class="header-section-number">5.2</span> Dealing with outliers</h2>
<ul>
<li>The 3-sigma rule (for normally distributed data)<br />
</li>
<li>The 1.5*IQR rule (more general)</li>
</ul>
<p>Outliers:</p>
<ul>
<li>any value lower that <span class="math inline">\(Q1 - 1.5 x IQR\)</span><br />
</li>
<li>or any higher than <span class="math inline">\(Q3 + 1.5 x IQR\)</span></li>
</ul>
<p><strong>Multivariate methods</strong><br />
* <strong>Distance-based</strong>: K-nearest neighbors (kNN) distance<br />
* <strong>Density-based</strong>: Local outlier factor (LOF)</p>
<p>**1.5*IQR rule**<br />
Outliers:</p>
<ul>
<li>any value lower that <span class="math inline">\(Q1 - 1.5 x IQR\)</span><br />
</li>
<li>or any higher than <span class="math inline">\(Q3 + 1.5 x IQR\)</span></li>
</ul>
<p><strong>Distance-based methods</strong></p>
<ul>
<li>Average distance to the K-nearest neighbors</li>
</ul>
<p><strong>Density-based methods</strong></p>
<ul>
<li>Number of the neighboring points within a certain distance</li>
</ul>
<p>Assumption: outliers often lie far from their neighbors</p>
<p>Local Outlier Factor (LOF)<br />
* Measures the local deviation of a data point with respect to its neighbors.<br />
* Outliers are observations with substantially lower density than their neighbors.<br />
<code>get.knn()</code> from FNN package</p>
<ul>
<li>Each observation <span class="math inline">\(x\)</span> has an associated score LOF(<span class="math inline">\(x\)</span>)<br />
LOF(<span class="math inline">\(x\)</span>) <span class="math inline">\(\approx\)</span> 1 similar density to its neighbors<br />
LOF(<span class="math inline">\(x\)</span>) &lt; 1 higher density than neighbors (inlier)<br />
LOF(<span class="math inline">\(x\)</span>) &gt; 1 lower density than neighbors (outlier)</li>
</ul>
<p><code>lof()</code> function from <code>dbscan</code> package</p>
<p><strong>What to do with outlier observations?</strong><br />
1. <strong>Retention</strong>: Keep them in your dataset and, if possible, use algorithms that are robust to outliers.
- e.g. K nearest-neighbors (kNN), tree-based methods (decision tree, random forest)<br />
2. <strong>Imputation</strong>: Use an imputation method to replace their value with a less extreme observation.<br />
- e.g. mode imputation, linear imputation, kNN imputation.<br />
3. <strong>Capping</strong>: Replace them with the value of the 5-th percentile (lower limit) or 95-th percentile (upper limit).<br />
4. <strong>Exclusion</strong>: Not recommended, especially in small datasets or those where a normal distribution cannot be assumed.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>cars <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&#39;./DATA/cars.csv&#39;</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>cars <span class="ot">&lt;-</span> cars[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(cars)</span></code></pre></div>
<pre><code>##   distance consume speed
## 1       28       5    26
## 2       12      42    30
## 3      112      55    38
## 4      129      39    36
## 5      185      45    46
## 6       83      64    50</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(cars<span class="sc">$</span>consume)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>consume_quartiles <span class="ot">&lt;-</span> <span class="fu">quantile</span>(cars<span class="sc">$</span>consume)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>consume_quartiles</span></code></pre></div>
<pre><code>##   0%  25%  50%  75% 100% 
##    4   41   46   52  122</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Scale data and create scatterplot: cars_scaled</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(dplyr)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(cars)</span></code></pre></div>
<pre><code>## Rows: 388
## Columns: 3
## $ distance &lt;int&gt; 28, 12, 112, 129, 185, 83, 78, 123, 49, 119, 124, 118, 123, 247, 124, 173, 334, 118, 259, 118, 253, 142, 179, 118, 123, 124, 184, 184, 183, 184, 123, 118,…
## $ consume  &lt;int&gt; 5, 42, 55, 39, 45, 64, 44, 5, 64, 53, 56, 46, 59, 51, 47, 51, 56, 51, 49, 47, 55, 59, 57, 47, 59, 41, 57, 58, 55, 57, 53, 5, 56, 48, 43, 57, 52, 74, 48, 6…
## $ speed    &lt;int&gt; 26, 30, 38, 36, 46, 50, 43, 40, 26, 30, 42, 38, 59, 58, 46, 24, 36, 32, 39, 40, 32, 38, 37, 36, 62, 57, 21, 28, 29, 35, 51, 29, 58, 40, 36, 36, 37, 26, 23…</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>cars_scaled <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">scale</span>(cars))</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(distance <span class="sc">~</span> consume, <span class="at">data =</span> cars_scaled, </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&#39;Fuel consumption vs. distance&#39;</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-18-2.png" width="672" /></p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate upper threshold: upper_th</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>upper_th <span class="ot">&lt;-</span> consume_quartiles[<span class="dv">4</span>] <span class="sc">+</span> </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    <span class="fl">1.5</span> <span class="sc">*</span> (consume_quartiles[<span class="dv">4</span>] <span class="sc">-</span> consume_quartiles[<span class="dv">2</span>])</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>upper_th</span></code></pre></div>
<pre><code>##  75% 
## 68.5</code></pre>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the sorted vector of distinct potential outliers</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">unique</span>(cars<span class="sc">$</span>consume[cars<span class="sc">$</span>consume <span class="sc">&gt;</span> upper_th]))</span></code></pre></div>
<pre><code>##  [1]  69  71  74  79  81  87  99 108 115 122</code></pre>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(FNN)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute KNN score</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>cars_knn <span class="ot">&lt;-</span> <span class="fu">get.knn</span>(<span class="at">data =</span> cars_scaled, <span class="at">k =</span> <span class="dv">7</span>)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>cars1 <span class="ot">&lt;-</span> cars</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>cars1<span class="sc">$</span>knn_score <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(cars_knn<span class="sc">$</span>nn.dist)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Print top 5 KNN scores and data point indices: top5_knn</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>(top5_knn <span class="ot">&lt;-</span> <span class="fu">order</span>(cars1<span class="sc">$</span>knn_score, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])</span></code></pre></div>
<pre><code>## [1] 320 107 335  56 190</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cars1<span class="sc">$</span>knn_score[top5_knn])</span></code></pre></div>
<pre><code>## [1] 4.472813 2.385471 2.246905 2.122242 1.740575</code></pre>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot variables using KNN score as size of points</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(distance <span class="sc">~</span> consume, <span class="at">data =</span> cars1, <span class="at">cex =</span> knn_score, <span class="at">pch =</span> <span class="dv">20</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-18-3.png" width="672" /></p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dbscan)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Add lof_score column to cars1</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>cars1 <span class="ot">&lt;-</span> cars</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>cars1<span class="sc">$</span>lof_score <span class="ot">&lt;-</span> <span class="fu">lof</span>(cars_scaled, <span class="at">minPts =</span> <span class="dv">7</span>)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Print top 5 LOF scores and data point indices: top5_lof</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>(top5_lof <span class="ot">&lt;-</span> <span class="fu">order</span>(cars1<span class="sc">$</span>lof_score, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])</span></code></pre></div>
<pre><code>## [1] 165 186 161 228  52</code></pre>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cars1<span class="sc">$</span>lof_score[top5_lof])</span></code></pre></div>
<pre><code>## [1] 2.606151 2.574906 2.328733 2.252610 2.027528</code></pre>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot variables using LOF score as size of points</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(distance <span class="sc">~</span> consume, <span class="at">data =</span> cars1, </span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> lof_score, <span class="at">pch =</span> <span class="dv">20</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-18-4.png" width="672" /></p>
</div>
</div>
<div id="data-normalization" class="section level1" number="6">
<h1 number="6"><span class="header-section-number">6</span> Data normalization</h1>
<p>Data normalization (feature scaling) is not always needed for e.g. decision-tree-based models.</p>
<p>Data normalization is beneficial for:</p>
<ul>
<li>Support Vector Machines, K-narest neighbors, Logistic Regression</li>
<li>Neural networks<br />
</li>
<li>Clustering algorithms (K-means, K-medoids, DBSCAN, etc.)<br />
</li>
<li>Feature extraction (Principal Component Analysis, Linear Discriminant Analysis, etc)</li>
</ul>
<p><strong>Min-max scaling</strong></p>
<ul>
<li>Maps a numerical value <span class="math inline">\(x\)</span> to the [0,1] interval</li>
</ul>
<p><span class="math display">\[x&#39; = \frac{x - min}{max - min}\]</span></p>
<ul>
<li>Ensures that all features will share the exact same scale.<br />
</li>
<li>Does not cope well with outliers.</li>
</ul>
<p><strong>Standardization (Z-score normalization)</strong></p>
<ul>
<li>Maps a numerical value to <span class="math inline">\(x\)</span> to a new distribution with mean <span class="math inline">\(\mu = 0\)</span> and standard deviation <span class="math inline">\(\sigma = 1\)</span></li>
</ul>
<p><span class="math display">\[x&#39; = \frac{x - \mu}{\sigma}\]</span></p>
<ul>
<li>More robust to outliers then min-max normalization.<br />
</li>
<li>Normalized data may be on different scales.</li>
</ul>
<p><strong>Example</strong></p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="co"># generate data with different ranges</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">a =</span> <span class="fu">sample</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="at">length.out=</span><span class="dv">20</span>)),</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">b =</span> <span class="fu">sample</span>(<span class="fu">seq</span>(<span class="dv">100</span>, <span class="dv">500</span>, <span class="at">length.out=</span><span class="dv">20</span>)))</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="co"># view data</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(df)</span></code></pre></div>
<pre><code>## Rows: 20
## Columns: 2
## $ a &lt;dbl&gt; 0.0000000, 1.8947368, 0.4210526, 1.4736842, 1.3684211, 0.5263158, 0.1052632, 0.8421053, 1.5789474, 1.1578947, 1.7894737, 1.0526316, 0.7368421, 1.2631579, 0.63157…
## $ b &lt;dbl&gt; 226.3158, 478.9474, 163.1579, 415.7895, 457.8947, 352.6316, 205.2632, 289.4737, 500.0000, 310.5263, 436.8421, 268.4211, 331.5789, 142.1053, 184.2105, 100.0000, 1…</code></pre>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># data ranges to see if normalization is needed</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(df, range)</span></code></pre></div>
<pre><code>##      a   b
## [1,] 0 100
## [2,] 2 500</code></pre>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ranges are different =&gt; normalize</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply min-max and standardization</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>nrm <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">a_MinMax =</span> (a <span class="sc">-</span> <span class="fu">min</span>(a)) <span class="sc">/</span> (<span class="fu">max</span>(a) <span class="sc">-</span> <span class="fu">min</span>(a)), </span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">b_MinMax =</span> (b <span class="sc">-</span> <span class="fu">min</span>(b)) <span class="sc">/</span> (<span class="fu">max</span>(b) <span class="sc">-</span> <span class="fu">min</span>(b)),</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">a_ZScore =</span> (a <span class="sc">-</span> <span class="fu">mean</span>(a)) <span class="sc">/</span> <span class="fu">sd</span>(a),</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">b_ZScore =</span> (b <span class="sc">-</span> <span class="fu">mean</span>(b)) <span class="sc">/</span> <span class="fu">sd</span>(b)</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a><span class="co"># ranges for normalized data</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(nrm, range)</span></code></pre></div>
<pre><code>##      a   b a_MinMax b_MinMax  a_ZScore  b_ZScore
## [1,] 0 100        0        0 -1.605793 -1.605793
## [2,] 2 500        1        1  1.605793  1.605793</code></pre>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plots</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(nrm[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], <span class="at">main =</span> <span class="st">&#39;Original&#39;</span>)</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(nrm[, <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>], <span class="at">main =</span> <span class="st">&#39;Min-Max&#39;</span>)</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(nrm[, <span class="dv">5</span><span class="sc">:</span><span class="dv">6</span>], <span class="at">main =</span> <span class="st">&#39;Z-Score&#39;</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<p><strong>Sources</strong><br />
<a href="https://learn.datacamp.com/courses/practicing-machine-learning-interview-questions-in-r">Practicing Machine Learning Interview Questions in R on DataCamp</a></p>
<!--chapter:end:04_primary_data_analysis.Rmd-->
</div>
<div id="statistical-distributions" class="section level1" number="7">
<h1 number="7"><span class="header-section-number">7</span> Statistical distributions</h1>
<div id="normal-distribution" class="section level2" number="7.1">
<h2 number="7.1"><span class="header-section-number">7.1</span> Normal Distribution</h2>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">6</span>, <span class="dv">6</span>, <span class="at">length=</span><span class="dv">100</span>)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>y1 <span class="ot">&lt;-</span> <span class="fu">dnorm</span>(x, <span class="at">sd=</span><span class="dv">1</span>)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>y2 <span class="ot">&lt;-</span> <span class="fu">dnorm</span>(x, <span class="at">sd=</span><span class="fl">0.5</span>)</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>y3 <span class="ot">&lt;-</span> <span class="fu">dnorm</span>(x, <span class="at">sd=</span><span class="dv">2</span>)</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, y1, </span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">6</span>,<span class="dv">6</span>), <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.8</span>),</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>,</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;x value&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;Density&quot;</span>,</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot;Normal distribution&quot;</span>)</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, y2, <span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, y3, <span class="at">col=</span><span class="st">&quot;green&quot;</span>)</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="at">legend=</span><span class="fu">c</span>(<span class="st">&quot;sd = 1&quot;</span>, <span class="st">&quot;sd = 0.5&quot;</span>, <span class="st">&quot;sd = 2&quot;</span>),</span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;green&quot;</span>), </span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">lty=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">lwd=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Area under the curve</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="co"># For normal distribution auc = 1 (probability for all)</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DescTools)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="fu">AUC</span>(x, y1)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AUC</span>(x,y2)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AUC</span>(x,y3) <span class="co"># to broad distribution, some samples out of the area</span></span></code></pre></div>
<pre><code>## [1] 0.9972921</code></pre>
</div>
<div id="bernoulli-distribution" class="section level2" number="7.2">
<h2 number="7.2"><span class="header-section-number">7.2</span> Bernoulli Distribution</h2>
<p><strong>Bernoulli distribution</strong> is the discrete probability distribution of a random variable which takes the value 1 with probability p and the value 0 with probability q=1-p <a href="https://en.wikipedia.org/wiki/Bernoulli_distribution">wiki</a>.<br />
Less formally, it can be thought of as a model for the set of possible outcomes of any single experiment that asks a yes–no question.<br />
The Bernoulli distribution is a special case of the binomial distribution with n=1.<br />
Bernoulli process, a random process consisting of a sequence of independent Bernoulli trials.</p>
</div>
<div id="binomial-distribution" class="section level2" number="7.3">
<h2 number="7.3"><span class="header-section-number">7.3</span> Binomial Distribution</h2>
<p>It describes the outcome of n independent trials in an experiment. Each trial is assumed to have only two outcomes, either success or failure. If the probability of a successful trial is p, then the probability of having x successful outcomes in an experiment of n independent trials is as follows.
<span class="math display">\[f(x) = p^x(1-p)^{(n-x)}\]</span>
where x = 0,1,2,3,4,….
The binomial distribution is the basis for the popular binomial test of statistical significance.</p>
<p>Rules:
1. Must be a fixed number of trials.<br />
2. Trials must be independent (the outcome of one rial does not affect the others).<br />
3. Each trial has only two outcomes: success or failure.<br />
4. The probability of success remains the same in all trials.</p>
<p><span class="math inline">\(n\)</span> - number of trials<br />
<span class="math inline">\(p\)</span> - probability of successful outcome for each trial<br />
<span class="math inline">\(q\)</span> - probability of failure outcome for each trial<br />
<span class="math inline">\(x\)</span> - number of successes<br />
<span class="math inline">\(P(x)\)</span> - probability of the number of successes</p>
<p><span class="math inline">\(q = 1 - p\)</span><br />
<span class="math inline">\(p = 1 - q\)</span></p>
<p><strong>Example</strong></p>
<p>Suppose there are twelve multiple choice questions in an English class quiz. Each question has five possible answers, and only one of them is correct. Find the probability of having four or less correct answers if a student attempts to answer every question at random.</p>
<p>Solution<br />
Since only one out of five possible answers is correct, the probability of answering a question correctly by random is 1/5=0.2. We can find the probability of having exactly 4 correct answers by random attempts as follows.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbinom</span>(<span class="dv">4</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">prob=</span><span class="fl">0.2</span>) </span></code></pre></div>
<pre><code>## [1] 0.1328756</code></pre>
<p>To find the probability of having four or less correct answers by random attempts, we apply the function dbinom with x = 0,…,4.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbinom</span>(<span class="dv">0</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">prob=</span><span class="fl">0.2</span>) <span class="sc">+</span> </span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dbinom</span>(<span class="dv">1</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">prob=</span><span class="fl">0.2</span>) <span class="sc">+</span> </span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dbinom</span>(<span class="dv">2</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">prob=</span><span class="fl">0.2</span>) <span class="sc">+</span> </span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dbinom</span>(<span class="dv">3</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">prob=</span><span class="fl">0.2</span>) <span class="sc">+</span> </span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="fu">dbinom</span>(<span class="dv">4</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">prob=</span><span class="fl">0.2</span>)</span></code></pre></div>
<pre><code>## [1] 0.9274445</code></pre>
<p>Alternatively, we can use the cumulative probability function for binomial distribution pbinom.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pbinom</span>(<span class="dv">4</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">prob=</span><span class="fl">0.2</span>)</span></code></pre></div>
<pre><code>## [1] 0.9274445</code></pre>
<p><strong>Tasks</strong><br />
60% of people who purchase sports cars are men. If 10 sports car owners are randomly selected, find the probability that exactly 7 are men (A: 0.215).</p>
<p><strong>Sources</strong></p>
<p><a href="http://www.r-tutor.com/elementary-statistics/probability-distributions/binomial-distribution">Binomial Distribution</a></p>
<p><a href="https://youtu.be/iGKSxMGX0Do">Statistics Lecture 5.3: A study of Binomial Probability Distributions</a></p>
<p>Youtube ‘Binomial distributions - Probabilities of probabilities’ at 3Blue1Brown channel <a href="https://youtu.be/8idr1WZ1A7Q">part 1</a><a href="https://youtu.be/ZA4JkHKZM50">part 2</a></p>
</div>
<div id="beta-distribution" class="section level2" number="7.4">
<h2 number="7.4"><span class="header-section-number">7.4</span> Beta distribution</h2>
<p>The <strong>beta distribution</strong> is a family of continuous probability distributions defined on
the interval [0, 1] parameterized by two positive <strong>shape parameters</strong>, denoted by <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span>.
<a href="https://en.wikipedia.org/wiki/Beta_distribution">wiki</a>.</p>
</div>
<div id="geometric-distribution" class="section level2" number="7.5">
<h2 number="7.5"><span class="header-section-number">7.5</span> Geometric Distribution</h2>
<p>In probability theory and statistics, the geometric distribution is either one of two discrete probability distributions:</p>
<ul>
<li>The probability distribution of the number X of Bernoulli trials needed to get one success, supported on the set { 1, 2, 3, … }<br />
</li>
<li>The probability distribution of the number Y = X − 1 of failures before the first success, supported on the set { 0, 1, 2, 3, … }<br />
<a href="https://en.wikipedia.org/wiki/Geometric_distribution">wiki</a></li>
</ul>
<p><span class="math display">\[(1 - p)^{k-1} for k trials where k \in {1,2,3,...}\]</span>
<span class="math display">\[(1 - p)^kp for k failures where k \in {0,1,2,...}\]</span></p>
</div>
<div id="uniform-distributions" class="section level2" number="7.6">
<h2 number="7.6"><span class="header-section-number">7.6</span> Uniform Distributions</h2>
<p><strong>Continuous uniform distribution</strong> is a family of symmetric probability distributions. The distribution describes an experiment where there is an arbitrary outcome that lies between certain bounds.<br />
The bounds are defined by the parameters, <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span>, which are the minimum and maximum values. The interval can either be closed <span class="math inline">\([a, b]\)</span> or open <span class="math inline">\((a, b)\)</span>.<br />
Therefore, the distribution is often abbreviated <span class="math inline">\(U(a, b)\)</span>, where <span class="math inline">\(U\)</span> stands for uniform distribution <a href="https://en.wikipedia.org/wiki/Continuous_uniform_distribution">wiki</a>.</p>
<p>Probability density function:<br />
<span class="math display">\[ \begin{cases} \frac{1}{b - a} &amp; \text{for} \, x \in [a,b] \\ 1 &amp; \text{for} \, x &lt; a \, \text{or} \, x\, &gt; b \end{cases}\]</span></p>
</div>
<div id="poisson-distribution" class="section level2" number="7.7">
<h2 number="7.7"><span class="header-section-number">7.7</span> Poisson Distribution</h2>
<p><strong>Poisson distribution</strong> is a discrete probability distribution that expresses the probability of <strong>a given number of events occurring in a
fixed interval of time or space</strong> if these events occur with a known constant mean rate and independently of the time since the last event. <a href="https://en.wikipedia.org/wiki/Poisson_distribution">wiki</a>
Also knows as <strong>Poisson Process</strong>.</p>
<p><span class="math display">\[P(k) = e^{\lambda}\frac{\lambda^k}{k!}\]</span></p>
<p>The Poisson distribution is also the limit of a binomial distribution, for which the probability of success for each trial equals λ divided by the number of trials, as the number of trials approaches infinity.</p>
<p>According to the Central Limit Theorem for big <span class="math inline">\(\lambda\)</span> the Normal distribution will be the approximation for the Poisson distribution.</p>
<p>Criteria of the Poisson process:<br />
1. Events are independent of each other. The occurrence of one event does not affect the probability another event will occur.
2. The average rate (events per time period) is constant.
3. Two events cannot occur at the same time.</p>
<p>Models:<br />
- Number of calls per minute in a call center.<br />
- Number of decay events that occur from a radioactive source in a given observation period.<br />
- The number of meteorites greater than 1 meter diameter that strike Earth in a year.<br />
- The number of patients arriving in an emergency room between 10 and 11 pm.<br />
- The number of laser photons hitting a detector in a particular time interval.</p>
<p>Example:<br />
12 cars cross the bridge in 1 min in average. What is the probability that 17 or more cars will cross the bridge?</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ppois</span>(<span class="dv">16</span>, <span class="at">lambda=</span><span class="dv">12</span>, <span class="at">lower=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## [1] 0.101291</code></pre>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate Poisson</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rpois</span>(<span class="at">n =</span> <span class="dv">10000</span>, <span class="at">lambda =</span> <span class="dv">3</span>)</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(x)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the probability of break-even</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(x <span class="sc">&gt;=</span> <span class="dv">15</span>)</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
</div>
<div id="exponential-distribution" class="section level2" number="7.8">
<h2 number="7.8"><span class="header-section-number">7.8</span> Exponential Distribution</h2>
<p><strong>Exponential distribution</strong> is the probability distribution of the time between events in a Poisson point process, i.e.,
a process in which events occur continuously and independently at a constant average rate. <a href="https://en.wikipedia.org/wiki/Exponential_distribution">wiki</a></p>
<p><span class="math display">\[P(x) = \lambda e ^{ - \lambda x }\]</span></p>
<p>It is a particular case of the gamma distribution.</p>
<p>Suppose the mean checkout time of a supermarket cashier is 3 minutes. Find the probability of a customer checkout being completed by the cashier in less than 2 minutes.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pexp</span>(<span class="dv">2</span>, <span class="at">rate=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] 0.4865829</code></pre>
</div>
<div id="chi-squared-distribution" class="section level2" number="7.9">
<h2 number="7.9"><span class="header-section-number">7.9</span> Chi-squared Distribution</h2>
<p>In probability theory and statistics, the <span class="math inline">\(\{chi}^2\)</span> distribution with k degrees of freedom is the distribution of a sum of the squares of
<span class="math inline">\(k\)</span> independent standard normal random variables. <a href="https://en.wikipedia.org/wiki/Chi-square_distribution">wiki</a>
If <span class="math inline">\(X_1,X_2,…,X_m\)</span> are <span class="math inline">\(m\)</span> independent random variables having the standard normal distribution, then the following quantity follows a <strong>Chi-Squared distribution</strong> with <span class="math inline">\(m\)</span> degrees of freedom. Its mean is <span class="math inline">\(m\)</span>, and its variance is <span class="math inline">\(2m\)</span>.</p>
<p><span class="math display">\[V = X_1^2 + X_2^2 + ... + X_m^{2} \tilde{} X_{(m)}^2\]</span></p>
<p>Summ of squares of standard normal, independen random variables are distributed according to the chi-square distribution with k degrees of freedom, where k is the number of random variables being summed.</p>
<p>Chi-squared distribution applications:<br />
* Chi-square test of independence in contingency tables<br />
* Chi-square test of goodness of fit of observed data to hypothetical distributions<br />
* Likelihood-ratio test for nested models<br />
* Log-rank test in survival analysis<br />
* Cochran–Mantel–Haenszel test for stratified contingency tables</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">25</span>, <span class="at">length=</span><span class="dv">100</span>)</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>v <span class="ot">=</span> <span class="fu">dchisq</span>(x, <span class="at">df=</span><span class="dv">7</span>)</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x,v, <span class="at">type=</span><span class="st">&#39;l&#39;</span>)</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="co"># quantiles of chi-squared</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>q <span class="ot">=</span> <span class="fu">c</span>(.<span class="dv">25</span>, .<span class="dv">5</span>, .<span class="dv">75</span>, .<span class="dv">999</span>)</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>qchi <span class="ot">=</span> <span class="fu">qchisq</span>(q, <span class="at">df =</span> <span class="dv">7</span>, <span class="at">lower.tail =</span> <span class="cn">TRUE</span>)</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span>qchi, <span class="at">lty=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">&#39;red&#39;</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>qchi</span></code></pre></div>
<pre><code>## [1]  4.254852  6.345811  9.037148 24.321886</code></pre>
<p><strong>Sources</strong><br />
<a href="https://towardsdatascience.com/seven-must-know-statistical-distributions-and-their-simulations-for-data-science-681c5ac41e32#:~:text=A%20statistical%20distribution%20is%20a,the%20random%20value%20it%20models.">Seven Must-Know Statistical Distributions and Their Simulations for Data Science</a>
<a href="http://www.r-tutor.com/elementary-statistics/probability-distributions">Probability distributions</a>
Hartmann, K., Krois, J., Waske, B. (2018): E-Learning Project SOGA: Statistics and Geospatial Data Analysis. Department of Earth Sciences, Freie Universitaet Berlin.</p>
<!--chapter:end:05_statistical_distributions.Rmd-->
</div>
</div>
<div id="hypothesis-testing" class="section level1" number="8">
<h1 number="8"><span class="header-section-number">8</span> Hypothesis testing</h1>
<div id="hypothesis-testing-theory" class="section level2" number="8.1">
<h2 number="8.1"><span class="header-section-number">8.1</span> Hypothesis testing theory</h2>
<p>Null hypothesis (H<sub>0</sub>):<br />
1. H<sub>0</sub>: m = μ<br />
2. H<sub>0</sub>: m <span class="math inline">\(\leq\)</span> μ<br />
3. H<sub>0</sub>: m <span class="math inline">\(\geq\)</span> μ</p>
<p>Alternative hypotheses (H<sub>a</sub>):<br />
1. H<sub>a</sub>:m ≠ μ (different)<br />
2. H<sub>a</sub>:m &gt; μ (greater)<br />
3. H<sub>a</sub>:m &lt; μ (less)</p>
<p><em>Note</em>: Hypothesis 1. are called <strong>two-tailed tests</strong> and hypotheses 2. &amp; 3. are called <strong>one-tailed tests</strong>.</p>
<p>The p-value is the probability that the observed data could happen, under the condition that the null hypothesis is true.</p>
<p><em>Note</em>: p-value is not the probability that the null hypothesis is true.<br />
<em>Note</em>: Absence of evidence ⧧ evidence of absence.</p>
<p>Cutoffs for hypothesis testing *p &lt; 0.05, **p &lt; 0.01, ***p &lt; 0.001.<br />
If p value is less than significance level alpha (0.05), the hull hypothesies is rejected.</p>
<table>
<thead>
<tr class="header">
<th></th>
<th>not rejected (‘negative’)</th>
<th>rejected (‘positive’)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>H<sub>0</sub> true</td>
<td>True negative (specificity)</td>
<td>False Positive (Type I error)</td>
</tr>
<tr class="even">
<td>H<sub>0</sub> false</td>
<td>False Negative (Type II error)</td>
<td>True positive (sensitivity)</td>
</tr>
</tbody>
</table>
<p>Type II errors are usually more dangerous.</p>
<p>Significance level <span class="math inline">\(/alpha\)</span> is the probability of mistakenly rejecting the null hypothesis, if the null hypothesis is true. This is also called false positive and type I error.</p>
</div>
<div id="hypothesis-test-practice" class="section level2" number="8.2">
<h2 number="8.2"><span class="header-section-number">8.2</span> Hypothesis test (Practice)</h2>
<ol style="list-style-type: decimal">
<li>Check distribution (is normal?): shapiro.test()<br />
</li>
<li>Distribution uniformity (are both normal?)<br />
</li>
<li>Dependence of variable (are x and y dependent?)<br />
</li>
<li>Difference of distribution parameters (are means different?)</li>
</ol>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="do">###. 1 Is distribution normal?</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>town <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;~/DataAnalysis/DATA/town_1959_2.csv&quot;</span>, <span class="at">header=</span>T, <span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>, <span class="at">dec=</span><span class="st">&quot;.&quot;</span>)</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>town</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="co"># histogram</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(town[,<span class="dv">3</span>])</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a><span class="co"># log scale</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">log</span>(town[,<span class="dv">3</span>]), <span class="at">breaks=</span><span class="dv">50</span>)</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a><span class="co"># ? Is log scaled number of sitizens per town is normally distributed?</span></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a><span class="co"># test for normal distribution of dataset</span></span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">log</span>(town[,<span class="dv">3</span>])</span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(data)</span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a><span class="co"># H0: data is normally distributed</span></span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a><span class="co"># W = 0.97467 - </span></span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a><span class="co"># p-value = 3.15e-12 -&gt; p &lt; alpha (0.01) - H0 is incorrect</span></span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Our distripution is not normal</span></span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Different tests for normality in package &quot;nortest&quot;</span></span>
<span id="cb82-21"><a href="#cb82-21" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;nortest&quot;</span>)</span>
<span id="cb82-22"><a href="#cb82-22" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nortest)</span>
<span id="cb82-23"><a href="#cb82-23" aria-hidden="true" tabindex="-1"></a><span class="fu">ad.test</span>(data)   <span class="co"># Anderson-Darling test</span></span>
<span id="cb82-24"><a href="#cb82-24" aria-hidden="true" tabindex="-1"></a><span class="fu">lillie.test</span>(data) <span class="co"># Lilliefors (Kolmogorov-Smirnov) test</span></span>
<span id="cb82-25"><a href="#cb82-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-26"><a href="#cb82-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Emperical rule: if n &lt; 2000 -&gt; shapiro.test, else -&gt; lillie.test</span></span>
<span id="cb82-27"><a href="#cb82-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-28"><a href="#cb82-28" aria-hidden="true" tabindex="-1"></a><span class="co"># In theory it is possible to use method for normally distributed data, </span></span>
<span id="cb82-29"><a href="#cb82-29" aria-hidden="true" tabindex="-1"></a><span class="co"># even if they are not normal, but almost normal:</span></span>
<span id="cb82-30"><a href="#cb82-30" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. No outlayers</span></span>
<span id="cb82-31"><a href="#cb82-31" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Symmetry of histogram</span></span>
<span id="cb82-32"><a href="#cb82-32" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Bell-shaped form of histogram</span></span>
<span id="cb82-33"><a href="#cb82-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-34"><a href="#cb82-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Method to make normal from not-normal distribution</span></span>
<span id="cb82-35"><a href="#cb82-35" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Remove outlayers</span></span>
<span id="cb82-36"><a href="#cb82-36" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Transform data to get symmetry: log, Boxcox</span></span>
<span id="cb82-37"><a href="#cb82-37" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Bimodality: split samples into groups</span></span>
<span id="cb82-38"><a href="#cb82-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-39"><a href="#cb82-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxcox transformation</span></span>
<span id="cb82-40"><a href="#cb82-40" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;AID&quot;</span>)</span>
<span id="cb82-41"><a href="#cb82-41" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(AID)</span>
<span id="cb82-42"><a href="#cb82-42" aria-hidden="true" tabindex="-1"></a>bctr <span class="ot">=</span> <span class="fu">boxcoxnc</span>(data)</span>
<span id="cb82-43"><a href="#cb82-43" aria-hidden="true" tabindex="-1"></a>bctr<span class="sc">$</span>results</span>
<span id="cb82-44"><a href="#cb82-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-45"><a href="#cb82-45" aria-hidden="true" tabindex="-1"></a><span class="do">### 2. Compair centers of two distributions</span></span>
<span id="cb82-46"><a href="#cb82-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Emperical rule: if notmal -&gt; mean, else -&gt; median</span></span>
<span id="cb82-47"><a href="#cb82-47" aria-hidden="true" tabindex="-1"></a><span class="co"># if median -&gt; Mann–Whitney-Wilcoxon (MWW) test</span></span>
<span id="cb82-48"><a href="#cb82-48" aria-hidden="true" tabindex="-1"></a><span class="co"># if mean -&gt; one of Student&#39;s tests</span></span>
<span id="cb82-49"><a href="#cb82-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-50"><a href="#cb82-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Student t-test</span></span>
<span id="cb82-51"><a href="#cb82-51" aria-hidden="true" tabindex="-1"></a><span class="co"># t.test(x,y, alternative=&quot;two.sided&quot;, paired=FALSE, var.equal=FALSE)</span></span>
<span id="cb82-52"><a href="#cb82-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-53"><a href="#cb82-53" aria-hidden="true" tabindex="-1"></a><span class="co"># How to compair if dispersions are the same?</span></span>
<span id="cb82-54"><a href="#cb82-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Fligner-Killeen test</span></span>
<span id="cb82-55"><a href="#cb82-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Brown-Forsythe test</span></span>
<span id="cb82-56"><a href="#cb82-56" aria-hidden="true" tabindex="-1"></a><span class="co">#fligner.test(x~g, data=data.table)</span></span>
<span id="cb82-57"><a href="#cb82-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-58"><a href="#cb82-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb82-59"><a href="#cb82-59" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">read.table</span> (<span class="st">&quot;~/DataAnalysis/R_data_analysis/DATA/Albuquerque Home Prices_data.txt&quot;</span>, <span class="at">header=</span>T)</span>
<span id="cb82-60"><a href="#cb82-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-61"><a href="#cb82-61" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(x)</span>
<span id="cb82-62"><a href="#cb82-62" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(x)</span>
<span id="cb82-63"><a href="#cb82-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-64"><a href="#cb82-64" aria-hidden="true" tabindex="-1"></a><span class="co"># Change -9999 to NA</span></span>
<span id="cb82-65"><a href="#cb82-65" aria-hidden="true" tabindex="-1"></a>x<span class="sc">$</span>AGE[x<span class="sc">$</span>AGE<span class="sc">==-</span><span class="dv">9999</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb82-66"><a href="#cb82-66" aria-hidden="true" tabindex="-1"></a>x<span class="sc">$</span>TAX[x<span class="sc">$</span>TAX<span class="sc">==-</span><span class="dv">9999</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb82-67"><a href="#cb82-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-68"><a href="#cb82-68" aria-hidden="true" tabindex="-1"></a><span class="fu">fligner.test</span>(PRICE<span class="sc">~</span>COR, <span class="at">data=</span>x)</span>
<span id="cb82-69"><a href="#cb82-69" aria-hidden="true" tabindex="-1"></a><span class="co"># Dispersion is the same for both distribution</span></span>
<span id="cb82-70"><a href="#cb82-70" aria-hidden="true" tabindex="-1"></a><span class="co"># p &gt; alpha (0.01)</span></span>
<span id="cb82-71"><a href="#cb82-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-72"><a href="#cb82-72" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(x<span class="sc">$</span>PRICE[x<span class="sc">$</span>COR<span class="sc">==</span><span class="dv">1</span>], x<span class="sc">$</span>PRICE[x<span class="sc">$</span>COR<span class="sc">==</span><span class="dv">0</span>],</span>
<span id="cb82-73"><a href="#cb82-73" aria-hidden="true" tabindex="-1"></a>       <span class="at">alternative=</span><span class="st">&quot;less&quot;</span>,</span>
<span id="cb82-74"><a href="#cb82-74" aria-hidden="true" tabindex="-1"></a>       <span class="at">paired=</span><span class="cn">FALSE</span>,</span>
<span id="cb82-75"><a href="#cb82-75" aria-hidden="true" tabindex="-1"></a>       <span class="at">var.equal=</span><span class="cn">TRUE</span>)</span>
<span id="cb82-76"><a href="#cb82-76" aria-hidden="true" tabindex="-1"></a><span class="co"># p-value = 0.1977 (H0 is true)</span></span>
<span id="cb82-77"><a href="#cb82-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-78"><a href="#cb82-78" aria-hidden="true" tabindex="-1"></a><span class="co"># Mood&#39;s median test</span></span>
<span id="cb82-79"><a href="#cb82-79" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(x)</span>
<span id="cb82-80"><a href="#cb82-80" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> x[x<span class="sc">$</span>NE<span class="sc">==</span><span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb82-81"><a href="#cb82-81" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> x[x<span class="sc">$</span>NE<span class="sc">==</span><span class="dv">0</span>,<span class="dv">1</span>]</span>
<span id="cb82-82"><a href="#cb82-82" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">median</span>(<span class="fu">c</span>(x1,x2))</span>
<span id="cb82-83"><a href="#cb82-83" aria-hidden="true" tabindex="-1"></a>f11 <span class="ot">&lt;-</span> <span class="fu">sum</span>(x1<span class="sc">&gt;</span>m)</span>
<span id="cb82-84"><a href="#cb82-84" aria-hidden="true" tabindex="-1"></a>f12 <span class="ot">&lt;-</span> <span class="fu">sum</span>(x2<span class="sc">&gt;</span>m)</span>
<span id="cb82-85"><a href="#cb82-85" aria-hidden="true" tabindex="-1"></a>f21 <span class="ot">&lt;-</span> <span class="fu">sum</span>(x1<span class="sc">&lt;=</span>m)</span>
<span id="cb82-86"><a href="#cb82-86" aria-hidden="true" tabindex="-1"></a>f22 <span class="ot">&lt;-</span> <span class="fu">sum</span>(x2<span class="sc">&lt;=</span>m)</span>
<span id="cb82-87"><a href="#cb82-87" aria-hidden="true" tabindex="-1"></a>table <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(f11,f12, f21, f22), <span class="at">nrow=</span><span class="dv">2</span>,<span class="at">ncol=</span><span class="dv">2</span>)</span>
<span id="cb82-88"><a href="#cb82-88" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(table)</span>
<span id="cb82-89"><a href="#cb82-89" aria-hidden="true" tabindex="-1"></a><span class="co"># p=0.47 &gt; alpha=0.05: H0 is true</span></span>
<span id="cb82-90"><a href="#cb82-90" aria-hidden="true" tabindex="-1"></a><span class="co"># medians are the same</span></span>
<span id="cb82-91"><a href="#cb82-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-92"><a href="#cb82-92" aria-hidden="true" tabindex="-1"></a><span class="do">## Mann–Whitney-Wilcoxon (MWW) test</span></span>
<span id="cb82-93"><a href="#cb82-93" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if medians are the same</span></span>
<span id="cb82-94"><a href="#cb82-94" aria-hidden="true" tabindex="-1"></a><span class="co"># U1 = n1*n2+{n1*(n1+1)/2 - T1}</span></span>
<span id="cb82-95"><a href="#cb82-95" aria-hidden="true" tabindex="-1"></a><span class="co"># U1 = n1*n2+{n2*(n2+1)/2 - T2}</span></span>
<span id="cb82-96"><a href="#cb82-96" aria-hidden="true" tabindex="-1"></a><span class="co"># U=min(U1,U2)</span></span>
<span id="cb82-97"><a href="#cb82-97" aria-hidden="true" tabindex="-1"></a><span class="co"># Ti - сумма рангов в объединенной выборке наблюдений из выборки i</span></span>
<span id="cb82-98"><a href="#cb82-98" aria-hidden="true" tabindex="-1"></a><span class="co"># n1, n2 - размеры выборок</span></span>
<span id="cb82-99"><a href="#cb82-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-100"><a href="#cb82-100" aria-hidden="true" tabindex="-1"></a><span class="fu">wilcox.test</span>(x,y,</span>
<span id="cb82-101"><a href="#cb82-101" aria-hidden="true" tabindex="-1"></a>            <span class="at">alternative=</span><span class="st">&quot;two.sided&quot;</span>,</span>
<span id="cb82-102"><a href="#cb82-102" aria-hidden="true" tabindex="-1"></a>            <span class="at">paired=</span><span class="cn">FALSE</span>,</span>
<span id="cb82-103"><a href="#cb82-103" aria-hidden="true" tabindex="-1"></a>            <span class="at">exact=</span><span class="cn">TRUE</span>,</span>
<span id="cb82-104"><a href="#cb82-104" aria-hidden="true" tabindex="-1"></a>            <span class="at">correct=</span><span class="cn">FALSE</span>)</span>
<span id="cb82-105"><a href="#cb82-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-106"><a href="#cb82-106" aria-hidden="true" tabindex="-1"></a><span class="do">###. 3. Dependency of variables</span></span>
<span id="cb82-107"><a href="#cb82-107" aria-hidden="true" tabindex="-1"></a><span class="co"># H0: x, y independent</span></span>
<span id="cb82-108"><a href="#cb82-108" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation analysis</span></span>
<span id="cb82-109"><a href="#cb82-109" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation (pearson) mesure linear dependency!</span></span>
<span id="cb82-110"><a href="#cb82-110" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation k depends on outlayers (must be removed)</span></span>
<span id="cb82-111"><a href="#cb82-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-112"><a href="#cb82-112" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x<span class="sc">$</span>SQFT, x<span class="sc">$</span>TAX)</span>
<span id="cb82-113"><a href="#cb82-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-114"><a href="#cb82-114" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(x<span class="sc">$</span>SQFT, x<span class="sc">$</span>TAX, <span class="at">use =</span> <span class="st">&quot;complete.obs&quot;</span>)</span>
<span id="cb82-115"><a href="#cb82-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-116"><a href="#cb82-116" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(x<span class="sc">$</span>SQFT, x<span class="sc">$</span>TAX, <span class="at">use =</span> <span class="st">&quot;complete.obs&quot;</span>, <span class="at">method =</span> <span class="st">&quot;spearman&quot;</span>)</span>
<span id="cb82-117"><a href="#cb82-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-118"><a href="#cb82-118" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(x, <span class="at">use =</span> <span class="st">&quot;complete.obs&quot;</span>, <span class="at">method =</span> <span class="st">&quot;spearman&quot;</span>)</span>
<span id="cb82-119"><a href="#cb82-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-120"><a href="#cb82-120" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(x, <span class="at">use =</span> <span class="st">&quot;complete.obs&quot;</span>, <span class="at">method =</span> <span class="st">&quot;pearson&quot;</span>)</span>
<span id="cb82-121"><a href="#cb82-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-122"><a href="#cb82-122" aria-hidden="true" tabindex="-1"></a><span class="fu">cor.test</span>(x<span class="sc">$</span>SQFT, x<span class="sc">$</span>TAX, <span class="at">use =</span> <span class="st">&quot;complete.obs&quot;</span>)</span></code></pre></div>
<!--chapter:end:06_hypothesis_testing.Rmd-->
</div>
</div>
<div id="t-procedures" class="section level1" number="9">
<h1 number="9"><span class="header-section-number">9</span> t-Procedures</h1>
<div id="t-test-and-normal-distribution" class="section level2" number="9.1">
<h2 number="9.1"><span class="header-section-number">9.1</span> t-test and normal distribution</h2>
<p>t-distribution assumes that the observations are <strong>independent</strong> and that they follow a <strong>normal distribution</strong>.
If the data are <strong>dependent</strong>, then p-values will likely be totally wrong (e.g., for positive correlation, too optimistic). Type II errors?<br />
It is good to test if observations are normally distributed. Otherwise we assume that data is normally distributed.<br />
Independence of observations is usually not testable, but can be reasonably assumed if the data collection process was random without replacement.</p>
<p>FIXME: I do not understand this. Deviation data from normalyty will lead to type-I errors. I data is deviated from normal distribution, use <strong>Wilcoxon test</strong> or <strong>permutation tests</strong>.</p>
</div>
<div id="one-sample-t-test" class="section level2" number="9.2">
<h2 number="9.2"><span class="header-section-number">9.2</span> One-sample t-test</h2>
<p>One-sample t-test is used to compare the mean of one sample to a known standard (or theoretical/hypothetical) mean (μ).<br />
t-statistics:
<span class="math inline">\(t = \frac{m - \mu}{s/\sqrt{n}}\)</span>, where<br />
<strong>m</strong> is the sample <strong>mean</strong><br />
<strong>n</strong> is the sample <strong>size</strong><br />
<strong>s</strong> is the sample <strong>standard deviation</strong> with n−1 <strong>degrees of freedom</strong><br />
<strong>μ</strong> is the <strong>theoretical value</strong></p>
<p>Q: And what should I do with this t-statistics?<br />
Q: What is the difference between t-test and ANOVA?<br />
Q: What is the smallest sample size which can be tested by t-test?<br />
Q: Show diagrams explaining why p-value of one-sided is smaller than two-sided tests.</p>
</div>
<div id="practical-example-t-test-in-r" class="section level2" number="9.3">
<h2 number="9.3"><span class="header-section-number">9.3</span> Practical example: t-test in R</h2>
<p>We want to test if <strong>N</strong> is different from given mean <strong>μ</strong>=0:</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>N <span class="ot">=</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.01</span>, <span class="fl">0.65</span>, <span class="sc">-</span><span class="fl">0.17</span>, <span class="fl">1.77</span>, <span class="fl">0.76</span>, <span class="sc">-</span><span class="fl">0.16</span>, <span class="fl">0.88</span>, <span class="fl">1.09</span>, <span class="fl">0.96</span>, <span class="fl">0.25</span>)</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(N, <span class="at">mu =</span> <span class="dv">0</span>, <span class="at">alternative =</span> <span class="st">&quot;less&quot;</span>)</span></code></pre></div>
<pre><code>## 
##  One Sample t-test
## 
## data:  N
## t = 3.0483, df = 9, p-value = 0.9931
## alternative hypothesis: true mean is less than 0
## 95 percent confidence interval:
##      -Inf 0.964019
## sample estimates:
## mean of x 
##     0.602</code></pre>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(N, <span class="at">mu =</span> <span class="dv">0</span>, <span class="at">alternative =</span> <span class="st">&quot;two.sided&quot;</span>)</span></code></pre></div>
<pre><code>## 
##  One Sample t-test
## 
## data:  N
## t = 3.0483, df = 9, p-value = 0.01383
## alternative hypothesis: true mean is not equal to 0
## 95 percent confidence interval:
##  0.1552496 1.0487504
## sample estimates:
## mean of x 
##     0.602</code></pre>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(N, <span class="at">mu =</span> <span class="dv">0</span>, <span class="at">alternative =</span> <span class="st">&quot;greater&quot;</span>)</span></code></pre></div>
<pre><code>## 
##  One Sample t-test
## 
## data:  N
## t = 3.0483, df = 9, p-value = 0.006916
## alternative hypothesis: true mean is greater than 0
## 95 percent confidence interval:
##  0.239981      Inf
## sample estimates:
## mean of x 
##     0.602</code></pre>
<p>FIXME: why it accepts all alternatives at the same time (less and greater?)</p>
</div>
<div id="two-samples-t-test" class="section level2" number="9.4">
<h2 number="9.4"><span class="header-section-number">9.4</span> Two samples t-test</h2>
<p>Do two different samples have the same mean?<br />
H<sub>0</sub>:<br />
1. H<sub>0</sub>: m<sub>1</sub> - m<sub>2</sub> = 0<br />
2. H<sub>0</sub>: m<sub>1</sub> - m<sub>2</sub> <span class="math inline">\(\leq\)</span> 0<br />
3. H<sub>0</sub>: m<sub>1</sub> - m<sub>2</sub> <span class="math inline">\(\geq\)</span> 0</p>
<p>H<sub>a</sub>:<br />
1. H<sub>a</sub>: m<sub>1</sub> - m<sub>2</sub> ≠ 0 (different)<br />
2. H<sub>a</sub>: m<sub>1</sub> - m<sub>2</sub> &gt; 0 (greater)<br />
3. H<sub>a</sub>: m<sub>1</sub> - m<sub>2</sub> &lt; 0 (less)</p>
<p>The paired sample t-test has four main assumptions:</p>
<ol style="list-style-type: decimal">
<li>The dependent variable must be <strong>continuous</strong> (interval/ratio).<br />
</li>
<li>The observations are <strong>independent</strong> of one another.<br />
</li>
<li>The dependent variable should be approximately <strong>normally distributed</strong>.<br />
</li>
<li>The dependent variable should not contain any <strong>outliers</strong>.</li>
</ol>
<p>Continuous data can take on any value within a range (income, height, weight, etc.). The opposite of continuous data is discrete data, which can only take on a few values (Low, Medium, High, etc.). Occasionally, discrete data can be used to approximate a continuous scale, such as with <strong>Likert-type scales</strong>.</p>
<p>t-statistics:
<span class="math inline">\(t=\frac{y - x}{SE}\)</span>, where
y and x are the samples means.
SE is the standard error for the difference.
If H<sub>0</sub> is correct, test statistic follows a t-distribution with n+m-2 degrees of freedom (n, m the number of observations in each sample).</p>
<p>To apply t-test samples must be tested if they have equal variance:<br />
equal variance (homoscedastic). Type 3 means two samples, unequal variance (heteroscedastic).</p>
</div>
<div id="compare-students-t-and-normal-distributions" class="section level2" number="9.5">
<h2 number="9.5"><span class="header-section-number">9.5</span> Compare Student’s t and normal distributions</h2>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">4</span>, <span class="at">length=</span><span class="dv">100</span>)</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>hx <span class="ot">&lt;-</span> <span class="fu">dnorm</span>(x)</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>degf <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">8</span>, <span class="dv">30</span>)</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;darkgreen&quot;</span>, <span class="st">&quot;gold&quot;</span>, <span class="st">&quot;black&quot;</span>)</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;df=1&quot;</span>, <span class="st">&quot;df=3&quot;</span>, <span class="st">&quot;df=8&quot;</span>, <span class="st">&quot;df=30&quot;</span>, <span class="st">&quot;normal&quot;</span>)</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, hx, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lty=</span><span class="dv">2</span>, <span class="at">xlab=</span><span class="st">&quot;x value&quot;</span>,</span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">&quot;Density&quot;</span>, <span class="at">main=</span><span class="st">&quot;Comparison of t Distributions&quot;</span>)</span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>){</span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines</span>(x, <span class="fu">dt</span>(x,degf[i]), <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">col=</span>colors[i])</span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="at">inset=</span>.<span class="dv">05</span>, <span class="at">title=</span><span class="st">&quot;Distributions&quot;</span>,</span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true" tabindex="-1"></a>       labels, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">lty=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>), <span class="at">col=</span>colors)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<p>To generate data with known mean and sd:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>rnorm2 <span class="ot">&lt;-</span> <span class="cf">function</span>(n,mean,sd) { mean<span class="sc">+</span>sd<span class="sc">*</span><span class="fu">scale</span>(<span class="fu">rnorm</span>(n)) }</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">rnorm2</span>(<span class="dv">100</span>,<span class="dv">4</span>,<span class="dv">1</span>)</span></code></pre></div>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="do">### t-test</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>a <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">175</span>, <span class="dv">168</span>, <span class="dv">168</span>, <span class="dv">190</span>, <span class="dv">156</span>, <span class="dv">181</span>, <span class="dv">182</span>, <span class="dv">175</span>, <span class="dv">174</span>, <span class="dv">179</span>)</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>b <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">185</span>, <span class="dv">169</span>, <span class="dv">173</span>, <span class="dv">173</span>, <span class="dv">188</span>, <span class="dv">186</span>, <span class="dv">175</span>, <span class="dv">174</span>, <span class="dv">179</span>, <span class="dv">180</span>)</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a><span class="co"># test homogeneity of variances using Fisher’s F-test</span></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a><span class="fu">var.test</span>(a,b)</span></code></pre></div>
<pre><code>## 
##  F test to compare two variances
## 
## data:  a and b
## F = 2.1028, num df = 9, denom df = 9, p-value = 0.2834
## alternative hypothesis: true ratio of variances is not equal to 1
## 95 percent confidence interval:
##  0.5223017 8.4657950
## sample estimates:
## ratio of variances 
##           2.102784</code></pre>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># variance is homogene (can use var.equal=T in t.test)</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a><span class="co"># t-test</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(a,b, </span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">var.equal=</span><span class="cn">TRUE</span>,   <span class="co"># variance is homogene (tested by var.test(a,b)) </span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">paired=</span><span class="cn">FALSE</span>)     <span class="co"># samples are independent</span></span></code></pre></div>
<pre><code>## 
##  Two Sample t-test
## 
## data:  a and b
## t = -0.94737, df = 18, p-value = 0.356
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -10.93994   4.13994
## sample estimates:
## mean of x mean of y 
##     174.8     178.2</code></pre>
</div>
<div id="non-parametric-tests" class="section level2" number="9.6">
<h2 number="9.6"><span class="header-section-number">9.6</span> Non-parametric tests</h2>
</div>
<div id="mann-whitney-u-rank-sum-test" class="section level2" number="9.7">
<h2 number="9.7"><span class="header-section-number">9.7</span> Mann-Whitney U Rank Sum Test</h2>
<ol style="list-style-type: decimal">
<li>The dependent variable is ordinal or continuous.<br />
</li>
<li>The data consist of a randomly selected sample of independent observations from two independent groups.<br />
</li>
<li>The dependent variables for the two independent groups share a similar shape.</li>
</ol>
</div>
<div id="wilcoxon-test" class="section level2" number="9.8">
<h2 number="9.8"><span class="header-section-number">9.8</span> Wilcoxon test</h2>
<p>The <strong>Wilcoxon</strong> is a <strong>non-parametric test</strong> which works on normal and non-normal data. However, we usually prefer not to use it if we can assume that the data is normally distributed. The non-parametric test comes with less statistical power, this is a price that one has to pay for more flexible assumptions.</p>
</div>
</div>
<div id="tests-for-categorical-variables" class="section level1" number="10">
<h1 number="10"><span class="header-section-number">10</span> Tests for categorical variables</h1>
<p><strong>Categorical variable</strong> can take fixed number of possible values, assigning each individual or other unit of observation to a particular group or nominal category on the basis of some qualitative property.</p>
<div id="chi-squared-tests" class="section level2" number="10.1">
<h2 number="10.1"><span class="header-section-number">10.1</span> Chi-squared tests</h2>
<p>The chi-squared test is most suited to large datasets. As a general rule, the chi-squared test is appropriate if at least 80% of the cells have an expected frequency of 5 or greater. In addition, none of the cells should have an expected frequency less than 1. If the expected values are very small, categories may be combined (if it makes sense to do so) to create fewer larger categories. Alternatively, Fisher’s exact test can be used.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">83</span>,<span class="dv">35</span>), <span class="fu">c</span>(<span class="dv">92</span>,<span class="dv">43</span>))</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>data</span></code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]   83   35
## [2,]   92   43</code></pre>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(data, <span class="at">correct=</span>F)</span></code></pre></div>
<pre><code>## 
##  Pearson&#39;s Chi-squared test
## 
## data:  data
## X-squared = 0.14172, df = 1, p-value = 0.7066</code></pre>
<p>chisq.test(testor,correct=F)
## Fisher’s Exact test
R Example:</p>
<table>
<thead>
<tr class="header">
<th>Group</th>
<th>TumourShrinkage-No</th>
<th>TumourShrinkage-Yes</th>
<th>Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1 Treatment</td>
<td>8</td>
<td>3</td>
<td>11</td>
</tr>
<tr class="even">
<td>2 Placebo</td>
<td>9</td>
<td>4</td>
<td>13</td>
</tr>
<tr class="odd">
<td>3 Total</td>
<td>17</td>
<td>7</td>
<td>24</td>
</tr>
</tbody>
</table>
<p>The <strong>null hypothesis</strong> is that there is <strong>no association</strong> between treatment and tumour shrinkage.<br />
The <strong>alternative hypothesis</strong> is that there is <strong>some association</strong> between treatment group and tumour shrinkage.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">8</span>,<span class="dv">3</span>), <span class="fu">c</span>(<span class="dv">9</span>,<span class="dv">4</span>))</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>data</span></code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]    8    3
## [2,]    9    4</code></pre>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fisher.test</span>(data)</span></code></pre></div>
<pre><code>## 
##  Fisher&#39;s Exact Test for Count Data
## 
## data:  data
## p-value = 1
## alternative hypothesis: true odds ratio is not equal to 1
## 95 percent confidence interval:
##   0.1456912 10.6433317
## sample estimates:
## odds ratio 
##   1.176844</code></pre>
<p>The output Fisher’s exact test tells us that the probability of observing such an extreme combination of frequencies is high, our p-value is 1.000 which is clearly greater than 0.05. In this case, there is <strong>no evidence of an association</strong> between treatment group and tumour shrinkage.</p>
</div>
</div>
<div id="multiple-testing" class="section level1" number="11">
<h1 number="11"><span class="header-section-number">11</span> Multiple testing</h1>
<p>When performing a large number of tests, the type I error is inflated: for α=0.05 and performing n tests, the probability of no false positive result is:
0.095 x 0.95 x … (n-times) &lt;&lt;&lt; 0.095<br />
The larger the number of tests performed, the higher the probability of a false rejection!<br />
Many data analysis approaches in genomics rely on itemby-item (i.e. multiple) testing:<br />
Microarray or RNA-Seq expression profiles of “normal” vs “perturbed” samples: gene-by-gene<br />
ChIP-chip: locus-by-locus<br />
RNAi and chemical compound screens<br />
Genome-wide association studies: marker-by-marker<br />
QTL analysis: marker-by-marker and trait-by-trait</p>
<p><strong>False positive rate</strong> (FPR) - the proportion of false positives among all resulst.</p>
<p><strong>False discovery rate</strong> (FDR) - the proportion of false positives among all significant results.</p>
<p>Example: 20,000 genes, 100 hits, 10 of them wrong.<br />
FPR: 0.05%<br />
FDR: 10%</p>
<div id="the-bonferroni-correction" class="section level2" number="11.1">
<h2 number="11.1"><span class="header-section-number">11.1</span> The Bonferroni correction</h2>
<p>The Bonferroni correction sets the significance cut-off at α/n. </p>
</div>
</div>
<div id="sources" class="section level1" number="12">
<h1 number="12"><span class="header-section-number">12</span> Sources</h1>
<p><a href="http://www.sthda.com/english/wiki/one-sample-t-test-in-r">One-Sample T-test in R</a></p>
<div id="t-test-1" class="section level2" number="12.1">
<h2 number="12.1"><span class="header-section-number">12.1</span> t-test</h2>
<p>The data set shows energy expend in two groups of women: stature</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ISwR)</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(energy)</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(energy)</span></code></pre></div>
<pre><code>## The following objects are masked from energy (pos = 4):
## 
##     expend, stature</code></pre>
<pre><code>## The following objects are masked from energy (pos = 9):
## 
##     expend, stature</code></pre>
<pre><code>## The following objects are masked from energy (pos = 11):
## 
##     expend, stature</code></pre>
<pre><code>## The following objects are masked from energy (pos = 30):
## 
##     expend, stature</code></pre>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(energy)</span></code></pre></div>
<pre><code>##   expend stature
## 1   9.21   obese
## 2   7.53    lean
## 3   7.48    lean
## 4   8.08    lean
## 5   8.09    lean
## 6  10.15    lean</code></pre>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tapply</span>(expend, stature, mean)</span></code></pre></div>
<pre><code>##      lean     obese 
##  8.066154 10.297778</code></pre>
<p>H<sub>0</sub>: there is no difference in averages between lean and obese.</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(expend <span class="sc">~</span> stature)</span></code></pre></div>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  expend by stature
## t = -3.8555, df = 15.919, p-value = 0.001411
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -3.459167 -1.004081
## sample estimates:
##  mean in group lean mean in group obese 
##            8.066154           10.297778</code></pre>
<p>Alternative hypothesis is true - means are different.<br />
Mean difference is in between -3.5 and 1.0 with a probability 95%.<br />
The risk of error is 0.15%</p>
<div id="two-tailed-test" class="section level3" number="12.1.1">
<h3 number="12.1.1"><span class="header-section-number">12.1.1</span> Two-tailed test</h3>
<p>Compair two sets of variables.</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(intake) <span class="co"># from package ISwR</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(intake)</span></code></pre></div>
<pre><code>## The following objects are masked from intake (pos = 4):
## 
##     post, pre</code></pre>
<pre><code>## The following objects are masked from intake (pos = 9):
## 
##     post, pre</code></pre>
<pre><code>## The following objects are masked from intake (pos = 11):
## 
##     post, pre</code></pre>
<pre><code>## The following objects are masked from intake (pos = 30):
## 
##     post, pre</code></pre>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(intake)</span></code></pre></div>
<pre><code>##    pre post
## 1 5260 3910
## 2 5470 4220
## 3 5640 3885
## 4 6180 5160
## 5 6390 5645
## 6 6515 4680</code></pre>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(post <span class="sc">-</span> pre)</span></code></pre></div>
<pre><code>## [1] -1320.455</code></pre>
<p>Is difference of means significant?</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(pre, post, <span class="at">paired=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## 
##  Paired t-test
## 
## data:  pre and post
## t = 11.941, df = 10, p-value = 3.059e-07
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  1074.072 1566.838
## sample estimates:
## mean of the differences 
##                1320.455</code></pre>
<p>The difference is significant with a probability 95%.<br />
The difference is in between 1074.1 and 1566.8 kJ/day</p>
<!--chapter:end:06_t_tests.Rmd-->
</div>
</div>
</div>
<div id="analysis-of-variance-anova" class="section level1" number="13">
<h1 number="13"><span class="header-section-number">13</span> Analysis of Variance (ANOVA)</h1>
<div id="one-way-anova" class="section level2" number="13.1">
<h2 number="13.1"><span class="header-section-number">13.1</span> One-way ANOVA</h2>
<p><strong>variance</strong> = SS/df, where SS - sum of squares and df - degree of freedom<br />
<span class="math inline">\(SS = \displaystyle\sum_{i=1}^{n}{(x_i - \mu)^2}\)</span>, where<br />
<span class="math inline">\(\mu\)</span> is the sample <strong>mean</strong><br />
<strong>n</strong> is the sample <strong>size</strong></p>
<p><span class="math inline">\(var(x) = \frac{1}{n}{\displaystyle\sum_{i=1}^{n}{(x_i - \mu)^2}}\)</span></p>
<p>SST = SSE + SSC = W + B, where<br />
SST - Total Sum of Squares<br />
SSE - Error Sum of Squares - within (W)<br />
SSC - Sum of Squares Columns (treatmens) - between (B)</p>
<p>C - columns (treatments)<br />
N - total number of observations</p>
<p>Mean squared of columns - MSC = SSC/df_columns, where df_columns = C-1<br />
Mean squared of error - MSE = SSE/df_error, where df_error = N-C<br />
Sum of squares (total) - SST, where df_total = N-1
F-statistics - F = MSC/MSE</p>
<p>Let’s calculate degree of freedom for our example:<br />
df_columns = 3-1 = 2, MSC = SSC/2<br />
df_error = 21-3 = 18, MSE = SSE/18<br />
df_total = 21-1 = 20</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3 groups of students with scores (1-100):</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>a <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">82</span>,<span class="dv">93</span>,<span class="dv">61</span>,<span class="dv">74</span>,<span class="dv">69</span>,<span class="dv">70</span>,<span class="dv">53</span>)</span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>b <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">71</span>,<span class="dv">62</span>,<span class="dv">85</span>,<span class="dv">94</span>,<span class="dv">78</span>,<span class="dv">66</span>,<span class="dv">71</span>)</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>c <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">64</span>,<span class="dv">73</span>,<span class="dv">87</span>,<span class="dv">91</span>,<span class="dv">56</span>,<span class="dv">78</span>,<span class="dv">87</span>)</span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>sq <span class="ot">=</span> <span class="cf">function</span>(x) { <span class="fu">sum</span>((x <span class="sc">-</span> <span class="fu">mean</span>(x))<span class="sc">^</span><span class="dv">2</span>) }</span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a><span class="fu">sq</span>(a)</span></code></pre></div>
<pre><code>## [1] 1039.429</code></pre>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sq</span>(b)</span></code></pre></div>
<pre><code>## [1] 751.4286</code></pre>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sq</span>(c)</span></code></pre></div>
<pre><code>## [1] 1021.714</code></pre>
<p>Using R packages:</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="co"># data</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of calories consumed by month:</span></span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>may <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2166</span>, <span class="dv">1568</span>, <span class="dv">2233</span>, <span class="dv">1882</span>, <span class="dv">2019</span>)</span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>sep <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2279</span>, <span class="dv">2075</span>, <span class="dv">2131</span>, <span class="dv">2009</span>, <span class="dv">1793</span>)</span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>dec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2226</span>, <span class="dv">2154</span>, <span class="dv">2583</span>, <span class="dv">2010</span>, <span class="dv">2190</span>)</span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">stack</span>(<span class="fu">list</span>(<span class="at">may=</span>may, <span class="at">sep=</span>sep, <span class="at">dec=</span>dec))</span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a>d</span></code></pre></div>
<pre><code>##    values ind
## 1    2166 may
## 2    1568 may
## 3    2233 may
## 4    1882 may
## 5    2019 may
## 6    2279 sep
## 7    2075 sep
## 8    2131 sep
## 9    2009 sep
## 10   1793 sep
## 11   2226 dec
## 12   2154 dec
## 13   2583 dec
## 14   2010 dec
## 15   2190 dec</code></pre>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(d)</span></code></pre></div>
<pre><code>## [1] &quot;values&quot; &quot;ind&quot;</code></pre>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="fu">oneway.test</span>(values <span class="sc">~</span> ind, <span class="at">data=</span>d, <span class="at">var.equal=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## 
##  One-way analysis of means
## 
## data:  values and ind
## F = 1.7862, num df = 2, denom df = 12, p-value = 0.2094</code></pre>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="co"># alternative using aov</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">aov</span>(values <span class="sc">~</span> ind, <span class="at">data =</span> d)</span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>res</span></code></pre></div>
<pre><code>## Call:
##    aov(formula = values ~ ind, data = d)
## 
## Terms:
##                      ind Residuals
## Sum of Squares  174664.1  586719.6
## Deg. of Freedom        2        12
## 
## Residual standard error: 221.1183
## Estimated effects may be unbalanced</code></pre>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(res)</span></code></pre></div>
<pre><code>##             Df Sum Sq Mean Sq F value Pr(&gt;F)
## ind          2 174664   87332   1.786  0.209
## Residuals   12 586720   48893</code></pre>
</div>
<div id="sources-1" class="section level2" number="13.2">
<h2 number="13.2"><span class="header-section-number">13.2</span> Sources</h2>
<p>Example for one-way ANOVA: <a href="https://www.youtube.com/playlist?list=PLIeGtxpvyG-KA-BLkL391X__r0kU4_hm5">youtube</a> by Brandon Foltz</p>
<!--chapter:end:07_anova.Rmd-->
</div>
</div>
<div id="t-test-anova-difference" class="section level1" number="14">
<h1 number="14"><span class="header-section-number">14</span> t-test ANOVA difference</h1>
<p>The t-test and ANOVA examine whether group means differ from one another. The t-test compares two groups, while ANOVA can do more than two groups.
The t-test ANOVA have three assumptions: independence assumption (the elements of one sample are not related to those of the other sample), normality assumption (samples are randomly drawn from the normally distributed populstions with unknown population means; otherwise the means are no longer best measures of central tendency, thus test will not be valid), and equal variance assumption (the population variances of the two groups are equal)
ANCOVA (analysis of covariance) includes covariates, interval independent variables, in the right-hand side to control their impacts. MANOVA (multivariate analysis of variance) has more than one left-hand side variable.</p>
<div class="figure">
<img src="_bookdown_files/images/anova.gif" alt="" />
<p class="caption">t-test and ANOVA usage.</p>
</div>
<!--chapter:end:07_ttest_anova_dif.Rmd-->
</div>
<div id="chi-squared-test" class="section level1" number="15">
<h1 number="15"><span class="header-section-number">15</span> Chi-squared test</h1>
<div id="multinomial-goodness-of-fit" class="section level2" number="15.1">
<h2 number="15.1"><span class="header-section-number">15.1</span> Multinomial Goodness of Fit</h2>
<p>A population is called multinomial if its data is categorical and belongs to a collection of discrete non-overlapping classes.</p>
<p>The null hypothesis for goodness of fit test for multinomial distribution is that the observed frequency fi is equal to an expected count <span class="math display">\[e_i\]</span> in each category.
It is to be rejected if the p-value of the following <strong>Chi-squared test</strong> statistics is less than a given significance level α.</p>
<p>Example
Survey response about the student’s smoking habit: “Heavy,” “Regul” (regularly), “Occas” (occasionally) and “Never.”
The Smoke data is multinomial.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(survey<span class="sc">$</span>Smoke) </span></code></pre></div>
<pre><code>## [1] &quot;Heavy&quot; &quot;Never&quot; &quot;Occas&quot; &quot;Regul&quot;</code></pre>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>smoke_freq <span class="ot">=</span> <span class="fu">table</span>(survey<span class="sc">$</span>Smoke) </span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>smoke_freq</span></code></pre></div>
<pre><code>## 
## Heavy Never Occas Regul 
##    11   189    19    17</code></pre>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="co"># estimated probabilities</span></span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>smoke_prob <span class="ot">=</span> <span class="fu">c</span>(<span class="at">heavy =</span> .<span class="dv">045</span>, </span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">never =</span> .<span class="dv">795</span>, </span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">occas =</span> .<span class="dv">085</span>, </span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">regul =</span> .<span class="dv">075</span>)</span></code></pre></div>
<p>Determine whether the sample data in <em>smoke_freq</em> supports estimated probabilities in <em>smoke_prob</em> at .05 significance level.</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(smoke_freq, <span class="at">p=</span>smoke_prob)</span></code></pre></div>
<pre><code>## 
##  Chi-squared test for given probabilities
## 
## data:  smoke_freq
## X-squared = 0.10744, df = 3, p-value = 0.9909</code></pre>
<p>As the p-value 0.991 is greater than the .05 significance level, we do not reject the null hypothesis that the sample data in survey supports the smoking statistics.</p>
<p><strong>Sources</strong></p>
<p><a href="https://www.r-tutor.com/elementary-statistics/goodness-fit/multinomial-goodness-fit">Multinomial Goodness of Fit</a></p>
<!--chapter:end:08_chi_squared_test.Rmd-->
</div>
</div>
<div id="non-parametric-methods" class="section level1" number="16">
<h1 number="16"><span class="header-section-number">16</span> Non-parametric Methods</h1>
<p>A statistical method is called non-parametric if it makes no assumption on the population distribution or sample size.</p>
<p>This is in contrast with most parametric methods in elementary statistics that assume the data is quantitative, the population has a normal distribution and the sample size is sufficiently large.</p>
<p>In general, conclusions drawn from non-parametric methods are not as powerful as the parametric ones. However, as non-parametric methods make fewer assumptions, they are more flexible, more robust, and applicable to non-quantitative data.</p>
<div id="sign-test" class="section level2" number="16.1">
<h2 number="16.1"><span class="header-section-number">16.1</span> Sign Test</h2>
</div>
<div id="wilcoxon-signed-rank-test" class="section level2" number="16.2">
<h2 number="16.2"><span class="header-section-number">16.2</span> Wilcoxon Signed-Rank Test</h2>
</div>
<div id="mann-whitney-wilcoxon-test" class="section level2" number="16.3">
<h2 number="16.3"><span class="header-section-number">16.3</span> Mann-Whitney-Wilcoxon Test</h2>
</div>
<div id="kruskal-wallis-test" class="section level2" number="16.4">
<h2 number="16.4"><span class="header-section-number">16.4</span> Kruskal-Wallis Test</h2>
<!--chapter:end:08_non-parametric_tests.Rmd-->
</div>
</div>
<div id="wilcoxon-signed-rank-test-1" class="section level1" number="17">
<h1 number="17"><span class="header-section-number">17</span> Wilcoxon signed-rank test</h1>
<p>The Wilcoxon signed-rank test is a non-parametric statistical hypothesis test used to compare two related samples,
matched samples, or repeated measurements on a single sample to assess whether their population mean ranks differ
(i.e. it is a paired difference test). It can be used as an alternative to the paired Student’s t-test
(also known as “t-test for matched pairs” or “t-test for dependent samples”) when the distribution of the
difference between two samples’ means cannot be assumed to be normally distributed. A Wilcoxon signed-rank test can be
used to determine whether two dependent samples were selected from populations having the same distribution.
<a href="https://en.wikipedia.org/wiki/Wilcoxon_signed-rank_test">wiki</a></p>
<p>Two data samples are matched if they come from repeated observations of the same subject.
Using the Wilcoxon Signed-Rank Test, we can decide whether the corresponding data population distributions are
identical without assuming them to follow the normal distribution.</p>
<p>Example
In the built-in data set named immer, the barley yield in years 1931 and 1932 of the same field are recorded.
The yield data are presented in the data frame columns Y1 and Y2.</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(immer)</span></code></pre></div>
<pre><code>##   Loc Var    Y1    Y2
## 1  UF   M  81.0  80.7
## 2  UF   S 105.4  82.3
## 3  UF   V 119.7  80.4
## 4  UF   T 109.7  87.2
## 5  UF   P  98.3  84.2
## 6   W   M 146.6 100.4</code></pre>
<p>Problem
Without assuming the data to have normal distribution, test at .05 significance level if the barley yields of 1931 and 1932 in data set immer have identical data distributions.</p>
<p>Solution
The null hypothesis is that the barley yields of the two sample years are identical populations.
To test the hypothesis, we apply the wilcox.test function to compare the matched samples.
For the paired test, we set the “paired” argument as TRUE. As the p-value turns out to be 0.005318,
and is less than the .05 significance level, we reject the null hypothesis.</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wilcox.test</span>(immer<span class="sc">$</span>Y1, immer<span class="sc">$</span>Y2, <span class="at">paired=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## Warning in wilcox.test.default(immer$Y1, immer$Y2, paired = TRUE): cannot compute exact p-value with ties</code></pre>
<pre><code>## 
##  Wilcoxon signed rank test with continuity correction
## 
## data:  immer$Y1 and immer$Y2
## V = 368.5, p-value = 0.005318
## alternative hypothesis: true location shift is not equal to 0</code></pre>
<p>Answer
At .05 significance level, we conclude that the barley yields of 1931 and 1932 from the data set immer are nonidentical populations.</p>
<p><strong>Source</strong>
<a href="http://www.r-tutor.com/elementary-statistics/non-parametric-methods/wilcoxon-signed-rank-test">Wilcoxon Signed-Rank Test</a></p>
<!--chapter:end:09_wilcoxon_signed-rank_test.Rmd-->
</div>
<div id="support-vector-machine" class="section level1" number="18">
<h1 number="18"><span class="header-section-number">18</span> Support Vector Machine</h1>
<p><strong>Definition</strong>: Support vector machine is a representation of the training data as points in space
separated into categories by a clear gap that is as wide as possible. New examples are then mapped
into that same space and predicted to belong to a category based on which side of the gap they fall.<br />
<strong>Advantages</strong>: Effective in high dimensional spaces and uses a subset of training points in the decision function so it is also memory efficient.<br />
<strong>Disadvantages</strong>: The algorithm does not directly provide probability estimates, these are calculated using an expensive five-fold cross-validation.</p>
<p>Parameters of SVM:<br />
* Type of kernel<br />
* Gamma value<br />
* C value</p>
<!--chapter:end:11_svm.Rmd-->
</div>
<div id="correlation" class="section level1" number="19">
<h1 number="19"><span class="header-section-number">19</span> Correlation</h1>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> mtcars</span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a><span class="co"># correlation miles per galon of petrol ~ horse power</span></span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cor.test</span>(<span class="at">x =</span> df<span class="sc">$</span>mpg, <span class="at">y =</span> df<span class="sc">$</span>hp)</span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a><span class="co"># get parameters of analysed correlation</span></span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(<span class="at">x =</span> df<span class="sc">$</span>mpg, <span class="at">y =</span> df<span class="sc">$</span>hp)</span>
<span id="cb153-7"><a href="#cb153-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(fit)</span>
<span id="cb153-8"><a href="#cb153-8" aria-hidden="true" tabindex="-1"></a>fit<span class="sc">$</span>p.value</span>
<span id="cb153-9"><a href="#cb153-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-10"><a href="#cb153-10" aria-hidden="true" tabindex="-1"></a><span class="co"># the same correlation in &#39;formula&#39; form (see. ?cor.test)</span></span>
<span id="cb153-11"><a href="#cb153-11" aria-hidden="true" tabindex="-1"></a>?cor.test</span>
<span id="cb153-12"><a href="#cb153-12" aria-hidden="true" tabindex="-1"></a><span class="fu">cor.test</span>(<span class="sc">~</span>mpg<span class="sc">+</span>hp, df)</span>
<span id="cb153-13"><a href="#cb153-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-14"><a href="#cb153-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot using generic plot function of ggplot from ggplot2 package</span></span>
<span id="cb153-15"><a href="#cb153-15" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> df<span class="sc">$</span>mpg, <span class="at">y =</span> df<span class="sc">$</span>hp)</span>
<span id="cb153-16"><a href="#cb153-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-17"><a href="#cb153-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb153-18"><a href="#cb153-18" aria-hidden="true" tabindex="-1"></a><span class="co"># add color by number of engine&#39;s cylinders</span></span>
<span id="cb153-19"><a href="#cb153-19" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> mpg, <span class="at">y =</span> hp, <span class="at">col =</span> <span class="fu">factor</span>(cyl)))<span class="sc">+</span><span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">5</span>)</span>
<span id="cb153-20"><a href="#cb153-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-21"><a href="#cb153-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset of necessary data from mtcars</span></span>
<span id="cb153-22"><a href="#cb153-22" aria-hidden="true" tabindex="-1"></a>df.sub <span class="ot">&lt;-</span> df[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span><span class="sc">:</span><span class="dv">7</span>)]</span>
<span id="cb153-23"><a href="#cb153-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Scatterplots for all pairs of variables</span></span>
<span id="cb153-24"><a href="#cb153-24" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(df.sub)</span>
<span id="cb153-25"><a href="#cb153-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-26"><a href="#cb153-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlations of all pairs of variables</span></span>
<span id="cb153-27"><a href="#cb153-27" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(df.sub)</span>
<span id="cb153-28"><a href="#cb153-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-29"><a href="#cb153-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation using corr.test function from &#39;psych&#39; package</span></span>
<span id="cb153-30"><a href="#cb153-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation for all pairs of variables</span></span>
<span id="cb153-31"><a href="#cb153-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(psych)</span>
<span id="cb153-32"><a href="#cb153-32" aria-hidden="true" tabindex="-1"></a>fit.sub <span class="ot">&lt;-</span> <span class="fu">corr.test</span>(df.sub)</span>
<span id="cb153-33"><a href="#cb153-33" aria-hidden="true" tabindex="-1"></a>fit.sub<span class="sc">$</span>r    <span class="co"># correlations</span></span>
<span id="cb153-34"><a href="#cb153-34" aria-hidden="true" tabindex="-1"></a>fit.sub<span class="sc">$</span>p    <span class="co"># dependecies of variables</span></span></code></pre></div>
<!--chapter:end:19_correlation.Rmd-->
</div>
<div id="methods-and-algorithms-of-machine-learning" class="section level1" number="20">
<h1 number="20"><span class="header-section-number">20</span> Methods and algorithms of machine learning</h1>
<p><strong>Regression Analysis</strong><br />
* Ordinary Least Squares Regression (OLSR)<br />
* Linear Regression<br />
* Logistic Regression<br />
* Stepwise Regression<br />
* Polynomial Regression<br />
* Locally Estimated Scatterplot Smoothing (LOESS)</p>
<p><strong>Distance-based algorithms</strong><br />
* k-Nearest Neighbor (kNN)<br />
* Learning Vector Quantization (LVQ)<br />
* Self-organizing Map (SOM)</p>
<p><strong>Regularization Algorithms</strong><br />
* Ridge Regression<br />
* Least Absolute Shrinkage and Selection Operator (LASSO)<br />
* Elastic Net<br />
* Least-Angle Regression (LARS)</p>
<p><strong>Decision Tree Algorithms</strong><br />
* Classification and Regression Tree (CART)<br />
* Iterative Dichotomiser 3 (ID3)<br />
* C4.5 and C5.0<br />
* Chi-squared Automatic Interation Detection (CHAID)<br />
* Random Forest<br />
* Conditional Decision Trees</p>
<p><strong>Bayesian Algorithms</strong><br />
* Naive Bayes<br />
* Gaussian Naive Bayes<br />
* Multinomial Naive Bayes<br />
* Bayesian Belief Network (BBN)<br />
* Bayesian Network (BN)</p>
<p><strong>Clustering Algorithms</strong><br />
* k-Means<br />
* k-Medians<br />
* Partitioning Around MEdoids (PAM)<br />
* Hierarchical Clustering</p>
<p><strong>Association Rule Mining Algorithms</strong><br />
* Apriori algorithm<br />
* Eclat algorithm<br />
* FP-growth algorithm<br />
* Context Based Rule Mining</p>
<p><strong>Artifical Neural Network Algorithms</strong><br />
* Perceptron<br />
* Back-Propagation<br />
* Hopfield Network<br />
* Radial Basis Function Network (RBFN)</p>
<p><strong>Deep Learining Algorithms</strong><br />
* Deep Boltzmann Machine (DBM)<br />
* Deep Belief Networks (DBN)<br />
* Convolutional NEural Network (CNN)<br />
* Stacked Auto-Encoders</p>
<p><strong>Dimensionality Reduction Algorithms</strong><br />
* Principal Component Analysis (PCA)<br />
* Principal Compnent Regression (PCR)<br />
* Partial LEast Squares Regression (PLSR)<br />
* Multidimensional Scaling (MDS)<br />
* Linear Discriminant Analysis (LDA)<br />
* Mixtrue Discriminant Analysis (MDA)<br />
* Quadratic Discriminant Analysis (QDA)
1. PCA (linear)<br />
2. t-SNE (non-parametric/ nonlinear)<br />
3. Sammon mapping (nonlinear)<br />
4. Isomap (nonlinear)<br />
5. LLE (nonlinear)<br />
6. CCA (nonlinear)<br />
7. SNE (nonlinear)<br />
8. MVU (nonlinear)<br />
9. Laplacian Eigenmaps (nonlinear)</p>
<p><strong>Ensemble Algorithms</strong><br />
* Boosting<br />
* Bagging<br />
* AdaBoost<br />
* Stacked Generalization (blending)<br />
* Gradient Boosting Machines (GBM)</p>
<p><strong>Text Mining</strong><br />
* Automatic summarization<br />
* Named entity recognition (NER)<br />
* Optical character recognition (OCR)<br />
* Part-of-speech tagging
* Sentiment analysis
* Speech recognition
* Topic Modeling</p>
<!--chapter:end:20_machine_learning.Rmd-->
</div>
<div id="machine-learning-functions-reference" class="section level1" number="21">
<h1 number="21"><span class="header-section-number">21</span> Machine Learning Functions Reference</h1>
<div id="linear-regression" class="section level2" number="21.1">
<h2 number="21.1"><span class="header-section-number">21.1</span> Linear Regression</h2>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>lm_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(y ∼ x1 <span class="sc">+</span> x2, <span class="at">data=</span><span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(y,x1,x2)))</span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm_model)</span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x3)     <span class="co"># multiple linear regression</span></span>
<span id="cb154-5"><a href="#cb154-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-6"><a href="#cb154-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="fu">log</span>(y) <span class="sc">~</span> x)           <span class="co"># log transformed</span></span>
<span id="cb154-7"><a href="#cb154-7" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="fu">sqrt</span>(y) <span class="sc">~</span> x)          <span class="co"># sqrt transformed</span></span>
<span id="cb154-8"><a href="#cb154-8" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>( y <span class="sc">~</span> <span class="fu">log</span>(x))          <span class="co"># fields transformed</span></span>
<span id="cb154-9"><a href="#cb154-9" aria-hidden="true" tabindex="-1"></a><span class="fu">llm</span>(<span class="fu">log</span>(y) <span class="sc">~</span> <span class="fu">log</span>(x))     <span class="co"># everything is transformed</span></span>
<span id="cb154-10"><a href="#cb154-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-11"><a href="#cb154-11" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(y <span class="sc">~</span> .)                <span class="co"># use all fields for regression model</span></span>
<span id="cb154-12"><a href="#cb154-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-13"><a href="#cb154-13" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(y <span class="sc">~</span> x <span class="sc">+</span> <span class="dv">0</span>)            <span class="co"># forced zero intercept</span></span>
<span id="cb154-14"><a href="#cb154-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-15"><a href="#cb154-15" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(y <span class="sc">~</span> x<span class="sc">*</span>k)              <span class="co"># interaction of two variables</span></span>
<span id="cb154-16"><a href="#cb154-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-17"><a href="#cb154-17" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(y <span class="sc">~</span> x <span class="sc">+</span> k <span class="sc">+</span> x<span class="sc">:</span>k)      <span class="co"># product of xkl but without interaction</span></span>
<span id="cb154-18"><a href="#cb154-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-19"><a href="#cb154-19" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(y <span class="sc">~</span> (x <span class="sc">+</span> k <span class="sc">+</span> ... <span class="sc">+</span> l)<span class="sc">^</span><span class="dv">2</span>) <span class="co"># all first order interactions</span></span>
<span id="cb154-20"><a href="#cb154-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-21"><a href="#cb154-21" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(y <span class="sc">~</span> <span class="fu">I</span>(x1 <span class="sc">+</span> x2))       <span class="co"># sum of variables</span></span>
<span id="cb154-22"><a href="#cb154-22" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(y <span class="sc">~</span> <span class="fu">I</span>(x1<span class="sc">^</span><span class="dv">2</span>))          <span class="co"># product of variables (not interation)</span></span>
<span id="cb154-23"><a href="#cb154-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-24"><a href="#cb154-24" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(y <span class="sc">~</span> x <span class="sc">+</span> <span class="fu">I</span>(x<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(x<span class="sc">^</span><span class="dv">3</span>)) <span class="co"># polynomial regression</span></span>
<span id="cb154-25"><a href="#cb154-25" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(y <span class="sc">~</span> <span class="fu">poly</span>(x,<span class="dv">3</span>))           <span class="co"># same as previous</span></span>
<span id="cb154-26"><a href="#cb154-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-27"><a href="#cb154-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Forward/backward stepwise regression</span></span>
<span id="cb154-28"><a href="#cb154-28" aria-hidden="true" tabindex="-1"></a><span class="co"># improve model</span></span>
<span id="cb154-29"><a href="#cb154-29" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2)</span>
<span id="cb154-30"><a href="#cb154-30" aria-hidden="true" tabindex="-1"></a>bwd.fit <span class="ot">&lt;-</span> <span class="fu">step</span>(fit, <span class="at">direction =</span> <span class="st">&#39;backward&#39;</span>)</span>
<span id="cb154-31"><a href="#cb154-31" aria-hidden="true" tabindex="-1"></a>fwd.fit <span class="ot">&lt;-</span> <span class="fu">step</span>(fit, <span class="at">direction =</span> <span class="st">&#39;forward&#39;</span>, <span class="fu">scope</span>( <span class="sc">~</span> x1 <span class="sc">+</span> x2))</span>
<span id="cb154-32"><a href="#cb154-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-33"><a href="#cb154-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Test linear model</span></span>
<span id="cb154-34"><a href="#cb154-34" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m)            <span class="co"># plot residuals</span></span>
<span id="cb154-35"><a href="#cb154-35" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">outlier.test</span>(m)</span>
<span id="cb154-36"><a href="#cb154-36" aria-hidden="true" tabindex="-1"></a><span class="fu">dwtest</span>(m)          <span class="co"># Durbin-Watson Test of the model residuals</span></span>
<span id="cb154-37"><a href="#cb154-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-38"><a href="#cb154-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Prediction</span></span>
<span id="cb154-39"><a href="#cb154-39" aria-hidden="true" tabindex="-1"></a>predicted_values <span class="ot">&lt;-</span> <span class="fu">predict</span>(lm_model, <span class="at">newdata=</span><span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(x1_test, x2_test)))</span>
<span id="cb154-40"><a href="#cb154-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-41"><a href="#cb154-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Apriori</span></span>
<span id="cb154-42"><a href="#cb154-42" aria-hidden="true" tabindex="-1"></a>dataset <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;C:</span><span class="sc">\\</span><span class="st">Datasets</span><span class="sc">\\</span><span class="st">mushroom.csv&quot;</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb154-43"><a href="#cb154-43" aria-hidden="true" tabindex="-1"></a>mushroom_rules <span class="ot">&lt;-</span> <span class="fu">apriori</span>(<span class="fu">as.matrix</span>(dataset), <span class="at">parameter =</span> <span class="fu">list</span>(<span class="at">supp =</span> <span class="fl">0.8</span>, <span class="at">conf =</span> <span class="fl">0.9</span>))</span>
<span id="cb154-44"><a href="#cb154-44" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mushroom_rules)</span>
<span id="cb154-45"><a href="#cb154-45" aria-hidden="true" tabindex="-1"></a><span class="fu">inspect</span>(mushroom_rules)</span>
<span id="cb154-46"><a href="#cb154-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-47"><a href="#cb154-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Logistic Regression</span></span>
<span id="cb154-48"><a href="#cb154-48" aria-hidden="true" tabindex="-1"></a><span class="fu">glm</span>()</span>
<span id="cb154-49"><a href="#cb154-49" aria-hidden="true" tabindex="-1"></a>glm_mod <span class="ot">&lt;-</span><span class="fu">glm</span>(y ∼ x1<span class="sc">+</span>x2, <span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link=</span><span class="st">&quot;logit&quot;</span>), <span class="at">data=</span><span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(y,x1,x2))) </span>
<span id="cb154-50"><a href="#cb154-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-51"><a href="#cb154-51" aria-hidden="true" tabindex="-1"></a><span class="co"># K-Means Clustering</span></span>
<span id="cb154-52"><a href="#cb154-52" aria-hidden="true" tabindex="-1"></a>kmeans_model <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(<span class="at">x=</span>X, <span class="at">centers=</span>m)</span>
<span id="cb154-53"><a href="#cb154-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-54"><a href="#cb154-54" aria-hidden="true" tabindex="-1"></a><span class="co"># k-Nearest Neighbor Classification</span></span>
<span id="cb154-55"><a href="#cb154-55" aria-hidden="true" tabindex="-1"></a>knn_model <span class="ot">&lt;-</span> <span class="fu">knn</span>(<span class="at">train=</span>X_train, <span class="at">test=</span>X_test, <span class="at">cl=</span><span class="fu">as.factor</span>(labels), <span class="at">k=</span>K)</span>
<span id="cb154-56"><a href="#cb154-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-57"><a href="#cb154-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Naıve Bayes</span></span>
<span id="cb154-58"><a href="#cb154-58" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(e1071)</span>
<span id="cb154-59"><a href="#cb154-59" aria-hidden="true" tabindex="-1"></a>nB_model <span class="ot">&lt;-</span> <span class="fu">naiveBayes</span>(y ∼ x1 <span class="sc">+</span> x2, <span class="at">data=</span><span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(y,x1,x2)))</span>
<span id="cb154-60"><a href="#cb154-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-61"><a href="#cb154-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Decision Trees (CART)</span></span>
<span id="cb154-62"><a href="#cb154-62" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart)</span>
<span id="cb154-63"><a href="#cb154-63" aria-hidden="true" tabindex="-1"></a><span class="co"># Tree-based models</span></span>
<span id="cb154-64"><a href="#cb154-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-65"><a href="#cb154-65" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart</span>(formula, data, method,control)</span>
<span id="cb154-66"><a href="#cb154-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-67"><a href="#cb154-67" aria-hidden="true" tabindex="-1"></a>formula outcome<span class="sc">~</span>predictor1<span class="sc">+</span>predictor2<span class="sc">+</span>predictor3<span class="sc">+</span>etc.</span>
<span id="cb154-68"><a href="#cb154-68" aria-hidden="true" tabindex="-1"></a>data    data frame</span>
<span id="cb154-69"><a href="#cb154-69" aria-hidden="true" tabindex="-1"></a>method <span class="st">&#39;class&#39;</span> <span class="cf">for</span> a classification tree</span>
<span id="cb154-70"><a href="#cb154-70" aria-hidden="true" tabindex="-1"></a>       <span class="st">&#39;anova&#39;</span> <span class="cf">for</span> a regression tree</span>
<span id="cb154-71"><a href="#cb154-71" aria-hidden="true" tabindex="-1"></a>control optional parameters <span class="cf">for</span> controlling tree growth.</span>
<span id="cb154-72"><a href="#cb154-72" aria-hidden="true" tabindex="-1"></a>        minsplit <span class="ot">=</span> <span class="dv">50</span> <span class="sc">-</span> minimal number of observation <span class="cf">in</span> a node</span>
<span id="cb154-73"><a href="#cb154-73" aria-hidden="true" tabindex="-1"></a>        cp<span class="ot">=</span><span class="fl">0.001</span> <span class="sc">-</span> cost coplexity factor</span>
<span id="cb154-74"><a href="#cb154-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-75"><a href="#cb154-75" aria-hidden="true" tabindex="-1"></a>cart_model <span class="ot">&lt;-</span> <span class="fu">rpart</span>(y ∼ x1 <span class="sc">+</span> x2, <span class="at">data=</span><span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(y,x1,x2)), <span class="at">method=</span><span class="st">&quot;class&quot;</span>)</span>
<span id="cb154-76"><a href="#cb154-76" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb154-77"><a href="#cb154-77" aria-hidden="true" tabindex="-1"></a><span class="fu">printcp</span>(fit)     <span class="co"># display cp table</span></span>
<span id="cb154-78"><a href="#cb154-78" aria-hidden="true" tabindex="-1"></a><span class="fu">plotcp</span>(fit)      <span class="co"># plot cross-validation results</span></span>
<span id="cb154-79"><a href="#cb154-79" aria-hidden="true" tabindex="-1"></a><span class="fu">rsq.rpart</span>(fit)   <span class="co"># plot approximate R-squared and relative error for different splits (2 plots). labels are only appropriate for the &quot;anova&quot; method.</span></span>
<span id="cb154-80"><a href="#cb154-80" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit)       <span class="co"># print results</span></span>
<span id="cb154-81"><a href="#cb154-81" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)     <span class="co"># detailed results including surrogate splits</span></span>
<span id="cb154-82"><a href="#cb154-82" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit)        <span class="co"># plot decision tree</span></span>
<span id="cb154-83"><a href="#cb154-83" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(fit)        <span class="co"># label the decision tree plot</span></span>
<span id="cb154-84"><a href="#cb154-84" aria-hidden="true" tabindex="-1"></a><span class="fu">post</span>(fit, <span class="at">file=</span>) <span class="co"># create postscript plot of decision tree</span></span>
<span id="cb154-85"><a href="#cb154-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-86"><a href="#cb154-86" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.rpart</span>(cart_model)</span>
<span id="cb154-87"><a href="#cb154-87" aria-hidden="true" tabindex="-1"></a><span class="fu">text.rpart</span>(cart_model)</span>
<span id="cb154-88"><a href="#cb154-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-89"><a href="#cb154-89" aria-hidden="true" tabindex="-1"></a><span class="co"># AdaBoost</span></span>
<span id="cb154-90"><a href="#cb154-90" aria-hidden="true" tabindex="-1"></a><span class="co"># boosting functions - uses decision trees as base classifiers</span></span>
<span id="cb154-91"><a href="#cb154-91" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart)</span>
<span id="cb154-92"><a href="#cb154-92" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ada)</span>
<span id="cb154-93"><a href="#cb154-93" aria-hidden="true" tabindex="-1"></a><span class="co"># Let X be the matrix of features, and labels be a vector of 0-1 class labels.</span></span>
<span id="cb154-94"><a href="#cb154-94" aria-hidden="true" tabindex="-1"></a>boost_model <span class="ot">&lt;-</span> <span class="fu">ada</span>(<span class="at">x=</span>X, <span class="at">y=</span>labels)</span>
<span id="cb154-95"><a href="#cb154-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-96"><a href="#cb154-96" aria-hidden="true" tabindex="-1"></a><span class="co"># Support Vector Machines (SVM)</span></span>
<span id="cb154-97"><a href="#cb154-97" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(e1071)</span>
<span id="cb154-98"><a href="#cb154-98" aria-hidden="true" tabindex="-1"></a><span class="co"># Let X be the matrix of features, and labels be a vector of 0-1 class labels. Let the regularization parameter be C. Use the following commands to generate the SVM model and view details:</span></span>
<span id="cb154-99"><a href="#cb154-99" aria-hidden="true" tabindex="-1"></a>svm_model <span class="ot">&lt;-</span> <span class="fu">svm</span>(<span class="at">x=</span>X, <span class="at">y=</span><span class="fu">as.factor</span>(labels), <span class="at">kernel =</span><span class="st">&quot;radial&quot;</span>, <span class="at">cost=</span>C)</span>
<span id="cb154-100"><a href="#cb154-100" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(svm_model)</span></code></pre></div>
<!--chapter:end:21_ml_fun_ref.Rmd-->
</div>
</div>
<div id="split-data-into-train-and-test-subsets" class="section level1" number="22">
<h1 number="22"><span class="header-section-number">22</span> Split data into train and test subsets</h1>
<p>Here you can find several simple approaches to split data into train and test subset to fit and to test parameters of your model.
We want to take 0.8 of our initial data to train our model.<br />
Data: <code>datasets::iris</code>.</p>
<ol style="list-style-type: decimal">
<li>First approach is to create a <strong>vector containing randomly selected row ids</strong> and to apply this vector to split data.</li>
</ol>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>inTrain <span class="ot">=</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(iris), <span class="fu">nrow</span>(iris)<span class="sc">*</span><span class="fl">0.8</span>)</span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a><span class="co"># split data</span></span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a>train <span class="ot">=</span> iris[inTrain, ]</span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a>test <span class="ot">=</span> iris[<span class="sc">-</span>inTrain, ]</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>The same idea to split data as before using <code>caret</code> package.<br />
The advantage is that <code>createDataPartition</code> function allows to split data many <code>times</code> and use these subsets to estimate parameters of our model.</li>
</ol>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>trainIndex <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(iris<span class="sc">$</span>Species, <span class="at">p=</span>.<span class="dv">8</span>,</span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">list =</span> <span class="cn">FALSE</span>,        <span class="co"># if FALSE - create a vector/matrix, if TRUE - create a list</span></span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">times =</span> <span class="dv">1</span>)           <span class="co"># how many subsets</span></span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a><span class="co"># split data</span></span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> iris[trainIndex, ]</span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> iris[<span class="sc">-</span>trainIndex, ]</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Another approch is to create a <strong>logical vecotor</strong> containing randomly distributed true/false and apply this vector to subset data.</li>
</ol>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>inTrain <span class="ot">=</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>), <span class="fu">nrow</span>(iris), <span class="at">replace =</span> T, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.8</span>,<span class="fl">0.2</span>))</span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a><span class="co"># select data</span></span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>train <span class="ot">=</span> iris[inTrain, ]</span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a>test <span class="ot">=</span> iris[<span class="sc">!</span>inTrain, ]</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Using <a href="https://cran.r-project.org/web/packages/caTools/index.html"><code>caTools</code></a>.</li>
</ol>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caTools)</span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>inTrain <span class="ot">=</span> <span class="fu">sample.split</span>(iris, <span class="at">SplitRatio =</span> .<span class="dv">8</span>)</span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>train <span class="ot">=</span> <span class="fu">subset</span>(iris, inTrain <span class="sc">==</span> <span class="cn">TRUE</span>)</span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>test  <span class="ot">=</span> <span class="fu">subset</span>(iris, inTrain <span class="sc">==</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>Using <a href="https://cran.r-project.org/web/packages/dplyr/"><code>dplyr</code></a></li>
</ol>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>iris<span class="sc">$</span>id <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(iris)</span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> iris <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">sample_frac</span>(.<span class="dv">8</span>)</span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a>test  <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">anti_join</span>(iris, train, <span class="at">by =</span> <span class="st">&#39;id&#39;</span>)</span></code></pre></div>
<!--chapter:end:22_split_data_ways.Rmd-->
</div>
<div id="linear-regression-1" class="section level1" number="23">
<h1 number="23"><span class="header-section-number">23</span> Linear Regression</h1>
<div id="linear-regression---theory" class="section level2" number="23.1">
<h2 number="23.1"><span class="header-section-number">23.1</span> Linear regression - theory</h2>
<p>Linear regression model is a line y=ax+b, where sum of distances between all y=axi+b and given yi (sum of squares) is minimal.</p>
<p>Assume that there is approximately a linear relationship between X and Y:<br />
<span class="math display">\[ Y \approx \beta_0 + \beta_1X\]</span>
where <span class="math inline">\(\beta\)</span><sub>0</sub> is an <strong>intercept</strong> and <span class="math inline">\(\beta\)</span><sub>1</sub> is a <strong>slope</strong></p>
<p>Parameters of the line could be calculated using <strong>least squares methods</strong>:</p>
<p><span class="math display">\[\beta_1 = \frac{\sum_{i=1}^{n} (x_i - \bar{x})(y_i - \bar{y})}{\sum_{i=1}^{n}{(x_i - \bar{x})^2}} \]</span>
<span class="math display">\[\beta_0 = \bar{y} - \beta_1\bar{x} \]</span></p>
</div>
<div id="generate-random-data-set-for-the-linear-model" class="section level2" number="23.2">
<h2 number="23.2"><span class="header-section-number">23.2</span> Generate random data set for the linear model</h2>
<p>Suppose we want to simulate from the following linear model:
y = <span class="math inline">\(\beta\)</span><sub>0</sub> + <span class="math inline">\(\beta\)</span><sub>1</sub>x + <span class="math inline">\(\epsilon\)</span>,<br />
where <span class="math inline">\(\epsilon\)</span> ~ N(0,2<sup>2</sup>). Assume x ~ N(0,1<sup>2</sup>), <span class="math inline">\(\beta\)</span><sub>0</sub> = 0.5, <span class="math inline">\(\beta\)</span><sub>1</sub> = 2.</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">20</span>)</span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span><span class="fu">rnorm</span>(<span class="dv">100</span>)</span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a>e <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">100</span>, <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fl">0.5</span> <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>x <span class="sc">+</span> e</span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(y)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
## -6.4084 -1.5402  0.6789  0.6893  2.9303  6.5052</code></pre>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x,y)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-52-1.png" width="672" /></p>
</div>
<div id="practical-example" class="section level2" number="23.3">
<h2 number="23.3"><span class="header-section-number">23.3</span> Practical example</h2>
<p>Practical example from <a href="https://en.wikipedia.org/wiki/Linear_least_squares_(mathematics)">Wikipedia</a><br />
Set of data: (1,6), (2,5), (3, 7), (4,10)</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>)</span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">10</span>)</span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(y<span class="sc">~</span>x, <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span>), <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">10</span>))</span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="fl">3.5</span>, <span class="fl">1.4</span>)</span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span>x)</span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a><span class="fu">segments</span>(x, y, x, r<span class="sc">$</span>fitted.values, <span class="at">col=</span><span class="st">&quot;green&quot;</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-53-1.png" width="672" /></p>
<p>We have to find the line corresponding to the minimal sum of errors (distances from the each point to this line):
1. For all points:<br />
<span class="math display">\[\beta_1 + 1\beta_2 = 6\]</span></p>
<p><span class="math display">\[\beta_1 + 2\beta_2 = 5\]</span>
<span class="math display">\[\beta_1 + 3\beta_2 = 7\]</span>
<span class="math display">\[\beta_1 + 4\beta_2 = 10\]</span>
the least squares S:<br />
<span class="math display">\[S(\beta_1, \beta_2) = [6 - (\beta_1 + 1\beta_2)]^2 + [5 - (\beta_1 + 2\beta_2)]^2 + [7 - (\beta_1 + 3\beta_2)]^2 + [10 - (\beta_1 + 4\beta_2)]^2 = 4\beta_1^2 + 30\beta_2^2 + 20\beta_1\beta_2 - 56\beta_1 - 154\beta_2 + 210\]</span>
The minimum is:
<span class="math display">\[\frac{\partial{S}}{\partial{\beta_1}} = 0 = 8 \beta_1 + 60\beta_2 - 154\]</span>
<span class="math display">\[\frac{\partial{S}}{\partial{\beta_2}} = 0 = 20 \beta_1 + 20\beta_2 - 56\]</span>
Result in a system of two equations in two unkowns gives:
<span class="math display">\[\beta_1 = 3.5\]</span>
<span class="math display">\[\beta_2 = 1.4\]</span>
The line of best fit:<br />
<span class="math inline">\(y = 3.5 + 1.4x\)</span><br />
All possible regression lines goes through the intersection point <span class="math inline">\((\bar{x}, \bar{y})\)</span></p>
</div>
<div id="mean-squared-error-mse" class="section level2" number="23.4">
<h2 number="23.4"><span class="header-section-number">23.4</span> Mean squared error (MSE)</h2>
<p><strong>Standard error of train data</strong><br />
<span class="math display">\[MSE = \frac{1}{n}\sum_{i=1}^{n}(y_i - \hat{f}(x_i))^2\]</span></p>
<p><strong>Standard error of learn data</strong><br />
<span class="math display">\[MSE = \frac{1}{n_o}\sum_{i=1}^{n_o}(y_i^o - \hat{f}(x_i^o))^2\]</span></p>
</div>
<div id="linear-model-in-r" class="section level2" number="23.5">
<h2 number="23.5"><span class="header-section-number">23.5</span> Linear model in R</h2>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Height and weight vectors for 19 children</span></span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>height <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">69.1</span>,<span class="fl">56.4</span>,<span class="fl">65.3</span>,<span class="fl">62.8</span>,<span class="dv">63</span>,<span class="fl">57.3</span>,<span class="fl">59.8</span>,<span class="fl">62.5</span>,<span class="fl">62.5</span>,<span class="fl">59.0</span>,<span class="fl">51.3</span>,<span class="dv">64</span>,<span class="fl">56.4</span>,<span class="fl">66.5</span>,<span class="fl">72.2</span>,<span class="fl">65.0</span>,<span class="fl">67.0</span>,<span class="fl">57.6</span>,<span class="fl">66.6</span>)</span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>weight <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">113</span>,<span class="dv">84</span>,<span class="dv">99</span>,<span class="dv">103</span>,<span class="dv">102</span>,<span class="dv">83</span>,<span class="dv">85</span>,<span class="dv">113</span>,<span class="dv">84</span>,<span class="dv">99</span>,<span class="dv">51</span>,<span class="dv">90</span>,<span class="dv">77</span>,<span class="dv">112</span>,<span class="dv">150</span>,<span class="dv">128</span>,<span class="dv">133</span>,<span class="dv">85</span>,<span class="dv">112</span>)</span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(height,weight)</span>
<span id="cb164-6"><a href="#cb164-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit linear model</span></span>
<span id="cb164-7"><a href="#cb164-7" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(weight <span class="sc">~</span> height) <span class="co"># weight = slope*weight + intercept</span></span>
<span id="cb164-8"><a href="#cb164-8" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(model)   <span class="co"># Regression line</span></span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-54-1.png" width="672" /></p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="co"># correlation between variables</span></span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(height,weight)</span></code></pre></div>
<pre><code>## [1] 0.8848454</code></pre>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get data from the model</span></span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a><span class="co">#get the intercept(b0) and the slope(b1) values</span></span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a>model</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = weight ~ height)
## 
## Coefficients:
## (Intercept)       height  
##    -143.227        3.905</code></pre>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="co"># detailed information about the model</span></span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = weight ~ height)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -16.816  -5.678   0.003   9.156  17.423 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -143.2266    31.1802  -4.594 0.000259 ***
## height         3.9047     0.4986   7.831 4.88e-07 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 10.89 on 17 degrees of freedom
## Multiple R-squared:  0.783,  Adjusted R-squared:  0.7702 
## F-statistic: 61.32 on 1 and 17 DF,  p-value: 4.876e-07</code></pre>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check all attributes calculated by lm</span></span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(model)</span></code></pre></div>
<pre><code>## $names
##  [1] &quot;coefficients&quot;  &quot;residuals&quot;     &quot;effects&quot;       &quot;rank&quot;          &quot;fitted.values&quot; &quot;assign&quot;        &quot;qr&quot;            &quot;df.residual&quot;   &quot;xlevels&quot;       &quot;call&quot;         
## [11] &quot;terms&quot;         &quot;model&quot;        
## 
## $class
## [1] &quot;lm&quot;</code></pre>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="co"># getting only the intercept</span></span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a>model<span class="sc">$</span>coefficients[<span class="dv">1</span>] <span class="co">#or model$coefficients[[1]]</span></span></code></pre></div>
<pre><code>## (Intercept) 
##   -143.2266</code></pre>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="co"># getting only the slope</span></span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a>model<span class="sc">$</span>coefficients[<span class="dv">2</span>] <span class="co">#or model$coefficients[[2]]</span></span></code></pre></div>
<pre><code>##   height 
## 3.904675</code></pre>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="co"># checking the residuals</span></span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a><span class="fu">residuals</span>(model)</span></code></pre></div>
<pre><code>##             1             2             3             4             5             6             7             8             9            10            11            12 
## -13.586376027   7.002990499 -12.748612814   1.013073510  -0.767861396   2.488783423  -5.272902901  12.184475869 -16.815524131  11.850836722  -6.083169400 -16.672535926 
##            13            14            15            16            17            18            19 
##   0.002990499  -4.434222250  11.309132932  17.422789545  14.613440486   3.317381064  -4.824689703</code></pre>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predict the weight for a given height, say 60 inches</span></span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a>model<span class="sc">$</span>coefficients[[<span class="dv">2</span>]]<span class="sc">*</span><span class="dv">60</span> <span class="sc">+</span> model<span class="sc">$</span>coefficients[[<span class="dv">1</span>]]</span></code></pre></div>
<pre><code>## [1] 91.05384</code></pre>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mean squared error (MSE)</span></span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a>predicted.weights <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, <span class="at">newdata =</span> <span class="fu">as.data.frame</span>(weight))</span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a>mse <span class="ot">&lt;-</span> <span class="fu">mean</span>(( weight <span class="sc">-</span> predicted.weights)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb181-4"><a href="#cb181-4" aria-hidden="true" tabindex="-1"></a>mse</span></code></pre></div>
<pre><code>## [1] 106.177</code></pre>
</div>
<div id="linear-regression-model-for-multiple-parameters" class="section level2" number="23.6">
<h2 number="23.6"><span class="header-section-number">23.6</span> Linear regression model for multiple parameters</h2>
</div>
<div id="choosing-explanatory-variables-for-the-model" class="section level2" number="23.7">
<h2 number="23.7"><span class="header-section-number">23.7</span> Choosing explanatory variables for the model</h2>
<p>In general, less MSE then better prediction. We can arrange variables by their importance
to predict and choose the number of significant variables.</p>
<ol style="list-style-type: decimal">
<li>run model with different number of variables.<br />
</li>
<li>Arrange MSE for each variable.<br />
</li>
<li>Compair MSE for different number of variables using t-test.<br />
If difference is significant =&gt; use more variables.</li>
</ol>
<p>In the same way we can compair different models.</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaicData)</span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(CPS85)</span></code></pre></div>
<pre><code>##   wage educ race sex hispanic south married exper union age   sector
## 1  9.0   10    W   M       NH    NS Married    27   Not  43    const
## 2  5.5   12    W   M       NH    NS Married    20   Not  38    sales
## 3  3.8   12    W   F       NH    NS  Single     4   Not  22    sales
## 4 10.5   12    W   F       NH    NS Married    29   Not  47 clerical
## 5 15.0   12    W   M       NH    NS Married    40 Union  58    const
## 6  9.0   16    W   F       NH    NS Married    27   Not  49 clerical</code></pre>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="co"># relation wage ~ education</span></span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a><span class="co"># wage - response variable</span></span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a><span class="co"># educ, exper, age are explanatory variables</span></span>
<span id="cb185-4"><a href="#cb185-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-5"><a href="#cb185-5" aria-hidden="true" tabindex="-1"></a><span class="co"># linear model</span></span>
<span id="cb185-6"><a href="#cb185-6" aria-hidden="true" tabindex="-1"></a>model1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> educ, <span class="at">data =</span> CPS85)</span>
<span id="cb185-7"><a href="#cb185-7" aria-hidden="true" tabindex="-1"></a>model2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> educ <span class="sc">+</span> age, <span class="at">data =</span> CPS85)</span>
<span id="cb185-8"><a href="#cb185-8" aria-hidden="true" tabindex="-1"></a>model3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> educ <span class="sc">+</span> age <span class="sc">+</span> exper, <span class="at">data =</span> CPS85)</span>
<span id="cb185-9"><a href="#cb185-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-10"><a href="#cb185-10" aria-hidden="true" tabindex="-1"></a>pred1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(model1, <span class="at">newdata =</span> CPS85)</span>
<span id="cb185-11"><a href="#cb185-11" aria-hidden="true" tabindex="-1"></a>pred2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(model2, <span class="at">newdata =</span> CPS85)</span>
<span id="cb185-12"><a href="#cb185-12" aria-hidden="true" tabindex="-1"></a>pred3 <span class="ot">&lt;-</span> <span class="fu">predict</span>(model3, <span class="at">newdata =</span> CPS85)</span>
<span id="cb185-13"><a href="#cb185-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-14"><a href="#cb185-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Compair MSE</span></span>
<span id="cb185-15"><a href="#cb185-15" aria-hidden="true" tabindex="-1"></a>mse1 <span class="ot">&lt;-</span> <span class="fu">mean</span>(( CPS85<span class="sc">$</span>wage <span class="sc">-</span> pred1)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb185-16"><a href="#cb185-16" aria-hidden="true" tabindex="-1"></a>mse2 <span class="ot">&lt;-</span> <span class="fu">mean</span>(( CPS85<span class="sc">$</span>wage <span class="sc">-</span> pred2)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb185-17"><a href="#cb185-17" aria-hidden="true" tabindex="-1"></a>mse3 <span class="ot">&lt;-</span> <span class="fu">mean</span>(( CPS85<span class="sc">$</span>wage <span class="sc">-</span> pred3)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb185-18"><a href="#cb185-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-19"><a href="#cb185-19" aria-hidden="true" tabindex="-1"></a>mse <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">model_1 =</span> mse1,</span>
<span id="cb185-20"><a href="#cb185-20" aria-hidden="true" tabindex="-1"></a>                  <span class="at">model_2 =</span> mse2,</span>
<span id="cb185-21"><a href="#cb185-21" aria-hidden="true" tabindex="-1"></a>                  <span class="at">model_3 =</span> mse3)</span>
<span id="cb185-22"><a href="#cb185-22" aria-hidden="true" tabindex="-1"></a>mse</span></code></pre></div>
<pre><code>##    model_1  model_2 model_3
## 1 22.51575 21.03578 21.0353</code></pre>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Using both educ and age variables reduese MSE =&gt; improve model, where</span></span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a><span class="co"># adding exper does not improve model</span></span></code></pre></div>
</div>
<div id="assessment-of-model-performance-for-categorical-data." class="section level2" number="23.8">
<h2 number="23.8"><span class="header-section-number">23.8</span> Assessment of model performance for categorical data.</h2>
<p>Errors for categorical data can be calculated as number of errors prediction model makes.<br />
Test whether predicted values match actual values.<br />
Likelihood: extract the probability that the model assigned to the observed outcome.</p>
</div>
<div id="confidence-intervals-for-linear-model" class="section level2" number="23.9">
<h2 number="23.9"><span class="header-section-number">23.9</span> Confidence intervals for linear model</h2>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 0. Build linear model </span></span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;cars&quot;</span>, <span class="at">package =</span> <span class="st">&quot;datasets&quot;</span>)</span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(dist <span class="sc">~</span> speed, <span class="at">data =</span> cars)</span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Add predictions </span></span>
<span id="cb188-5"><a href="#cb188-5" aria-hidden="true" tabindex="-1"></a>pred.int <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, <span class="at">interval =</span> <span class="st">&quot;prediction&quot;</span>)</span></code></pre></div>
<pre><code>## Warning in predict.lm(model, interval = &quot;prediction&quot;): predictions on current data refer to _future_ responses</code></pre>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a>mydata <span class="ot">&lt;-</span> <span class="fu">cbind</span>(cars, pred.int)</span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Regression line + confidence intervals</span></span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;ggplot2&quot;</span>)</span>
<span id="cb190-4"><a href="#cb190-4" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mydata, <span class="fu">aes</span>(speed, dist)) <span class="sc">+</span></span>
<span id="cb190-5"><a href="#cb190-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb190-6"><a href="#cb190-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> lm)</span>
<span id="cb190-7"><a href="#cb190-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Add prediction intervals</span></span>
<span id="cb190-8"><a href="#cb190-8" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> lwr), <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>)<span class="sc">+</span></span>
<span id="cb190-9"><a href="#cb190-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> upr), <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<pre><code>## Warning in grid.Call.graphics(C_polygon, x$x, x$y, index): semi-transparency is not supported on this device: reported only once per page</code></pre>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-56-1.png" width="672" /></p>
<!--chapter:end:23_linear_regression.Rmd-->
</div>
<div id="practical-examples-for-linear-model-regression" class="section level2" number="23.10">
<h2 number="23.10"><span class="header-section-number">23.10</span> Practical examples for linear model regression</h2>
<p>In this simple example we have 6 persons (3 males and 3 femails) and their score from 0 to 10.<br />
We want to build a model to see the dependence of score on gender: score ~ gender + <span class="math inline">\(\epsilon\)</span>, where <span class="math inline">\(\epsilon\)</span> is an error</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create data frame for the dataset</span></span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">gender=</span><span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">3</span>), <span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">3</span>)), <span class="at">score=</span><span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">8</span>,<span class="dv">7</span>, <span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">2</span>))</span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a>df</span></code></pre></div>
<pre><code>##   gender score
## 1      0    10
## 2      0     8
## 3      0     7
## 4      1     1
## 5      1     3
## 6      1     2</code></pre>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="co"># build linear model</span></span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">lm</span>(score <span class="sc">~</span> gender, df)</span>
<span id="cb195-3"><a href="#cb195-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(x)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = score ~ gender, data = df)
## 
## Residuals:
##          1          2          3          4          5          6 
##  1.667e+00 -3.333e-01 -1.333e+00 -1.000e+00  1.000e+00  1.110e-16 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   8.3333     0.7454  11.180 0.000364 ***
## gender       -6.3333     1.0541  -6.008 0.003863 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.291 on 4 degrees of freedom
## Multiple R-squared:  0.9002, Adjusted R-squared:  0.8753 
## F-statistic:  36.1 on 1 and 4 DF,  p-value: 0.003863</code></pre>
<!--chapter:end:24_linear_model_categorical.Rmd-->
</div>
</div>
<div id="linear-regression-complex-cases" class="section level1" number="24">
<h1 number="24"><span class="header-section-number">24</span> Linear regression complex cases</h1>
<div id="cars" class="section level2" number="24.1">
<h2 number="24.1"><span class="header-section-number">24.1</span> Cars</h2>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> mtcars</span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-3"><a href="#cb197-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset of necessary data from mtcars</span></span>
<span id="cb197-4"><a href="#cb197-4" aria-hidden="true" tabindex="-1"></a>df.sub <span class="ot">&lt;-</span> df[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span><span class="sc">:</span><span class="dv">7</span>)]</span>
<span id="cb197-5"><a href="#cb197-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-6"><a href="#cb197-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Linear regression model</span></span>
<span id="cb197-7"><a href="#cb197-7" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg <span class="sc">~</span> hp, df)</span>
<span id="cb197-8"><a href="#cb197-8" aria-hidden="true" tabindex="-1"></a>fit</span>
<span id="cb197-9"><a href="#cb197-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span>
<span id="cb197-10"><a href="#cb197-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-11"><a href="#cb197-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot regression models using ggplot</span></span>
<span id="cb197-12"><a href="#cb197-12" aria-hidden="true" tabindex="-1"></a><span class="co"># parameter geom_smooth builds regression model</span></span>
<span id="cb197-13"><a href="#cb197-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb197-14"><a href="#cb197-14" aria-hidden="true" tabindex="-1"></a><span class="co"># auto model</span></span>
<span id="cb197-15"><a href="#cb197-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(hp, mpg))<span class="sc">+</span><span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">2</span>)<span class="sc">+</span><span class="fu">geom_smooth</span>()</span>
<span id="cb197-16"><a href="#cb197-16" aria-hidden="true" tabindex="-1"></a><span class="co"># for linear model: method = &#39;lm&#39;</span></span>
<span id="cb197-17"><a href="#cb197-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(hp, mpg))<span class="sc">+</span><span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">2</span>)<span class="sc">+</span><span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>)</span>
<span id="cb197-18"><a href="#cb197-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-19"><a href="#cb197-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Split data into two groups by am - Transmission (0 = automatic, 1 = manual)</span></span>
<span id="cb197-20"><a href="#cb197-20" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(hp, mpg, <span class="at">col=</span><span class="fu">factor</span>(am)))<span class="sc">+</span></span>
<span id="cb197-21"><a href="#cb197-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb197-22"><a href="#cb197-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>)</span>
<span id="cb197-23"><a href="#cb197-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-24"><a href="#cb197-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Prediction of values using linear regression model</span></span>
<span id="cb197-25"><a href="#cb197-25" aria-hidden="true" tabindex="-1"></a>fitted_values_mpg <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">mpg=</span>df<span class="sc">$</span>mpg, <span class="at">fitted=</span>fit<span class="sc">$</span>fitted.values)</span>
<span id="cb197-26"><a href="#cb197-26" aria-hidden="true" tabindex="-1"></a>fitted_values_mpg</span>
<span id="cb197-27"><a href="#cb197-27" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(fitted_values_mpg)</span>
<span id="cb197-28"><a href="#cb197-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-29"><a href="#cb197-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Lets predict galons of petrol for given horse powers</span></span>
<span id="cb197-30"><a href="#cb197-30" aria-hidden="true" tabindex="-1"></a>new_hp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">hp=</span><span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">150</span>, <span class="dv">129</span>, <span class="dv">300</span>))</span>
<span id="cb197-31"><a href="#cb197-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-32"><a href="#cb197-32" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(fit, new_hp)</span>
<span id="cb197-33"><a href="#cb197-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-34"><a href="#cb197-34" aria-hidden="true" tabindex="-1"></a>new_hp<span class="sc">$</span>mpg <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, new_hp)</span>
<span id="cb197-35"><a href="#cb197-35" aria-hidden="true" tabindex="-1"></a>new_hp</span>
<span id="cb197-36"><a href="#cb197-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-37"><a href="#cb197-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Lets make regression model for cylinders as numeric (not factor)</span></span>
<span id="cb197-38"><a href="#cb197-38" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg <span class="sc">~</span> cyl, df)</span>
<span id="cb197-39"><a href="#cb197-39" aria-hidden="true" tabindex="-1"></a>fit</span>
<span id="cb197-40"><a href="#cb197-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-41"><a href="#cb197-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Regression line for cyclinders</span></span>
<span id="cb197-42"><a href="#cb197-42" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(cyl, mpg))<span class="sc">+</span></span>
<span id="cb197-43"><a href="#cb197-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb197-44"><a href="#cb197-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&quot;lm&quot;</span>)<span class="sc">+</span></span>
<span id="cb197-45"><a href="#cb197-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">25</span>),</span>
<span id="cb197-46"><a href="#cb197-46" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">25</span>, <span class="at">face=</span><span class="st">&quot;bold&quot;</span>))</span></code></pre></div>
</div>
<div id="linear-regression-modeling-compair-with-knn" class="section level2" number="24.2">
<h2 number="24.2"><span class="header-section-number">24.2</span> Linear regression modeling, compair with kNN</h2>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&#39;GGally&#39;</span>)</span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&#39;lmtest&#39;</span>)</span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&#39;FNN&#39;</span>)</span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-5"><a href="#cb198-5" aria-hidden="true" tabindex="-1"></a><span class="co"># константы</span></span>
<span id="cb198-6"><a href="#cb198-6" aria-hidden="true" tabindex="-1"></a>my.seed <span class="ot">&lt;-</span> <span class="dv">12345</span></span>
<span id="cb198-7"><a href="#cb198-7" aria-hidden="true" tabindex="-1"></a>train.percent <span class="ot">&lt;-</span> <span class="fl">0.85</span></span>
<span id="cb198-8"><a href="#cb198-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-9"><a href="#cb198-9" aria-hidden="true" tabindex="-1"></a><span class="co"># загрузка данных</span></span>
<span id="cb198-10"><a href="#cb198-10" aria-hidden="true" tabindex="-1"></a>fileURL <span class="ot">&lt;-</span> <span class="st">&#39;https://sites.google.com/a/kiber-guu.ru/msep/mag-econ/salary_data.csv?attredirects=0&amp;d=1&#39;</span></span>
<span id="cb198-11"><a href="#cb198-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-12"><a href="#cb198-12" aria-hidden="true" tabindex="-1"></a><span class="co"># преобразуем категориальные переменные в факторы</span></span>
<span id="cb198-13"><a href="#cb198-13" aria-hidden="true" tabindex="-1"></a>wages.ru <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(fileURL, <span class="at">row.names =</span> <span class="dv">1</span>, <span class="at">sep =</span> <span class="st">&#39;;&#39;</span>, <span class="at">as.is =</span> T)</span>
<span id="cb198-14"><a href="#cb198-14" aria-hidden="true" tabindex="-1"></a>wages.ru<span class="sc">$</span>male <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(wages.ru<span class="sc">$</span>male)</span>
<span id="cb198-15"><a href="#cb198-15" aria-hidden="true" tabindex="-1"></a>wages.ru<span class="sc">$</span>educ <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(wages.ru<span class="sc">$</span>educ)</span>
<span id="cb198-16"><a href="#cb198-16" aria-hidden="true" tabindex="-1"></a>wages.ru<span class="sc">$</span>forlang <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(wages.ru<span class="sc">$</span>forlang)</span>
<span id="cb198-17"><a href="#cb198-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-18"><a href="#cb198-18" aria-hidden="true" tabindex="-1"></a><span class="co"># обучающая выборка</span></span>
<span id="cb198-19"><a href="#cb198-19" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(my.seed)</span>
<span id="cb198-20"><a href="#cb198-20" aria-hidden="true" tabindex="-1"></a>inTrain <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">seq_along</span>(wages.ru<span class="sc">$</span>salary), </span>
<span id="cb198-21"><a href="#cb198-21" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">nrow</span>(wages.ru) <span class="sc">*</span> train.percent)</span>
<span id="cb198-22"><a href="#cb198-22" aria-hidden="true" tabindex="-1"></a>df.train <span class="ot">&lt;-</span> wages.ru[inTrain, <span class="fu">c</span>(<span class="fu">colnames</span>(wages.ru)[<span class="sc">-</span><span class="dv">1</span>], <span class="fu">colnames</span>(wages.ru)[<span class="dv">1</span>])]</span>
<span id="cb198-23"><a href="#cb198-23" aria-hidden="true" tabindex="-1"></a>df.test <span class="ot">&lt;-</span> wages.ru[<span class="sc">-</span>inTrain, <span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb198-24"><a href="#cb198-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-25"><a href="#cb198-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Variable description</span></span>
<span id="cb198-26"><a href="#cb198-26" aria-hidden="true" tabindex="-1"></a><span class="co"># salary – среднемесячная зарплата после вычета налогов за последние 12 месяцев (рублей);</span></span>
<span id="cb198-27"><a href="#cb198-27" aria-hidden="true" tabindex="-1"></a><span class="co"># male – пол: 1 – мужчина, 0 – женщина;</span></span>
<span id="cb198-28"><a href="#cb198-28" aria-hidden="true" tabindex="-1"></a><span class="co"># educ – уровень образования:</span></span>
<span id="cb198-29"><a href="#cb198-29" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 – 0-6 классов,</span></span>
<span id="cb198-30"><a href="#cb198-30" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 – незаконченное среднее (7-8 классов),</span></span>
<span id="cb198-31"><a href="#cb198-31" aria-hidden="true" tabindex="-1"></a><span class="co"># 3 - незаконченное среднее плюс что-то ещё,</span></span>
<span id="cb198-32"><a href="#cb198-32" aria-hidden="true" tabindex="-1"></a><span class="co"># 4 – законченное среднее,</span></span>
<span id="cb198-33"><a href="#cb198-33" aria-hidden="true" tabindex="-1"></a><span class="co"># 5 – законченное среднее специальное, 6 – законченное высшее образование и выше;</span></span>
<span id="cb198-34"><a href="#cb198-34" aria-hidden="true" tabindex="-1"></a><span class="co"># forlang - иност. язык: 1 – владеет, 0 – нет;</span></span>
<span id="cb198-35"><a href="#cb198-35" aria-hidden="true" tabindex="-1"></a><span class="co"># exper – официальный стаж c 1.01.2002 (лет).</span></span>
<span id="cb198-36"><a href="#cb198-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-37"><a href="#cb198-37" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(df.train)</span>
<span id="cb198-38"><a href="#cb198-38" aria-hidden="true" tabindex="-1"></a>ggp <span class="ot">&lt;-</span> <span class="fu">ggpairs</span>(df.train)</span>
<span id="cb198-39"><a href="#cb198-39" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ggp, <span class="at">progress =</span> F)</span>
<span id="cb198-40"><a href="#cb198-40" aria-hidden="true" tabindex="-1"></a><span class="co"># цвета по фактору male</span></span>
<span id="cb198-41"><a href="#cb198-41" aria-hidden="true" tabindex="-1"></a>ggp <span class="ot">&lt;-</span> <span class="fu">ggpairs</span>(df.train[, <span class="fu">c</span>(<span class="st">&#39;exper&#39;</span>, <span class="st">&#39;male&#39;</span>, <span class="st">&#39;salary&#39;</span>)], </span>
<span id="cb198-42"><a href="#cb198-42" aria-hidden="true" tabindex="-1"></a>               <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">color =</span> male))</span>
<span id="cb198-43"><a href="#cb198-43" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ggp, <span class="at">progress =</span> F)</span>
<span id="cb198-44"><a href="#cb198-44" aria-hidden="true" tabindex="-1"></a><span class="co"># цвета по фактору educ</span></span>
<span id="cb198-45"><a href="#cb198-45" aria-hidden="true" tabindex="-1"></a>ggp <span class="ot">&lt;-</span> <span class="fu">ggpairs</span>(df.train[, <span class="fu">c</span>(<span class="st">&#39;exper&#39;</span>, <span class="st">&#39;educ&#39;</span>, <span class="st">&#39;salary&#39;</span>)], </span>
<span id="cb198-46"><a href="#cb198-46" aria-hidden="true" tabindex="-1"></a>               <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">color =</span> educ))</span>
<span id="cb198-47"><a href="#cb198-47" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ggp, <span class="at">progress =</span> F)</span>
<span id="cb198-48"><a href="#cb198-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-49"><a href="#cb198-49" aria-hidden="true" tabindex="-1"></a><span class="co"># цвета по фактору forlang</span></span>
<span id="cb198-50"><a href="#cb198-50" aria-hidden="true" tabindex="-1"></a>ggp <span class="ot">&lt;-</span> <span class="fu">ggpairs</span>(df.train[, <span class="fu">c</span>(<span class="st">&#39;exper&#39;</span>, <span class="st">&#39;forlang&#39;</span>, <span class="st">&#39;salary&#39;</span>)], </span>
<span id="cb198-51"><a href="#cb198-51" aria-hidden="true" tabindex="-1"></a>               <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">color =</span> forlang))</span>
<span id="cb198-52"><a href="#cb198-52" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ggp, <span class="at">progress =</span> F)</span>
<span id="cb198-53"><a href="#cb198-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-54"><a href="#cb198-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Linear regression model</span></span>
<span id="cb198-55"><a href="#cb198-55" aria-hidden="true" tabindex="-1"></a>model<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(salary <span class="sc">~</span> . <span class="sc">+</span> exper<span class="sc">:</span>educ <span class="sc">+</span> exper<span class="sc">:</span>forlang <span class="sc">+</span> exper<span class="sc">:</span>male, <span class="at">data =</span> df.train)</span>
<span id="cb198-56"><a href="#cb198-56" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model<span class="fl">.1</span>)</span>
<span id="cb198-57"><a href="#cb198-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-58"><a href="#cb198-58" aria-hidden="true" tabindex="-1"></a><span class="do">## Exclude uninfluencial parameters</span></span>
<span id="cb198-59"><a href="#cb198-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Exclude eper:educ as paramaeters are not important</span></span>
<span id="cb198-60"><a href="#cb198-60" aria-hidden="true" tabindex="-1"></a>model<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(salary <span class="sc">~</span> . <span class="sc">+</span> exper<span class="sc">:</span>forlang <span class="sc">+</span> exper<span class="sc">:</span>male, <span class="at">data =</span> df.train)</span>
<span id="cb198-61"><a href="#cb198-61" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model<span class="fl">.2</span>)</span>
<span id="cb198-62"><a href="#cb198-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-63"><a href="#cb198-63" aria-hidden="true" tabindex="-1"></a><span class="co"># Exclude male1:exper</span></span>
<span id="cb198-64"><a href="#cb198-64" aria-hidden="true" tabindex="-1"></a>model<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(salary <span class="sc">~</span> . <span class="sc">+</span> exper<span class="sc">:</span>forlang, <span class="at">data =</span> df.train)</span>
<span id="cb198-65"><a href="#cb198-65" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model<span class="fl">.3</span>)</span>
<span id="cb198-66"><a href="#cb198-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-67"><a href="#cb198-67" aria-hidden="true" tabindex="-1"></a><span class="co"># forlang1 is less important, has no sence</span></span>
<span id="cb198-68"><a href="#cb198-68" aria-hidden="true" tabindex="-1"></a>model<span class="fl">.4</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(salary <span class="sc">~</span> male <span class="sc">+</span> educ <span class="sc">+</span> exper, <span class="at">data =</span> df.train)</span>
<span id="cb198-69"><a href="#cb198-69" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model<span class="fl">.4</span>)</span>
<span id="cb198-70"><a href="#cb198-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-71"><a href="#cb198-71" aria-hidden="true" tabindex="-1"></a>df.train<span class="sc">$</span>educ <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(df.train<span class="sc">$</span>educ)</span>
<span id="cb198-72"><a href="#cb198-72" aria-hidden="true" tabindex="-1"></a>df.test<span class="sc">$</span>educ <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(df.test<span class="sc">$</span>educ)</span>
<span id="cb198-73"><a href="#cb198-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-74"><a href="#cb198-74" aria-hidden="true" tabindex="-1"></a>model<span class="fl">.6</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(salary <span class="sc">~</span> ., <span class="at">data =</span> df.train)</span>
<span id="cb198-75"><a href="#cb198-75" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model<span class="fl">.6</span>)</span>
<span id="cb198-76"><a href="#cb198-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-77"><a href="#cb198-77" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 6 is week, let&#39;s add exper:male interactions</span></span>
<span id="cb198-78"><a href="#cb198-78" aria-hidden="true" tabindex="-1"></a>df.train<span class="sc">$</span>educ <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(df.train<span class="sc">$</span>educ)</span>
<span id="cb198-79"><a href="#cb198-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-80"><a href="#cb198-80" aria-hidden="true" tabindex="-1"></a>model<span class="fl">.7</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(salary <span class="sc">~</span> . <span class="sc">+</span> exper<span class="sc">:</span>male, <span class="at">data =</span> df.train)</span>
<span id="cb198-81"><a href="#cb198-81" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model<span class="fl">.7</span>)</span>
<span id="cb198-82"><a href="#cb198-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-83"><a href="#cb198-83" aria-hidden="true" tabindex="-1"></a><span class="co"># Obviously the best decision is not to use interactions for modeling</span></span>
<span id="cb198-84"><a href="#cb198-84" aria-hidden="true" tabindex="-1"></a><span class="co"># Test remainers</span></span>
<span id="cb198-85"><a href="#cb198-85" aria-hidden="true" tabindex="-1"></a><span class="co"># тест Бройша-Пагана</span></span>
<span id="cb198-86"><a href="#cb198-86" aria-hidden="true" tabindex="-1"></a><span class="fu">bptest</span>(model<span class="fl">.6</span>)</span>
<span id="cb198-87"><a href="#cb198-87" aria-hidden="true" tabindex="-1"></a><span class="co"># статистика Дарбина-Уотсона</span></span>
<span id="cb198-88"><a href="#cb198-88" aria-hidden="true" tabindex="-1"></a><span class="fu">dwtest</span>(model<span class="fl">.6</span>)</span>
<span id="cb198-89"><a href="#cb198-89" aria-hidden="true" tabindex="-1"></a><span class="co"># графики остатков</span></span>
<span id="cb198-90"><a href="#cb198-90" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">4.5</span>, <span class="fl">4.5</span>, <span class="dv">2</span>, <span class="dv">1</span>))</span>
<span id="cb198-91"><a href="#cb198-91" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb198-92"><a href="#cb198-92" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model<span class="fl">.7</span>, <span class="dv">1</span>)</span>
<span id="cb198-93"><a href="#cb198-93" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model<span class="fl">.7</span>, <span class="dv">4</span>)</span>
<span id="cb198-94"><a href="#cb198-94" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model<span class="fl">.7</span>, <span class="dv">5</span>)</span>
<span id="cb198-95"><a href="#cb198-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-96"><a href="#cb198-96" aria-hidden="true" tabindex="-1"></a><span class="do">### Comparison with kNN-method</span></span>
<span id="cb198-97"><a href="#cb198-97" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb198-98"><a href="#cb198-98" aria-hidden="true" tabindex="-1"></a><span class="co"># фактические значения y на тестовой выборке</span></span>
<span id="cb198-99"><a href="#cb198-99" aria-hidden="true" tabindex="-1"></a>y.fact <span class="ot">&lt;-</span> wages.ru[<span class="sc">-</span>inTrain, <span class="dv">1</span>]</span>
<span id="cb198-100"><a href="#cb198-100" aria-hidden="true" tabindex="-1"></a>y.model.lm <span class="ot">&lt;-</span> <span class="fu">predict</span>(model<span class="fl">.6</span>, df.test)</span>
<span id="cb198-101"><a href="#cb198-101" aria-hidden="true" tabindex="-1"></a>MSE.lm <span class="ot">&lt;-</span> <span class="fu">sum</span>((y.model.lm <span class="sc">-</span> y.fact)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> <span class="fu">length</span>(y.model.lm)</span>
<span id="cb198-102"><a href="#cb198-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-103"><a href="#cb198-103" aria-hidden="true" tabindex="-1"></a><span class="co"># kNN требует на вход только числовые переменные</span></span>
<span id="cb198-104"><a href="#cb198-104" aria-hidden="true" tabindex="-1"></a>df.train.num <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">apply</span>(df.train, <span class="dv">2</span>, as.numeric))</span>
<span id="cb198-105"><a href="#cb198-105" aria-hidden="true" tabindex="-1"></a>df.test.num <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">apply</span>(df.test, <span class="dv">2</span>, as.numeric))</span>
<span id="cb198-106"><a href="#cb198-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-107"><a href="#cb198-107" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">50</span>){</span>
<span id="cb198-108"><a href="#cb198-108" aria-hidden="true" tabindex="-1"></a>    model.knn <span class="ot">&lt;-</span> <span class="fu">knn.reg</span>(<span class="at">train =</span> df.train.num[, <span class="sc">!</span>(<span class="fu">colnames</span>(df.train.num) <span class="sc">%in%</span> <span class="st">&#39;salary&#39;</span>)], </span>
<span id="cb198-109"><a href="#cb198-109" aria-hidden="true" tabindex="-1"></a>                         <span class="at">y =</span> df.train.num[, <span class="st">&#39;salary&#39;</span>], </span>
<span id="cb198-110"><a href="#cb198-110" aria-hidden="true" tabindex="-1"></a>                         <span class="at">test =</span> df.test.num, <span class="at">k =</span> i)</span>
<span id="cb198-111"><a href="#cb198-111" aria-hidden="true" tabindex="-1"></a>    y.model.knn <span class="ot">&lt;-</span> model.knn<span class="sc">$</span>pred</span>
<span id="cb198-112"><a href="#cb198-112" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (i <span class="sc">==</span> <span class="dv">2</span>){</span>
<span id="cb198-113"><a href="#cb198-113" aria-hidden="true" tabindex="-1"></a>        MSE.knn <span class="ot">&lt;-</span> <span class="fu">sum</span>((y.model.knn <span class="sc">-</span> y.fact)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> <span class="fu">length</span>(y.model.knn)</span>
<span id="cb198-114"><a href="#cb198-114" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb198-115"><a href="#cb198-115" aria-hidden="true" tabindex="-1"></a>        MSE.knn <span class="ot">&lt;-</span> <span class="fu">c</span>(MSE.knn, </span>
<span id="cb198-116"><a href="#cb198-116" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">sum</span>((y.model.knn <span class="sc">-</span> y.fact)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> <span class="fu">length</span>(y.model.knn))</span>
<span id="cb198-117"><a href="#cb198-117" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb198-118"><a href="#cb198-118" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb198-119"><a href="#cb198-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-120"><a href="#cb198-120" aria-hidden="true" tabindex="-1"></a><span class="co"># график</span></span>
<span id="cb198-121"><a href="#cb198-121" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">4.5</span>, <span class="fl">4.5</span>, <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb198-122"><a href="#cb198-122" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">50</span>, MSE.knn, <span class="at">type =</span> <span class="st">&#39;b&#39;</span>, <span class="at">col =</span> <span class="st">&#39;darkgreen&#39;</span>,</span>
<span id="cb198-123"><a href="#cb198-123" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&#39;значение k&#39;</span>, <span class="at">ylab =</span> <span class="st">&#39;MSE на тестовой выборке&#39;</span>)</span>
<span id="cb198-124"><a href="#cb198-124" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">50</span>, <span class="fu">rep</span>(MSE.lm, <span class="dv">49</span>), <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="fu">grey</span>(<span class="fl">0.2</span>), <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb198-125"><a href="#cb198-125" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&#39;bottomright&#39;</span>, <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="cn">NA</span>), </span>
<span id="cb198-126"><a href="#cb198-126" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&#39;darkgreen&#39;</span>, <span class="fu">grey</span>(<span class="fl">0.2</span>)), </span>
<span id="cb198-127"><a href="#cb198-127" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&#39;k ближайших соседа&#39;</span>, <span class="st">&#39;регрессия (все факторы)&#39;</span>), </span>
<span id="cb198-128"><a href="#cb198-128" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd =</span> <span class="fu">rep</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span></code></pre></div>
<p><strong>Source</strong></p>
<p><a href="https://sites.google.com/a/kiber-guu.ru/r-practice/home">Course ‘Math modeling’ practical work, State University of Management, Moscow</a></p>
</div>
<div id="more-complex-example" class="section level2" number="24.3">
<h2 number="24.3"><span class="header-section-number">24.3</span> More complex example</h2>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Linear regression modeling, compair with kNN</span></span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Source: Course &#39;Math modeling&#39; practical work, State University of Management, Moscow</span></span>
<span id="cb199-4"><a href="#cb199-4" aria-hidden="true" tabindex="-1"></a><span class="co"># link: https://sites.google.com/a/kiber-guu.ru/r-practice/home</span></span>
<span id="cb199-5"><a href="#cb199-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-6"><a href="#cb199-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&#39;GGally&#39;</span>)</span>
<span id="cb199-7"><a href="#cb199-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&#39;lmtest&#39;</span>)</span>
<span id="cb199-8"><a href="#cb199-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&#39;FNN&#39;</span>)</span>
<span id="cb199-9"><a href="#cb199-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-10"><a href="#cb199-10" aria-hidden="true" tabindex="-1"></a><span class="co"># variable</span></span>
<span id="cb199-11"><a href="#cb199-11" aria-hidden="true" tabindex="-1"></a>my.seed <span class="ot">&lt;-</span> <span class="dv">12345</span></span>
<span id="cb199-12"><a href="#cb199-12" aria-hidden="true" tabindex="-1"></a>train.percent <span class="ot">&lt;-</span> <span class="fl">0.85</span></span>
<span id="cb199-13"><a href="#cb199-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-14"><a href="#cb199-14" aria-hidden="true" tabindex="-1"></a>wages.ru <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;~/Projects/data_analysis/DATA/salary.csv&quot;</span>, <span class="at">row.names =</span> <span class="dv">1</span>, <span class="at">sep =</span> <span class="st">&#39;</span><span class="sc">\t</span><span class="st">&#39;</span>, </span>
<span id="cb199-15"><a href="#cb199-15" aria-hidden="true" tabindex="-1"></a>                     <span class="at">as.is =</span> T)  <span class="co"># transform data into factors when possible</span></span>
<span id="cb199-16"><a href="#cb199-16" aria-hidden="true" tabindex="-1"></a>wages.ru<span class="sc">$</span>male <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(wages.ru<span class="sc">$</span>male)</span>
<span id="cb199-17"><a href="#cb199-17" aria-hidden="true" tabindex="-1"></a>wages.ru<span class="sc">$</span>educ <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(wages.ru<span class="sc">$</span>educ)</span>
<span id="cb199-18"><a href="#cb199-18" aria-hidden="true" tabindex="-1"></a>wages.ru<span class="sc">$</span>forlang <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(wages.ru<span class="sc">$</span>forlang)</span>
<span id="cb199-19"><a href="#cb199-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-20"><a href="#cb199-20" aria-hidden="true" tabindex="-1"></a><span class="co"># test data</span></span>
<span id="cb199-21"><a href="#cb199-21" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(my.seed)</span>
<span id="cb199-22"><a href="#cb199-22" aria-hidden="true" tabindex="-1"></a>inTrain <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">seq_along</span>(wages.ru<span class="sc">$</span>salary), </span>
<span id="cb199-23"><a href="#cb199-23" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">nrow</span>(wages.ru) <span class="sc">*</span> train.percent)</span>
<span id="cb199-24"><a href="#cb199-24" aria-hidden="true" tabindex="-1"></a>df.train <span class="ot">&lt;-</span> wages.ru[inTrain, <span class="fu">c</span>(<span class="fu">colnames</span>(wages.ru)[<span class="sc">-</span><span class="dv">1</span>], <span class="fu">colnames</span>(wages.ru)[<span class="dv">1</span>])]</span>
<span id="cb199-25"><a href="#cb199-25" aria-hidden="true" tabindex="-1"></a>df.test <span class="ot">&lt;-</span> wages.ru[<span class="sc">-</span>inTrain, <span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb199-26"><a href="#cb199-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-27"><a href="#cb199-27" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(df.train)</span>
<span id="cb199-28"><a href="#cb199-28" aria-hidden="true" tabindex="-1"></a>ggp <span class="ot">&lt;-</span> <span class="fu">ggpairs</span>(df.train)</span>
<span id="cb199-29"><a href="#cb199-29" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ggp, <span class="at">progress =</span> F)</span>
<span id="cb199-30"><a href="#cb199-30" aria-hidden="true" tabindex="-1"></a><span class="co"># цвета по фактору male</span></span>
<span id="cb199-31"><a href="#cb199-31" aria-hidden="true" tabindex="-1"></a>ggp <span class="ot">&lt;-</span> <span class="fu">ggpairs</span>(df.train[, <span class="fu">c</span>(<span class="st">&#39;exper&#39;</span>, <span class="st">&#39;male&#39;</span>, <span class="st">&#39;salary&#39;</span>)], </span>
<span id="cb199-32"><a href="#cb199-32" aria-hidden="true" tabindex="-1"></a>               <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">color =</span> male))</span>
<span id="cb199-33"><a href="#cb199-33" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ggp, <span class="at">progress =</span> F)</span>
<span id="cb199-34"><a href="#cb199-34" aria-hidden="true" tabindex="-1"></a><span class="co"># цвета по фактору educ</span></span>
<span id="cb199-35"><a href="#cb199-35" aria-hidden="true" tabindex="-1"></a>ggp <span class="ot">&lt;-</span> <span class="fu">ggpairs</span>(df.train[, <span class="fu">c</span>(<span class="st">&#39;exper&#39;</span>, <span class="st">&#39;educ&#39;</span>, <span class="st">&#39;salary&#39;</span>)], </span>
<span id="cb199-36"><a href="#cb199-36" aria-hidden="true" tabindex="-1"></a>               <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">color =</span> educ))</span>
<span id="cb199-37"><a href="#cb199-37" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ggp, <span class="at">progress =</span> F)</span>
<span id="cb199-38"><a href="#cb199-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-39"><a href="#cb199-39" aria-hidden="true" tabindex="-1"></a><span class="co"># цвета по фактору forlang</span></span>
<span id="cb199-40"><a href="#cb199-40" aria-hidden="true" tabindex="-1"></a>ggp <span class="ot">&lt;-</span> <span class="fu">ggpairs</span>(df.train[, <span class="fu">c</span>(<span class="st">&#39;exper&#39;</span>, <span class="st">&#39;forlang&#39;</span>, <span class="st">&#39;salary&#39;</span>)], </span>
<span id="cb199-41"><a href="#cb199-41" aria-hidden="true" tabindex="-1"></a>               <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">color =</span> forlang))</span>
<span id="cb199-42"><a href="#cb199-42" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ggp, <span class="at">progress =</span> F)</span>
<span id="cb199-43"><a href="#cb199-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-44"><a href="#cb199-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Linear regression model</span></span>
<span id="cb199-45"><a href="#cb199-45" aria-hidden="true" tabindex="-1"></a>model<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(salary <span class="sc">~</span> . <span class="sc">+</span> exper<span class="sc">:</span>educ <span class="sc">+</span> exper<span class="sc">:</span>forlang <span class="sc">+</span> exper<span class="sc">:</span>male, <span class="at">data =</span> df.train)</span>
<span id="cb199-46"><a href="#cb199-46" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model<span class="fl">.1</span>)</span>
<span id="cb199-47"><a href="#cb199-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-48"><a href="#cb199-48" aria-hidden="true" tabindex="-1"></a><span class="do">## Exclude uninfluencial parameters</span></span>
<span id="cb199-49"><a href="#cb199-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Exclude eper:educ as paramaeters are not important</span></span>
<span id="cb199-50"><a href="#cb199-50" aria-hidden="true" tabindex="-1"></a>model<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(salary <span class="sc">~</span> . <span class="sc">+</span> exper<span class="sc">:</span>forlang <span class="sc">+</span> exper<span class="sc">:</span>male, <span class="at">data =</span> df.train)</span>
<span id="cb199-51"><a href="#cb199-51" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model<span class="fl">.2</span>)</span>
<span id="cb199-52"><a href="#cb199-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-53"><a href="#cb199-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Exclude male1:exper</span></span>
<span id="cb199-54"><a href="#cb199-54" aria-hidden="true" tabindex="-1"></a>model<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(salary <span class="sc">~</span> . <span class="sc">+</span> exper<span class="sc">:</span>forlang, <span class="at">data =</span> df.train)</span>
<span id="cb199-55"><a href="#cb199-55" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model<span class="fl">.3</span>)</span>
<span id="cb199-56"><a href="#cb199-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-57"><a href="#cb199-57" aria-hidden="true" tabindex="-1"></a><span class="co"># forlang1 is less important, has no sence</span></span>
<span id="cb199-58"><a href="#cb199-58" aria-hidden="true" tabindex="-1"></a>model<span class="fl">.4</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(salary <span class="sc">~</span> male <span class="sc">+</span> educ <span class="sc">+</span> exper, <span class="at">data =</span> df.train)</span>
<span id="cb199-59"><a href="#cb199-59" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model<span class="fl">.4</span>)</span>
<span id="cb199-60"><a href="#cb199-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-61"><a href="#cb199-61" aria-hidden="true" tabindex="-1"></a>df.train<span class="sc">$</span>educ <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(df.train<span class="sc">$</span>educ)</span>
<span id="cb199-62"><a href="#cb199-62" aria-hidden="true" tabindex="-1"></a>df.test<span class="sc">$</span>educ <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(df.test<span class="sc">$</span>educ)</span>
<span id="cb199-63"><a href="#cb199-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-64"><a href="#cb199-64" aria-hidden="true" tabindex="-1"></a>model<span class="fl">.6</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(salary <span class="sc">~</span> ., <span class="at">data =</span> df.train)</span>
<span id="cb199-65"><a href="#cb199-65" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model<span class="fl">.6</span>)</span>
<span id="cb199-66"><a href="#cb199-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-67"><a href="#cb199-67" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 6 is week, let&#39;s add exper:male interactions</span></span>
<span id="cb199-68"><a href="#cb199-68" aria-hidden="true" tabindex="-1"></a>df.train<span class="sc">$</span>educ <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(df.train<span class="sc">$</span>educ)</span>
<span id="cb199-69"><a href="#cb199-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-70"><a href="#cb199-70" aria-hidden="true" tabindex="-1"></a>model<span class="fl">.7</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(salary <span class="sc">~</span> . <span class="sc">+</span> exper<span class="sc">:</span>male, <span class="at">data =</span> df.train)</span>
<span id="cb199-71"><a href="#cb199-71" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model<span class="fl">.7</span>)</span>
<span id="cb199-72"><a href="#cb199-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-73"><a href="#cb199-73" aria-hidden="true" tabindex="-1"></a><span class="co"># Obviously the best decision is not to use interactions for modeling</span></span>
<span id="cb199-74"><a href="#cb199-74" aria-hidden="true" tabindex="-1"></a><span class="co"># Test remainers</span></span>
<span id="cb199-75"><a href="#cb199-75" aria-hidden="true" tabindex="-1"></a><span class="co"># тест Бройша-Пагана</span></span>
<span id="cb199-76"><a href="#cb199-76" aria-hidden="true" tabindex="-1"></a><span class="fu">bptest</span>(model<span class="fl">.6</span>)</span>
<span id="cb199-77"><a href="#cb199-77" aria-hidden="true" tabindex="-1"></a><span class="co"># статистика Дарбина-Уотсона</span></span>
<span id="cb199-78"><a href="#cb199-78" aria-hidden="true" tabindex="-1"></a><span class="fu">dwtest</span>(model<span class="fl">.6</span>)</span>
<span id="cb199-79"><a href="#cb199-79" aria-hidden="true" tabindex="-1"></a><span class="co"># графики остатков</span></span>
<span id="cb199-80"><a href="#cb199-80" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">4.5</span>, <span class="fl">4.5</span>, <span class="dv">2</span>, <span class="dv">1</span>))</span>
<span id="cb199-81"><a href="#cb199-81" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb199-82"><a href="#cb199-82" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model<span class="fl">.7</span>, <span class="dv">1</span>)</span>
<span id="cb199-83"><a href="#cb199-83" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model<span class="fl">.7</span>, <span class="dv">4</span>)</span>
<span id="cb199-84"><a href="#cb199-84" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model<span class="fl">.7</span>, <span class="dv">5</span>)</span>
<span id="cb199-85"><a href="#cb199-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-86"><a href="#cb199-86" aria-hidden="true" tabindex="-1"></a><span class="do">### Comparison with kNN-method</span></span>
<span id="cb199-87"><a href="#cb199-87" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb199-88"><a href="#cb199-88" aria-hidden="true" tabindex="-1"></a><span class="co"># фактические значения y на тестовой выборке</span></span>
<span id="cb199-89"><a href="#cb199-89" aria-hidden="true" tabindex="-1"></a>y.fact <span class="ot">&lt;-</span> wages.ru[<span class="sc">-</span>inTrain, <span class="dv">1</span>]</span>
<span id="cb199-90"><a href="#cb199-90" aria-hidden="true" tabindex="-1"></a>y.model.lm <span class="ot">&lt;-</span> <span class="fu">predict</span>(model<span class="fl">.6</span>, df.test)</span>
<span id="cb199-91"><a href="#cb199-91" aria-hidden="true" tabindex="-1"></a>MSE.lm <span class="ot">&lt;-</span> <span class="fu">sum</span>((y.model.lm <span class="sc">-</span> y.fact)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> <span class="fu">length</span>(y.model.lm)</span>
<span id="cb199-92"><a href="#cb199-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-93"><a href="#cb199-93" aria-hidden="true" tabindex="-1"></a><span class="co"># kNN требует на вход только числовые переменные</span></span>
<span id="cb199-94"><a href="#cb199-94" aria-hidden="true" tabindex="-1"></a>df.train.num <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">apply</span>(df.train, <span class="dv">2</span>, as.numeric))</span>
<span id="cb199-95"><a href="#cb199-95" aria-hidden="true" tabindex="-1"></a>df.test.num <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">apply</span>(df.test, <span class="dv">2</span>, as.numeric))</span>
<span id="cb199-96"><a href="#cb199-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-97"><a href="#cb199-97" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">50</span>){</span>
<span id="cb199-98"><a href="#cb199-98" aria-hidden="true" tabindex="-1"></a>    model.knn <span class="ot">&lt;-</span> <span class="fu">knn.reg</span>(<span class="at">train =</span> df.train.num[, <span class="sc">!</span>(<span class="fu">colnames</span>(df.train.num) <span class="sc">%in%</span> <span class="st">&#39;salary&#39;</span>)], </span>
<span id="cb199-99"><a href="#cb199-99" aria-hidden="true" tabindex="-1"></a>                         <span class="at">y =</span> df.train.num[, <span class="st">&#39;salary&#39;</span>], </span>
<span id="cb199-100"><a href="#cb199-100" aria-hidden="true" tabindex="-1"></a>                         <span class="at">test =</span> df.test.num, <span class="at">k =</span> i)</span>
<span id="cb199-101"><a href="#cb199-101" aria-hidden="true" tabindex="-1"></a>    y.model.knn <span class="ot">&lt;-</span> model.knn<span class="sc">$</span>pred</span>
<span id="cb199-102"><a href="#cb199-102" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (i <span class="sc">==</span> <span class="dv">2</span>){</span>
<span id="cb199-103"><a href="#cb199-103" aria-hidden="true" tabindex="-1"></a>        MSE.knn <span class="ot">&lt;-</span> <span class="fu">sum</span>((y.model.knn <span class="sc">-</span> y.fact)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> <span class="fu">length</span>(y.model.knn)</span>
<span id="cb199-104"><a href="#cb199-104" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb199-105"><a href="#cb199-105" aria-hidden="true" tabindex="-1"></a>        MSE.knn <span class="ot">&lt;-</span> <span class="fu">c</span>(MSE.knn, </span>
<span id="cb199-106"><a href="#cb199-106" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">sum</span>((y.model.knn <span class="sc">-</span> y.fact)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> <span class="fu">length</span>(y.model.knn))</span>
<span id="cb199-107"><a href="#cb199-107" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb199-108"><a href="#cb199-108" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb199-109"><a href="#cb199-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-110"><a href="#cb199-110" aria-hidden="true" tabindex="-1"></a><span class="co"># график</span></span>
<span id="cb199-111"><a href="#cb199-111" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">4.5</span>, <span class="fl">4.5</span>, <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb199-112"><a href="#cb199-112" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">50</span>, MSE.knn, <span class="at">type =</span> <span class="st">&#39;b&#39;</span>, <span class="at">col =</span> <span class="st">&#39;darkgreen&#39;</span>,</span>
<span id="cb199-113"><a href="#cb199-113" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&#39;значение k&#39;</span>, <span class="at">ylab =</span> <span class="st">&#39;MSE на тестовой выборке&#39;</span>)</span>
<span id="cb199-114"><a href="#cb199-114" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">50</span>, <span class="fu">rep</span>(MSE.lm, <span class="dv">49</span>), <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="fu">grey</span>(<span class="fl">0.2</span>), <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb199-115"><a href="#cb199-115" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&#39;bottomright&#39;</span>, <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="cn">NA</span>), </span>
<span id="cb199-116"><a href="#cb199-116" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&#39;darkgreen&#39;</span>, <span class="fu">grey</span>(<span class="fl">0.2</span>)), </span>
<span id="cb199-117"><a href="#cb199-117" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&#39;k ближайших соседа&#39;</span>, <span class="st">&#39;регрессия (все факторы)&#39;</span>), </span>
<span id="cb199-118"><a href="#cb199-118" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd =</span> <span class="fu">rep</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span></code></pre></div>
</div>
<div id="next-part" class="section level2" number="24.4">
<h2 number="24.4"><span class="header-section-number">24.4</span> NEXT part</h2>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Linear regression (part 1)</span></span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-4"><a href="#cb200-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Linear Regression (part 2)</span></span>
<span id="cb200-5"><a href="#cb200-5" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;~/DataAnalysis/R_data_analysis/DATA/Diamond.dat&quot;</span>, <span class="at">header=</span>T)</span>
<span id="cb200-6"><a href="#cb200-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-7"><a href="#cb200-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Check 3 models</span></span>
<span id="cb200-8"><a href="#cb200-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. ax+b</span></span>
<span id="cb200-9"><a href="#cb200-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. ax^2+b</span></span>
<span id="cb200-10"><a href="#cb200-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. ax^2+bx+c</span></span>
<span id="cb200-11"><a href="#cb200-11" aria-hidden="true" tabindex="-1"></a>res<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(x[,<span class="dv">2</span>]<span class="sc">~</span>x[,<span class="dv">1</span>])</span>
<span id="cb200-12"><a href="#cb200-12" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(res<span class="fl">.1</span>)</span>
<span id="cb200-13"><a href="#cb200-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-14"><a href="#cb200-14" aria-hidden="true" tabindex="-1"></a>ves2 <span class="ot">&lt;-</span> x[,<span class="dv">1</span>]<span class="sc">*</span>x[,<span class="dv">1</span>]</span>
<span id="cb200-15"><a href="#cb200-15" aria-hidden="true" tabindex="-1"></a>res<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(x[,<span class="dv">2</span>]<span class="sc">~</span>ves2)</span>
<span id="cb200-16"><a href="#cb200-16" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(res<span class="fl">.2</span>)</span>
<span id="cb200-17"><a href="#cb200-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-18"><a href="#cb200-18" aria-hidden="true" tabindex="-1"></a>res<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(x[,<span class="dv">2</span>]<span class="sc">~</span>x[,<span class="dv">1</span>]<span class="sc">+</span>ves2)</span>
<span id="cb200-19"><a href="#cb200-19" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(res<span class="fl">.3</span>)</span>
<span id="cb200-20"><a href="#cb200-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-21"><a href="#cb200-21" aria-hidden="true" tabindex="-1"></a><span class="co"># weight of diamands ~ weight^2</span></span>
<span id="cb200-22"><a href="#cb200-22" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x[,<span class="dv">1</span>]<span class="sc">~</span>ves2) </span>
<span id="cb200-23"><a href="#cb200-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-24"><a href="#cb200-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Conclusion: from 3 models, the 2d is optimal</span></span>
<span id="cb200-25"><a href="#cb200-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-26"><a href="#cb200-26" aria-hidden="true" tabindex="-1"></a><span class="do">### Временные ряды</span></span>
<span id="cb200-27"><a href="#cb200-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-28"><a href="#cb200-28" aria-hidden="true" tabindex="-1"></a>ser.g<span class="fl">.01</span> <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;~/DataAnalysis/R_data_analysis/DATA/series_g.csv&quot;</span>, <span class="at">header=</span>T, <span class="at">sep=</span><span class="st">&quot;;&quot;</span>)</span>
<span id="cb200-29"><a href="#cb200-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-30"><a href="#cb200-30" aria-hidden="true" tabindex="-1"></a><span class="co"># visual inspection</span></span>
<span id="cb200-31"><a href="#cb200-31" aria-hidden="true" tabindex="-1"></a>ser.g<span class="fl">.01</span></span>
<span id="cb200-32"><a href="#cb200-32" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(ser.g<span class="fl">.01</span>)</span>
<span id="cb200-33"><a href="#cb200-33" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(ser.g<span class="fl">.01</span>)</span>
<span id="cb200-34"><a href="#cb200-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-35"><a href="#cb200-35" aria-hidden="true" tabindex="-1"></a><span class="co"># plot vaiable</span></span>
<span id="cb200-36"><a href="#cb200-36" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ser.g<span class="fl">.01</span><span class="sc">$</span>series_g, <span class="at">type=</span><span class="st">&quot;l&quot;</span>)</span>
<span id="cb200-37"><a href="#cb200-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-38"><a href="#cb200-38" aria-hidden="true" tabindex="-1"></a>log.ser.g <span class="ot">&lt;-</span> <span class="fu">log</span>(ser.g<span class="fl">.01</span><span class="sc">$</span>series_g)</span>
<span id="cb200-39"><a href="#cb200-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-40"><a href="#cb200-40" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(log.ser.g, <span class="at">type=</span><span class="st">&quot;l&quot;</span>)</span>
<span id="cb200-41"><a href="#cb200-41" aria-hidden="true" tabindex="-1"></a>time. <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>(<span class="dv">144</span><span class="sc">+</span><span class="dv">12</span>)</span>
<span id="cb200-42"><a href="#cb200-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-43"><a href="#cb200-43" aria-hidden="true" tabindex="-1"></a>month<span class="fl">.01</span> <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="dv">12</span><span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb200-44"><a href="#cb200-44" aria-hidden="true" tabindex="-1"></a>month<span class="fl">.02</span> <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="dv">12</span><span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb200-45"><a href="#cb200-45" aria-hidden="true" tabindex="-1"></a>month<span class="fl">.03</span> <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="dv">12</span><span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb200-46"><a href="#cb200-46" aria-hidden="true" tabindex="-1"></a>month<span class="fl">.04</span> <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="dv">12</span><span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb200-47"><a href="#cb200-47" aria-hidden="true" tabindex="-1"></a>month<span class="fl">.05</span> <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="dv">12</span><span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb200-48"><a href="#cb200-48" aria-hidden="true" tabindex="-1"></a>month<span class="fl">.06</span> <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="dv">12</span><span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb200-49"><a href="#cb200-49" aria-hidden="true" tabindex="-1"></a>month<span class="fl">.07</span> <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="dv">12</span><span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb200-50"><a href="#cb200-50" aria-hidden="true" tabindex="-1"></a>month<span class="fl">.08</span> <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="dv">12</span><span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb200-51"><a href="#cb200-51" aria-hidden="true" tabindex="-1"></a>month<span class="fl">.09</span> <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="dv">12</span><span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb200-52"><a href="#cb200-52" aria-hidden="true" tabindex="-1"></a>month<span class="fl">.10</span> <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="dv">12</span><span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb200-53"><a href="#cb200-53" aria-hidden="true" tabindex="-1"></a>month<span class="fl">.11</span> <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>), <span class="dv">12</span><span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb200-54"><a href="#cb200-54" aria-hidden="true" tabindex="-1"></a>month<span class="fl">.12</span> <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>), <span class="dv">12</span><span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb200-55"><a href="#cb200-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-56"><a href="#cb200-56" aria-hidden="true" tabindex="-1"></a>log.ser.g[<span class="dv">145</span><span class="sc">:</span>(<span class="dv">144</span><span class="sc">+</span><span class="dv">12</span>)] <span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb200-57"><a href="#cb200-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-58"><a href="#cb200-58" aria-hidden="true" tabindex="-1"></a>ser.g<span class="fl">.02</span> <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(log.ser.g, time., month<span class="fl">.01</span>, month<span class="fl">.02</span>, month<span class="fl">.03</span>, </span>
<span id="cb200-59"><a href="#cb200-59" aria-hidden="true" tabindex="-1"></a>                       month<span class="fl">.04</span>, month<span class="fl">.05</span>, month<span class="fl">.06</span>, month<span class="fl">.07</span>, month<span class="fl">.08</span>, month<span class="fl">.09</span>, month<span class="fl">.10</span>, </span>
<span id="cb200-60"><a href="#cb200-60" aria-hidden="true" tabindex="-1"></a>                       month<span class="fl">.11</span>, month<span class="fl">.12</span>)</span>
<span id="cb200-61"><a href="#cb200-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-62"><a href="#cb200-62" aria-hidden="true" tabindex="-1"></a>ser.g<span class="fl">.02</span></span>
<span id="cb200-63"><a href="#cb200-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-64"><a href="#cb200-64" aria-hidden="true" tabindex="-1"></a>res<span class="fl">.01</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(log.ser.g <span class="sc">~</span> time. <span class="sc">+</span>              month<span class="fl">.02</span> <span class="sc">+</span> month<span class="fl">.03</span> <span class="sc">+</span> month<span class="fl">.04</span> <span class="sc">+</span> </span>
<span id="cb200-65"><a href="#cb200-65" aria-hidden="true" tabindex="-1"></a>                 month<span class="fl">.05</span> <span class="sc">+</span> month<span class="fl">.06</span> <span class="sc">+</span> month<span class="fl">.07</span> <span class="sc">+</span> month<span class="fl">.08</span> <span class="sc">+</span> month<span class="fl">.09</span> <span class="sc">+</span> month<span class="fl">.10</span> <span class="sc">+</span> </span>
<span id="cb200-66"><a href="#cb200-66" aria-hidden="true" tabindex="-1"></a>                 month<span class="fl">.11</span> <span class="sc">+</span> month<span class="fl">.12</span>, ser.g<span class="fl">.02</span>)</span>
<span id="cb200-67"><a href="#cb200-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-68"><a href="#cb200-68" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(res<span class="fl">.01</span>)</span>
<span id="cb200-69"><a href="#cb200-69" aria-hidden="true" tabindex="-1"></a>res<span class="fl">.01</span><span class="sc">$</span>fitted.values</span>
<span id="cb200-70"><a href="#cb200-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-71"><a href="#cb200-71" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ser.g<span class="fl">.02</span><span class="sc">$</span>log.ser.g, <span class="at">type=</span><span class="st">&quot;l&quot;</span>)</span>
<span id="cb200-72"><a href="#cb200-72" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(res<span class="fl">.01</span><span class="sc">$</span>fitted.values)</span>
<span id="cb200-73"><a href="#cb200-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-74"><a href="#cb200-74" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ser.g<span class="fl">.02</span><span class="sc">$</span>log.ser.g, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">col=</span><span class="st">&quot;green&quot;</span>)</span>
<span id="cb200-75"><a href="#cb200-75" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(res<span class="fl">.01</span><span class="sc">$</span>fitted.values, <span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb200-76"><a href="#cb200-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-77"><a href="#cb200-77" aria-hidden="true" tabindex="-1"></a>x.lg <span class="ot">=</span> <span class="fu">predict.lm</span>(res<span class="fl">.01</span>, ser.g<span class="fl">.02</span>)</span>
<span id="cb200-78"><a href="#cb200-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-79"><a href="#cb200-79" aria-hidden="true" tabindex="-1"></a>x.lg</span>
<span id="cb200-80"><a href="#cb200-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-81"><a href="#cb200-81" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x.lg, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb200-82"><a href="#cb200-82" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(ser.g<span class="fl">.02</span><span class="sc">$</span>log.ser.g, <span class="at">col=</span><span class="st">&quot;green&quot;</span>)</span>
<span id="cb200-83"><a href="#cb200-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-84"><a href="#cb200-84" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">exp</span>(x.lg)</span>
<span id="cb200-85"><a href="#cb200-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-86"><a href="#cb200-86" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(y, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb200-87"><a href="#cb200-87" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(ser.g<span class="fl">.01</span><span class="sc">$</span>series_g, <span class="at">col=</span><span class="st">&quot;green&quot;</span>)</span></code></pre></div>
</div>
<div id="next-part-1" class="section level2" number="24.5">
<h2 number="24.5"><span class="header-section-number">24.5</span> NEXT Part</h2>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="co"># провести отбор оптимального подмножества переменных;</span></span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a><span class="co"># отобрать предикторы методами пошагового включения и исключения;</span></span>
<span id="cb201-3"><a href="#cb201-3" aria-hidden="true" tabindex="-1"></a><span class="co"># как построить ридж- и лассо-регрессию;</span></span>
<span id="cb201-4"><a href="#cb201-4" aria-hidden="true" tabindex="-1"></a><span class="co"># как использовать снижение размерности: PCR и PLS;</span></span>
<span id="cb201-5"><a href="#cb201-5" aria-hidden="true" tabindex="-1"></a><span class="co"># как применять эти методы в сочетании с кросс-валидацией.</span></span>
<span id="cb201-6"><a href="#cb201-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-7"><a href="#cb201-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&#39;ISLR&#39;</span>)              <span class="co"># набор данных Hitters</span></span>
<span id="cb201-8"><a href="#cb201-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&#39;leaps&#39;</span>)             <span class="co"># функция regsubset() -- отбор оптимального </span></span>
<span id="cb201-9"><a href="#cb201-9" aria-hidden="true" tabindex="-1"></a><span class="co">#  подмножества переменных</span></span>
<span id="cb201-10"><a href="#cb201-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&#39;glmnet&#39;</span>)            <span class="co"># функция glmnet() -- лассо</span></span>
<span id="cb201-11"><a href="#cb201-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&#39;pls&#39;</span>)               <span class="co"># регрессия на главные компоненты -- pcr()</span></span>
<span id="cb201-12"><a href="#cb201-12" aria-hidden="true" tabindex="-1"></a><span class="co">#  и частный МНК -- plsr()</span></span>
<span id="cb201-13"><a href="#cb201-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-14"><a href="#cb201-14" aria-hidden="true" tabindex="-1"></a>my.seed <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb201-15"><a href="#cb201-15" aria-hidden="true" tabindex="-1"></a>?Hitters</span>
<span id="cb201-16"><a href="#cb201-16" aria-hidden="true" tabindex="-1"></a><span class="fu">fix</span>(Hitters)</span>
<span id="cb201-17"><a href="#cb201-17" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(Hitters)</span>
<span id="cb201-18"><a href="#cb201-18" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(Hitters)</span>
<span id="cb201-19"><a href="#cb201-19" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(Hitters<span class="sc">$</span>Salary))</span>
<span id="cb201-20"><a href="#cb201-20" aria-hidden="true" tabindex="-1"></a>Hitters <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(Hitters)</span>
<span id="cb201-21"><a href="#cb201-21" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(Hitters)</span>
<span id="cb201-22"><a href="#cb201-22" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(Hitters<span class="sc">$</span>Salary))</span>
<span id="cb201-23"><a href="#cb201-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-24"><a href="#cb201-24" aria-hidden="true" tabindex="-1"></a><span class="do">##  Отбор оптимального подмножества</span></span>
<span id="cb201-25"><a href="#cb201-25" aria-hidden="true" tabindex="-1"></a><span class="co"># подгоняем модели с сочетаниями предикторов до 8 включительно</span></span>
<span id="cb201-26"><a href="#cb201-26" aria-hidden="true" tabindex="-1"></a>regfit.full <span class="ot">&lt;-</span> <span class="fu">regsubsets</span>(Salary <span class="sc">~</span> ., Hitters)</span>
<span id="cb201-27"><a href="#cb201-27" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(regfit.full)</span>
<span id="cb201-28"><a href="#cb201-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-29"><a href="#cb201-29" aria-hidden="true" tabindex="-1"></a><span class="co"># подгоняем модели с сочетаниями предикторов до 19 (максимум в данных)</span></span>
<span id="cb201-30"><a href="#cb201-30" aria-hidden="true" tabindex="-1"></a>regfit.full <span class="ot">&lt;-</span> <span class="fu">regsubsets</span>(Salary <span class="sc">~</span> ., Hitters, <span class="at">nvmax =</span> <span class="dv">19</span>)</span>
<span id="cb201-31"><a href="#cb201-31" aria-hidden="true" tabindex="-1"></a>reg.summary <span class="ot">&lt;-</span> <span class="fu">summary</span>(regfit.full)</span>
<span id="cb201-32"><a href="#cb201-32" aria-hidden="true" tabindex="-1"></a>reg.summary</span>
<span id="cb201-33"><a href="#cb201-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-34"><a href="#cb201-34" aria-hidden="true" tabindex="-1"></a><span class="co"># структура отчёта по модели (ищем характеристики качества)</span></span>
<span id="cb201-35"><a href="#cb201-35" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(reg.summary)</span>
<span id="cb201-36"><a href="#cb201-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-37"><a href="#cb201-37" aria-hidden="true" tabindex="-1"></a><span class="co"># R^2 и скорректированный R^2</span></span>
<span id="cb201-38"><a href="#cb201-38" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(reg.summary<span class="sc">$</span>rsq, <span class="dv">3</span>)</span>
<span id="cb201-39"><a href="#cb201-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-40"><a href="#cb201-40" aria-hidden="true" tabindex="-1"></a><span class="co"># на графике</span></span>
<span id="cb201-41"><a href="#cb201-41" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">19</span>, reg.summary<span class="sc">$</span>rsq, <span class="at">type =</span> <span class="st">&#39;b&#39;</span>,</span>
<span id="cb201-42"><a href="#cb201-42" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&#39;Количество предикторов&#39;</span>, <span class="at">ylab =</span> <span class="st">&#39;R-квадрат&#39;</span>)</span>
<span id="cb201-43"><a href="#cb201-43" aria-hidden="true" tabindex="-1"></a><span class="co"># сода же добавим скорректированный R-квадрат</span></span>
<span id="cb201-44"><a href="#cb201-44" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">19</span>, reg.summary<span class="sc">$</span>adjr2, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>)</span>
<span id="cb201-45"><a href="#cb201-45" aria-hidden="true" tabindex="-1"></a><span class="co"># модель с максимальным скорректированным R-квадратом</span></span>
<span id="cb201-46"><a href="#cb201-46" aria-hidden="true" tabindex="-1"></a><span class="fu">which.max</span>(reg.summary<span class="sc">$</span>adjr2)</span>
<span id="cb201-47"><a href="#cb201-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-48"><a href="#cb201-48" aria-hidden="true" tabindex="-1"></a><span class="do">### 11</span></span>
<span id="cb201-49"><a href="#cb201-49" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="fu">which.max</span>(reg.summary<span class="sc">$</span>adjr2), </span>
<span id="cb201-50"><a href="#cb201-50" aria-hidden="true" tabindex="-1"></a>       reg.summary<span class="sc">$</span>adjr2[<span class="fu">which.max</span>(reg.summary<span class="sc">$</span>adjr2)],</span>
<span id="cb201-51"><a href="#cb201-51" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">&#39;red&#39;</span>, <span class="at">cex =</span> <span class="dv">2</span>, <span class="at">pch =</span> <span class="dv">20</span>)</span>
<span id="cb201-52"><a href="#cb201-52" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&#39;bottomright&#39;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&#39;R^2&#39;</span>, <span class="st">&#39;R^2_adg&#39;</span>),</span>
<span id="cb201-53"><a href="#cb201-53" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&#39;black&#39;</span>, <span class="st">&#39;red&#39;</span>), <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="cn">NA</span>),</span>
<span id="cb201-54"><a href="#cb201-54" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb201-55"><a href="#cb201-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-56"><a href="#cb201-56" aria-hidden="true" tabindex="-1"></a><span class="co"># C_p</span></span>
<span id="cb201-57"><a href="#cb201-57" aria-hidden="true" tabindex="-1"></a>reg.summary<span class="sc">$</span>cp</span>
<span id="cb201-58"><a href="#cb201-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-59"><a href="#cb201-59" aria-hidden="true" tabindex="-1"></a><span class="co"># число предикторов у оптимального значения критерия</span></span>
<span id="cb201-60"><a href="#cb201-60" aria-hidden="true" tabindex="-1"></a><span class="fu">which.min</span>(reg.summary<span class="sc">$</span>cp)</span>
<span id="cb201-61"><a href="#cb201-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-62"><a href="#cb201-62" aria-hidden="true" tabindex="-1"></a><span class="do">### 10</span></span>
<span id="cb201-63"><a href="#cb201-63" aria-hidden="true" tabindex="-1"></a><span class="co"># график</span></span>
<span id="cb201-64"><a href="#cb201-64" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(reg.summary<span class="sc">$</span>cp, <span class="at">xlab =</span> <span class="st">&#39;Число предикторов&#39;</span>,</span>
<span id="cb201-65"><a href="#cb201-65" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&#39;C_p&#39;</span>, <span class="at">type =</span> <span class="st">&#39;b&#39;</span>)</span>
<span id="cb201-66"><a href="#cb201-66" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="fu">which.min</span>(reg.summary<span class="sc">$</span>cp),</span>
<span id="cb201-67"><a href="#cb201-67" aria-hidden="true" tabindex="-1"></a>       reg.summary<span class="sc">$</span>cp[<span class="fu">which.min</span>(reg.summary<span class="sc">$</span>cp)], </span>
<span id="cb201-68"><a href="#cb201-68" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">&#39;red&#39;</span>, <span class="at">cex =</span> <span class="dv">2</span>, <span class="at">pch =</span> <span class="dv">20</span>)</span>
<span id="cb201-69"><a href="#cb201-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-70"><a href="#cb201-70" aria-hidden="true" tabindex="-1"></a><span class="co"># BIC</span></span>
<span id="cb201-71"><a href="#cb201-71" aria-hidden="true" tabindex="-1"></a>reg.summary<span class="sc">$</span>bic</span>
<span id="cb201-72"><a href="#cb201-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-73"><a href="#cb201-73" aria-hidden="true" tabindex="-1"></a><span class="co"># число предикторов у оптимального значения критерия</span></span>
<span id="cb201-74"><a href="#cb201-74" aria-hidden="true" tabindex="-1"></a><span class="fu">which.min</span>(reg.summary<span class="sc">$</span>bic)</span>
<span id="cb201-75"><a href="#cb201-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-76"><a href="#cb201-76" aria-hidden="true" tabindex="-1"></a><span class="do">### 6</span></span>
<span id="cb201-77"><a href="#cb201-77" aria-hidden="true" tabindex="-1"></a><span class="co"># график</span></span>
<span id="cb201-78"><a href="#cb201-78" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(reg.summary<span class="sc">$</span>bic, <span class="at">xlab =</span> <span class="st">&#39;Число предикторов&#39;</span>,</span>
<span id="cb201-79"><a href="#cb201-79" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&#39;BIC&#39;</span>, <span class="at">type =</span> <span class="st">&#39;b&#39;</span>)</span>
<span id="cb201-80"><a href="#cb201-80" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="fu">which.min</span>(reg.summary<span class="sc">$</span>bic),</span>
<span id="cb201-81"><a href="#cb201-81" aria-hidden="true" tabindex="-1"></a>       reg.summary<span class="sc">$</span>bic[<span class="fu">which.min</span>(reg.summary<span class="sc">$</span>bic)], </span>
<span id="cb201-82"><a href="#cb201-82" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">&#39;red&#39;</span>, <span class="at">cex =</span> <span class="dv">2</span>, <span class="at">pch =</span> <span class="dv">20</span>)</span>
<span id="cb201-83"><a href="#cb201-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-84"><a href="#cb201-84" aria-hidden="true" tabindex="-1"></a><span class="co"># метод plot для визуализации результатов</span></span>
<span id="cb201-85"><a href="#cb201-85" aria-hidden="true" tabindex="-1"></a>?plot.regsubsets</span>
<span id="cb201-86"><a href="#cb201-86" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(regfit.full, <span class="at">scale =</span> <span class="st">&#39;r2&#39;</span>)</span>
<span id="cb201-87"><a href="#cb201-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-88"><a href="#cb201-88" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(regfit.full, <span class="at">scale =</span> <span class="st">&#39;adjr2&#39;</span>)</span>
<span id="cb201-89"><a href="#cb201-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-90"><a href="#cb201-90" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(regfit.full, <span class="at">scale =</span> <span class="st">&#39;Cp&#39;</span>)</span>
<span id="cb201-91"><a href="#cb201-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-92"><a href="#cb201-92" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(regfit.full, <span class="at">scale =</span> <span class="st">&#39;bic&#39;</span>)</span>
<span id="cb201-93"><a href="#cb201-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-94"><a href="#cb201-94" aria-hidden="true" tabindex="-1"></a><span class="co"># коэффициенты модели с наименьшим BIC</span></span>
<span id="cb201-95"><a href="#cb201-95" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">coef</span>(regfit.full, <span class="dv">6</span>), <span class="dv">3</span>)</span>
<span id="cb201-96"><a href="#cb201-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-97"><a href="#cb201-97" aria-hidden="true" tabindex="-1"></a><span class="do">##  Отбор путём пошагового включения и исключения переменных</span></span>
<span id="cb201-98"><a href="#cb201-98" aria-hidden="true" tabindex="-1"></a><span class="co"># Пошаговое включение</span></span>
<span id="cb201-99"><a href="#cb201-99" aria-hidden="true" tabindex="-1"></a>regfit.fwd <span class="ot">&lt;-</span> <span class="fu">regsubsets</span>(Salary <span class="sc">~</span> ., <span class="at">data =</span> Hitters, <span class="at">nvmax =</span> <span class="dv">19</span>, <span class="at">method =</span> <span class="st">&#39;forward&#39;</span>)</span>
<span id="cb201-100"><a href="#cb201-100" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(regfit.fwd)</span>
<span id="cb201-101"><a href="#cb201-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-102"><a href="#cb201-102" aria-hidden="true" tabindex="-1"></a>regfit.bwd <span class="ot">&lt;-</span> <span class="fu">regsubsets</span>(Salary <span class="sc">~</span> ., <span class="at">data =</span> Hitters,</span>
<span id="cb201-103"><a href="#cb201-103" aria-hidden="true" tabindex="-1"></a>                         <span class="at">nvmax =</span> <span class="dv">19</span>, <span class="at">method =</span> <span class="st">&#39;backward&#39;</span>)</span>
<span id="cb201-104"><a href="#cb201-104" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(regfit.bwd)</span>
<span id="cb201-105"><a href="#cb201-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-106"><a href="#cb201-106" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">coef</span>(regfit.full, <span class="dv">7</span>), <span class="dv">3</span>)</span>
<span id="cb201-107"><a href="#cb201-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-108"><a href="#cb201-108" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">coef</span>(regfit.fwd, <span class="dv">7</span>), <span class="dv">3</span>)</span>
<span id="cb201-109"><a href="#cb201-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-110"><a href="#cb201-110" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">coef</span>(regfit.bwd, <span class="dv">7</span>), <span class="dv">3</span>)</span>
<span id="cb201-111"><a href="#cb201-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-112"><a href="#cb201-112" aria-hidden="true" tabindex="-1"></a><span class="do">### Нахождение оптимальной модели при помощи методов проверочной выборки и перекрёстной проверки</span></span>
<span id="cb201-113"><a href="#cb201-113" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(my.seed)</span>
<span id="cb201-114"><a href="#cb201-114" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(T, F), <span class="fu">nrow</span>(Hitters), <span class="at">rep =</span> T)</span>
<span id="cb201-115"><a href="#cb201-115" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> <span class="sc">!</span>train</span>
<span id="cb201-116"><a href="#cb201-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-117"><a href="#cb201-117" aria-hidden="true" tabindex="-1"></a><span class="co"># обучаем модели</span></span>
<span id="cb201-118"><a href="#cb201-118" aria-hidden="true" tabindex="-1"></a>regfit.best <span class="ot">&lt;-</span> <span class="fu">regsubsets</span>(Salary <span class="sc">~</span> ., <span class="at">data =</span> Hitters[train, ],</span>
<span id="cb201-119"><a href="#cb201-119" aria-hidden="true" tabindex="-1"></a>                          <span class="at">nvmax =</span> <span class="dv">19</span>)</span>
<span id="cb201-120"><a href="#cb201-120" aria-hidden="true" tabindex="-1"></a><span class="co"># матрица объясняющих переменных модели для тестовой выборки</span></span>
<span id="cb201-121"><a href="#cb201-121" aria-hidden="true" tabindex="-1"></a>test.mat <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(Salary <span class="sc">~</span> ., <span class="at">data =</span> Hitters[test, ])</span>
<span id="cb201-122"><a href="#cb201-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-123"><a href="#cb201-123" aria-hidden="true" tabindex="-1"></a><span class="co"># вектор ошибок</span></span>
<span id="cb201-124"><a href="#cb201-124" aria-hidden="true" tabindex="-1"></a>val.errors <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">19</span>)</span>
<span id="cb201-125"><a href="#cb201-125" aria-hidden="true" tabindex="-1"></a><span class="co"># цикл по количеству предикторов</span></span>
<span id="cb201-126"><a href="#cb201-126" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">19</span>){</span>
<span id="cb201-127"><a href="#cb201-127" aria-hidden="true" tabindex="-1"></a>    coefi <span class="ot">&lt;-</span> <span class="fu">coef</span>(regfit.best, <span class="at">id =</span> i)</span>
<span id="cb201-128"><a href="#cb201-128" aria-hidden="true" tabindex="-1"></a>    pred <span class="ot">&lt;-</span> test.mat[, <span class="fu">names</span>(coefi)] <span class="sc">%*%</span> coefi</span>
<span id="cb201-129"><a href="#cb201-129" aria-hidden="true" tabindex="-1"></a>    <span class="co"># записываем значение MSE на тестовой выборке в вектор</span></span>
<span id="cb201-130"><a href="#cb201-130" aria-hidden="true" tabindex="-1"></a>    val.errors[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>((Hitters<span class="sc">$</span>Salary[test] <span class="sc">-</span> pred)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb201-131"><a href="#cb201-131" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb201-132"><a href="#cb201-132" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(val.errors, <span class="dv">0</span>)</span>
<span id="cb201-133"><a href="#cb201-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-134"><a href="#cb201-134" aria-hidden="true" tabindex="-1"></a><span class="co"># находим число предикторов у оптимальной модели</span></span>
<span id="cb201-135"><a href="#cb201-135" aria-hidden="true" tabindex="-1"></a><span class="fu">which.min</span>(val.errors)</span>
<span id="cb201-136"><a href="#cb201-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-137"><a href="#cb201-137" aria-hidden="true" tabindex="-1"></a><span class="do">### 10</span></span>
<span id="cb201-138"><a href="#cb201-138" aria-hidden="true" tabindex="-1"></a><span class="co"># коэффициенты оптимальной модели</span></span>
<span id="cb201-139"><a href="#cb201-139" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">coef</span>(regfit.best, <span class="dv">10</span>), <span class="dv">3</span>)</span>
<span id="cb201-140"><a href="#cb201-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-141"><a href="#cb201-141" aria-hidden="true" tabindex="-1"></a><span class="co"># функция для прогноза для функции regsubset()</span></span>
<span id="cb201-142"><a href="#cb201-142" aria-hidden="true" tabindex="-1"></a>predict.regsubsets <span class="ot">&lt;-</span> <span class="cf">function</span>(object, newdata, id, ...){</span>
<span id="cb201-143"><a href="#cb201-143" aria-hidden="true" tabindex="-1"></a>    form <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(object<span class="sc">$</span>call[[<span class="dv">2</span>]])</span>
<span id="cb201-144"><a href="#cb201-144" aria-hidden="true" tabindex="-1"></a>    mat <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(form, newdata)</span>
<span id="cb201-145"><a href="#cb201-145" aria-hidden="true" tabindex="-1"></a>    coefi <span class="ot">&lt;-</span> <span class="fu">coef</span>(object, <span class="at">id =</span> id)</span>
<span id="cb201-146"><a href="#cb201-146" aria-hidden="true" tabindex="-1"></a>    xvars <span class="ot">&lt;-</span> <span class="fu">names</span>(coefi)</span>
<span id="cb201-147"><a href="#cb201-147" aria-hidden="true" tabindex="-1"></a>    mat[, xvars] <span class="sc">%*%</span> coefi</span>
<span id="cb201-148"><a href="#cb201-148" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb201-149"><a href="#cb201-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-150"><a href="#cb201-150" aria-hidden="true" tabindex="-1"></a><span class="co"># набор с оптимальным количеством переменных на полном наборе данных</span></span>
<span id="cb201-151"><a href="#cb201-151" aria-hidden="true" tabindex="-1"></a>regfit.best <span class="ot">&lt;-</span> <span class="fu">regsubsets</span>(Salary <span class="sc">~</span> ., <span class="at">data =</span> Hitters,</span>
<span id="cb201-152"><a href="#cb201-152" aria-hidden="true" tabindex="-1"></a>                          <span class="at">nvmax =</span> <span class="dv">19</span>)</span>
<span id="cb201-153"><a href="#cb201-153" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">coef</span>(regfit.best, <span class="dv">10</span>), <span class="dv">3</span>)</span>
<span id="cb201-154"><a href="#cb201-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-155"><a href="#cb201-155" aria-hidden="true" tabindex="-1"></a><span class="co"># k-кратная кросс-валидация</span></span>
<span id="cb201-156"><a href="#cb201-156" aria-hidden="true" tabindex="-1"></a><span class="co"># отбираем 10 блоков наблюдений</span></span>
<span id="cb201-157"><a href="#cb201-157" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb201-158"><a href="#cb201-158" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(my.seed)</span>
<span id="cb201-159"><a href="#cb201-159" aria-hidden="true" tabindex="-1"></a>folds <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>k, <span class="fu">nrow</span>(Hitters), <span class="at">replace =</span> T)</span>
<span id="cb201-160"><a href="#cb201-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-161"><a href="#cb201-161" aria-hidden="true" tabindex="-1"></a><span class="co"># заготовка под матрицу с ошибками</span></span>
<span id="cb201-162"><a href="#cb201-162" aria-hidden="true" tabindex="-1"></a>cv.errors <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, k, <span class="dv">19</span>, <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="cn">NULL</span>, <span class="fu">paste</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">19</span>)))</span>
<span id="cb201-163"><a href="#cb201-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-164"><a href="#cb201-164" aria-hidden="true" tabindex="-1"></a><span class="co"># заполняем матрицу в цикле по блокам данных</span></span>
<span id="cb201-165"><a href="#cb201-165" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k){</span>
<span id="cb201-166"><a href="#cb201-166" aria-hidden="true" tabindex="-1"></a>    best.fit <span class="ot">&lt;-</span> <span class="fu">regsubsets</span>(Salary <span class="sc">~</span> ., <span class="at">data =</span> Hitters[folds <span class="sc">!=</span> j, ],</span>
<span id="cb201-167"><a href="#cb201-167" aria-hidden="true" tabindex="-1"></a>                           <span class="at">nvmax =</span> <span class="dv">19</span>)</span>
<span id="cb201-168"><a href="#cb201-168" aria-hidden="true" tabindex="-1"></a>    <span class="co"># теперь цикл по количеству объясняющих переменных</span></span>
<span id="cb201-169"><a href="#cb201-169" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">19</span>){</span>
<span id="cb201-170"><a href="#cb201-170" aria-hidden="true" tabindex="-1"></a>        <span class="co"># модельные значения Salary</span></span>
<span id="cb201-171"><a href="#cb201-171" aria-hidden="true" tabindex="-1"></a>        pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(best.fit, Hitters[folds <span class="sc">==</span> j, ], <span class="at">id =</span> i)</span>
<span id="cb201-172"><a href="#cb201-172" aria-hidden="true" tabindex="-1"></a>        <span class="co"># вписываем ошибку в матрицу</span></span>
<span id="cb201-173"><a href="#cb201-173" aria-hidden="true" tabindex="-1"></a>        cv.errors[j, i] <span class="ot">&lt;-</span> <span class="fu">mean</span>((Hitters<span class="sc">$</span>Salary[folds <span class="sc">==</span> j] <span class="sc">-</span> pred)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb201-174"><a href="#cb201-174" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb201-175"><a href="#cb201-175" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb201-176"><a href="#cb201-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-177"><a href="#cb201-177" aria-hidden="true" tabindex="-1"></a><span class="co"># усредняем матрицу по каждому столбцу (т.е. по блокам наблюдений), </span></span>
<span id="cb201-178"><a href="#cb201-178" aria-hidden="true" tabindex="-1"></a><span class="co">#  чтобы получить оценку MSE для каждой модели с фиксированным </span></span>
<span id="cb201-179"><a href="#cb201-179" aria-hidden="true" tabindex="-1"></a><span class="co">#  количеством объясняющих переменных</span></span>
<span id="cb201-180"><a href="#cb201-180" aria-hidden="true" tabindex="-1"></a>mean.cv.errors <span class="ot">&lt;-</span> <span class="fu">apply</span>(cv.errors, <span class="dv">2</span>, mean)</span>
<span id="cb201-181"><a href="#cb201-181" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(mean.cv.errors, <span class="dv">0</span>)</span>
<span id="cb201-182"><a href="#cb201-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-183"><a href="#cb201-183" aria-hidden="true" tabindex="-1"></a><span class="co"># на графике</span></span>
<span id="cb201-184"><a href="#cb201-184" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mean.cv.errors, <span class="at">type =</span> <span class="st">&#39;b&#39;</span>)</span>
<span id="cb201-185"><a href="#cb201-185" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="fu">which.min</span>(mean.cv.errors), mean.cv.errors[<span class="fu">which.min</span>(mean.cv.errors)],</span>
<span id="cb201-186"><a href="#cb201-186" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">&#39;red&#39;</span>, <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">cex =</span> <span class="dv">2</span>)</span>
<span id="cb201-187"><a href="#cb201-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-188"><a href="#cb201-188" aria-hidden="true" tabindex="-1"></a><span class="co"># перестраиваем модель с 11 объясняющими переменными на всём наборе данных</span></span>
<span id="cb201-189"><a href="#cb201-189" aria-hidden="true" tabindex="-1"></a>reg.best <span class="ot">&lt;-</span> <span class="fu">regsubsets</span>(Salary <span class="sc">~</span> ., <span class="at">data =</span> Hitters, <span class="at">nvmax =</span> <span class="dv">19</span>)</span>
<span id="cb201-190"><a href="#cb201-190" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">coef</span>(reg.best, <span class="dv">11</span>), <span class="dv">3</span>)</span>
<span id="cb201-191"><a href="#cb201-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-192"><a href="#cb201-192" aria-hidden="true" tabindex="-1"></a><span class="co"># из-за синтаксиса glmnet() формируем явно матрицу объясняющих...</span></span>
<span id="cb201-193"><a href="#cb201-193" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(Salary <span class="sc">~</span> ., Hitters)[, <span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb201-194"><a href="#cb201-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-195"><a href="#cb201-195" aria-hidden="true" tabindex="-1"></a><span class="co"># и вектор значений зависимой переменной</span></span>
<span id="cb201-196"><a href="#cb201-196" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> Hitters<span class="sc">$</span>Salary</span>
<span id="cb201-197"><a href="#cb201-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-198"><a href="#cb201-198" aria-hidden="true" tabindex="-1"></a><span class="do">### Гребневая регрессия</span></span>
<span id="cb201-199"><a href="#cb201-199" aria-hidden="true" tabindex="-1"></a><span class="co"># вектор значений гиперпараметра лямбда</span></span>
<span id="cb201-200"><a href="#cb201-200" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="dv">10</span><span class="sc">^</span><span class="fu">seq</span>(<span class="dv">10</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="at">length =</span> <span class="dv">100</span>)</span>
<span id="cb201-201"><a href="#cb201-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-202"><a href="#cb201-202" aria-hidden="true" tabindex="-1"></a><span class="co"># подгоняем серию моделей ридж-регрессии</span></span>
<span id="cb201-203"><a href="#cb201-203" aria-hidden="true" tabindex="-1"></a>ridge.mod <span class="ot">&lt;-</span> <span class="fu">glmnet</span>(x, y, <span class="at">alpha =</span> <span class="dv">0</span>, <span class="at">lambda =</span> grid)</span>
<span id="cb201-204"><a href="#cb201-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-205"><a href="#cb201-205" aria-hidden="true" tabindex="-1"></a><span class="co"># размерность матрицы коэффициентов моделей</span></span>
<span id="cb201-206"><a href="#cb201-206" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(<span class="fu">coef</span>(ridge.mod))</span>
<span id="cb201-207"><a href="#cb201-207" aria-hidden="true" tabindex="-1"></a><span class="do">## [1]  20 100</span></span>
<span id="cb201-208"><a href="#cb201-208" aria-hidden="true" tabindex="-1"></a><span class="co"># значение лямбда под номером 50</span></span>
<span id="cb201-209"><a href="#cb201-209" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(ridge.mod<span class="sc">$</span>lambda[<span class="dv">50</span>], <span class="dv">0</span>)</span>
<span id="cb201-210"><a href="#cb201-210" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 11498</span></span>
<span id="cb201-211"><a href="#cb201-211" aria-hidden="true" tabindex="-1"></a><span class="co"># коэффициенты соответствующей модели</span></span>
<span id="cb201-212"><a href="#cb201-212" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">coef</span>(ridge.mod)[, <span class="dv">50</span>], <span class="dv">3</span>)</span>
<span id="cb201-213"><a href="#cb201-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-214"><a href="#cb201-214" aria-hidden="true" tabindex="-1"></a><span class="co"># норма эль-два</span></span>
<span id="cb201-215"><a href="#cb201-215" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">sqrt</span>(<span class="fu">sum</span>(<span class="fu">coef</span>(ridge.mod)[<span class="sc">-</span><span class="dv">1</span>, <span class="dv">50</span>]<span class="sc">^</span><span class="dv">2</span>)), <span class="dv">2</span>)</span>
<span id="cb201-216"><a href="#cb201-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-217"><a href="#cb201-217" aria-hidden="true" tabindex="-1"></a><span class="co"># всё то же для лямбды под номером 60</span></span>
<span id="cb201-218"><a href="#cb201-218" aria-hidden="true" tabindex="-1"></a><span class="co"># значение лямбда под номером 50</span></span>
<span id="cb201-219"><a href="#cb201-219" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(ridge.mod<span class="sc">$</span>lambda[<span class="dv">60</span>], <span class="dv">0</span>)</span>
<span id="cb201-220"><a href="#cb201-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-221"><a href="#cb201-221" aria-hidden="true" tabindex="-1"></a><span class="co"># коэффициенты соответствующей модели</span></span>
<span id="cb201-222"><a href="#cb201-222" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">coef</span>(ridge.mod)[, <span class="dv">60</span>], <span class="dv">3</span>)</span>
<span id="cb201-223"><a href="#cb201-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-224"><a href="#cb201-224" aria-hidden="true" tabindex="-1"></a><span class="co"># норма эль-два</span></span>
<span id="cb201-225"><a href="#cb201-225" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">sqrt</span>(<span class="fu">sum</span>(<span class="fu">coef</span>(ridge.mod)[<span class="sc">-</span><span class="dv">1</span>, <span class="dv">60</span>]<span class="sc">^</span><span class="dv">2</span>)), <span class="dv">1</span>)</span>
<span id="cb201-226"><a href="#cb201-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-227"><a href="#cb201-227" aria-hidden="true" tabindex="-1"></a><span class="co"># мы можем получить значения коэффициентов для новой лямбды</span></span>
<span id="cb201-228"><a href="#cb201-228" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">predict</span>(ridge.mod, <span class="at">s =</span> <span class="dv">50</span>, <span class="at">type =</span> <span class="st">&#39;coefficients&#39;</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>, ], <span class="dv">3</span>)</span>
<span id="cb201-229"><a href="#cb201-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-230"><a href="#cb201-230" aria-hidden="true" tabindex="-1"></a><span class="do">## Метод проверочной выборки</span></span>
<span id="cb201-231"><a href="#cb201-231" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(my.seed)</span>
<span id="cb201-232"><a href="#cb201-232" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(x), <span class="fu">nrow</span>(x)<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb201-233"><a href="#cb201-233" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> <span class="sc">-</span>train</span>
<span id="cb201-234"><a href="#cb201-234" aria-hidden="true" tabindex="-1"></a>y.test <span class="ot">&lt;-</span> y[test]</span>
<span id="cb201-235"><a href="#cb201-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-236"><a href="#cb201-236" aria-hidden="true" tabindex="-1"></a><span class="co"># подгоняем ридж-модели с большей точностью (thresh ниже значения по умолчанию)</span></span>
<span id="cb201-237"><a href="#cb201-237" aria-hidden="true" tabindex="-1"></a>ridge.mod <span class="ot">&lt;-</span> <span class="fu">glmnet</span>(x[train, ], y[train], <span class="at">alpha =</span> <span class="dv">0</span>, <span class="at">lambda =</span> grid,</span>
<span id="cb201-238"><a href="#cb201-238" aria-hidden="true" tabindex="-1"></a>                    <span class="at">thresh =</span> <span class="fl">1e-12</span>)</span>
<span id="cb201-239"><a href="#cb201-239" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ridge.mod)</span>
<span id="cb201-240"><a href="#cb201-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-241"><a href="#cb201-241" aria-hidden="true" tabindex="-1"></a><span class="co"># прогнозы для модели с лямбда = 4</span></span>
<span id="cb201-242"><a href="#cb201-242" aria-hidden="true" tabindex="-1"></a>ridge.pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(ridge.mod, <span class="at">s =</span> <span class="dv">4</span>, <span class="at">newx =</span> x[test, ])</span>
<span id="cb201-243"><a href="#cb201-243" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">mean</span>((ridge.pred <span class="sc">-</span> y.test)<span class="sc">^</span><span class="dv">2</span>), <span class="dv">0</span>)</span>
<span id="cb201-244"><a href="#cb201-244" aria-hidden="true" tabindex="-1"></a><span class="co"># сравним с MSE для нулевой модели (прогноз = среднее)</span></span>
<span id="cb201-245"><a href="#cb201-245" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">mean</span>((<span class="fu">mean</span>(y[train]) <span class="sc">-</span> y.test)<span class="sc">^</span><span class="dv">2</span>), <span class="dv">0</span>)</span>
<span id="cb201-246"><a href="#cb201-246" aria-hidden="true" tabindex="-1"></a><span class="co"># насколько модель с лямбда = 4 отличается от обычной ПЛР</span></span>
<span id="cb201-247"><a href="#cb201-247" aria-hidden="true" tabindex="-1"></a>ridge.pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(ridge.mod, <span class="at">s =</span> <span class="dv">0</span>, <span class="at">newx =</span> x[test, ], <span class="at">exact =</span> T,</span>
<span id="cb201-248"><a href="#cb201-248" aria-hidden="true" tabindex="-1"></a>                      <span class="at">x =</span> x[train, ], <span class="at">y =</span> y[train])</span>
<span id="cb201-249"><a href="#cb201-249" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">mean</span>((ridge.pred <span class="sc">-</span> y.test)<span class="sc">^</span><span class="dv">2</span>), <span class="dv">0</span>)</span>
<span id="cb201-250"><a href="#cb201-250" aria-hidden="true" tabindex="-1"></a><span class="co"># predict с лямбдой (s) = 0 даёт модель ПЛР</span></span>
<span id="cb201-251"><a href="#cb201-251" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">subset =</span> train)</span>
<span id="cb201-252"><a href="#cb201-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-253"><a href="#cb201-253" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">predict</span>(ridge.mod, <span class="at">s =</span> <span class="dv">0</span>, <span class="at">exact =</span> T, <span class="at">type =</span> <span class="st">&#39;coefficients&#39;</span>,</span>
<span id="cb201-254"><a href="#cb201-254" aria-hidden="true" tabindex="-1"></a>              <span class="at">x =</span> x[train, ], <span class="at">y =</span> y[train])[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>, ], <span class="dv">3</span>)</span>
<span id="cb201-255"><a href="#cb201-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-256"><a href="#cb201-256" aria-hidden="true" tabindex="-1"></a><span class="do">## Подбор оптимального значения лямбда с помощью перекрёстной проверки</span></span>
<span id="cb201-257"><a href="#cb201-257" aria-hidden="true" tabindex="-1"></a><span class="co"># k-кратная кросс-валидация</span></span>
<span id="cb201-258"><a href="#cb201-258" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(my.seed)</span>
<span id="cb201-259"><a href="#cb201-259" aria-hidden="true" tabindex="-1"></a><span class="co"># оценка ошибки</span></span>
<span id="cb201-260"><a href="#cb201-260" aria-hidden="true" tabindex="-1"></a>cv.out <span class="ot">&lt;-</span> <span class="fu">cv.glmnet</span>(x[train, ], y[train], <span class="at">alpha =</span> <span class="dv">0</span>)</span>
<span id="cb201-261"><a href="#cb201-261" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cv.out)</span>
<span id="cb201-262"><a href="#cb201-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-263"><a href="#cb201-263" aria-hidden="true" tabindex="-1"></a><span class="co"># значение лямбда, обеспечивающее минимальную ошибку перекрёстной проверки</span></span>
<span id="cb201-264"><a href="#cb201-264" aria-hidden="true" tabindex="-1"></a>bestlam <span class="ot">&lt;-</span> cv.out<span class="sc">$</span>lambda.min</span>
<span id="cb201-265"><a href="#cb201-265" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(bestlam, <span class="dv">0</span>)</span>
<span id="cb201-266"><a href="#cb201-266" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 212</span></span>
<span id="cb201-267"><a href="#cb201-267" aria-hidden="true" tabindex="-1"></a><span class="co"># MSE на тестовой для этого значения лямбды</span></span>
<span id="cb201-268"><a href="#cb201-268" aria-hidden="true" tabindex="-1"></a>ridge.pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(ridge.mod, <span class="at">s =</span> bestlam, <span class="at">newx =</span> x[test, ])</span>
<span id="cb201-269"><a href="#cb201-269" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">mean</span>((ridge.pred <span class="sc">-</span> y.test)<span class="sc">^</span><span class="dv">2</span>), <span class="dv">0</span>)</span>
<span id="cb201-270"><a href="#cb201-270" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 96016</span></span>
<span id="cb201-271"><a href="#cb201-271" aria-hidden="true" tabindex="-1"></a><span class="co"># наконец, подгоняем модель для оптимальной лямбды, </span></span>
<span id="cb201-272"><a href="#cb201-272" aria-hidden="true" tabindex="-1"></a><span class="co">#  найденной по перекрёстной проверке</span></span>
<span id="cb201-273"><a href="#cb201-273" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">glmnet</span>(x, y, <span class="at">alpha =</span> <span class="dv">0</span>)</span>
<span id="cb201-274"><a href="#cb201-274" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">predict</span>(out, <span class="at">type =</span> <span class="st">&#39;coefficients&#39;</span>, <span class="at">s =</span> bestlam)[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>, ], <span class="dv">3</span>)</span>
<span id="cb201-275"><a href="#cb201-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-276"><a href="#cb201-276" aria-hidden="true" tabindex="-1"></a><span class="do">## Лассо</span></span>
<span id="cb201-277"><a href="#cb201-277" aria-hidden="true" tabindex="-1"></a>lasso.mod <span class="ot">&lt;-</span> <span class="fu">glmnet</span>(x[train, ], y[train], <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">lambda =</span> grid)</span>
<span id="cb201-278"><a href="#cb201-278" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lasso.mod)</span>
<span id="cb201-279"><a href="#cb201-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-280"><a href="#cb201-280" aria-hidden="true" tabindex="-1"></a><span class="co"># Подбор оптимального значения лямбда с помощью перекрёстной проверки</span></span>
<span id="cb201-281"><a href="#cb201-281" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(my.seed)</span>
<span id="cb201-282"><a href="#cb201-282" aria-hidden="true" tabindex="-1"></a>cv.out <span class="ot">&lt;-</span> <span class="fu">cv.glmnet</span>(x[train, ], y[train], <span class="at">alpha =</span> <span class="dv">1</span>)</span>
<span id="cb201-283"><a href="#cb201-283" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cv.out)</span>
<span id="cb201-284"><a href="#cb201-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-285"><a href="#cb201-285" aria-hidden="true" tabindex="-1"></a>bestlam <span class="ot">&lt;-</span> cv.out<span class="sc">$</span>lambda.min</span>
<span id="cb201-286"><a href="#cb201-286" aria-hidden="true" tabindex="-1"></a>lasso.pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(lasso.mod, <span class="at">s =</span> bestlam, <span class="at">newx =</span> x[test, ])</span>
<span id="cb201-287"><a href="#cb201-287" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">mean</span>((lasso.pred <span class="sc">-</span> y.test)<span class="sc">^</span><span class="dv">2</span>), <span class="dv">0</span>)</span>
<span id="cb201-288"><a href="#cb201-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-289"><a href="#cb201-289" aria-hidden="true" tabindex="-1"></a><span class="co"># коэффициенты лучшей модели</span></span>
<span id="cb201-290"><a href="#cb201-290" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">glmnet</span>(x, y, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">lambda =</span> grid)</span>
<span id="cb201-291"><a href="#cb201-291" aria-hidden="true" tabindex="-1"></a>lasso.coef <span class="ot">&lt;-</span> <span class="fu">predict</span>(out, <span class="at">type =</span> <span class="st">&#39;coefficients&#39;</span>, <span class="at">s =</span> bestlam)[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>, ]</span>
<span id="cb201-292"><a href="#cb201-292" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(lasso.coef, <span class="dv">3</span>)</span>
<span id="cb201-293"><a href="#cb201-293" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(lasso.coef[lasso.coef <span class="sc">!=</span> <span class="dv">0</span>], <span class="dv">3</span>)</span>
<span id="cb201-294"><a href="#cb201-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-295"><a href="#cb201-295" aria-hidden="true" tabindex="-1"></a><span class="do">### Лабораторная работа 3: регрессия при помощи методов PCR и PLS</span></span>
<span id="cb201-296"><a href="#cb201-296" aria-hidden="true" tabindex="-1"></a><span class="do">### 6.7.1 Регрессия на главные компоненты</span></span>
<span id="cb201-297"><a href="#cb201-297" aria-hidden="true" tabindex="-1"></a><span class="co"># кросс-валидация </span></span>
<span id="cb201-298"><a href="#cb201-298" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2</span>)   <span class="co"># непонятно почему они сменили зерно; похоже, опечатка</span></span>
<span id="cb201-299"><a href="#cb201-299" aria-hidden="true" tabindex="-1"></a>pcr.fit <span class="ot">&lt;-</span> <span class="fu">pcr</span>(Salary <span class="sc">~</span> ., <span class="at">data =</span> Hitters, <span class="at">scale =</span> T, <span class="at">validation =</span> <span class="st">&#39;CV&#39;</span>)</span>
<span id="cb201-300"><a href="#cb201-300" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pcr.fit)</span>
<span id="cb201-301"><a href="#cb201-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-302"><a href="#cb201-302" aria-hidden="true" tabindex="-1"></a><span class="co"># график ошибок</span></span>
<span id="cb201-303"><a href="#cb201-303" aria-hidden="true" tabindex="-1"></a><span class="fu">validationplot</span>(pcr.fit, <span class="at">val.type =</span> <span class="st">&#39;MSEP&#39;</span>)</span>
<span id="cb201-304"><a href="#cb201-304" aria-hidden="true" tabindex="-1"></a><span class="co"># Подбор оптиального M: кросс-валидация на обучающей выборке</span></span>
<span id="cb201-305"><a href="#cb201-305" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(my.seed)</span>
<span id="cb201-306"><a href="#cb201-306" aria-hidden="true" tabindex="-1"></a>pcr.fit <span class="ot">&lt;-</span> <span class="fu">pcr</span>(Salary <span class="sc">~</span> ., <span class="at">data =</span> Hitters, <span class="at">subset =</span> train, <span class="at">scale =</span> T,</span>
<span id="cb201-307"><a href="#cb201-307" aria-hidden="true" tabindex="-1"></a>               <span class="at">validation =</span> <span class="st">&#39;CV&#39;</span>)</span>
<span id="cb201-308"><a href="#cb201-308" aria-hidden="true" tabindex="-1"></a><span class="fu">validationplot</span>(pcr.fit, <span class="at">val.type =</span> <span class="st">&#39;MSEP&#39;</span>)</span>
<span id="cb201-309"><a href="#cb201-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-310"><a href="#cb201-310" aria-hidden="true" tabindex="-1"></a><span class="co"># MSE на тестовой выборке</span></span>
<span id="cb201-311"><a href="#cb201-311" aria-hidden="true" tabindex="-1"></a>pcr.pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(pcr.fit, x[test, ], <span class="at">ncomp =</span> <span class="dv">7</span>)</span>
<span id="cb201-312"><a href="#cb201-312" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">mean</span>((pcr.pred <span class="sc">-</span> y.test)<span class="sc">^</span><span class="dv">2</span>), <span class="dv">0</span>)</span>
<span id="cb201-313"><a href="#cb201-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-314"><a href="#cb201-314" aria-hidden="true" tabindex="-1"></a><span class="co"># подгоняем модель на всей выборке для M = 7 </span></span>
<span id="cb201-315"><a href="#cb201-315" aria-hidden="true" tabindex="-1"></a><span class="co">#  (оптимально по методу перекрёстной проверки)</span></span>
<span id="cb201-316"><a href="#cb201-316" aria-hidden="true" tabindex="-1"></a>pcr.fit <span class="ot">&lt;-</span> <span class="fu">pcr</span>(y <span class="sc">~</span> x, <span class="at">scale =</span> T, <span class="at">ncomp =</span> <span class="dv">7</span>)</span>
<span id="cb201-317"><a href="#cb201-317" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pcr.fit)</span>
<span id="cb201-318"><a href="#cb201-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-319"><a href="#cb201-319" aria-hidden="true" tabindex="-1"></a><span class="co"># Регрессия по методу частных наименьших квадратов</span></span>
<span id="cb201-320"><a href="#cb201-320" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(my.seed)</span>
<span id="cb201-321"><a href="#cb201-321" aria-hidden="true" tabindex="-1"></a>pls.fit <span class="ot">&lt;-</span> <span class="fu">plsr</span>(Salary <span class="sc">~</span> ., <span class="at">data =</span> Hitters, <span class="at">subset =</span> train, <span class="at">scale =</span> T,</span>
<span id="cb201-322"><a href="#cb201-322" aria-hidden="true" tabindex="-1"></a>                <span class="at">validation =</span> <span class="st">&#39;CV&#39;</span>)</span>
<span id="cb201-323"><a href="#cb201-323" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pls.fit)</span>
<span id="cb201-324"><a href="#cb201-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-325"><a href="#cb201-325" aria-hidden="true" tabindex="-1"></a><span class="co"># теперь подгоняем модель для найденного оптимального M = 2 </span></span>
<span id="cb201-326"><a href="#cb201-326" aria-hidden="true" tabindex="-1"></a><span class="co">#  и оцениваем MSE на тестовой</span></span>
<span id="cb201-327"><a href="#cb201-327" aria-hidden="true" tabindex="-1"></a>pls.pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(pls.fit, x[test, ], <span class="at">ncomp =</span> <span class="dv">2</span>)</span>
<span id="cb201-328"><a href="#cb201-328" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">mean</span>((pls.pred <span class="sc">-</span> y.test)<span class="sc">^</span><span class="dv">2</span>), <span class="dv">0</span>)</span>
<span id="cb201-329"><a href="#cb201-329" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 101417</span></span>
<span id="cb201-330"><a href="#cb201-330" aria-hidden="true" tabindex="-1"></a><span class="co"># подгоняем модель на всей выборке</span></span>
<span id="cb201-331"><a href="#cb201-331" aria-hidden="true" tabindex="-1"></a>pls.fit <span class="ot">&lt;-</span> <span class="fu">plsr</span>(Salary <span class="sc">~</span> ., <span class="at">data =</span> Hitters, <span class="at">scale =</span> T, <span class="at">ncomp =</span> <span class="dv">2</span>)</span>
<span id="cb201-332"><a href="#cb201-332" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pls.fit)</span></code></pre></div>
<!--chapter:end:24_linear_regression_complex.Rmd-->
</div>
</div>
<div id="nonlinear-regression" class="section level1" number="25">
<h1 number="25"><span class="header-section-number">25</span> Nonlinear regression</h1>
<p>Nonlinear regression is a form of regression analysis in which observational data are modeled by a function which is a nonlinear combination of the model parameters and <strong>depends on one or more independent variables</strong>.<br />
Some nonlinear data sets can be transformed to a linear model.<br />
Sone can not be transformed. For such modeling methods of Numerical analysis should be applied such as Newton’s method, Gauss-Newton method and Levenberg–Marquardt method.</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a>Математическое моделирование</span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a>Практика <span class="dv">7</span></span>
<span id="cb202-3"><a href="#cb202-3" aria-hidden="true" tabindex="-1"></a>Нелинейные модели</span>
<span id="cb202-4"><a href="#cb202-4" aria-hidden="true" tabindex="-1"></a>В практических примерах ниже показано как<span class="sc">:</span></span>
<span id="cb202-5"><a href="#cb202-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb202-6"><a href="#cb202-6" aria-hidden="true" tabindex="-1"></a>    оценивать полиномиальную регрессию;</span>
<span id="cb202-7"><a href="#cb202-7" aria-hidden="true" tabindex="-1"></a>аппроксимировать нелинейные модели ступенчатыми функциями;</span>
<span id="cb202-8"><a href="#cb202-8" aria-hidden="true" tabindex="-1"></a>строить сплайны;</span>
<span id="cb202-9"><a href="#cb202-9" aria-hidden="true" tabindex="-1"></a>работать с локальной регрессией;</span>
<span id="cb202-10"><a href="#cb202-10" aria-hidden="true" tabindex="-1"></a>строить обобщённые линейные модели (GAM).</span>
<span id="cb202-11"><a href="#cb202-11" aria-hidden="true" tabindex="-1"></a>Модели<span class="sc">:</span> полиномиальная регрессия, полиномиальная логистическая регрессия, ступенчатая модель, обобщённая линейная модель.</span>
<span id="cb202-12"><a href="#cb202-12" aria-hidden="true" tabindex="-1"></a>Данные<span class="sc">:</span> Wage {ISLR}</span>
<span id="cb202-13"><a href="#cb202-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-14"><a href="#cb202-14" aria-hidden="true" tabindex="-1"></a>Подробные комментарии к коду лабораторных см. в [<span class="dv">1</span>], глава <span class="fl">7.</span></span>
<span id="cb202-15"><a href="#cb202-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-16"><a href="#cb202-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&#39;ISLR&#39;</span>)              <span class="co"># набор данных Auto</span></span>
<span id="cb202-17"><a href="#cb202-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&#39;splines&#39;</span>)           <span class="co"># сплайны</span></span>
<span id="cb202-18"><a href="#cb202-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&#39;gam&#39;</span>)               <span class="co"># обобщённые аддитивные модели</span></span>
<span id="cb202-19"><a href="#cb202-19" aria-hidden="true" tabindex="-1"></a><span class="do">## Warning: package &#39;gam&#39; was built under R version 3.3.3</span></span>
<span id="cb202-20"><a href="#cb202-20" aria-hidden="true" tabindex="-1"></a><span class="do">## Loading required package: foreach</span></span>
<span id="cb202-21"><a href="#cb202-21" aria-hidden="true" tabindex="-1"></a><span class="do">## Warning: package &#39;foreach&#39; was built under R version 3.3.3</span></span>
<span id="cb202-22"><a href="#cb202-22" aria-hidden="true" tabindex="-1"></a><span class="do">## Loaded gam 1.14</span></span>
<span id="cb202-23"><a href="#cb202-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&#39;akima&#39;</span>)             <span class="co"># график двумерной плоскости</span></span>
<span id="cb202-24"><a href="#cb202-24" aria-hidden="true" tabindex="-1"></a><span class="do">## Warning: package &#39;akima&#39; was built under R version 3.3.3</span></span>
<span id="cb202-25"><a href="#cb202-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&#39;ggplot2&#39;</span>)           <span class="co"># красивые графики</span></span>
<span id="cb202-26"><a href="#cb202-26" aria-hidden="true" tabindex="-1"></a><span class="do">## Warning: package &#39;ggplot2&#39; was built under R version 3.3.3</span></span>
<span id="cb202-27"><a href="#cb202-27" aria-hidden="true" tabindex="-1"></a>my.seed <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb202-28"><a href="#cb202-28" aria-hidden="true" tabindex="-1"></a>Работаем с набором данных по зарплатам <span class="dv">3000</span> работников<span class="sc">-</span>мужчин среднеатлантического региона Wage. Присоединяем его к пространству имён функцией <span class="fu">attach</span>(), и дальше обращаемся напрямую к столбцам таблицы.</span>
<span id="cb202-29"><a href="#cb202-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-30"><a href="#cb202-30" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(Wage)</span>
<span id="cb202-31"><a href="#cb202-31" aria-hidden="true" tabindex="-1"></a>Работаем со столбцами<span class="sc">:</span></span>
<span id="cb202-32"><a href="#cb202-32" aria-hidden="true" tabindex="-1"></a>    <span class="er">*</span> wage – заработная плата работника до уплаты налогов;</span>
<span id="cb202-33"><a href="#cb202-33" aria-hidden="true" tabindex="-1"></a><span class="sc">*</span> age – возраст работника в годах.</span>
<span id="cb202-34"><a href="#cb202-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-35"><a href="#cb202-35" aria-hidden="true" tabindex="-1"></a>Полиномиальная регрессия</span>
<span id="cb202-36"><a href="#cb202-36" aria-hidden="true" tabindex="-1"></a>Зависимость зарплаты от возраста</span>
<span id="cb202-37"><a href="#cb202-37" aria-hidden="true" tabindex="-1"></a>Судя по графику ниже, ззаимосвязь заработной платы и возраста нелинейна. Наблюдается также группа наблюдений с высоким значением wage, граница проходит примерно на уровне <span class="fl">250.</span></span>
<span id="cb202-38"><a href="#cb202-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-39"><a href="#cb202-39" aria-hidden="true" tabindex="-1"></a>gp <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> Wage, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> wage))</span>
<span id="cb202-40"><a href="#cb202-40" aria-hidden="true" tabindex="-1"></a>gp <span class="ot">&lt;-</span> gp <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">0</span>, <span class="at">intercept =</span> <span class="dv">250</span>, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>)</span>
<span id="cb202-41"><a href="#cb202-41" aria-hidden="true" tabindex="-1"></a>gp</span>
<span id="cb202-42"><a href="#cb202-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-43"><a href="#cb202-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-44"><a href="#cb202-44" aria-hidden="true" tabindex="-1"></a>Подгоняем полином четвёртой степени для зависимости заработной платы от возраста.</span>
<span id="cb202-45"><a href="#cb202-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-46"><a href="#cb202-46" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> <span class="fu">poly</span>(age, <span class="dv">4</span>), <span class="at">data =</span> Wage)</span>
<span id="cb202-47"><a href="#cb202-47" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">coef</span>(<span class="fu">summary</span>(fit)), <span class="dv">2</span>)</span>
<span id="cb202-48"><a href="#cb202-48" aria-hidden="true" tabindex="-1"></a><span class="do">##               Estimate Std. Error t value Pr(&gt;|t|)</span></span>
<span id="cb202-49"><a href="#cb202-49" aria-hidden="true" tabindex="-1"></a><span class="do">## (Intercept)     111.70       0.73  153.28     0.00</span></span>
<span id="cb202-50"><a href="#cb202-50" aria-hidden="true" tabindex="-1"></a><span class="do">## poly(age, 4)1   447.07      39.91   11.20     0.00</span></span>
<span id="cb202-51"><a href="#cb202-51" aria-hidden="true" tabindex="-1"></a><span class="do">## poly(age, 4)2  -478.32      39.91  -11.98     0.00</span></span>
<span id="cb202-52"><a href="#cb202-52" aria-hidden="true" tabindex="-1"></a><span class="do">## poly(age, 4)3   125.52      39.91    3.14     0.00</span></span>
<span id="cb202-53"><a href="#cb202-53" aria-hidden="true" tabindex="-1"></a><span class="do">## poly(age, 4)4   -77.91      39.91   -1.95     0.05</span></span>
<span id="cb202-54"><a href="#cb202-54" aria-hidden="true" tabindex="-1"></a>Функция <span class="fu">poly</span>(age, <span class="dv">4</span>) создаёт таблицу с базисом ортогональных полиномов<span class="sc">:</span> линейные комбинации значений переменной age в степенях от <span class="dv">1</span> до <span class="fl">4.</span></span>
<span id="cb202-55"><a href="#cb202-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-56"><a href="#cb202-56" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">head</span>(<span class="fu">poly</span>(age, <span class="dv">4</span>)), <span class="dv">3</span>)</span>
<span id="cb202-57"><a href="#cb202-57" aria-hidden="true" tabindex="-1"></a><span class="do">##           1      2      3      4</span></span>
<span id="cb202-58"><a href="#cb202-58" aria-hidden="true" tabindex="-1"></a><span class="do">## [1,] -0.039  0.056 -0.072  0.087</span></span>
<span id="cb202-59"><a href="#cb202-59" aria-hidden="true" tabindex="-1"></a><span class="do">## [2,] -0.029  0.026 -0.015 -0.003</span></span>
<span id="cb202-60"><a href="#cb202-60" aria-hidden="true" tabindex="-1"></a><span class="do">## [3,]  0.004 -0.015  0.000  0.014</span></span>
<span id="cb202-61"><a href="#cb202-61" aria-hidden="true" tabindex="-1"></a><span class="do">## [4,]  0.001 -0.015  0.005  0.013</span></span>
<span id="cb202-62"><a href="#cb202-62" aria-hidden="true" tabindex="-1"></a><span class="do">## [5,]  0.012 -0.010 -0.011  0.010</span></span>
<span id="cb202-63"><a href="#cb202-63" aria-hidden="true" tabindex="-1"></a><span class="do">## [6,]  0.018 -0.002 -0.017 -0.001</span></span>
<span id="cb202-64"><a href="#cb202-64" aria-hidden="true" tabindex="-1"></a><span class="co"># можно получить сами значения age в заданных степенях</span></span>
<span id="cb202-65"><a href="#cb202-65" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">head</span>(<span class="fu">poly</span>(age, <span class="dv">4</span>, <span class="at">raw =</span> T)), <span class="dv">3</span>)</span>
<span id="cb202-66"><a href="#cb202-66" aria-hidden="true" tabindex="-1"></a><span class="do">##       1    2      3       4</span></span>
<span id="cb202-67"><a href="#cb202-67" aria-hidden="true" tabindex="-1"></a><span class="do">## [1,] 18  324   5832  104976</span></span>
<span id="cb202-68"><a href="#cb202-68" aria-hidden="true" tabindex="-1"></a><span class="do">## [2,] 24  576  13824  331776</span></span>
<span id="cb202-69"><a href="#cb202-69" aria-hidden="true" tabindex="-1"></a><span class="do">## [3,] 45 2025  91125 4100625</span></span>
<span id="cb202-70"><a href="#cb202-70" aria-hidden="true" tabindex="-1"></a><span class="do">## [4,] 43 1849  79507 3418801</span></span>
<span id="cb202-71"><a href="#cb202-71" aria-hidden="true" tabindex="-1"></a><span class="do">## [5,] 50 2500 125000 6250000</span></span>
<span id="cb202-72"><a href="#cb202-72" aria-hidden="true" tabindex="-1"></a><span class="do">## [6,] 54 2916 157464 8503056</span></span>
<span id="cb202-73"><a href="#cb202-73" aria-hidden="true" tabindex="-1"></a><span class="co"># на прогноз не повлияет, но оценки параметров изменяются</span></span>
<span id="cb202-74"><a href="#cb202-74" aria-hidden="true" tabindex="-1"></a>fit<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> <span class="fu">poly</span>(age, <span class="dv">4</span>, <span class="at">raw =</span> T), <span class="at">data =</span> Wage)</span>
<span id="cb202-75"><a href="#cb202-75" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">coef</span>(<span class="fu">summary</span>(fit<span class="fl">.2</span>)), <span class="dv">2</span>)</span>
<span id="cb202-76"><a href="#cb202-76" aria-hidden="true" tabindex="-1"></a><span class="do">##                        Estimate Std. Error t value Pr(&gt;|t|)</span></span>
<span id="cb202-77"><a href="#cb202-77" aria-hidden="true" tabindex="-1"></a><span class="do">## (Intercept)             -184.15      60.04   -3.07     0.00</span></span>
<span id="cb202-78"><a href="#cb202-78" aria-hidden="true" tabindex="-1"></a><span class="do">## poly(age, 4, raw = T)1    21.25       5.89    3.61     0.00</span></span>
<span id="cb202-79"><a href="#cb202-79" aria-hidden="true" tabindex="-1"></a><span class="do">## poly(age, 4, raw = T)2    -0.56       0.21   -2.74     0.01</span></span>
<span id="cb202-80"><a href="#cb202-80" aria-hidden="true" tabindex="-1"></a><span class="do">## poly(age, 4, raw = T)3     0.01       0.00    2.22     0.03</span></span>
<span id="cb202-81"><a href="#cb202-81" aria-hidden="true" tabindex="-1"></a><span class="do">## poly(age, 4, raw = T)4     0.00       0.00   -1.95     0.05</span></span>
<span id="cb202-82"><a href="#cb202-82" aria-hidden="true" tabindex="-1"></a><span class="co"># границы изменения переменной age</span></span>
<span id="cb202-83"><a href="#cb202-83" aria-hidden="true" tabindex="-1"></a>agelims <span class="ot">&lt;-</span> <span class="fu">range</span>(age)</span>
<span id="cb202-84"><a href="#cb202-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-85"><a href="#cb202-85" aria-hidden="true" tabindex="-1"></a><span class="co"># значения age, для которых делаем прогноз (от min до max с шагом 1)</span></span>
<span id="cb202-86"><a href="#cb202-86" aria-hidden="true" tabindex="-1"></a>age.grid <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> agelims[<span class="dv">1</span>], <span class="at">to =</span> agelims[<span class="dv">2</span>])</span>
<span id="cb202-87"><a href="#cb202-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-88"><a href="#cb202-88" aria-hidden="true" tabindex="-1"></a><span class="co"># рассчитать прогнозы и их стандартные ошибки</span></span>
<span id="cb202-89"><a href="#cb202-89" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, <span class="at">newdata =</span> <span class="fu">list</span>(<span class="at">age =</span> age.grid), <span class="at">se =</span> T)</span>
<span id="cb202-90"><a href="#cb202-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-91"><a href="#cb202-91" aria-hidden="true" tabindex="-1"></a><span class="co"># границы доверительного интервала для заработной платы</span></span>
<span id="cb202-92"><a href="#cb202-92" aria-hidden="true" tabindex="-1"></a>se.bands <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="at">lower.bound =</span> preds<span class="sc">$</span>fit <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>preds<span class="sc">$</span>se.fit,</span>
<span id="cb202-93"><a href="#cb202-93" aria-hidden="true" tabindex="-1"></a>                  <span class="at">upper.bound =</span> preds<span class="sc">$</span>fit <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>preds<span class="sc">$</span>se.fit)</span>
<span id="cb202-94"><a href="#cb202-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-95"><a href="#cb202-95" aria-hidden="true" tabindex="-1"></a><span class="co"># смотрим результат</span></span>
<span id="cb202-96"><a href="#cb202-96" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">head</span>(se.bands), <span class="dv">2</span>)</span>
<span id="cb202-97"><a href="#cb202-97" aria-hidden="true" tabindex="-1"></a><span class="do">##   lower.bound upper.bound</span></span>
<span id="cb202-98"><a href="#cb202-98" aria-hidden="true" tabindex="-1"></a><span class="do">## 1       41.33       62.53</span></span>
<span id="cb202-99"><a href="#cb202-99" aria-hidden="true" tabindex="-1"></a><span class="do">## 2       49.76       67.24</span></span>
<span id="cb202-100"><a href="#cb202-100" aria-hidden="true" tabindex="-1"></a><span class="do">## 3       57.39       71.76</span></span>
<span id="cb202-101"><a href="#cb202-101" aria-hidden="true" tabindex="-1"></a><span class="do">## 4       64.27       76.09</span></span>
<span id="cb202-102"><a href="#cb202-102" aria-hidden="true" tabindex="-1"></a><span class="do">## 5       70.44       80.27</span></span>
<span id="cb202-103"><a href="#cb202-103" aria-hidden="true" tabindex="-1"></a><span class="do">## 6       75.94       84.28</span></span>
<span id="cb202-104"><a href="#cb202-104" aria-hidden="true" tabindex="-1"></a>Рисуем левую панель графика со слайда <span class="dv">4</span> презентации (рис. <span class="fl">7.1</span> книги). Функция <span class="fu">matlines</span>() рисует грфик столбцов одной матрицы против столбцов другой.</span>
<span id="cb202-105"><a href="#cb202-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-106"><a href="#cb202-106" aria-hidden="true" tabindex="-1"></a><span class="co"># наблюдения</span></span>
<span id="cb202-107"><a href="#cb202-107" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(age, wage, <span class="at">xlim =</span> agelims, <span class="at">cex =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">&#39;darkgrey&#39;</span>)</span>
<span id="cb202-108"><a href="#cb202-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-109"><a href="#cb202-109" aria-hidden="true" tabindex="-1"></a><span class="co"># заголовок</span></span>
<span id="cb202-110"><a href="#cb202-110" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">&#39;Полином четвёртой степени&#39;</span>)</span>
<span id="cb202-111"><a href="#cb202-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-112"><a href="#cb202-112" aria-hidden="true" tabindex="-1"></a><span class="co"># модель</span></span>
<span id="cb202-113"><a href="#cb202-113" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(age.grid, preds<span class="sc">$</span>fit, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&#39;blue&#39;</span>)</span>
<span id="cb202-114"><a href="#cb202-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-115"><a href="#cb202-115" aria-hidden="true" tabindex="-1"></a><span class="co"># доверительные интервалы прогноза</span></span>
<span id="cb202-116"><a href="#cb202-116" aria-hidden="true" tabindex="-1"></a><span class="fu">matlines</span>(<span class="at">x =</span> age.grid, <span class="at">y =</span> se.bands, <span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">&#39;blue&#39;</span>, <span class="at">lty =</span> <span class="dv">3</span>)</span>
<span id="cb202-117"><a href="#cb202-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-118"><a href="#cb202-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-119"><a href="#cb202-119" aria-hidden="true" tabindex="-1"></a>Убедимся, что прогнозы по моделям с различными вызовами <span class="fu">poly</span>() совпадают.</span>
<span id="cb202-120"><a href="#cb202-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-121"><a href="#cb202-121" aria-hidden="true" tabindex="-1"></a><span class="co"># прогнозы по второму вызову модели</span></span>
<span id="cb202-122"><a href="#cb202-122" aria-hidden="true" tabindex="-1"></a>preds2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit<span class="fl">.2</span>, <span class="at">newdata =</span> <span class="fu">list</span>(<span class="at">age =</span> age.grid), <span class="at">se =</span> T)</span>
<span id="cb202-123"><a href="#cb202-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-124"><a href="#cb202-124" aria-hidden="true" tabindex="-1"></a><span class="co"># максимальное расхождение между прогнозами по двум вариантам вызова модели</span></span>
<span id="cb202-125"><a href="#cb202-125" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(<span class="fu">abs</span>(preds<span class="sc">$</span>fit <span class="sc">-</span> preds2<span class="sc">$</span>fit))</span>
<span id="cb202-126"><a href="#cb202-126" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 7.389644e-13</span></span>
<span id="cb202-127"><a href="#cb202-127" aria-hidden="true" tabindex="-1"></a>Теперь подбираем степень полинома, сравнивая модели со степенями от <span class="dv">1</span> до <span class="dv">5</span> с помощью дисперсионного анализа (ANOVA).</span>
<span id="cb202-128"><a href="#cb202-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-129"><a href="#cb202-129" aria-hidden="true" tabindex="-1"></a>fit<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> age, <span class="at">data =</span> Wage)</span>
<span id="cb202-130"><a href="#cb202-130" aria-hidden="true" tabindex="-1"></a>fit<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> <span class="fu">poly</span>(age, <span class="dv">2</span>), <span class="at">data =</span> Wage)</span>
<span id="cb202-131"><a href="#cb202-131" aria-hidden="true" tabindex="-1"></a>fit<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> <span class="fu">poly</span>(age, <span class="dv">3</span>), <span class="at">data =</span> Wage)</span>
<span id="cb202-132"><a href="#cb202-132" aria-hidden="true" tabindex="-1"></a>fit<span class="fl">.4</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> <span class="fu">poly</span>(age, <span class="dv">4</span>), <span class="at">data =</span> Wage)</span>
<span id="cb202-133"><a href="#cb202-133" aria-hidden="true" tabindex="-1"></a>fit<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> <span class="fu">poly</span>(age, <span class="dv">5</span>), <span class="at">data =</span> Wage)</span>
<span id="cb202-134"><a href="#cb202-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-135"><a href="#cb202-135" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">anova</span>(fit<span class="fl">.1</span>, fit<span class="fl">.2</span>, fit<span class="fl">.3</span>, fit<span class="fl">.4</span>, fit<span class="fl">.5</span>), <span class="dv">2</span>)</span>
<span id="cb202-136"><a href="#cb202-136" aria-hidden="true" tabindex="-1"></a>Res.Df</span>
<span id="cb202-137"><a href="#cb202-137" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb202-138"><a href="#cb202-138" aria-hidden="true" tabindex="-1"></a>    RSS</span>
<span id="cb202-139"><a href="#cb202-139" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb202-140"><a href="#cb202-140" aria-hidden="true" tabindex="-1"></a>    Df</span>
<span id="cb202-141"><a href="#cb202-141" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb202-142"><a href="#cb202-142" aria-hidden="true" tabindex="-1"></a>    Sum of Sq</span>
<span id="cb202-143"><a href="#cb202-143" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb202-144"><a href="#cb202-144" aria-hidden="true" tabindex="-1"></a>    F</span>
<span id="cb202-145"><a href="#cb202-145" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb202-146"><a href="#cb202-146" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Pr</span>(<span class="sc">&gt;</span>F)</span>
<span id="cb202-147"><a href="#cb202-147" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb202-148"><a href="#cb202-148" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2998</span>    <span class="dv">5022216</span> <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span></span>
<span id="cb202-149"><a href="#cb202-149" aria-hidden="true" tabindex="-1"></a><span class="dv">2997</span>    <span class="dv">4793430</span> <span class="dv">1</span>   <span class="fl">228786.01</span>   <span class="fl">143.59</span>  <span class="fl">0.00</span></span>
<span id="cb202-150"><a href="#cb202-150" aria-hidden="true" tabindex="-1"></a><span class="dv">2996</span>    <span class="dv">4777674</span> <span class="dv">1</span>   <span class="fl">15755.69</span>    <span class="fl">9.89</span>    <span class="fl">0.00</span></span>
<span id="cb202-151"><a href="#cb202-151" aria-hidden="true" tabindex="-1"></a><span class="dv">2995</span>    <span class="dv">4771604</span> <span class="dv">1</span>   <span class="fl">6070.15</span> <span class="fl">3.81</span>    <span class="fl">0.05</span></span>
<span id="cb202-152"><a href="#cb202-152" aria-hidden="true" tabindex="-1"></a><span class="dv">2994</span>    <span class="dv">4770322</span> <span class="dv">1</span>   <span class="fl">1282.56</span> <span class="fl">0.80</span>    <span class="fl">0.37</span></span>
<span id="cb202-153"><a href="#cb202-153" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> rows</span>
<span id="cb202-154"><a href="#cb202-154" aria-hidden="true" tabindex="-1"></a>Рассматриваются пять моделей, в которых степени полинома от age идут по возрастанию. В крайнем правом столбце таблице приводятся p<span class="sc">-</span>значения для проверки нулевой гипотезы<span class="sc">:</span> текущая модель не даёт статистически значимого сокращения RSS по сравнению с предыдущей моделью. Можно сделать вывод, что степени <span class="dv">3</span> достаточно, дальнейшее увеличение степени не даёт значимого улучшения качества модели.</span>
<span id="cb202-155"><a href="#cb202-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-156"><a href="#cb202-156" aria-hidden="true" tabindex="-1"></a>Зависимость вероятности получать зарплату <span class="sc">&gt;</span> <span class="dv">250</span> от возраста</span>
<span id="cb202-157"><a href="#cb202-157" aria-hidden="true" tabindex="-1"></a>Теперь вернёмся к группе наблюдений с высоким wage. Рассмотрим зависимость вероятности того, что величина зарплаты больше <span class="dv">250</span>, от возраста.</span>
<span id="cb202-158"><a href="#cb202-158" aria-hidden="true" tabindex="-1"></a>Подгоняем логистическую регрессию и делаем прогнозы, для этого используем функцию для оценки обобщённой линейной модели  <span class="fu">glm</span>() и указываем тип модели binomial<span class="sc">:</span></span>
<span id="cb202-159"><a href="#cb202-159" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb202-160"><a href="#cb202-160" aria-hidden="true" tabindex="-1"></a>    fit <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="fu">I</span>(wage <span class="sc">&gt;</span> <span class="dv">250</span>) <span class="sc">~</span> <span class="fu">poly</span>(age, <span class="dv">4</span>), <span class="at">data =</span> Wage, <span class="at">family =</span> <span class="st">&#39;binomial&#39;</span>)</span>
<span id="cb202-161"><a href="#cb202-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-162"><a href="#cb202-162" aria-hidden="true" tabindex="-1"></a><span class="co"># прогнозы</span></span>
<span id="cb202-163"><a href="#cb202-163" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, <span class="at">newdata =</span> <span class="fu">list</span>(<span class="at">age =</span> age.grid), <span class="at">se =</span> T)</span>
<span id="cb202-164"><a href="#cb202-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-165"><a href="#cb202-165" aria-hidden="true" tabindex="-1"></a><span class="co"># пересчитываем доверительные интервалы и прогнозы в исходные ЕИ</span></span>
<span id="cb202-166"><a href="#cb202-166" aria-hidden="true" tabindex="-1"></a>pfit <span class="ot">&lt;-</span> <span class="fu">exp</span>(preds<span class="sc">$</span>fit) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(preds<span class="sc">$</span>fit))</span>
<span id="cb202-167"><a href="#cb202-167" aria-hidden="true" tabindex="-1"></a>se.bands.logit <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="at">lower.bound =</span> preds<span class="sc">$</span>fit <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>preds<span class="sc">$</span>se.fit,</span>
<span id="cb202-168"><a href="#cb202-168" aria-hidden="true" tabindex="-1"></a>                        <span class="at">upper.bound =</span> preds<span class="sc">$</span>fit <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>preds<span class="sc">$</span>se.fit)</span>
<span id="cb202-169"><a href="#cb202-169" aria-hidden="true" tabindex="-1"></a>se.bands <span class="ot">&lt;-</span> <span class="fu">exp</span>(se.bands.logit)<span class="sc">/</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(se.bands.logit))</span>
<span id="cb202-170"><a href="#cb202-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-171"><a href="#cb202-171" aria-hidden="true" tabindex="-1"></a><span class="co"># результат - доверительный интервал для вероятности события </span></span>
<span id="cb202-172"><a href="#cb202-172" aria-hidden="true" tabindex="-1"></a><span class="co">#   &quot;Заработная плата выше 250&quot;.   </span></span>
<span id="cb202-173"><a href="#cb202-173" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">head</span>(se.bands), <span class="dv">3</span>)</span>
<span id="cb202-174"><a href="#cb202-174" aria-hidden="true" tabindex="-1"></a><span class="do">##   lower.bound upper.bound</span></span>
<span id="cb202-175"><a href="#cb202-175" aria-hidden="true" tabindex="-1"></a><span class="do">## 1           0       0.002</span></span>
<span id="cb202-176"><a href="#cb202-176" aria-hidden="true" tabindex="-1"></a><span class="do">## 2           0       0.003</span></span>
<span id="cb202-177"><a href="#cb202-177" aria-hidden="true" tabindex="-1"></a><span class="do">## 3           0       0.004</span></span>
<span id="cb202-178"><a href="#cb202-178" aria-hidden="true" tabindex="-1"></a><span class="do">## 4           0       0.005</span></span>
<span id="cb202-179"><a href="#cb202-179" aria-hidden="true" tabindex="-1"></a><span class="do">## 5           0       0.006</span></span>
<span id="cb202-180"><a href="#cb202-180" aria-hidden="true" tabindex="-1"></a><span class="do">## 6           0       0.007</span></span>
<span id="cb202-181"><a href="#cb202-181" aria-hidden="true" tabindex="-1"></a>Достраиваем график с <span class="dv">4</span> слайда презентации (рис. <span class="fl">7.1</span> книги). Рисуем правую панель.</span>
<span id="cb202-182"><a href="#cb202-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-183"><a href="#cb202-183" aria-hidden="true" tabindex="-1"></a><span class="co"># сетка для графика (изображаем вероятности, поэтому интервал изменения y мал)</span></span>
<span id="cb202-184"><a href="#cb202-184" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(age, <span class="fu">I</span>(wage <span class="sc">&gt;</span> <span class="dv">250</span>), <span class="at">xlim =</span> agelims, <span class="at">type =</span> <span class="st">&#39;n&#39;</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>),</span>
<span id="cb202-185"><a href="#cb202-185" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&#39;P(Wage &gt; 250 | Age)&#39;</span>)</span>
<span id="cb202-186"><a href="#cb202-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-187"><a href="#cb202-187" aria-hidden="true" tabindex="-1"></a><span class="co"># фактические наблюдения показываем засечками</span></span>
<span id="cb202-188"><a href="#cb202-188" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="fu">jitter</span>(age), <span class="fu">I</span>((wage <span class="sc">&gt;</span> <span class="dv">250</span>) <span class="sc">/</span> <span class="dv">5</span>), <span class="at">cex =</span> <span class="fl">0.5</span>, <span class="at">pch =</span> <span class="st">&#39;|&#39;</span>, <span class="at">col =</span> <span class="st">&#39;darkgrey&#39;</span>)</span>
<span id="cb202-189"><a href="#cb202-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-190"><a href="#cb202-190" aria-hidden="true" tabindex="-1"></a><span class="co"># модель</span></span>
<span id="cb202-191"><a href="#cb202-191" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(age.grid, pfit, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&#39;blue&#39;</span>)</span>
<span id="cb202-192"><a href="#cb202-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-193"><a href="#cb202-193" aria-hidden="true" tabindex="-1"></a><span class="co"># доверительные интервалы</span></span>
<span id="cb202-194"><a href="#cb202-194" aria-hidden="true" tabindex="-1"></a><span class="fu">matlines</span>(age.grid, se.bands, <span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">&#39;blue&#39;</span>, <span class="at">lty =</span> <span class="dv">3</span>)</span>
<span id="cb202-195"><a href="#cb202-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-196"><a href="#cb202-196" aria-hidden="true" tabindex="-1"></a><span class="co"># заголовок</span></span>
<span id="cb202-197"><a href="#cb202-197" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">&#39;Полином четвёртой степени&#39;</span>)</span>
<span id="cb202-198"><a href="#cb202-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-199"><a href="#cb202-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-200"><a href="#cb202-200" aria-hidden="true" tabindex="-1"></a>Ступенчатые функции</span>
<span id="cb202-201"><a href="#cb202-201" aria-hidden="true" tabindex="-1"></a>Для начала определим несколько интервалов, на каждом из которых будем моделировать зависимость wage от age своим средним уровнем.</span>
<span id="cb202-202"><a href="#cb202-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-203"><a href="#cb202-203" aria-hidden="true" tabindex="-1"></a><span class="co"># нарезаем предиктор age на 4 равных интервала</span></span>
<span id="cb202-204"><a href="#cb202-204" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">cut</span>(age, <span class="dv">4</span>))</span>
<span id="cb202-205"><a href="#cb202-205" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb202-206"><a href="#cb202-206" aria-hidden="true" tabindex="-1"></a><span class="do">## (17.9,33.5]   (33.5,49]   (49,64.5] (64.5,80.1] </span></span>
<span id="cb202-207"><a href="#cb202-207" aria-hidden="true" tabindex="-1"></a><span class="do">##         750        1399         779          72</span></span>
<span id="cb202-208"><a href="#cb202-208" aria-hidden="true" tabindex="-1"></a><span class="co"># подгоняем линейную модель на интервалах</span></span>
<span id="cb202-209"><a href="#cb202-209" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> <span class="fu">cut</span>(age, <span class="dv">4</span>), <span class="at">data =</span> Wage)</span>
<span id="cb202-210"><a href="#cb202-210" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">coef</span>(<span class="fu">summary</span>(fit)), <span class="dv">2</span>)</span>
<span id="cb202-211"><a href="#cb202-211" aria-hidden="true" tabindex="-1"></a><span class="do">##                        Estimate Std. Error t value Pr(&gt;|t|)</span></span>
<span id="cb202-212"><a href="#cb202-212" aria-hidden="true" tabindex="-1"></a><span class="do">## (Intercept)               94.16       1.48   63.79     0.00</span></span>
<span id="cb202-213"><a href="#cb202-213" aria-hidden="true" tabindex="-1"></a><span class="do">## cut(age, 4)(33.5,49]      24.05       1.83   13.15     0.00</span></span>
<span id="cb202-214"><a href="#cb202-214" aria-hidden="true" tabindex="-1"></a><span class="do">## cut(age, 4)(49,64.5]      23.66       2.07   11.44     0.00</span></span>
<span id="cb202-215"><a href="#cb202-215" aria-hidden="true" tabindex="-1"></a><span class="do">## cut(age, 4)(64.5,80.1]     7.64       4.99    1.53     0.13</span></span>
<span id="cb202-216"><a href="#cb202-216" aria-hidden="true" tabindex="-1"></a><span class="co"># прогноз -- это средние по `wage` на каждом интервале</span></span>
<span id="cb202-217"><a href="#cb202-217" aria-hidden="true" tabindex="-1"></a>preds.cut <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, <span class="at">newdata =</span> <span class="fu">list</span>(<span class="at">age =</span> age.grid), <span class="at">se =</span> T)</span>
<span id="cb202-218"><a href="#cb202-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-219"><a href="#cb202-219" aria-hidden="true" tabindex="-1"></a><span class="co"># интервальный прогноз</span></span>
<span id="cb202-220"><a href="#cb202-220" aria-hidden="true" tabindex="-1"></a>se.bands.cut <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="at">lower.bound =</span> preds.cut<span class="sc">$</span>fit <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>preds.cut<span class="sc">$</span>se.fit,</span>
<span id="cb202-221"><a href="#cb202-221" aria-hidden="true" tabindex="-1"></a>                      <span class="at">upper.bound =</span> preds.cut<span class="sc">$</span>fit <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>preds.cut<span class="sc">$</span>se.fit)</span>
<span id="cb202-222"><a href="#cb202-222" aria-hidden="true" tabindex="-1"></a>Воспроизведём график со слайда <span class="dv">7</span> презентации (рис. <span class="fl">7.2</span> книги).</span>
<span id="cb202-223"><a href="#cb202-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-224"><a href="#cb202-224" aria-hidden="true" tabindex="-1"></a><span class="co"># наблюдения</span></span>
<span id="cb202-225"><a href="#cb202-225" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(age, wage, <span class="at">xlim =</span> agelims, <span class="at">cex =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">&#39;darkgrey&#39;</span>)</span>
<span id="cb202-226"><a href="#cb202-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-227"><a href="#cb202-227" aria-hidden="true" tabindex="-1"></a><span class="co"># модель</span></span>
<span id="cb202-228"><a href="#cb202-228" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(age.grid, preds.cut<span class="sc">$</span>fit, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&#39;darkgreen&#39;</span>)</span>
<span id="cb202-229"><a href="#cb202-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-230"><a href="#cb202-230" aria-hidden="true" tabindex="-1"></a><span class="co"># доверительные интервалы прогноза</span></span>
<span id="cb202-231"><a href="#cb202-231" aria-hidden="true" tabindex="-1"></a><span class="fu">matlines</span>(<span class="at">x =</span> age.grid, <span class="at">y =</span> se.bands.cut, <span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">&#39;darkgreen&#39;</span>, <span class="at">lty =</span> <span class="dv">3</span>)</span>
<span id="cb202-232"><a href="#cb202-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-233"><a href="#cb202-233" aria-hidden="true" tabindex="-1"></a><span class="co"># заголовок</span></span>
<span id="cb202-234"><a href="#cb202-234" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">&#39;Ступенчатая функция&#39;</span>)</span>
<span id="cb202-235"><a href="#cb202-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-236"><a href="#cb202-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-237"><a href="#cb202-237" aria-hidden="true" tabindex="-1"></a>Правая часть графика, для вероятности того, что зарплата выше <span class="fl">250.</span></span>
<span id="cb202-238"><a href="#cb202-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-239"><a href="#cb202-239" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="fu">I</span>(wage <span class="sc">&gt;</span> <span class="dv">250</span>) <span class="sc">~</span> <span class="fu">cut</span>(age, <span class="dv">4</span>), <span class="at">data =</span> Wage, <span class="at">family =</span> <span class="st">&#39;binomial&#39;</span>)</span>
<span id="cb202-240"><a href="#cb202-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-241"><a href="#cb202-241" aria-hidden="true" tabindex="-1"></a><span class="co"># прогнозы</span></span>
<span id="cb202-242"><a href="#cb202-242" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, <span class="at">newdata =</span> <span class="fu">list</span>(<span class="at">age =</span> age.grid), <span class="at">se =</span> T)</span>
<span id="cb202-243"><a href="#cb202-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-244"><a href="#cb202-244" aria-hidden="true" tabindex="-1"></a><span class="co"># пересчитываем доверительные интервалы и прогнозы в исходные ЕИ</span></span>
<span id="cb202-245"><a href="#cb202-245" aria-hidden="true" tabindex="-1"></a>pfit <span class="ot">&lt;-</span> <span class="fu">exp</span>(preds<span class="sc">$</span>fit) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(preds<span class="sc">$</span>fit))</span>
<span id="cb202-246"><a href="#cb202-246" aria-hidden="true" tabindex="-1"></a>se.bands.logit <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="at">lower.bound =</span> preds<span class="sc">$</span>fit <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>preds<span class="sc">$</span>se.fit,</span>
<span id="cb202-247"><a href="#cb202-247" aria-hidden="true" tabindex="-1"></a>                        <span class="at">upper.bound =</span> preds<span class="sc">$</span>fit <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>preds<span class="sc">$</span>se.fit)</span>
<span id="cb202-248"><a href="#cb202-248" aria-hidden="true" tabindex="-1"></a>se.bands <span class="ot">&lt;-</span> <span class="fu">exp</span>(se.bands.logit)<span class="sc">/</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(se.bands.logit))</span>
<span id="cb202-249"><a href="#cb202-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-250"><a href="#cb202-250" aria-hidden="true" tabindex="-1"></a><span class="co"># результат - доверительный интервал для вероятности события </span></span>
<span id="cb202-251"><a href="#cb202-251" aria-hidden="true" tabindex="-1"></a><span class="co">#   &quot;Заработная плата выше 250&quot;.   </span></span>
<span id="cb202-252"><a href="#cb202-252" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">head</span>(se.bands), <span class="dv">3</span>)</span>
<span id="cb202-253"><a href="#cb202-253" aria-hidden="true" tabindex="-1"></a><span class="do">##   lower.bound upper.bound</span></span>
<span id="cb202-254"><a href="#cb202-254" aria-hidden="true" tabindex="-1"></a><span class="do">## 1       0.003       0.016</span></span>
<span id="cb202-255"><a href="#cb202-255" aria-hidden="true" tabindex="-1"></a><span class="do">## 2       0.003       0.016</span></span>
<span id="cb202-256"><a href="#cb202-256" aria-hidden="true" tabindex="-1"></a><span class="do">## 3       0.003       0.016</span></span>
<span id="cb202-257"><a href="#cb202-257" aria-hidden="true" tabindex="-1"></a><span class="do">## 4       0.003       0.016</span></span>
<span id="cb202-258"><a href="#cb202-258" aria-hidden="true" tabindex="-1"></a><span class="do">## 5       0.003       0.016</span></span>
<span id="cb202-259"><a href="#cb202-259" aria-hidden="true" tabindex="-1"></a><span class="do">## 6       0.003       0.016</span></span>
<span id="cb202-260"><a href="#cb202-260" aria-hidden="true" tabindex="-1"></a><span class="co"># сетка для графика (изображаем вероятности, поэтому интервал изменения y мал)</span></span>
<span id="cb202-261"><a href="#cb202-261" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(age, <span class="fu">I</span>(wage <span class="sc">&gt;</span> <span class="dv">250</span>), <span class="at">xlim =</span> agelims, <span class="at">type =</span> <span class="st">&#39;n&#39;</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>),</span>
<span id="cb202-262"><a href="#cb202-262" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&#39;P(Wage &gt; 250 | Age)&#39;</span>)</span>
<span id="cb202-263"><a href="#cb202-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-264"><a href="#cb202-264" aria-hidden="true" tabindex="-1"></a><span class="co"># фактические наблюдения показываем засечками</span></span>
<span id="cb202-265"><a href="#cb202-265" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="fu">jitter</span>(age), <span class="fu">I</span>((wage <span class="sc">&gt;</span> <span class="dv">250</span>) <span class="sc">/</span> <span class="dv">5</span>), <span class="at">cex =</span> <span class="fl">0.5</span>, <span class="at">pch =</span> <span class="st">&#39;|&#39;</span>, <span class="at">col =</span> <span class="st">&#39;darkgrey&#39;</span>)</span>
<span id="cb202-266"><a href="#cb202-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-267"><a href="#cb202-267" aria-hidden="true" tabindex="-1"></a><span class="co"># модель</span></span>
<span id="cb202-268"><a href="#cb202-268" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(age.grid, pfit, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&#39;darkgreen&#39;</span>)</span>
<span id="cb202-269"><a href="#cb202-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-270"><a href="#cb202-270" aria-hidden="true" tabindex="-1"></a><span class="co"># доверительные интервалы</span></span>
<span id="cb202-271"><a href="#cb202-271" aria-hidden="true" tabindex="-1"></a><span class="fu">matlines</span>(age.grid, se.bands, <span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">&#39;darkgreen&#39;</span>, <span class="at">lty =</span> <span class="dv">3</span>)</span>
<span id="cb202-272"><a href="#cb202-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-273"><a href="#cb202-273" aria-hidden="true" tabindex="-1"></a><span class="co"># заголовок</span></span>
<span id="cb202-274"><a href="#cb202-274" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">&#39;Ступенчатая функция&#39;</span>)</span>
<span id="cb202-275"><a href="#cb202-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-276"><a href="#cb202-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-277"><a href="#cb202-277" aria-hidden="true" tabindex="-1"></a>Сплайны</span>
<span id="cb202-278"><a href="#cb202-278" aria-hidden="true" tabindex="-1"></a>Построим кубический сплайн с тремя узлами.</span>
<span id="cb202-279"><a href="#cb202-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-280"><a href="#cb202-280" aria-hidden="true" tabindex="-1"></a><span class="co"># кубический сплайн с тремя узлами</span></span>
<span id="cb202-281"><a href="#cb202-281" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> <span class="fu">bs</span>(age, <span class="at">knots =</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">40</span>, <span class="dv">60</span>)), <span class="at">data =</span> Wage)</span>
<span id="cb202-282"><a href="#cb202-282" aria-hidden="true" tabindex="-1"></a><span class="co"># прогноз</span></span>
<span id="cb202-283"><a href="#cb202-283" aria-hidden="true" tabindex="-1"></a>preds.spl <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, <span class="at">newdata =</span> <span class="fu">list</span>(<span class="at">age =</span> age.grid), <span class="at">se =</span> T)</span>
<span id="cb202-284"><a href="#cb202-284" aria-hidden="true" tabindex="-1"></a>Теперь построим натуральный по трём узлам. Три узла это <span class="dv">6</span> степеней свободы. Если функции <span class="fu">bs</span>(), которая создаёт матрицу с базисом для полиномиального сплайна, передать только степени свободы, она распределит узлы равномерно. В данном случае это квартили распределения age.</span>
<span id="cb202-285"><a href="#cb202-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-286"><a href="#cb202-286" aria-hidden="true" tabindex="-1"></a><span class="co"># 3 узла -- 6 степеней свободы (столбцы матрицы)</span></span>
<span id="cb202-287"><a href="#cb202-287" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(<span class="fu">bs</span>(age, <span class="at">knots =</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">40</span>, <span class="dv">60</span>)))</span>
<span id="cb202-288"><a href="#cb202-288" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 3000    6</span></span>
<span id="cb202-289"><a href="#cb202-289" aria-hidden="true" tabindex="-1"></a><span class="co"># если не указываем узлы явно...</span></span>
<span id="cb202-290"><a href="#cb202-290" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(<span class="fu">bs</span>(age, <span class="at">df =</span> <span class="dv">6</span>))</span>
<span id="cb202-291"><a href="#cb202-291" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 3000    6</span></span>
<span id="cb202-292"><a href="#cb202-292" aria-hidden="true" tabindex="-1"></a><span class="co">#  они привязываются к квартилям</span></span>
<span id="cb202-293"><a href="#cb202-293" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(<span class="fu">bs</span>(age, <span class="at">df =</span> <span class="dv">6</span>), <span class="st">&#39;knots&#39;</span>)</span>
<span id="cb202-294"><a href="#cb202-294" aria-hidden="true" tabindex="-1"></a><span class="do">##   25%   50%   75% </span></span>
<span id="cb202-295"><a href="#cb202-295" aria-hidden="true" tabindex="-1"></a><span class="do">## 33.75 42.00 51.00</span></span>
<span id="cb202-296"><a href="#cb202-296" aria-hidden="true" tabindex="-1"></a><span class="co"># натуральный сплайн</span></span>
<span id="cb202-297"><a href="#cb202-297" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> <span class="fu">ns</span>(age, <span class="at">df =</span> <span class="dv">4</span>), <span class="at">data =</span> Wage)</span>
<span id="cb202-298"><a href="#cb202-298" aria-hidden="true" tabindex="-1"></a>preds.spl2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit2, <span class="at">newdata =</span> <span class="fu">list</span>(<span class="at">age =</span> age.grid), <span class="at">se =</span> T)</span>
<span id="cb202-299"><a href="#cb202-299" aria-hidden="true" tabindex="-1"></a>График сравнения кубического и натурального сплайнов.</span>
<span id="cb202-300"><a href="#cb202-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-301"><a href="#cb202-301" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">4.5</span>, <span class="fl">4.5</span>, <span class="dv">1</span>, <span class="fl">8.5</span>), <span class="at">oma =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="at">xpd =</span> T)</span>
<span id="cb202-302"><a href="#cb202-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-303"><a href="#cb202-303" aria-hidden="true" tabindex="-1"></a><span class="co"># наблюдения</span></span>
<span id="cb202-304"><a href="#cb202-304" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(age, wage, <span class="at">col =</span> <span class="st">&#39;grey&#39;</span>)</span>
<span id="cb202-305"><a href="#cb202-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-306"><a href="#cb202-306" aria-hidden="true" tabindex="-1"></a><span class="co"># модель кубического сплайна</span></span>
<span id="cb202-307"><a href="#cb202-307" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(age.grid, preds.spl<span class="sc">$</span>fit, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb202-308"><a href="#cb202-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-309"><a href="#cb202-309" aria-hidden="true" tabindex="-1"></a><span class="co"># доверительный интервал</span></span>
<span id="cb202-310"><a href="#cb202-310" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(age.grid, preds.spl<span class="sc">$</span>fit <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>preds.spl<span class="sc">$</span>se, <span class="at">lty =</span> <span class="st">&#39;dashed&#39;</span>)</span>
<span id="cb202-311"><a href="#cb202-311" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(age.grid, preds.spl<span class="sc">$</span>fit <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>preds.spl<span class="sc">$</span>se, <span class="at">lty =</span> <span class="st">&#39;dashed&#39;</span>)</span>
<span id="cb202-312"><a href="#cb202-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-313"><a href="#cb202-313" aria-hidden="true" tabindex="-1"></a><span class="co"># натуральный сплайн</span></span>
<span id="cb202-314"><a href="#cb202-314" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(age.grid, preds.spl2<span class="sc">$</span>fit, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb202-315"><a href="#cb202-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-316"><a href="#cb202-316" aria-hidden="true" tabindex="-1"></a><span class="co"># легенда</span></span>
<span id="cb202-317"><a href="#cb202-317" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="at">inset =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.7</span>, <span class="dv">0</span>),</span>
<span id="cb202-318"><a href="#cb202-318" aria-hidden="true" tabindex="-1"></a>       <span class="fu">c</span>(<span class="st">&#39;Кубический </span><span class="sc">\n</span><span class="st"> с 3 узлами&#39;</span>, <span class="st">&#39;Натуральный&#39;</span>),</span>
<span id="cb202-319"><a href="#cb202-319" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd =</span> <span class="fu">rep</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&#39;black&#39;</span>, <span class="st">&#39;red&#39;</span>))</span>
<span id="cb202-320"><a href="#cb202-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-321"><a href="#cb202-321" aria-hidden="true" tabindex="-1"></a><span class="co"># заголовок</span></span>
<span id="cb202-322"><a href="#cb202-322" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">&quot;Сплайны&quot;</span>)</span>
<span id="cb202-323"><a href="#cb202-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-324"><a href="#cb202-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-325"><a href="#cb202-325" aria-hidden="true" tabindex="-1"></a>Построим график со слайда <span class="dv">20</span> (рисунок <span class="fl">7.8</span> книги).</span>
<span id="cb202-326"><a href="#cb202-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-327"><a href="#cb202-327" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">4.5</span>, <span class="fl">4.5</span>, <span class="dv">1</span>, <span class="dv">1</span>), <span class="at">oma =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">4</span>, <span class="dv">0</span>))</span>
<span id="cb202-328"><a href="#cb202-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-329"><a href="#cb202-329" aria-hidden="true" tabindex="-1"></a><span class="co"># наблюдения</span></span>
<span id="cb202-330"><a href="#cb202-330" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(age, wage, <span class="at">xlim =</span> agelims, <span class="at">cex =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">&#39;darkgrey&#39;</span>)</span>
<span id="cb202-331"><a href="#cb202-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-332"><a href="#cb202-332" aria-hidden="true" tabindex="-1"></a><span class="co"># заголовок</span></span>
<span id="cb202-333"><a href="#cb202-333" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">&#39;Сглаживающий сплайн&#39;</span>)</span>
<span id="cb202-334"><a href="#cb202-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-335"><a href="#cb202-335" aria-hidden="true" tabindex="-1"></a><span class="co"># подгоняем модель с 16 степенями свободы</span></span>
<span id="cb202-336"><a href="#cb202-336" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">smooth.spline</span>(age, wage, <span class="at">df =</span> <span class="dv">16</span>)</span>
<span id="cb202-337"><a href="#cb202-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-338"><a href="#cb202-338" aria-hidden="true" tabindex="-1"></a><span class="co"># подгоняем модель с подбором лямбды с помощью перекрёстной проверки</span></span>
<span id="cb202-339"><a href="#cb202-339" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">smooth.spline</span>(age, wage, <span class="at">cv =</span> T)</span>
<span id="cb202-340"><a href="#cb202-340" aria-hidden="true" tabindex="-1"></a><span class="do">## Warning in smooth.spline(age, wage, cv = T): cross-validation with non-</span></span>
<span id="cb202-341"><a href="#cb202-341" aria-hidden="true" tabindex="-1"></a><span class="do">## unique &#39;x&#39; values seems doubtful</span></span>
<span id="cb202-342"><a href="#cb202-342" aria-hidden="true" tabindex="-1"></a>fit2<span class="sc">$</span>df</span>
<span id="cb202-343"><a href="#cb202-343" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 6.794596</span></span>
<span id="cb202-344"><a href="#cb202-344" aria-hidden="true" tabindex="-1"></a><span class="co"># рисуем модель</span></span>
<span id="cb202-345"><a href="#cb202-345" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(fit, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb202-346"><a href="#cb202-346" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(fit2, <span class="at">col =</span> <span class="st">&#39;blue&#39;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb202-347"><a href="#cb202-347" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&#39;topright&#39;</span>, </span>
<span id="cb202-348"><a href="#cb202-348" aria-hidden="true" tabindex="-1"></a>       <span class="fu">c</span>(<span class="st">&#39;16 df&#39;</span>, <span class="st">&#39;6.8 df&#39;</span>),</span>
<span id="cb202-349"><a href="#cb202-349" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&#39;red&#39;</span>, <span class="st">&#39;blue&#39;</span>), <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">cex =</span> <span class="fl">0.8</span>)</span>
<span id="cb202-350"><a href="#cb202-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-351"><a href="#cb202-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-352"><a href="#cb202-352" aria-hidden="true" tabindex="-1"></a>Локальная регрессия</span>
<span id="cb202-353"><a href="#cb202-353" aria-hidden="true" tabindex="-1"></a>Строим график со слайда <span class="dv">24</span> (рис. <span class="fl">7.10</span>).</span>
<span id="cb202-354"><a href="#cb202-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-355"><a href="#cb202-355" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(age, wage, <span class="at">xlim =</span> agelims, <span class="at">cex =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">&#39;darkgrey&#39;</span>)</span>
<span id="cb202-356"><a href="#cb202-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-357"><a href="#cb202-357" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">&#39;Локальная регрессия&#39;</span>)</span>
<span id="cb202-358"><a href="#cb202-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-359"><a href="#cb202-359" aria-hidden="true" tabindex="-1"></a><span class="co"># подгоняем модель c окном 0.2</span></span>
<span id="cb202-360"><a href="#cb202-360" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">loess</span>(wage <span class="sc">~</span> age, <span class="at">span =</span> <span class="fl">0.2</span>, <span class="at">data =</span> Wage)</span>
<span id="cb202-361"><a href="#cb202-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-362"><a href="#cb202-362" aria-hidden="true" tabindex="-1"></a><span class="co"># подгоняем модель c окном 0.5</span></span>
<span id="cb202-363"><a href="#cb202-363" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">loess</span>(wage <span class="sc">~</span> age, <span class="at">span =</span> <span class="fl">0.5</span>, <span class="at">data =</span> Wage)</span>
<span id="cb202-364"><a href="#cb202-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-365"><a href="#cb202-365" aria-hidden="true" tabindex="-1"></a><span class="co"># рисум модели</span></span>
<span id="cb202-366"><a href="#cb202-366" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(age.grid, <span class="fu">predict</span>(fit, <span class="fu">data.frame</span>(<span class="at">age =</span> age.grid)),</span>
<span id="cb202-367"><a href="#cb202-367" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> <span class="st">&#39;red&#39;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb202-368"><a href="#cb202-368" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(age.grid, <span class="fu">predict</span>(fit2, <span class="fu">data.frame</span>(<span class="at">age =</span> age.grid)),</span>
<span id="cb202-369"><a href="#cb202-369" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> <span class="st">&#39;blue&#39;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb202-370"><a href="#cb202-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-371"><a href="#cb202-371" aria-hidden="true" tabindex="-1"></a><span class="co"># легенда</span></span>
<span id="cb202-372"><a href="#cb202-372" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&#39;topright&#39;</span>, </span>
<span id="cb202-373"><a href="#cb202-373" aria-hidden="true" tabindex="-1"></a>       <span class="fu">c</span>(<span class="st">&#39;s = 0.2&#39;</span>, <span class="st">&#39;s = 0.5&#39;</span>),</span>
<span id="cb202-374"><a href="#cb202-374" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&#39;red&#39;</span>, <span class="st">&#39;blue&#39;</span>), <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">cex =</span> <span class="fl">0.8</span>)</span>
<span id="cb202-375"><a href="#cb202-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-376"><a href="#cb202-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-377"><a href="#cb202-377" aria-hidden="true" tabindex="-1"></a>Обобщённые аддитивные модели (GAM) с непрерывным откликом</span>
<span id="cb202-378"><a href="#cb202-378" aria-hidden="true" tabindex="-1"></a>Построим GAM на натуральных сплайнах степеней <span class="dv">4</span> (year), <span class="dv">5</span> (age) с категориальным предиктором edication.</span>
<span id="cb202-379"><a href="#cb202-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-380"><a href="#cb202-380" aria-hidden="true" tabindex="-1"></a><span class="co"># GAM на натуральных сплайнах</span></span>
<span id="cb202-381"><a href="#cb202-381" aria-hidden="true" tabindex="-1"></a>gam.ns <span class="ot">&lt;-</span> <span class="fu">gam</span>(wage <span class="sc">~</span> <span class="fu">ns</span>(year, <span class="dv">4</span>) <span class="sc">+</span> <span class="fu">ns</span>(age, <span class="dv">5</span>) <span class="sc">+</span> education, <span class="at">data =</span> Wage)</span>
<span id="cb202-382"><a href="#cb202-382" aria-hidden="true" tabindex="-1"></a>Также построим модель на сглаживающих сплайнах.</span>
<span id="cb202-383"><a href="#cb202-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-384"><a href="#cb202-384" aria-hidden="true" tabindex="-1"></a><span class="co"># GAM на сглаживающих сплайнах</span></span>
<span id="cb202-385"><a href="#cb202-385" aria-hidden="true" tabindex="-1"></a>gam.m3 <span class="ot">&lt;-</span> <span class="fu">gam</span>(wage <span class="sc">~</span> <span class="fu">s</span>(year, <span class="dv">4</span>) <span class="sc">+</span> <span class="fu">s</span>(age, <span class="dv">5</span>) <span class="sc">+</span> education, <span class="at">data =</span> Wage)</span>
<span id="cb202-386"><a href="#cb202-386" aria-hidden="true" tabindex="-1"></a>График со слайда <span class="dv">28</span> (рис. <span class="fl">7.12</span>).</span>
<span id="cb202-387"><a href="#cb202-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-388"><a href="#cb202-388" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb202-389"><a href="#cb202-389" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(gam.m3, <span class="at">se =</span> T, <span class="at">col =</span> <span class="st">&#39;blue&#39;</span>)</span>
<span id="cb202-390"><a href="#cb202-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-391"><a href="#cb202-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-392"><a href="#cb202-392" aria-hidden="true" tabindex="-1"></a>График со слайда <span class="dv">27</span> (рис. <span class="fl">7.11</span>).</span>
<span id="cb202-393"><a href="#cb202-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-394"><a href="#cb202-394" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb202-395"><a href="#cb202-395" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(gam.ns, <span class="at">se =</span> T, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>)</span>
<span id="cb202-396"><a href="#cb202-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-397"><a href="#cb202-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-398"><a href="#cb202-398" aria-hidden="true" tabindex="-1"></a>График функции от year похож на прямую. Сделаем ANOVA, чтобы понять, какая степень для year лучше.</span>
<span id="cb202-399"><a href="#cb202-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-400"><a href="#cb202-400" aria-hidden="true" tabindex="-1"></a>gam.m1 <span class="ot">&lt;-</span> <span class="fu">gam</span>(wage <span class="sc">~</span> <span class="fu">s</span>(age, <span class="dv">5</span>) <span class="sc">+</span> education, <span class="at">data =</span> Wage)          <span class="co"># без year</span></span>
<span id="cb202-401"><a href="#cb202-401" aria-hidden="true" tabindex="-1"></a>gam.m2 <span class="ot">&lt;-</span> <span class="fu">gam</span>(wage <span class="sc">~</span> year <span class="sc">+</span> <span class="fu">s</span>(age, <span class="dv">5</span>) <span class="sc">+</span> education, <span class="at">data =</span> Wage)   <span class="co"># year^1</span></span>
<span id="cb202-402"><a href="#cb202-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-403"><a href="#cb202-403" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(gam.m1, gam.m2, gam.m3, <span class="at">test =</span> <span class="st">&#39;F&#39;</span>)</span>
<span id="cb202-404"><a href="#cb202-404" aria-hidden="true" tabindex="-1"></a>Resid. Df</span>
<span id="cb202-405"><a href="#cb202-405" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb202-406"><a href="#cb202-406" aria-hidden="true" tabindex="-1"></a>    Resid. Dev</span>
<span id="cb202-407"><a href="#cb202-407" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb202-408"><a href="#cb202-408" aria-hidden="true" tabindex="-1"></a>    Df</span>
<span id="cb202-409"><a href="#cb202-409" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb202-410"><a href="#cb202-410" aria-hidden="true" tabindex="-1"></a>    Deviance</span>
<span id="cb202-411"><a href="#cb202-411" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb202-412"><a href="#cb202-412" aria-hidden="true" tabindex="-1"></a>    F</span>
<span id="cb202-413"><a href="#cb202-413" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb202-414"><a href="#cb202-414" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Pr</span>(<span class="sc">&gt;</span>F)</span>
<span id="cb202-415"><a href="#cb202-415" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb202-416"><a href="#cb202-416" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2990</span>    <span class="dv">3711731</span> <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span></span>
<span id="cb202-417"><a href="#cb202-417" aria-hidden="true" tabindex="-1"></a><span class="dv">2989</span>    <span class="dv">3693842</span> <span class="fl">1.000000</span>    <span class="fl">17889.243</span>   <span class="fl">14.477130</span>   <span class="fl">0.0001447167</span></span>
<span id="cb202-418"><a href="#cb202-418" aria-hidden="true" tabindex="-1"></a><span class="dv">2986</span>    <span class="dv">3689770</span> <span class="fl">2.999989</span>    <span class="fl">4071.134</span>    <span class="fl">1.098212</span>    <span class="fl">0.3485661430</span></span>
<span id="cb202-419"><a href="#cb202-419" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> rows</span>
<span id="cb202-420"><a href="#cb202-420" aria-hidden="true" tabindex="-1"></a>Третья модель статистически не лучше второй. Кроме того, один из параметров этой модели незначим.</span>
<span id="cb202-421"><a href="#cb202-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-422"><a href="#cb202-422" aria-hidden="true" tabindex="-1"></a><span class="co"># сводка по модели gam.m3</span></span>
<span id="cb202-423"><a href="#cb202-423" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(gam.m3)</span>
<span id="cb202-424"><a href="#cb202-424" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb202-425"><a href="#cb202-425" aria-hidden="true" tabindex="-1"></a><span class="do">## Call: gam(formula = wage ~ s(year, 4) + s(age, 5) + education, data = Wage)</span></span>
<span id="cb202-426"><a href="#cb202-426" aria-hidden="true" tabindex="-1"></a><span class="do">## Deviance Residuals:</span></span>
<span id="cb202-427"><a href="#cb202-427" aria-hidden="true" tabindex="-1"></a><span class="do">##     Min      1Q  Median      3Q     Max </span></span>
<span id="cb202-428"><a href="#cb202-428" aria-hidden="true" tabindex="-1"></a><span class="do">## -119.43  -19.70   -3.33   14.17  213.48 </span></span>
<span id="cb202-429"><a href="#cb202-429" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb202-430"><a href="#cb202-430" aria-hidden="true" tabindex="-1"></a><span class="do">## (Dispersion Parameter for gaussian family taken to be 1235.69)</span></span>
<span id="cb202-431"><a href="#cb202-431" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb202-432"><a href="#cb202-432" aria-hidden="true" tabindex="-1"></a><span class="do">##     Null Deviance: 5222086 on 2999 degrees of freedom</span></span>
<span id="cb202-433"><a href="#cb202-433" aria-hidden="true" tabindex="-1"></a><span class="do">## Residual Deviance: 3689770 on 2986 degrees of freedom</span></span>
<span id="cb202-434"><a href="#cb202-434" aria-hidden="true" tabindex="-1"></a><span class="do">## AIC: 29887.75 </span></span>
<span id="cb202-435"><a href="#cb202-435" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb202-436"><a href="#cb202-436" aria-hidden="true" tabindex="-1"></a><span class="do">## Number of Local Scoring Iterations: 2 </span></span>
<span id="cb202-437"><a href="#cb202-437" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb202-438"><a href="#cb202-438" aria-hidden="true" tabindex="-1"></a><span class="do">## Anova for Parametric Effects</span></span>
<span id="cb202-439"><a href="#cb202-439" aria-hidden="true" tabindex="-1"></a><span class="do">##              Df  Sum Sq Mean Sq F value    Pr(&gt;F)    </span></span>
<span id="cb202-440"><a href="#cb202-440" aria-hidden="true" tabindex="-1"></a><span class="do">## s(year, 4)    1   27162   27162  21.981 2.877e-06 ***</span></span>
<span id="cb202-441"><a href="#cb202-441" aria-hidden="true" tabindex="-1"></a><span class="do">## s(age, 5)     1  195338  195338 158.081 &lt; 2.2e-16 ***</span></span>
<span id="cb202-442"><a href="#cb202-442" aria-hidden="true" tabindex="-1"></a><span class="do">## education     4 1069726  267432 216.423 &lt; 2.2e-16 ***</span></span>
<span id="cb202-443"><a href="#cb202-443" aria-hidden="true" tabindex="-1"></a><span class="do">## Residuals  2986 3689770    1236                      </span></span>
<span id="cb202-444"><a href="#cb202-444" aria-hidden="true" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb202-445"><a href="#cb202-445" aria-hidden="true" tabindex="-1"></a><span class="do">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb202-446"><a href="#cb202-446" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb202-447"><a href="#cb202-447" aria-hidden="true" tabindex="-1"></a><span class="do">## Anova for Nonparametric Effects</span></span>
<span id="cb202-448"><a href="#cb202-448" aria-hidden="true" tabindex="-1"></a><span class="do">##             Npar Df Npar F  Pr(F)    </span></span>
<span id="cb202-449"><a href="#cb202-449" aria-hidden="true" tabindex="-1"></a><span class="do">## (Intercept)                          </span></span>
<span id="cb202-450"><a href="#cb202-450" aria-hidden="true" tabindex="-1"></a><span class="do">## s(year, 4)        3  1.086 0.3537    </span></span>
<span id="cb202-451"><a href="#cb202-451" aria-hidden="true" tabindex="-1"></a><span class="do">## s(age, 5)         4 32.380 &lt;2e-16 ***</span></span>
<span id="cb202-452"><a href="#cb202-452" aria-hidden="true" tabindex="-1"></a><span class="do">## education                            </span></span>
<span id="cb202-453"><a href="#cb202-453" aria-hidden="true" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb202-454"><a href="#cb202-454" aria-hidden="true" tabindex="-1"></a><span class="do">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb202-455"><a href="#cb202-455" aria-hidden="true" tabindex="-1"></a>Работаем с моделью gam.m2.</span>
<span id="cb202-456"><a href="#cb202-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-457"><a href="#cb202-457" aria-hidden="true" tabindex="-1"></a><span class="co"># прогноз по обучающей выборке</span></span>
<span id="cb202-458"><a href="#cb202-458" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(gam.m2, <span class="at">newdata =</span> Wage)</span>
<span id="cb202-459"><a href="#cb202-459" aria-hidden="true" tabindex="-1"></a>Также можно использовать в GAM локальные регрессии.</span>
<span id="cb202-460"><a href="#cb202-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-461"><a href="#cb202-461" aria-hidden="true" tabindex="-1"></a><span class="co"># GAM на локальных регрессиях</span></span>
<span id="cb202-462"><a href="#cb202-462" aria-hidden="true" tabindex="-1"></a>gam.lo <span class="ot">&lt;-</span> <span class="fu">gam</span>(wage <span class="sc">~</span> <span class="fu">s</span>(year, <span class="at">df =</span> <span class="dv">4</span>) <span class="sc">+</span> <span class="fu">lo</span>(age, <span class="at">span =</span> <span class="fl">0.7</span>) <span class="sc">+</span> education, </span>
<span id="cb202-463"><a href="#cb202-463" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> Wage)</span>
<span id="cb202-464"><a href="#cb202-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-465"><a href="#cb202-465" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb202-466"><a href="#cb202-466" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.gam</span>(gam.lo, <span class="at">se =</span> T, <span class="at">col =</span> <span class="st">&#39;green&#39;</span>)</span>
<span id="cb202-467"><a href="#cb202-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-468"><a href="#cb202-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-469"><a href="#cb202-469" aria-hidden="true" tabindex="-1"></a><span class="co"># модель со взаимодействием регрессоров year и age</span></span>
<span id="cb202-470"><a href="#cb202-470" aria-hidden="true" tabindex="-1"></a>gam.lo.i <span class="ot">&lt;-</span> <span class="fu">gam</span>(wage <span class="sc">~</span> <span class="fu">lo</span>(year, age, <span class="at">span =</span> <span class="fl">0.5</span>) <span class="sc">+</span> education, <span class="at">data =</span> Wage)</span>
<span id="cb202-471"><a href="#cb202-471" aria-hidden="true" tabindex="-1"></a><span class="do">## Warning in lo.wam(x, z, wz, fit$smooth, which, fit$smooth.frame,</span></span>
<span id="cb202-472"><a href="#cb202-472" aria-hidden="true" tabindex="-1"></a><span class="do">## bf.maxit, : liv too small. (Discovered by lowesd)</span></span>
<span id="cb202-473"><a href="#cb202-473" aria-hidden="true" tabindex="-1"></a><span class="do">## Warning in lo.wam(x, z, wz, fit$smooth, which, fit$smooth.frame,</span></span>
<span id="cb202-474"><a href="#cb202-474" aria-hidden="true" tabindex="-1"></a><span class="do">## bf.maxit, : lv too small. (Discovered by lowesd)</span></span>
<span id="cb202-475"><a href="#cb202-475" aria-hidden="true" tabindex="-1"></a><span class="do">## Warning in lo.wam(x, z, wz, fit$smooth, which, fit$smooth.frame,</span></span>
<span id="cb202-476"><a href="#cb202-476" aria-hidden="true" tabindex="-1"></a><span class="do">## bf.maxit, : liv too small. (Discovered by lowesd)</span></span>
<span id="cb202-477"><a href="#cb202-477" aria-hidden="true" tabindex="-1"></a><span class="do">## Warning in lo.wam(x, z, wz, fit$smooth, which, fit$smooth.frame,</span></span>
<span id="cb202-478"><a href="#cb202-478" aria-hidden="true" tabindex="-1"></a><span class="do">## bf.maxit, : lv too small. (Discovered by lowesd)</span></span>
<span id="cb202-479"><a href="#cb202-479" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(gam.lo.i)</span>
<span id="cb202-480"><a href="#cb202-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-481"><a href="#cb202-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-482"><a href="#cb202-482" aria-hidden="true" tabindex="-1"></a>Логистическая GAM</span>
<span id="cb202-483"><a href="#cb202-483" aria-hidden="true" tabindex="-1"></a>Построим логистическую GAM для всероятности того, что wage превышает <span class="fl">250.</span></span>
<span id="cb202-484"><a href="#cb202-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-485"><a href="#cb202-485" aria-hidden="true" tabindex="-1"></a>gam.lr <span class="ot">&lt;-</span> <span class="fu">gam</span>(<span class="fu">I</span>(wage <span class="sc">&gt;</span> <span class="dv">250</span>) <span class="sc">~</span> year <span class="sc">+</span> <span class="fu">s</span>(age, <span class="at">df =</span> <span class="dv">5</span>) <span class="sc">+</span> education, </span>
<span id="cb202-486"><a href="#cb202-486" aria-hidden="true" tabindex="-1"></a>              <span class="at">family =</span> <span class="st">&#39;binomial&#39;</span>, <span class="at">data =</span> Wage)</span>
<span id="cb202-487"><a href="#cb202-487" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb202-488"><a href="#cb202-488" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(gam.lr, <span class="at">se =</span> T, <span class="at">col =</span> <span class="st">&#39;green&#39;</span>)</span>
<span id="cb202-489"><a href="#cb202-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-490"><a href="#cb202-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-491"><a href="#cb202-491" aria-hidden="true" tabindex="-1"></a><span class="co"># уровни образования по группам разного достатка</span></span>
<span id="cb202-492"><a href="#cb202-492" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(education, <span class="fu">I</span>(wage <span class="sc">&gt;</span> <span class="dv">250</span>))</span>
<span id="cb202-493"><a href="#cb202-493" aria-hidden="true" tabindex="-1"></a><span class="do">##                     </span></span>
<span id="cb202-494"><a href="#cb202-494" aria-hidden="true" tabindex="-1"></a><span class="do">## education            FALSE TRUE</span></span>
<span id="cb202-495"><a href="#cb202-495" aria-hidden="true" tabindex="-1"></a><span class="do">##   1. &lt; HS Grad         268    0</span></span>
<span id="cb202-496"><a href="#cb202-496" aria-hidden="true" tabindex="-1"></a><span class="do">##   2. HS Grad           966    5</span></span>
<span id="cb202-497"><a href="#cb202-497" aria-hidden="true" tabindex="-1"></a><span class="do">##   3. Some College      643    7</span></span>
<span id="cb202-498"><a href="#cb202-498" aria-hidden="true" tabindex="-1"></a><span class="do">##   4. College Grad      663   22</span></span>
<span id="cb202-499"><a href="#cb202-499" aria-hidden="true" tabindex="-1"></a><span class="do">##   5. Advanced Degree   381   45</span></span>
<span id="cb202-500"><a href="#cb202-500" aria-hidden="true" tabindex="-1"></a>В категории с самым низким уровнем образования нет wage <span class="sc">&gt;</span> <span class="dv">250</span>, поэтому убираем её.</span>
<span id="cb202-501"><a href="#cb202-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-502"><a href="#cb202-502" aria-hidden="true" tabindex="-1"></a>gam.lr.s <span class="ot">&lt;-</span> <span class="fu">gam</span>(<span class="fu">I</span>(wage <span class="sc">&gt;</span> <span class="dv">250</span>) <span class="sc">~</span> year <span class="sc">+</span> <span class="fu">s</span>(age, <span class="at">df =</span> <span class="dv">5</span>) <span class="sc">+</span> education,</span>
<span id="cb202-503"><a href="#cb202-503" aria-hidden="true" tabindex="-1"></a>                <span class="at">family =</span> <span class="st">&#39;binomial&#39;</span>, <span class="at">data =</span> Wage, </span>
<span id="cb202-504"><a href="#cb202-504" aria-hidden="true" tabindex="-1"></a>                <span class="at">subset =</span> (education <span class="sc">!=</span> <span class="st">&quot;1. &lt; HS Grad&quot;</span>))</span>
<span id="cb202-505"><a href="#cb202-505" aria-hidden="true" tabindex="-1"></a><span class="co"># график</span></span>
<span id="cb202-506"><a href="#cb202-506" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb202-507"><a href="#cb202-507" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(gam.lr.s, <span class="at">se =</span> T, <span class="at">col =</span> <span class="st">&#39;green&#39;</span>)</span>
<span id="cb202-508"><a href="#cb202-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-509"><a href="#cb202-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-510"><a href="#cb202-510" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(Wage)</span></code></pre></div>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Nonlinear modeling</span></span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a>Математическое моделирование</span>
<span id="cb203-3"><a href="#cb203-3" aria-hidden="true" tabindex="-1"></a>Практика <span class="dv">8</span></span>
<span id="cb203-4"><a href="#cb203-4" aria-hidden="true" tabindex="-1"></a>Нелинейные модели</span>
<span id="cb203-5"><a href="#cb203-5" aria-hidden="true" tabindex="-1"></a>В практических примерах ниже показано как<span class="sc">:</span></span>
<span id="cb203-6"><a href="#cb203-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb203-7"><a href="#cb203-7" aria-hidden="true" tabindex="-1"></a>    строить регрессионные деревья;</span>
<span id="cb203-8"><a href="#cb203-8" aria-hidden="true" tabindex="-1"></a>строить деревья классификации;</span>
<span id="cb203-9"><a href="#cb203-9" aria-hidden="true" tabindex="-1"></a>делать обрезку дерева;</span>
<span id="cb203-10"><a href="#cb203-10" aria-hidden="true" tabindex="-1"></a>использовать бэггинг, бустинг, случайный лес для улучшения качества прогнозирования.</span>
<span id="cb203-11"><a href="#cb203-11" aria-hidden="true" tabindex="-1"></a>Модели<span class="sc">:</span> деревья решений.</span>
<span id="cb203-12"><a href="#cb203-12" aria-hidden="true" tabindex="-1"></a>Данные<span class="sc">:</span> Sales {ISLR}, Boston {ISLR}</span>
<span id="cb203-13"><a href="#cb203-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-14"><a href="#cb203-14" aria-hidden="true" tabindex="-1"></a>Подробные комментарии к коду лабораторных см. в [<span class="dv">1</span>], глава <span class="fl">8.</span></span>
<span id="cb203-15"><a href="#cb203-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-16"><a href="#cb203-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&#39;tree&#39;</span>)              <span class="co"># деревья</span></span>
<span id="cb203-17"><a href="#cb203-17" aria-hidden="true" tabindex="-1"></a><span class="do">## Warning: package &#39;tree&#39; was built under R version 3.4.4</span></span>
<span id="cb203-18"><a href="#cb203-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&#39;ISLR&#39;</span>)              <span class="co"># наборы данных</span></span>
<span id="cb203-19"><a href="#cb203-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&#39;MASS&#39;</span>)</span>
<span id="cb203-20"><a href="#cb203-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&#39;randomForest&#39;</span>)      <span class="co"># случайный лес</span></span>
<span id="cb203-21"><a href="#cb203-21" aria-hidden="true" tabindex="-1"></a><span class="do">## Warning: package &#39;randomForest&#39; was built under R version 3.4.4</span></span>
<span id="cb203-22"><a href="#cb203-22" aria-hidden="true" tabindex="-1"></a><span class="do">## randomForest 4.6-14</span></span>
<span id="cb203-23"><a href="#cb203-23" aria-hidden="true" tabindex="-1"></a><span class="do">## Type rfNews() to see new features/changes/bug fixes.</span></span>
<span id="cb203-24"><a href="#cb203-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&#39;gbm&#39;</span>)</span>
<span id="cb203-25"><a href="#cb203-25" aria-hidden="true" tabindex="-1"></a><span class="do">## Warning: package &#39;gbm&#39; was built under R version 3.4.4</span></span>
<span id="cb203-26"><a href="#cb203-26" aria-hidden="true" tabindex="-1"></a><span class="do">## Loading required package: survival</span></span>
<span id="cb203-27"><a href="#cb203-27" aria-hidden="true" tabindex="-1"></a><span class="do">## Loading required package: lattice</span></span>
<span id="cb203-28"><a href="#cb203-28" aria-hidden="true" tabindex="-1"></a><span class="do">## Loading required package: splines</span></span>
<span id="cb203-29"><a href="#cb203-29" aria-hidden="true" tabindex="-1"></a><span class="do">## Loading required package: parallel</span></span>
<span id="cb203-30"><a href="#cb203-30" aria-hidden="true" tabindex="-1"></a><span class="do">## Loaded gbm 2.1.3</span></span>
<span id="cb203-31"><a href="#cb203-31" aria-hidden="true" tabindex="-1"></a>Деревья решений</span>
<span id="cb203-32"><a href="#cb203-32" aria-hidden="true" tabindex="-1"></a>Загрузим таблицу с данными по продажам детских кресел и добавим к ней переменную High – “высокие продажи” со значениями<span class="sc">:</span></span>
<span id="cb203-33"><a href="#cb203-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb203-34"><a href="#cb203-34" aria-hidden="true" tabindex="-1"></a>    Yes если продажи больше <span class="dv">8</span> (тыс. шт.);</span>
<span id="cb203-35"><a href="#cb203-35" aria-hidden="true" tabindex="-1"></a>No в противном случае.</span>
<span id="cb203-36"><a href="#cb203-36" aria-hidden="true" tabindex="-1"></a>?Carseats</span>
<span id="cb203-37"><a href="#cb203-37" aria-hidden="true" tabindex="-1"></a><span class="do">## starting httpd help server ... done</span></span>
<span id="cb203-38"><a href="#cb203-38" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(Carseats)</span>
<span id="cb203-39"><a href="#cb203-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-40"><a href="#cb203-40" aria-hidden="true" tabindex="-1"></a><span class="co"># новая переменная</span></span>
<span id="cb203-41"><a href="#cb203-41" aria-hidden="true" tabindex="-1"></a>High <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(Sales <span class="sc">&lt;=</span> <span class="dv">8</span>, <span class="st">&quot;No&quot;</span>, <span class="st">&quot;Yes&quot;</span>)</span>
<span id="cb203-42"><a href="#cb203-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-43"><a href="#cb203-43" aria-hidden="true" tabindex="-1"></a><span class="co"># присоединяем к таблице данных</span></span>
<span id="cb203-44"><a href="#cb203-44" aria-hidden="true" tabindex="-1"></a>Carseats <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Carseats, High)</span>
<span id="cb203-45"><a href="#cb203-45" aria-hidden="true" tabindex="-1"></a>Строим дерево для категориального отклика High, отбросив непрерывный отклик Sales.</span>
<span id="cb203-46"><a href="#cb203-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-47"><a href="#cb203-47" aria-hidden="true" tabindex="-1"></a><span class="co"># модель бинарного  дерева</span></span>
<span id="cb203-48"><a href="#cb203-48" aria-hidden="true" tabindex="-1"></a>tree.carseats <span class="ot">&lt;-</span> <span class="fu">tree</span>(High <span class="sc">~</span> . <span class="sc">-</span>Sales, Carseats)</span>
<span id="cb203-49"><a href="#cb203-49" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(tree.carseats)</span>
<span id="cb203-50"><a href="#cb203-50" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb203-51"><a href="#cb203-51" aria-hidden="true" tabindex="-1"></a><span class="do">## Classification tree:</span></span>
<span id="cb203-52"><a href="#cb203-52" aria-hidden="true" tabindex="-1"></a><span class="do">## tree(formula = High ~ . - Sales, data = Carseats)</span></span>
<span id="cb203-53"><a href="#cb203-53" aria-hidden="true" tabindex="-1"></a><span class="do">## Variables actually used in tree construction:</span></span>
<span id="cb203-54"><a href="#cb203-54" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;ShelveLoc&quot;   &quot;Price&quot;       &quot;Income&quot;      &quot;CompPrice&quot;   &quot;Population&quot; </span></span>
<span id="cb203-55"><a href="#cb203-55" aria-hidden="true" tabindex="-1"></a><span class="do">## [6] &quot;Advertising&quot; &quot;Age&quot;         &quot;US&quot;         </span></span>
<span id="cb203-56"><a href="#cb203-56" aria-hidden="true" tabindex="-1"></a><span class="do">## Number of terminal nodes:  27 </span></span>
<span id="cb203-57"><a href="#cb203-57" aria-hidden="true" tabindex="-1"></a><span class="do">## Residual mean deviance:  0.4575 = 170.7 / 373 </span></span>
<span id="cb203-58"><a href="#cb203-58" aria-hidden="true" tabindex="-1"></a><span class="do">## Misclassification error rate: 0.09 = 36 / 400</span></span>
<span id="cb203-59"><a href="#cb203-59" aria-hidden="true" tabindex="-1"></a><span class="co"># график результата</span></span>
<span id="cb203-60"><a href="#cb203-60" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(tree.carseats)            <span class="co"># ветви</span></span>
<span id="cb203-61"><a href="#cb203-61" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(tree.carseats, <span class="at">pretty=</span><span class="dv">0</span>)  <span class="co"># подписи</span></span>
<span id="cb203-62"><a href="#cb203-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-63"><a href="#cb203-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-64"><a href="#cb203-64" aria-hidden="true" tabindex="-1"></a>tree.carseats                  <span class="co"># посмотреть всё дерево в консоли</span></span>
<span id="cb203-65"><a href="#cb203-65" aria-hidden="true" tabindex="-1"></a><span class="do">## node), split, n, deviance, yval, (yprob)</span></span>
<span id="cb203-66"><a href="#cb203-66" aria-hidden="true" tabindex="-1"></a><span class="do">##       * denotes terminal node</span></span>
<span id="cb203-67"><a href="#cb203-67" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb203-68"><a href="#cb203-68" aria-hidden="true" tabindex="-1"></a><span class="do">##   1) root 400 541.500 No ( 0.59000 0.41000 )  </span></span>
<span id="cb203-69"><a href="#cb203-69" aria-hidden="true" tabindex="-1"></a><span class="do">##     2) ShelveLoc: Bad,Medium 315 390.600 No ( 0.68889 0.31111 )  </span></span>
<span id="cb203-70"><a href="#cb203-70" aria-hidden="true" tabindex="-1"></a><span class="do">##       4) Price &lt; 92.5 46  56.530 Yes ( 0.30435 0.69565 )  </span></span>
<span id="cb203-71"><a href="#cb203-71" aria-hidden="true" tabindex="-1"></a><span class="do">##         8) Income &lt; 57 10  12.220 No ( 0.70000 0.30000 )  </span></span>
<span id="cb203-72"><a href="#cb203-72" aria-hidden="true" tabindex="-1"></a><span class="do">##          16) CompPrice &lt; 110.5 5   0.000 No ( 1.00000 0.00000 ) *</span></span>
<span id="cb203-73"><a href="#cb203-73" aria-hidden="true" tabindex="-1"></a><span class="do">##          17) CompPrice &gt; 110.5 5   6.730 Yes ( 0.40000 0.60000 ) *</span></span>
<span id="cb203-74"><a href="#cb203-74" aria-hidden="true" tabindex="-1"></a><span class="do">##         9) Income &gt; 57 36  35.470 Yes ( 0.19444 0.80556 )  </span></span>
<span id="cb203-75"><a href="#cb203-75" aria-hidden="true" tabindex="-1"></a><span class="do">##          18) Population &lt; 207.5 16  21.170 Yes ( 0.37500 0.62500 ) *</span></span>
<span id="cb203-76"><a href="#cb203-76" aria-hidden="true" tabindex="-1"></a><span class="do">##          19) Population &gt; 207.5 20   7.941 Yes ( 0.05000 0.95000 ) *</span></span>
<span id="cb203-77"><a href="#cb203-77" aria-hidden="true" tabindex="-1"></a><span class="do">##       5) Price &gt; 92.5 269 299.800 No ( 0.75465 0.24535 )  </span></span>
<span id="cb203-78"><a href="#cb203-78" aria-hidden="true" tabindex="-1"></a><span class="do">##        10) Advertising &lt; 13.5 224 213.200 No ( 0.81696 0.18304 )  </span></span>
<span id="cb203-79"><a href="#cb203-79" aria-hidden="true" tabindex="-1"></a><span class="do">##          20) CompPrice &lt; 124.5 96  44.890 No ( 0.93750 0.06250 )  </span></span>
<span id="cb203-80"><a href="#cb203-80" aria-hidden="true" tabindex="-1"></a><span class="do">##            40) Price &lt; 106.5 38  33.150 No ( 0.84211 0.15789 )  </span></span>
<span id="cb203-81"><a href="#cb203-81" aria-hidden="true" tabindex="-1"></a><span class="do">##              80) Population &lt; 177 12  16.300 No ( 0.58333 0.41667 )  </span></span>
<span id="cb203-82"><a href="#cb203-82" aria-hidden="true" tabindex="-1"></a><span class="do">##               160) Income &lt; 60.5 6   0.000 No ( 1.00000 0.00000 ) *</span></span>
<span id="cb203-83"><a href="#cb203-83" aria-hidden="true" tabindex="-1"></a><span class="do">##               161) Income &gt; 60.5 6   5.407 Yes ( 0.16667 0.83333 ) *</span></span>
<span id="cb203-84"><a href="#cb203-84" aria-hidden="true" tabindex="-1"></a><span class="do">##              81) Population &gt; 177 26   8.477 No ( 0.96154 0.03846 ) *</span></span>
<span id="cb203-85"><a href="#cb203-85" aria-hidden="true" tabindex="-1"></a><span class="do">##            41) Price &gt; 106.5 58   0.000 No ( 1.00000 0.00000 ) *</span></span>
<span id="cb203-86"><a href="#cb203-86" aria-hidden="true" tabindex="-1"></a><span class="do">##          21) CompPrice &gt; 124.5 128 150.200 No ( 0.72656 0.27344 )  </span></span>
<span id="cb203-87"><a href="#cb203-87" aria-hidden="true" tabindex="-1"></a><span class="do">##            42) Price &lt; 122.5 51  70.680 Yes ( 0.49020 0.50980 )  </span></span>
<span id="cb203-88"><a href="#cb203-88" aria-hidden="true" tabindex="-1"></a><span class="do">##              84) ShelveLoc: Bad 11   6.702 No ( 0.90909 0.09091 ) *</span></span>
<span id="cb203-89"><a href="#cb203-89" aria-hidden="true" tabindex="-1"></a><span class="do">##              85) ShelveLoc: Medium 40  52.930 Yes ( 0.37500 0.62500 )  </span></span>
<span id="cb203-90"><a href="#cb203-90" aria-hidden="true" tabindex="-1"></a><span class="do">##               170) Price &lt; 109.5 16   7.481 Yes ( 0.06250 0.93750 ) *</span></span>
<span id="cb203-91"><a href="#cb203-91" aria-hidden="true" tabindex="-1"></a><span class="do">##               171) Price &gt; 109.5 24  32.600 No ( 0.58333 0.41667 )  </span></span>
<span id="cb203-92"><a href="#cb203-92" aria-hidden="true" tabindex="-1"></a><span class="do">##                 342) Age &lt; 49.5 13  16.050 Yes ( 0.30769 0.69231 ) *</span></span>
<span id="cb203-93"><a href="#cb203-93" aria-hidden="true" tabindex="-1"></a><span class="do">##                 343) Age &gt; 49.5 11   6.702 No ( 0.90909 0.09091 ) *</span></span>
<span id="cb203-94"><a href="#cb203-94" aria-hidden="true" tabindex="-1"></a><span class="do">##            43) Price &gt; 122.5 77  55.540 No ( 0.88312 0.11688 )  </span></span>
<span id="cb203-95"><a href="#cb203-95" aria-hidden="true" tabindex="-1"></a><span class="do">##              86) CompPrice &lt; 147.5 58  17.400 No ( 0.96552 0.03448 ) *</span></span>
<span id="cb203-96"><a href="#cb203-96" aria-hidden="true" tabindex="-1"></a><span class="do">##              87) CompPrice &gt; 147.5 19  25.010 No ( 0.63158 0.36842 )  </span></span>
<span id="cb203-97"><a href="#cb203-97" aria-hidden="true" tabindex="-1"></a><span class="do">##               174) Price &lt; 147 12  16.300 Yes ( 0.41667 0.58333 )  </span></span>
<span id="cb203-98"><a href="#cb203-98" aria-hidden="true" tabindex="-1"></a><span class="do">##                 348) CompPrice &lt; 152.5 7   5.742 Yes ( 0.14286 0.85714 ) *</span></span>
<span id="cb203-99"><a href="#cb203-99" aria-hidden="true" tabindex="-1"></a><span class="do">##                 349) CompPrice &gt; 152.5 5   5.004 No ( 0.80000 0.20000 ) *</span></span>
<span id="cb203-100"><a href="#cb203-100" aria-hidden="true" tabindex="-1"></a><span class="do">##               175) Price &gt; 147 7   0.000 No ( 1.00000 0.00000 ) *</span></span>
<span id="cb203-101"><a href="#cb203-101" aria-hidden="true" tabindex="-1"></a><span class="do">##        11) Advertising &gt; 13.5 45  61.830 Yes ( 0.44444 0.55556 )  </span></span>
<span id="cb203-102"><a href="#cb203-102" aria-hidden="true" tabindex="-1"></a><span class="do">##          22) Age &lt; 54.5 25  25.020 Yes ( 0.20000 0.80000 )  </span></span>
<span id="cb203-103"><a href="#cb203-103" aria-hidden="true" tabindex="-1"></a><span class="do">##            44) CompPrice &lt; 130.5 14  18.250 Yes ( 0.35714 0.64286 )  </span></span>
<span id="cb203-104"><a href="#cb203-104" aria-hidden="true" tabindex="-1"></a><span class="do">##              88) Income &lt; 100 9  12.370 No ( 0.55556 0.44444 ) *</span></span>
<span id="cb203-105"><a href="#cb203-105" aria-hidden="true" tabindex="-1"></a><span class="do">##              89) Income &gt; 100 5   0.000 Yes ( 0.00000 1.00000 ) *</span></span>
<span id="cb203-106"><a href="#cb203-106" aria-hidden="true" tabindex="-1"></a><span class="do">##            45) CompPrice &gt; 130.5 11   0.000 Yes ( 0.00000 1.00000 ) *</span></span>
<span id="cb203-107"><a href="#cb203-107" aria-hidden="true" tabindex="-1"></a><span class="do">##          23) Age &gt; 54.5 20  22.490 No ( 0.75000 0.25000 )  </span></span>
<span id="cb203-108"><a href="#cb203-108" aria-hidden="true" tabindex="-1"></a><span class="do">##            46) CompPrice &lt; 122.5 10   0.000 No ( 1.00000 0.00000 ) *</span></span>
<span id="cb203-109"><a href="#cb203-109" aria-hidden="true" tabindex="-1"></a><span class="do">##            47) CompPrice &gt; 122.5 10  13.860 No ( 0.50000 0.50000 )  </span></span>
<span id="cb203-110"><a href="#cb203-110" aria-hidden="true" tabindex="-1"></a><span class="do">##              94) Price &lt; 125 5   0.000 Yes ( 0.00000 1.00000 ) *</span></span>
<span id="cb203-111"><a href="#cb203-111" aria-hidden="true" tabindex="-1"></a><span class="do">##              95) Price &gt; 125 5   0.000 No ( 1.00000 0.00000 ) *</span></span>
<span id="cb203-112"><a href="#cb203-112" aria-hidden="true" tabindex="-1"></a><span class="do">##     3) ShelveLoc: Good 85  90.330 Yes ( 0.22353 0.77647 )  </span></span>
<span id="cb203-113"><a href="#cb203-113" aria-hidden="true" tabindex="-1"></a><span class="do">##       6) Price &lt; 135 68  49.260 Yes ( 0.11765 0.88235 )  </span></span>
<span id="cb203-114"><a href="#cb203-114" aria-hidden="true" tabindex="-1"></a><span class="do">##        12) US: No 17  22.070 Yes ( 0.35294 0.64706 )  </span></span>
<span id="cb203-115"><a href="#cb203-115" aria-hidden="true" tabindex="-1"></a><span class="do">##          24) Price &lt; 109 8   0.000 Yes ( 0.00000 1.00000 ) *</span></span>
<span id="cb203-116"><a href="#cb203-116" aria-hidden="true" tabindex="-1"></a><span class="do">##          25) Price &gt; 109 9  11.460 No ( 0.66667 0.33333 ) *</span></span>
<span id="cb203-117"><a href="#cb203-117" aria-hidden="true" tabindex="-1"></a><span class="do">##        13) US: Yes 51  16.880 Yes ( 0.03922 0.96078 ) *</span></span>
<span id="cb203-118"><a href="#cb203-118" aria-hidden="true" tabindex="-1"></a><span class="do">##       7) Price &gt; 135 17  22.070 No ( 0.64706 0.35294 )  </span></span>
<span id="cb203-119"><a href="#cb203-119" aria-hidden="true" tabindex="-1"></a><span class="do">##        14) Income &lt; 46 6   0.000 No ( 1.00000 0.00000 ) *</span></span>
<span id="cb203-120"><a href="#cb203-120" aria-hidden="true" tabindex="-1"></a><span class="do">##        15) Income &gt; 46 11  15.160 Yes ( 0.45455 0.54545 ) *</span></span>
<span id="cb203-121"><a href="#cb203-121" aria-hidden="true" tabindex="-1"></a>Теперь построим дерево на обучающей выборке и оценим ошибку на тестовой.</span>
<span id="cb203-122"><a href="#cb203-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-123"><a href="#cb203-123" aria-hidden="true" tabindex="-1"></a><span class="co"># ядро генератора случайных чисел</span></span>
<span id="cb203-124"><a href="#cb203-124" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2</span>)</span>
<span id="cb203-125"><a href="#cb203-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-126"><a href="#cb203-126" aria-hidden="true" tabindex="-1"></a><span class="co"># обучающая выборка</span></span>
<span id="cb203-127"><a href="#cb203-127" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(Carseats), <span class="dv">200</span>)</span>
<span id="cb203-128"><a href="#cb203-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-129"><a href="#cb203-129" aria-hidden="true" tabindex="-1"></a><span class="co"># тестовая выборка</span></span>
<span id="cb203-130"><a href="#cb203-130" aria-hidden="true" tabindex="-1"></a>Carseats.test <span class="ot">&lt;-</span> Carseats[<span class="sc">-</span>train,]</span>
<span id="cb203-131"><a href="#cb203-131" aria-hidden="true" tabindex="-1"></a>High.test <span class="ot">&lt;-</span> High[<span class="sc">-</span>train]</span>
<span id="cb203-132"><a href="#cb203-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-133"><a href="#cb203-133" aria-hidden="true" tabindex="-1"></a><span class="co"># строим дерево на обучающей выборке</span></span>
<span id="cb203-134"><a href="#cb203-134" aria-hidden="true" tabindex="-1"></a>tree.carseats <span class="ot">&lt;-</span> <span class="fu">tree</span>(High <span class="sc">~</span> . <span class="sc">-</span>Sales, Carseats, <span class="at">subset =</span> train)</span>
<span id="cb203-135"><a href="#cb203-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-136"><a href="#cb203-136" aria-hidden="true" tabindex="-1"></a><span class="co"># делаем прогноз</span></span>
<span id="cb203-137"><a href="#cb203-137" aria-hidden="true" tabindex="-1"></a>tree.pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(tree.carseats, Carseats.test, <span class="at">type =</span> <span class="st">&quot;class&quot;</span>)</span>
<span id="cb203-138"><a href="#cb203-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-139"><a href="#cb203-139" aria-hidden="true" tabindex="-1"></a><span class="co"># матрица неточностей</span></span>
<span id="cb203-140"><a href="#cb203-140" aria-hidden="true" tabindex="-1"></a>tbl <span class="ot">&lt;-</span> <span class="fu">table</span>(tree.pred, High.test)</span>
<span id="cb203-141"><a href="#cb203-141" aria-hidden="true" tabindex="-1"></a>tbl</span>
<span id="cb203-142"><a href="#cb203-142" aria-hidden="true" tabindex="-1"></a><span class="do">##          High.test</span></span>
<span id="cb203-143"><a href="#cb203-143" aria-hidden="true" tabindex="-1"></a><span class="do">## tree.pred No Yes</span></span>
<span id="cb203-144"><a href="#cb203-144" aria-hidden="true" tabindex="-1"></a><span class="do">##       No  86  27</span></span>
<span id="cb203-145"><a href="#cb203-145" aria-hidden="true" tabindex="-1"></a><span class="do">##       Yes 30  57</span></span>
<span id="cb203-146"><a href="#cb203-146" aria-hidden="true" tabindex="-1"></a><span class="co"># оценка точности</span></span>
<span id="cb203-147"><a href="#cb203-147" aria-hidden="true" tabindex="-1"></a>acc.test <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">diag</span>(tbl))<span class="sc">/</span><span class="fu">sum</span>(tbl)</span>
<span id="cb203-148"><a href="#cb203-148" aria-hidden="true" tabindex="-1"></a>acc.test</span>
<span id="cb203-149"><a href="#cb203-149" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 0.715</span></span>
<span id="cb203-150"><a href="#cb203-150" aria-hidden="true" tabindex="-1"></a>Обобщённая характеристика точности<span class="sc">:</span> доля верных прогнозов<span class="sc">:</span> <span class="dv">0</span>.<span class="fl">72.</span></span>
<span id="cb203-151"><a href="#cb203-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-152"><a href="#cb203-152" aria-hidden="true" tabindex="-1"></a>Теперь обрезаем дерево, используя в качестве критерия частоту ошибок классификации. Функция <span class="fu">cv.tree</span>() проводит кросс<span class="sc">-</span>валидацию для выбора лучшего дерева, аргумент prune.misclass означает, что мы минимизируем ошибку классификации.</span>
<span id="cb203-153"><a href="#cb203-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-154"><a href="#cb203-154" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">3</span>)</span>
<span id="cb203-155"><a href="#cb203-155" aria-hidden="true" tabindex="-1"></a>cv.carseats <span class="ot">&lt;-</span> <span class="fu">cv.tree</span>(tree.carseats, <span class="at">FUN =</span> prune.misclass)</span>
<span id="cb203-156"><a href="#cb203-156" aria-hidden="true" tabindex="-1"></a><span class="co"># имена элементов полученного объекта</span></span>
<span id="cb203-157"><a href="#cb203-157" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(cv.carseats)</span>
<span id="cb203-158"><a href="#cb203-158" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;size&quot;   &quot;dev&quot;    &quot;k&quot;      &quot;method&quot;</span></span>
<span id="cb203-159"><a href="#cb203-159" aria-hidden="true" tabindex="-1"></a><span class="co"># сам объект</span></span>
<span id="cb203-160"><a href="#cb203-160" aria-hidden="true" tabindex="-1"></a>cv.carseats</span>
<span id="cb203-161"><a href="#cb203-161" aria-hidden="true" tabindex="-1"></a><span class="do">## $size</span></span>
<span id="cb203-162"><a href="#cb203-162" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 19 17 14 13  9  7  3  2  1</span></span>
<span id="cb203-163"><a href="#cb203-163" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb203-164"><a href="#cb203-164" aria-hidden="true" tabindex="-1"></a><span class="do">## $dev</span></span>
<span id="cb203-165"><a href="#cb203-165" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 55 55 53 52 50 56 69 65 80</span></span>
<span id="cb203-166"><a href="#cb203-166" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb203-167"><a href="#cb203-167" aria-hidden="true" tabindex="-1"></a><span class="do">## $k</span></span>
<span id="cb203-168"><a href="#cb203-168" aria-hidden="true" tabindex="-1"></a><span class="do">## [1]       -Inf  0.0000000  0.6666667  1.0000000  1.7500000  2.0000000</span></span>
<span id="cb203-169"><a href="#cb203-169" aria-hidden="true" tabindex="-1"></a><span class="do">## [7]  4.2500000  5.0000000 23.0000000</span></span>
<span id="cb203-170"><a href="#cb203-170" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb203-171"><a href="#cb203-171" aria-hidden="true" tabindex="-1"></a><span class="do">## $method</span></span>
<span id="cb203-172"><a href="#cb203-172" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;misclass&quot;</span></span>
<span id="cb203-173"><a href="#cb203-173" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb203-174"><a href="#cb203-174" aria-hidden="true" tabindex="-1"></a><span class="do">## attr(,&quot;class&quot;)</span></span>
<span id="cb203-175"><a href="#cb203-175" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;prune&quot;         &quot;tree.sequence&quot;</span></span>
<span id="cb203-176"><a href="#cb203-176" aria-hidden="true" tabindex="-1"></a><span class="co"># графики изменения параметров метода по ходу обрезки дерева ###################</span></span>
<span id="cb203-177"><a href="#cb203-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-178"><a href="#cb203-178" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. ошибка с кросс-валидацией в зависимости от числа узлов</span></span>
<span id="cb203-179"><a href="#cb203-179" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb203-180"><a href="#cb203-180" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cv.carseats<span class="sc">$</span>size, cv.carseats<span class="sc">$</span>dev, <span class="at">type =</span> <span class="st">&quot;b&quot;</span>,</span>
<span id="cb203-181"><a href="#cb203-181" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&#39;Частота ошибок с кросс-вал. (dev)&#39;</span>,</span>
<span id="cb203-182"><a href="#cb203-182" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&#39;Число узлов (size)&#39;</span>)</span>
<span id="cb203-183"><a href="#cb203-183" aria-hidden="true" tabindex="-1"></a><span class="co"># размер дерева с минимальной ошибкой</span></span>
<span id="cb203-184"><a href="#cb203-184" aria-hidden="true" tabindex="-1"></a>opt.size <span class="ot">&lt;-</span> cv.carseats<span class="sc">$</span>size[cv.carseats<span class="sc">$</span>dev <span class="sc">==</span> <span class="fu">min</span>(cv.carseats<span class="sc">$</span>dev)]</span>
<span id="cb203-185"><a href="#cb203-185" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> opt.size, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>, <span class="st">&#39;lwd&#39;</span> <span class="ot">=</span> <span class="dv">2</span>)     <span class="co"># соотв. вертикальная прямая</span></span>
<span id="cb203-186"><a href="#cb203-186" aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>(opt.size, <span class="at">at =</span> opt.size, <span class="at">side =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>, <span class="at">line =</span> <span class="dv">1</span>)</span>
<span id="cb203-187"><a href="#cb203-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-188"><a href="#cb203-188" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. ошибка с кросс-валидацией в зависимости от штрафа на сложность</span></span>
<span id="cb203-189"><a href="#cb203-189" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cv.carseats<span class="sc">$</span>k, cv.carseats<span class="sc">$</span>dev, <span class="at">type =</span> <span class="st">&quot;b&quot;</span>,</span>
<span id="cb203-190"><a href="#cb203-190" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&#39;Частота ошибок с кросс-вал. (dev)&#39;</span>,</span>
<span id="cb203-191"><a href="#cb203-191" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&#39;Штраф за сложность (k)&#39;</span>)</span>
<span id="cb203-192"><a href="#cb203-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-193"><a href="#cb203-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-194"><a href="#cb203-194" aria-hidden="true" tabindex="-1"></a>Как видно на графике слева, минимум частоты ошибок достигается при числе узлов <span class="fl">9.</span> Оценим точность дерева с <span class="dv">9</span> узлами.</span>
<span id="cb203-195"><a href="#cb203-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-196"><a href="#cb203-196" aria-hidden="true" tabindex="-1"></a><span class="co"># дерево с 9 узлами</span></span>
<span id="cb203-197"><a href="#cb203-197" aria-hidden="true" tabindex="-1"></a>prune.carseats <span class="ot">&lt;-</span> <span class="fu">prune.misclass</span>(tree.carseats, <span class="at">best =</span> <span class="dv">9</span>)</span>
<span id="cb203-198"><a href="#cb203-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-199"><a href="#cb203-199" aria-hidden="true" tabindex="-1"></a><span class="co"># визуализация</span></span>
<span id="cb203-200"><a href="#cb203-200" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(prune.carseats)</span>
<span id="cb203-201"><a href="#cb203-201" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(prune.carseats, <span class="at">pretty =</span> <span class="dv">0</span>)</span>
<span id="cb203-202"><a href="#cb203-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-203"><a href="#cb203-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-204"><a href="#cb203-204" aria-hidden="true" tabindex="-1"></a><span class="co"># прогноз на тестовую выборку</span></span>
<span id="cb203-205"><a href="#cb203-205" aria-hidden="true" tabindex="-1"></a>tree.pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(prune.carseats, Carseats.test, <span class="at">type =</span> <span class="st">&quot;class&quot;</span>)</span>
<span id="cb203-206"><a href="#cb203-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-207"><a href="#cb203-207" aria-hidden="true" tabindex="-1"></a><span class="co"># матрица неточностей</span></span>
<span id="cb203-208"><a href="#cb203-208" aria-hidden="true" tabindex="-1"></a>tbl <span class="ot">&lt;-</span> <span class="fu">table</span>(tree.pred, High.test)</span>
<span id="cb203-209"><a href="#cb203-209" aria-hidden="true" tabindex="-1"></a>tbl</span>
<span id="cb203-210"><a href="#cb203-210" aria-hidden="true" tabindex="-1"></a><span class="do">##          High.test</span></span>
<span id="cb203-211"><a href="#cb203-211" aria-hidden="true" tabindex="-1"></a><span class="do">## tree.pred No Yes</span></span>
<span id="cb203-212"><a href="#cb203-212" aria-hidden="true" tabindex="-1"></a><span class="do">##       No  94  24</span></span>
<span id="cb203-213"><a href="#cb203-213" aria-hidden="true" tabindex="-1"></a><span class="do">##       Yes 22  60</span></span>
<span id="cb203-214"><a href="#cb203-214" aria-hidden="true" tabindex="-1"></a><span class="co"># оценка точности</span></span>
<span id="cb203-215"><a href="#cb203-215" aria-hidden="true" tabindex="-1"></a>acc.test <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">diag</span>(tbl))<span class="sc">/</span><span class="fu">sum</span>(tbl)</span>
<span id="cb203-216"><a href="#cb203-216" aria-hidden="true" tabindex="-1"></a>acc.test</span>
<span id="cb203-217"><a href="#cb203-217" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 0.77</span></span>
<span id="cb203-218"><a href="#cb203-218" aria-hidden="true" tabindex="-1"></a>Точность этой модели чуть выше точности исходного дерева и составляет <span class="dv">0</span>.<span class="fl">77.</span> Увеличив количество узлов, получим более глубокое дерево, но менее точное.</span>
<span id="cb203-219"><a href="#cb203-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-220"><a href="#cb203-220" aria-hidden="true" tabindex="-1"></a><span class="co"># дерево с 13 узлами</span></span>
<span id="cb203-221"><a href="#cb203-221" aria-hidden="true" tabindex="-1"></a>prune.carseats <span class="ot">&lt;-</span> <span class="fu">prune.misclass</span>(tree.carseats, <span class="at">best =</span> <span class="dv">15</span>)</span>
<span id="cb203-222"><a href="#cb203-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-223"><a href="#cb203-223" aria-hidden="true" tabindex="-1"></a><span class="co"># визуализация</span></span>
<span id="cb203-224"><a href="#cb203-224" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(prune.carseats)</span>
<span id="cb203-225"><a href="#cb203-225" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(prune.carseats, <span class="at">pretty =</span> <span class="dv">0</span>)</span>
<span id="cb203-226"><a href="#cb203-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-227"><a href="#cb203-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-228"><a href="#cb203-228" aria-hidden="true" tabindex="-1"></a><span class="co"># прогноз на тестовую выборку</span></span>
<span id="cb203-229"><a href="#cb203-229" aria-hidden="true" tabindex="-1"></a>tree.pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(prune.carseats, Carseats.test, <span class="at">type =</span> <span class="st">&quot;class&quot;</span>)</span>
<span id="cb203-230"><a href="#cb203-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-231"><a href="#cb203-231" aria-hidden="true" tabindex="-1"></a><span class="co"># матрица неточностей</span></span>
<span id="cb203-232"><a href="#cb203-232" aria-hidden="true" tabindex="-1"></a>tbl <span class="ot">&lt;-</span> <span class="fu">table</span>(tree.pred, High.test)</span>
<span id="cb203-233"><a href="#cb203-233" aria-hidden="true" tabindex="-1"></a>tbl</span>
<span id="cb203-234"><a href="#cb203-234" aria-hidden="true" tabindex="-1"></a><span class="do">##          High.test</span></span>
<span id="cb203-235"><a href="#cb203-235" aria-hidden="true" tabindex="-1"></a><span class="do">## tree.pred No Yes</span></span>
<span id="cb203-236"><a href="#cb203-236" aria-hidden="true" tabindex="-1"></a><span class="do">##       No  86  22</span></span>
<span id="cb203-237"><a href="#cb203-237" aria-hidden="true" tabindex="-1"></a><span class="do">##       Yes 30  62</span></span>
<span id="cb203-238"><a href="#cb203-238" aria-hidden="true" tabindex="-1"></a><span class="co"># оценка точности</span></span>
<span id="cb203-239"><a href="#cb203-239" aria-hidden="true" tabindex="-1"></a>acc.test <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">diag</span>(tbl))<span class="sc">/</span><span class="fu">sum</span>(tbl)</span>
<span id="cb203-240"><a href="#cb203-240" aria-hidden="true" tabindex="-1"></a>acc.test</span>
<span id="cb203-241"><a href="#cb203-241" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 0.74</span></span>
<span id="cb203-242"><a href="#cb203-242" aria-hidden="true" tabindex="-1"></a><span class="co"># сбрасываем графические параметры</span></span>
<span id="cb203-243"><a href="#cb203-243" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb203-244"><a href="#cb203-244" aria-hidden="true" tabindex="-1"></a>Регрессионные деревья</span>
<span id="cb203-245"><a href="#cb203-245" aria-hidden="true" tabindex="-1"></a>Воспользуемся набором данных Boston.</span>
<span id="cb203-246"><a href="#cb203-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-247"><a href="#cb203-247" aria-hidden="true" tabindex="-1"></a>?Boston</span>
<span id="cb203-248"><a href="#cb203-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-249"><a href="#cb203-249" aria-hidden="true" tabindex="-1"></a><span class="co"># обучающая выборка</span></span>
<span id="cb203-250"><a href="#cb203-250" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb203-251"><a href="#cb203-251" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(Boston), <span class="fu">nrow</span>(Boston)<span class="sc">/</span><span class="dv">2</span>) <span class="co"># обучающая выборка -- 50%</span></span>
<span id="cb203-252"><a href="#cb203-252" aria-hidden="true" tabindex="-1"></a>Построим дерево регрессии для зависимой переменной medv<span class="sc">:</span> медианная стоимости домов, в которых живут собственники (тыс. долл.).</span>
<span id="cb203-253"><a href="#cb203-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-254"><a href="#cb203-254" aria-hidden="true" tabindex="-1"></a><span class="co"># обучаем модель</span></span>
<span id="cb203-255"><a href="#cb203-255" aria-hidden="true" tabindex="-1"></a>tree.boston <span class="ot">&lt;-</span> <span class="fu">tree</span>(medv <span class="sc">~</span> ., Boston, <span class="at">subset =</span> train)</span>
<span id="cb203-256"><a href="#cb203-256" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(tree.boston)</span>
<span id="cb203-257"><a href="#cb203-257" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb203-258"><a href="#cb203-258" aria-hidden="true" tabindex="-1"></a><span class="do">## Regression tree:</span></span>
<span id="cb203-259"><a href="#cb203-259" aria-hidden="true" tabindex="-1"></a><span class="do">## tree(formula = medv ~ ., data = Boston, subset = train)</span></span>
<span id="cb203-260"><a href="#cb203-260" aria-hidden="true" tabindex="-1"></a><span class="do">## Variables actually used in tree construction:</span></span>
<span id="cb203-261"><a href="#cb203-261" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;lstat&quot; &quot;rm&quot;    &quot;dis&quot;  </span></span>
<span id="cb203-262"><a href="#cb203-262" aria-hidden="true" tabindex="-1"></a><span class="do">## Number of terminal nodes:  8 </span></span>
<span id="cb203-263"><a href="#cb203-263" aria-hidden="true" tabindex="-1"></a><span class="do">## Residual mean deviance:  12.65 = 3099 / 245 </span></span>
<span id="cb203-264"><a href="#cb203-264" aria-hidden="true" tabindex="-1"></a><span class="do">## Distribution of residuals:</span></span>
<span id="cb203-265"><a href="#cb203-265" aria-hidden="true" tabindex="-1"></a><span class="do">##      Min.   1st Qu.    Median      Mean   3rd Qu.      Max. </span></span>
<span id="cb203-266"><a href="#cb203-266" aria-hidden="true" tabindex="-1"></a><span class="do">## -14.10000  -2.04200  -0.05357   0.00000   1.96000  12.60000</span></span>
<span id="cb203-267"><a href="#cb203-267" aria-hidden="true" tabindex="-1"></a><span class="co"># визуализация</span></span>
<span id="cb203-268"><a href="#cb203-268" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(tree.boston)</span>
<span id="cb203-269"><a href="#cb203-269" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(tree.boston, <span class="at">pretty =</span> <span class="dv">0</span>)</span>
<span id="cb203-270"><a href="#cb203-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-271"><a href="#cb203-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-272"><a href="#cb203-272" aria-hidden="true" tabindex="-1"></a>Снова сделаем обрезку дерева в целях улучшения качества прогноза.</span>
<span id="cb203-273"><a href="#cb203-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-274"><a href="#cb203-274" aria-hidden="true" tabindex="-1"></a>cv.boston <span class="ot">&lt;-</span> <span class="fu">cv.tree</span>(tree.boston)</span>
<span id="cb203-275"><a href="#cb203-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-276"><a href="#cb203-276" aria-hidden="true" tabindex="-1"></a><span class="co"># размер дерева с минимальной ошибкой</span></span>
<span id="cb203-277"><a href="#cb203-277" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cv.boston<span class="sc">$</span>size, cv.boston<span class="sc">$</span>dev, <span class="at">type =</span> <span class="st">&#39;b&#39;</span>)</span>
<span id="cb203-278"><a href="#cb203-278" aria-hidden="true" tabindex="-1"></a>opt.size <span class="ot">&lt;-</span> cv.boston<span class="sc">$</span>size[cv.boston<span class="sc">$</span>dev <span class="sc">==</span> <span class="fu">min</span>(cv.boston<span class="sc">$</span>dev)]</span>
<span id="cb203-279"><a href="#cb203-279" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> opt.size, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>, <span class="st">&#39;lwd&#39;</span> <span class="ot">=</span> <span class="dv">2</span>)     <span class="co"># соотв. вертикальная прямая</span></span>
<span id="cb203-280"><a href="#cb203-280" aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>(opt.size, <span class="at">at =</span> opt.size, <span class="at">side =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>, <span class="at">line =</span> <span class="dv">1</span>)</span>
<span id="cb203-281"><a href="#cb203-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-282"><a href="#cb203-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-283"><a href="#cb203-283" aria-hidden="true" tabindex="-1"></a>В данном случаем минимум ошибки соответствует самому сложному дереву, с <span class="dv">8</span> узлами. Покажем, как при желании можно обрезать дерево до <span class="dv">7</span> узлов (ошибка ненамного выше, чем минимальная).</span>
<span id="cb203-284"><a href="#cb203-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-285"><a href="#cb203-285" aria-hidden="true" tabindex="-1"></a><span class="co"># дерево с 7 узлами</span></span>
<span id="cb203-286"><a href="#cb203-286" aria-hidden="true" tabindex="-1"></a>prune.boston <span class="ot">=</span> <span class="fu">prune.tree</span>(tree.boston, <span class="at">best =</span> <span class="dv">7</span>)</span>
<span id="cb203-287"><a href="#cb203-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-288"><a href="#cb203-288" aria-hidden="true" tabindex="-1"></a><span class="co"># визуализация</span></span>
<span id="cb203-289"><a href="#cb203-289" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(prune.boston)</span>
<span id="cb203-290"><a href="#cb203-290" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(prune.boston, <span class="at">pretty =</span> <span class="dv">0</span>)</span>
<span id="cb203-291"><a href="#cb203-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-292"><a href="#cb203-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-293"><a href="#cb203-293" aria-hidden="true" tabindex="-1"></a>Прогноз сделаем по необрезанному дереву, т.к. там ошибка, оцененная по методу перекрёстной проверки, минимальна.</span>
<span id="cb203-294"><a href="#cb203-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-295"><a href="#cb203-295" aria-hidden="true" tabindex="-1"></a><span class="co"># прогноз по лучшей модели (8 узлов)</span></span>
<span id="cb203-296"><a href="#cb203-296" aria-hidden="true" tabindex="-1"></a>yhat <span class="ot">&lt;-</span> <span class="fu">predict</span>(tree.boston, <span class="at">newdata =</span> Boston[<span class="sc">-</span>train, ])</span>
<span id="cb203-297"><a href="#cb203-297" aria-hidden="true" tabindex="-1"></a>boston.test <span class="ot">&lt;-</span> Boston[<span class="sc">-</span>train, <span class="st">&quot;medv&quot;</span>]</span>
<span id="cb203-298"><a href="#cb203-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-299"><a href="#cb203-299" aria-hidden="true" tabindex="-1"></a><span class="co"># график &quot;прогноз -- реализация&quot;</span></span>
<span id="cb203-300"><a href="#cb203-300" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(yhat, boston.test)</span>
<span id="cb203-301"><a href="#cb203-301" aria-hidden="true" tabindex="-1"></a><span class="co"># линия идеального прогноза</span></span>
<span id="cb203-302"><a href="#cb203-302" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb203-303"><a href="#cb203-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-304"><a href="#cb203-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-305"><a href="#cb203-305" aria-hidden="true" tabindex="-1"></a><span class="co"># MSE на тестовой выборке</span></span>
<span id="cb203-306"><a href="#cb203-306" aria-hidden="true" tabindex="-1"></a>mse.test <span class="ot">&lt;-</span> <span class="fu">mean</span>((yhat <span class="sc">-</span> boston.test)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb203-307"><a href="#cb203-307" aria-hidden="true" tabindex="-1"></a>MSE на тестовой выборке равна <span class="fl">25.05</span> (тыс.долл.).</span>
<span id="cb203-308"><a href="#cb203-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-309"><a href="#cb203-309" aria-hidden="true" tabindex="-1"></a>Бэггинг и метод случайного леса</span>
<span id="cb203-310"><a href="#cb203-310" aria-hidden="true" tabindex="-1"></a>Рассмотрим более сложные методы улучшения качества дерева. Бэггинг – частный случай случайного леса с m<span class="ot">=</span>p, поэтому и то, и другое можно построить функцией <span class="fu">randomForest</span>().</span>
<span id="cb203-311"><a href="#cb203-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-312"><a href="#cb203-312" aria-hidden="true" tabindex="-1"></a>Для начала используем бэггинг, причём возьмём все <span class="dv">13</span> предикторов на каждом шаге (аргумент mtry).</span>
<span id="cb203-313"><a href="#cb203-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-314"><a href="#cb203-314" aria-hidden="true" tabindex="-1"></a><span class="co"># бэггинг с 13 предикторами</span></span>
<span id="cb203-315"><a href="#cb203-315" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb203-316"><a href="#cb203-316" aria-hidden="true" tabindex="-1"></a>bag.boston <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(medv <span class="sc">~</span> ., <span class="at">data =</span> Boston, <span class="at">subset =</span> train, </span>
<span id="cb203-317"><a href="#cb203-317" aria-hidden="true" tabindex="-1"></a>                           <span class="at">mtry =</span> <span class="dv">13</span>, <span class="at">importance =</span> <span class="cn">TRUE</span>)</span>
<span id="cb203-318"><a href="#cb203-318" aria-hidden="true" tabindex="-1"></a>bag.boston</span>
<span id="cb203-319"><a href="#cb203-319" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb203-320"><a href="#cb203-320" aria-hidden="true" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb203-321"><a href="#cb203-321" aria-hidden="true" tabindex="-1"></a><span class="do">##  randomForest(formula = medv ~ ., data = Boston, mtry = 13, importance = TRUE,      subset = train) </span></span>
<span id="cb203-322"><a href="#cb203-322" aria-hidden="true" tabindex="-1"></a><span class="do">##                Type of random forest: regression</span></span>
<span id="cb203-323"><a href="#cb203-323" aria-hidden="true" tabindex="-1"></a><span class="do">##                      Number of trees: 500</span></span>
<span id="cb203-324"><a href="#cb203-324" aria-hidden="true" tabindex="-1"></a><span class="do">## No. of variables tried at each split: 13</span></span>
<span id="cb203-325"><a href="#cb203-325" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb203-326"><a href="#cb203-326" aria-hidden="true" tabindex="-1"></a><span class="do">##           Mean of squared residuals: 11.15723</span></span>
<span id="cb203-327"><a href="#cb203-327" aria-hidden="true" tabindex="-1"></a><span class="do">##                     % Var explained: 86.49</span></span>
<span id="cb203-328"><a href="#cb203-328" aria-hidden="true" tabindex="-1"></a><span class="co"># прогноз</span></span>
<span id="cb203-329"><a href="#cb203-329" aria-hidden="true" tabindex="-1"></a>yhat.bag <span class="ot">=</span> <span class="fu">predict</span>(bag.boston, <span class="at">newdata =</span> Boston[<span class="sc">-</span>train, ])</span>
<span id="cb203-330"><a href="#cb203-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-331"><a href="#cb203-331" aria-hidden="true" tabindex="-1"></a><span class="co"># график &quot;прогноз -- реализация&quot;</span></span>
<span id="cb203-332"><a href="#cb203-332" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(yhat.bag, boston.test)</span>
<span id="cb203-333"><a href="#cb203-333" aria-hidden="true" tabindex="-1"></a><span class="co"># линия идеального прогноза</span></span>
<span id="cb203-334"><a href="#cb203-334" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb203-335"><a href="#cb203-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-336"><a href="#cb203-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-337"><a href="#cb203-337" aria-hidden="true" tabindex="-1"></a><span class="co"># MSE на тестовой</span></span>
<span id="cb203-338"><a href="#cb203-338" aria-hidden="true" tabindex="-1"></a>mse.test <span class="ot">&lt;-</span> <span class="fu">mean</span>((yhat.bag <span class="sc">-</span> boston.test)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb203-339"><a href="#cb203-339" aria-hidden="true" tabindex="-1"></a>mse.test</span>
<span id="cb203-340"><a href="#cb203-340" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 13.50808</span></span>
<span id="cb203-341"><a href="#cb203-341" aria-hidden="true" tabindex="-1"></a>Ошибка на тестовой выборке равна <span class="dv">13</span>.<span class="fl">51.</span></span>
<span id="cb203-342"><a href="#cb203-342" aria-hidden="true" tabindex="-1"></a>Можно изменить число деревьев с помощью аргумента ntree.</span>
<span id="cb203-343"><a href="#cb203-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-344"><a href="#cb203-344" aria-hidden="true" tabindex="-1"></a>bag.boston <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(medv <span class="sc">~</span> ., <span class="at">data =</span> Boston, <span class="at">subset =</span> train,</span>
<span id="cb203-345"><a href="#cb203-345" aria-hidden="true" tabindex="-1"></a>                           <span class="at">mtry =</span> <span class="dv">13</span>, <span class="at">ntree =</span> <span class="dv">25</span>)</span>
<span id="cb203-346"><a href="#cb203-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-347"><a href="#cb203-347" aria-hidden="true" tabindex="-1"></a><span class="co"># прогноз</span></span>
<span id="cb203-348"><a href="#cb203-348" aria-hidden="true" tabindex="-1"></a>yhat.bag <span class="ot">&lt;-</span> <span class="fu">predict</span>(bag.boston, <span class="at">newdata =</span> Boston[<span class="sc">-</span>train, ])</span>
<span id="cb203-349"><a href="#cb203-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-350"><a href="#cb203-350" aria-hidden="true" tabindex="-1"></a><span class="co"># MSE на тестовой</span></span>
<span id="cb203-351"><a href="#cb203-351" aria-hidden="true" tabindex="-1"></a>mse.test <span class="ot">&lt;-</span> <span class="fu">mean</span>((yhat.bag <span class="sc">-</span> boston.test)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb203-352"><a href="#cb203-352" aria-hidden="true" tabindex="-1"></a>mse.test</span>
<span id="cb203-353"><a href="#cb203-353" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 13.94835</span></span>
<span id="cb203-354"><a href="#cb203-354" aria-hidden="true" tabindex="-1"></a>Но, как видно, это только ухудшает прогноз.</span>
<span id="cb203-355"><a href="#cb203-355" aria-hidden="true" tabindex="-1"></a>Теперь попробуем вырастить случайный лес. Берём <span class="dv">6</span> предикторов на каждом шаге.</span>
<span id="cb203-356"><a href="#cb203-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-357"><a href="#cb203-357" aria-hidden="true" tabindex="-1"></a><span class="co"># обучаем модель</span></span>
<span id="cb203-358"><a href="#cb203-358" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb203-359"><a href="#cb203-359" aria-hidden="true" tabindex="-1"></a>rf.boston <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(medv <span class="sc">~</span> ., <span class="at">data =</span> Boston, <span class="at">subset =</span> train,</span>
<span id="cb203-360"><a href="#cb203-360" aria-hidden="true" tabindex="-1"></a>                          <span class="at">mtry =</span> <span class="dv">6</span>, <span class="at">importance =</span> <span class="cn">TRUE</span>)</span>
<span id="cb203-361"><a href="#cb203-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-362"><a href="#cb203-362" aria-hidden="true" tabindex="-1"></a><span class="co"># прогноз</span></span>
<span id="cb203-363"><a href="#cb203-363" aria-hidden="true" tabindex="-1"></a>yhat.rf <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf.boston, <span class="at">newdata =</span> Boston[<span class="sc">-</span>train, ])</span>
<span id="cb203-364"><a href="#cb203-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-365"><a href="#cb203-365" aria-hidden="true" tabindex="-1"></a><span class="co"># MSE на тестовой выборке</span></span>
<span id="cb203-366"><a href="#cb203-366" aria-hidden="true" tabindex="-1"></a>mse.test <span class="ot">&lt;-</span> <span class="fu">mean</span>((yhat.rf <span class="sc">-</span> boston.test)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb203-367"><a href="#cb203-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-368"><a href="#cb203-368" aria-hidden="true" tabindex="-1"></a><span class="co"># важность предикторов</span></span>
<span id="cb203-369"><a href="#cb203-369" aria-hidden="true" tabindex="-1"></a><span class="fu">importance</span>(rf.boston)  <span class="co"># оценки </span></span>
<span id="cb203-370"><a href="#cb203-370" aria-hidden="true" tabindex="-1"></a><span class="do">##           %IncMSE IncNodePurity</span></span>
<span id="cb203-371"><a href="#cb203-371" aria-hidden="true" tabindex="-1"></a><span class="do">## crim    12.132320     986.50338</span></span>
<span id="cb203-372"><a href="#cb203-372" aria-hidden="true" tabindex="-1"></a><span class="do">## zn       1.955579      57.96945</span></span>
<span id="cb203-373"><a href="#cb203-373" aria-hidden="true" tabindex="-1"></a><span class="do">## indus    9.069302     882.78261</span></span>
<span id="cb203-374"><a href="#cb203-374" aria-hidden="true" tabindex="-1"></a><span class="do">## chas     2.210835      45.22941</span></span>
<span id="cb203-375"><a href="#cb203-375" aria-hidden="true" tabindex="-1"></a><span class="do">## nox     11.104823    1044.33776</span></span>
<span id="cb203-376"><a href="#cb203-376" aria-hidden="true" tabindex="-1"></a><span class="do">## rm      31.784033    6359.31971</span></span>
<span id="cb203-377"><a href="#cb203-377" aria-hidden="true" tabindex="-1"></a><span class="do">## age     10.962684     516.82969</span></span>
<span id="cb203-378"><a href="#cb203-378" aria-hidden="true" tabindex="-1"></a><span class="do">## dis     15.015236    1224.11605</span></span>
<span id="cb203-379"><a href="#cb203-379" aria-hidden="true" tabindex="-1"></a><span class="do">## rad      4.118011      95.94586</span></span>
<span id="cb203-380"><a href="#cb203-380" aria-hidden="true" tabindex="-1"></a><span class="do">## tax      8.587932     502.96719</span></span>
<span id="cb203-381"><a href="#cb203-381" aria-hidden="true" tabindex="-1"></a><span class="do">## ptratio 12.503896     830.77523</span></span>
<span id="cb203-382"><a href="#cb203-382" aria-hidden="true" tabindex="-1"></a><span class="do">## black    6.702609     341.30361</span></span>
<span id="cb203-383"><a href="#cb203-383" aria-hidden="true" tabindex="-1"></a><span class="do">## lstat   30.695224    7505.73936</span></span>
<span id="cb203-384"><a href="#cb203-384" aria-hidden="true" tabindex="-1"></a><span class="fu">varImpPlot</span>(rf.boston)  <span class="co"># графики</span></span>
<span id="cb203-385"><a href="#cb203-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-386"><a href="#cb203-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-387"><a href="#cb203-387" aria-hidden="true" tabindex="-1"></a>Ошибка по модели случайного леса равна <span class="fl">11.66</span>, что ниже, чем для бэггинга.</span>
<span id="cb203-388"><a href="#cb203-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-389"><a href="#cb203-389" aria-hidden="true" tabindex="-1"></a>Бустинг</span>
<span id="cb203-390"><a href="#cb203-390" aria-hidden="true" tabindex="-1"></a>Построим <span class="dv">5000</span> регрессионных деревьев с глубиной <span class="fl">4.</span></span>
<span id="cb203-391"><a href="#cb203-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-392"><a href="#cb203-392" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb203-393"><a href="#cb203-393" aria-hidden="true" tabindex="-1"></a>boost.boston <span class="ot">&lt;-</span> <span class="fu">gbm</span>(medv <span class="sc">~</span> ., <span class="at">data =</span> Boston[train, ], <span class="at">distribution =</span> <span class="st">&quot;gaussian&quot;</span>,</span>
<span id="cb203-394"><a href="#cb203-394" aria-hidden="true" tabindex="-1"></a>                    <span class="at">n.trees =</span> <span class="dv">5000</span>, <span class="at">interaction.depth =</span> <span class="dv">4</span>)</span>
<span id="cb203-395"><a href="#cb203-395" aria-hidden="true" tabindex="-1"></a><span class="co"># график и таблица относительной важности переменных</span></span>
<span id="cb203-396"><a href="#cb203-396" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(boost.boston)</span>
<span id="cb203-397"><a href="#cb203-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-398"><a href="#cb203-398" aria-hidden="true" tabindex="-1"></a><span class="co"># графики частной зависимости для двух наиболее важных предикторов</span></span>
<span id="cb203-399"><a href="#cb203-399" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb203-400"><a href="#cb203-400" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(boost.boston, <span class="at">i =</span> <span class="st">&quot;rm&quot;</span>)</span>
<span id="cb203-401"><a href="#cb203-401" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(boost.boston, <span class="at">i =</span> <span class="st">&quot;lstat&quot;</span>)</span>
<span id="cb203-402"><a href="#cb203-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-403"><a href="#cb203-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-404"><a href="#cb203-404" aria-hidden="true" tabindex="-1"></a><span class="co"># прогноз</span></span>
<span id="cb203-405"><a href="#cb203-405" aria-hidden="true" tabindex="-1"></a>yhat.boost <span class="ot">&lt;-</span> <span class="fu">predict</span>(boost.boston, <span class="at">newdata =</span> Boston[<span class="sc">-</span>train, ], <span class="at">n.trees =</span> <span class="dv">5000</span>)</span>
<span id="cb203-406"><a href="#cb203-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-407"><a href="#cb203-407" aria-hidden="true" tabindex="-1"></a><span class="co"># MSE на тестовой</span></span>
<span id="cb203-408"><a href="#cb203-408" aria-hidden="true" tabindex="-1"></a>mse.test <span class="ot">&lt;-</span> <span class="fu">mean</span>((yhat.boost <span class="sc">-</span> boston.test)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb203-409"><a href="#cb203-409" aria-hidden="true" tabindex="-1"></a>mse.test</span>
<span id="cb203-410"><a href="#cb203-410" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 11.84434</span></span>
<span id="cb203-411"><a href="#cb203-411" aria-hidden="true" tabindex="-1"></a>Настройку бустинга можно делать с помощью гиперпараметра λ (аргумент shrinkage). Установим его равным <span class="dv">0</span>.<span class="fl">2.</span></span>
<span id="cb203-412"><a href="#cb203-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-413"><a href="#cb203-413" aria-hidden="true" tabindex="-1"></a><span class="co"># меняем значение гиперпараметра (lambda) на 0.2 -- аргумент shrinkage</span></span>
<span id="cb203-414"><a href="#cb203-414" aria-hidden="true" tabindex="-1"></a>boost.boston <span class="ot">&lt;-</span> <span class="fu">gbm</span>(medv <span class="sc">~</span> ., <span class="at">data =</span> Boston[train, ], <span class="at">distribution =</span> <span class="st">&quot;gaussian&quot;</span>,</span>
<span id="cb203-415"><a href="#cb203-415" aria-hidden="true" tabindex="-1"></a>                    <span class="at">n.trees =</span> <span class="dv">5000</span>, <span class="at">interaction.depth =</span> <span class="dv">4</span>, </span>
<span id="cb203-416"><a href="#cb203-416" aria-hidden="true" tabindex="-1"></a>                    <span class="at">shrinkage =</span> <span class="fl">0.2</span>, <span class="at">verbose =</span> F)</span>
<span id="cb203-417"><a href="#cb203-417" aria-hidden="true" tabindex="-1"></a><span class="co"># прогноз</span></span>
<span id="cb203-418"><a href="#cb203-418" aria-hidden="true" tabindex="-1"></a>yhat.boost <span class="ot">&lt;-</span> <span class="fu">predict</span>(boost.boston, <span class="at">newdata =</span> Boston[<span class="sc">-</span>train, ], <span class="at">n.trees =</span> <span class="dv">5000</span>)</span>
<span id="cb203-419"><a href="#cb203-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-420"><a href="#cb203-420" aria-hidden="true" tabindex="-1"></a><span class="co"># MSE а тестовой</span></span>
<span id="cb203-421"><a href="#cb203-421" aria-hidden="true" tabindex="-1"></a>mse.test <span class="ot">&lt;-</span> <span class="fu">mean</span>((yhat.boost <span class="sc">-</span> boston.test)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb203-422"><a href="#cb203-422" aria-hidden="true" tabindex="-1"></a>mse.test</span>
<span id="cb203-423"><a href="#cb203-423" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 11.51109</span></span>
<span id="cb203-424"><a href="#cb203-424" aria-hidden="true" tabindex="-1"></a>Таким образом, изменив гиперпараметр, мы ещё немного снизили ошибку прогноза.</span></code></pre></div>
<!--chapter:end:24_nonlinear_regression.Rmd-->
</div>
<div id="multiple-linear-regression" class="section level1" number="26">
<h1 number="26"><span class="header-section-number">26</span> Multiple linear regression</h1>
<p>Source: Анализ данных в R. Множественная линейная регрессия</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Dataset swiss</span></span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a>?swiss</span>
<span id="cb204-3"><a href="#cb204-3" aria-hidden="true" tabindex="-1"></a>swiss <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(swiss)</span>
<span id="cb204-4"><a href="#cb204-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(swiss)</span>
<span id="cb204-5"><a href="#cb204-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-6"><a href="#cb204-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Histogram of fertility</span></span>
<span id="cb204-7"><a href="#cb204-7" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(swiss<span class="sc">$</span>Fertility, <span class="at">col=</span><span class="st">&#39;red&#39;</span>)</span>
<span id="cb204-8"><a href="#cb204-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-9"><a href="#cb204-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Numeric predictors for Fertility prediction</span></span>
<span id="cb204-10"><a href="#cb204-10" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(Fertility <span class="sc">~</span> Examination <span class="sc">+</span> Catholic, <span class="at">data =</span> swiss)</span>
<span id="cb204-11"><a href="#cb204-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span>
<span id="cb204-12"><a href="#cb204-12" aria-hidden="true" tabindex="-1"></a><span class="co"># the principal predictor is an &#39;examination&#39; with negative correlation.</span></span>
<span id="cb204-13"><a href="#cb204-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-14"><a href="#cb204-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Interaction of variables &#39;examination&#39; and &#39;catholics&#39; &#39;*&#39;</span></span>
<span id="cb204-15"><a href="#cb204-15" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Fertility <span class="sc">~</span> Examination<span class="sc">*</span>Catholic, <span class="at">data =</span> swiss)</span>
<span id="cb204-16"><a href="#cb204-16" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit2)</span>
<span id="cb204-17"><a href="#cb204-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-18"><a href="#cb204-18" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(fit2)</span>
<span id="cb204-19"><a href="#cb204-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-20"><a href="#cb204-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Categorical predictors</span></span>
<span id="cb204-21"><a href="#cb204-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Histogram obviously have two parts -&gt; we can split data for two factors</span></span>
<span id="cb204-22"><a href="#cb204-22" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(swiss<span class="sc">$</span>Catholic, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>)</span>
<span id="cb204-23"><a href="#cb204-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-24"><a href="#cb204-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Lets split &#39;Catholics&#39; for two groups: with many &#39;lots&#39; and few &#39;few&#39;</span></span>
<span id="cb204-25"><a href="#cb204-25" aria-hidden="true" tabindex="-1"></a>swiss<span class="sc">$</span>religious <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(swiss<span class="sc">$</span>Catholic <span class="sc">&gt;</span> <span class="dv">60</span>, <span class="st">&#39;Lots&#39;</span>, <span class="st">&#39;Few&#39;</span>)</span>
<span id="cb204-26"><a href="#cb204-26" aria-hidden="true" tabindex="-1"></a>swiss<span class="sc">$</span>religious <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(swiss<span class="sc">$</span>religious)</span>
<span id="cb204-27"><a href="#cb204-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-28"><a href="#cb204-28" aria-hidden="true" tabindex="-1"></a>fit3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Fertility <span class="sc">~</span> Examination <span class="sc">+</span> religious, <span class="at">data =</span> swiss)</span>
<span id="cb204-29"><a href="#cb204-29" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit3)</span>
<span id="cb204-30"><a href="#cb204-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-31"><a href="#cb204-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Interaction of variables</span></span>
<span id="cb204-32"><a href="#cb204-32" aria-hidden="true" tabindex="-1"></a>fit4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Fertility <span class="sc">~</span> religious<span class="sc">*</span>Examination, <span class="at">data =</span> swiss)</span>
<span id="cb204-33"><a href="#cb204-33" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit4)</span>
<span id="cb204-34"><a href="#cb204-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-35"><a href="#cb204-35" aria-hidden="true" tabindex="-1"></a><span class="co"># plots</span></span>
<span id="cb204-36"><a href="#cb204-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-37"><a href="#cb204-37" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(swiss, <span class="fu">aes</span>(<span class="at">x =</span> Examination, <span class="at">y =</span> Fertility)) <span class="sc">+</span> </span>
<span id="cb204-38"><a href="#cb204-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() </span>
<span id="cb204-39"><a href="#cb204-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-40"><a href="#cb204-40" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(swiss, <span class="fu">aes</span>(<span class="at">x =</span> Examination, <span class="at">y =</span> Fertility)) <span class="sc">+</span> </span>
<span id="cb204-41"><a href="#cb204-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb204-42"><a href="#cb204-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>()</span>
<span id="cb204-43"><a href="#cb204-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-44"><a href="#cb204-44" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(swiss, <span class="fu">aes</span>(<span class="at">x =</span> Examination, <span class="at">y =</span> Fertility)) <span class="sc">+</span> </span>
<span id="cb204-45"><a href="#cb204-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb204-46"><a href="#cb204-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&#39;lm&#39;</span>)</span>
<span id="cb204-47"><a href="#cb204-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-48"><a href="#cb204-48" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(swiss, <span class="fu">aes</span>(<span class="at">x =</span> Examination, <span class="at">y =</span> Fertility, <span class="at">col =</span> religious)) <span class="sc">+</span> </span>
<span id="cb204-49"><a href="#cb204-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() </span>
<span id="cb204-50"><a href="#cb204-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-51"><a href="#cb204-51" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(swiss, <span class="fu">aes</span>(<span class="at">x =</span> Examination, <span class="at">y =</span> Fertility, <span class="at">col =</span> religious)) <span class="sc">+</span> </span>
<span id="cb204-52"><a href="#cb204-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()  <span class="sc">+</span> </span>
<span id="cb204-53"><a href="#cb204-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>()</span>
<span id="cb204-54"><a href="#cb204-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-55"><a href="#cb204-55" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(swiss, <span class="fu">aes</span>(<span class="at">x =</span> Examination, <span class="at">y =</span> Fertility, <span class="at">col =</span> religious)) <span class="sc">+</span> </span>
<span id="cb204-56"><a href="#cb204-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()  <span class="sc">+</span> </span>
<span id="cb204-57"><a href="#cb204-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&#39;lm&#39;</span>)</span>
<span id="cb204-58"><a href="#cb204-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-59"><a href="#cb204-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-60"><a href="#cb204-60" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb204-61"><a href="#cb204-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-62"><a href="#cb204-62" aria-hidden="true" tabindex="-1"></a>fit5 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Fertility <span class="sc">~</span> religious<span class="sc">*</span>Infant.Mortality<span class="sc">*</span>Examination, <span class="at">data =</span> swiss)</span>
<span id="cb204-63"><a href="#cb204-63" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit5)</span>
<span id="cb204-64"><a href="#cb204-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-65"><a href="#cb204-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-66"><a href="#cb204-66" aria-hidden="true" tabindex="-1"></a><span class="co"># model comparison</span></span>
<span id="cb204-67"><a href="#cb204-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-68"><a href="#cb204-68" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(swiss)</span>
<span id="cb204-69"><a href="#cb204-69" aria-hidden="true" tabindex="-1"></a>swiss <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(swiss)</span>
<span id="cb204-70"><a href="#cb204-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-71"><a href="#cb204-71" aria-hidden="true" tabindex="-1"></a>fit_full <span class="ot">&lt;-</span> <span class="fu">lm</span>(Fertility <span class="sc">~</span> ., <span class="at">data =</span> swiss)</span>
<span id="cb204-72"><a href="#cb204-72" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_full)</span>
<span id="cb204-73"><a href="#cb204-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-74"><a href="#cb204-74" aria-hidden="true" tabindex="-1"></a>fit_reduced1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Fertility <span class="sc">~</span> Infant.Mortality <span class="sc">+</span> Examination <span class="sc">+</span> Catholic <span class="sc">+</span> Education, <span class="at">data =</span> swiss)</span>
<span id="cb204-75"><a href="#cb204-75" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_reduced1)</span>
<span id="cb204-76"><a href="#cb204-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-77"><a href="#cb204-77" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fit_full, fit_reduced1)</span>
<span id="cb204-78"><a href="#cb204-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-79"><a href="#cb204-79" aria-hidden="true" tabindex="-1"></a>fit_reduced2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Fertility <span class="sc">~</span> Infant.Mortality <span class="sc">+</span> Education <span class="sc">+</span> Catholic <span class="sc">+</span> Agriculture, <span class="at">data =</span> swiss)</span>
<span id="cb204-80"><a href="#cb204-80" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_reduced2)</span>
<span id="cb204-81"><a href="#cb204-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-82"><a href="#cb204-82" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fit_full, fit_reduced2)</span>
<span id="cb204-83"><a href="#cb204-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-84"><a href="#cb204-84" aria-hidden="true" tabindex="-1"></a><span class="co"># model selection</span></span>
<span id="cb204-85"><a href="#cb204-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-86"><a href="#cb204-86" aria-hidden="true" tabindex="-1"></a>optimal_fit <span class="ot">&lt;-</span>  <span class="fu">step</span>(fit_full, <span class="at">direction =</span> <span class="st">&#39;backward&#39;</span>)</span>
<span id="cb204-87"><a href="#cb204-87" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(optimal_fit)</span></code></pre></div>
<!--chapter:end:26_multiple_regression.Rmd-->
</div>
<div id="spline-model" class="section level1" number="27">
<h1 number="27"><span class="header-section-number">27</span> Spline model</h1>
<p>In this example we will generate data from a given function and then build a model using splines and estimate quality of the model.</p>
<div id="generate-dataset-from-a-given-function" class="section level2" number="27.1">
<h2 number="27.1"><span class="header-section-number">27.1</span> Generate dataset from a given function</h2>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="co"># parameters to generate a dataset</span></span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a>n.all <span class="ot">&lt;-</span> <span class="dv">100</span>             <span class="co"># number of observations</span></span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a>train.percent <span class="ot">&lt;-</span> <span class="fl">0.85</span>    <span class="co"># portion of the data for training</span></span>
<span id="cb205-4"><a href="#cb205-4" aria-hidden="true" tabindex="-1"></a>res.sd <span class="ot">&lt;-</span> <span class="dv">1</span>              <span class="co"># standard deviation of noise</span></span>
<span id="cb205-5"><a href="#cb205-5" aria-hidden="true" tabindex="-1"></a>x.min <span class="ot">&lt;-</span> <span class="dv">5</span>               <span class="co"># min limit of the data</span></span>
<span id="cb205-6"><a href="#cb205-6" aria-hidden="true" tabindex="-1"></a>x.max <span class="ot">&lt;-</span> <span class="dv">105</span>             <span class="co"># max limit of the data</span></span>
<span id="cb205-7"><a href="#cb205-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-8"><a href="#cb205-8" aria-hidden="true" tabindex="-1"></a><span class="co"># generate x</span></span>
<span id="cb205-9"><a href="#cb205-9" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)       <span class="co"># to get reproducible results by randomizer</span></span>
<span id="cb205-10"><a href="#cb205-10" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(x.min, x.max, <span class="at">n =</span> n.all)</span>
<span id="cb205-11"><a href="#cb205-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-12"><a href="#cb205-12" aria-hidden="true" tabindex="-1"></a><span class="co"># noise from normal destibution</span></span>
<span id="cb205-13"><a href="#cb205-13" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb205-14"><a href="#cb205-14" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> res.sd, <span class="at">n =</span> n.all)</span>
<span id="cb205-15"><a href="#cb205-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-16"><a href="#cb205-16" aria-hidden="true" tabindex="-1"></a><span class="co"># generate y using a given function</span></span>
<span id="cb205-17"><a href="#cb205-17" aria-hidden="true" tabindex="-1"></a>y.func <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {<span class="dv">4</span> <span class="sc">-</span> <span class="fl">2e-02</span><span class="sc">*</span>x <span class="sc">+</span> <span class="fl">5.5e-03</span><span class="sc">*</span>x<span class="sc">^</span><span class="dv">2</span> <span class="sc">-</span> <span class="fl">4.9e-05</span><span class="sc">*</span>x<span class="sc">^</span><span class="dv">3</span>}</span>
<span id="cb205-18"><a href="#cb205-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-19"><a href="#cb205-19" aria-hidden="true" tabindex="-1"></a><span class="co"># add noise</span></span>
<span id="cb205-20"><a href="#cb205-20" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">y.func</span>(x) <span class="sc">+</span> res</span></code></pre></div>
</div>
<div id="split-data-for-train-and-test" class="section level2" number="27.2">
<h2 number="27.2"><span class="header-section-number">27.2</span> Split data for train and test</h2>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="co"># split dataset for training and test</span></span>
<span id="cb206-2"><a href="#cb206-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb206-3"><a href="#cb206-3" aria-hidden="true" tabindex="-1"></a><span class="co"># generate vector of chosen x for train data</span></span>
<span id="cb206-4"><a href="#cb206-4" aria-hidden="true" tabindex="-1"></a>inTrain <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">seq_along</span>(x), <span class="at">size =</span> train.percent<span class="sc">*</span>n.all)</span>
<span id="cb206-5"><a href="#cb206-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-6"><a href="#cb206-6" aria-hidden="true" tabindex="-1"></a><span class="co"># train data set</span></span>
<span id="cb206-7"><a href="#cb206-7" aria-hidden="true" tabindex="-1"></a>x.train <span class="ot">&lt;-</span> x[inTrain]</span>
<span id="cb206-8"><a href="#cb206-8" aria-hidden="true" tabindex="-1"></a>y.train <span class="ot">&lt;-</span> y[inTrain]</span>
<span id="cb206-9"><a href="#cb206-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-10"><a href="#cb206-10" aria-hidden="true" tabindex="-1"></a><span class="co"># test data set</span></span>
<span id="cb206-11"><a href="#cb206-11" aria-hidden="true" tabindex="-1"></a>x.test <span class="ot">&lt;-</span> x[<span class="sc">-</span>inTrain]</span>
<span id="cb206-12"><a href="#cb206-12" aria-hidden="true" tabindex="-1"></a>y.test <span class="ot">&lt;-</span> y[<span class="sc">-</span>inTrain]</span></code></pre></div>
</div>
<div id="diagram-of-the-given-function-and-generated-datasets" class="section level2" number="27.3">
<h2 number="27.3"><span class="header-section-number">27.3</span> Diagram of the given function and generated datasets</h2>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="co"># lines of generated data for plot</span></span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a>x.line <span class="ot">&lt;-</span> <span class="fu">seq</span>(x.min, x.max, <span class="at">length =</span> n.all)</span>
<span id="cb207-3"><a href="#cb207-3" aria-hidden="true" tabindex="-1"></a>y.line <span class="ot">&lt;-</span> <span class="fu">y.func</span>(x.line)</span>
<span id="cb207-4"><a href="#cb207-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-5"><a href="#cb207-5" aria-hidden="true" tabindex="-1"></a><span class="co"># PLOT</span></span>
<span id="cb207-6"><a href="#cb207-6" aria-hidden="true" tabindex="-1"></a><span class="co"># generate plot by train data</span></span>
<span id="cb207-7"><a href="#cb207-7" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">1</span>)) <span class="co"># reduce margins (optional)</span></span>
<span id="cb207-8"><a href="#cb207-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x.train, y.train,</span>
<span id="cb207-9"><a href="#cb207-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&#39;Generated data and original function&#39;</span>,</span>
<span id="cb207-10"><a href="#cb207-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="fu">grey</span>(<span class="fl">0.2</span>), <span class="at">bg =</span> <span class="fu">grey</span>(<span class="fl">0.2</span>), <span class="at">pch =</span> <span class="dv">21</span>,</span>
<span id="cb207-11"><a href="#cb207-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&#39;X&#39;</span>, <span class="at">ylab =</span> <span class="st">&#39;Y&#39;</span>, </span>
<span id="cb207-12"><a href="#cb207-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim =</span> <span class="fu">c</span>(x.min, x.max),</span>
<span id="cb207-13"><a href="#cb207-13" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fu">min</span>(y), <span class="fu">max</span>(y)), </span>
<span id="cb207-14"><a href="#cb207-14" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">1.2</span>, <span class="at">cex.lab =</span> <span class="fl">1.2</span>, <span class="at">cex.axis =</span> <span class="fl">1.2</span>)</span>
<span id="cb207-15"><a href="#cb207-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-16"><a href="#cb207-16" aria-hidden="true" tabindex="-1"></a><span class="co"># add points of test data</span></span>
<span id="cb207-17"><a href="#cb207-17" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(x.test, y.test, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>, <span class="at">bg =</span> <span class="st">&#39;red&#39;</span>, <span class="at">pch =</span> <span class="dv">21</span>)</span>
<span id="cb207-18"><a href="#cb207-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-19"><a href="#cb207-19" aria-hidden="true" tabindex="-1"></a><span class="co"># add the given function</span></span>
<span id="cb207-20"><a href="#cb207-20" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x.line, y.line, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb207-21"><a href="#cb207-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-22"><a href="#cb207-22" aria-hidden="true" tabindex="-1"></a><span class="co"># add legend</span></span>
<span id="cb207-23"><a href="#cb207-23" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&#39;topleft&#39;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&#39;train&#39;</span>, <span class="st">&#39;test&#39;</span>, <span class="st">&#39;f(X)&#39;</span>),</span>
<span id="cb207-24"><a href="#cb207-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">16</span>, <span class="dv">16</span>, <span class="cn">NA</span>), </span>
<span id="cb207-25"><a href="#cb207-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="fu">grey</span>(<span class="fl">0.2</span>), <span class="st">&#39;red&#39;</span>, <span class="st">&#39;black&#39;</span>),  </span>
<span id="cb207-26"><a href="#cb207-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">2</span>), <span class="at">lwd =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>), <span class="at">cex =</span> <span class="fl">1.2</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-68-1.png" width="672" /></p>
</div>
<div id="build-a-model-using-splines" class="section level2" number="27.4">
<h2 number="27.4"><span class="header-section-number">27.4</span> Build a model using splines</h2>
<p>We will compair sevaral models with degree of freedoms (df) from 2 to 40, where 2 correspond to a linear model.</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a>max.df <span class="ot">&lt;-</span> <span class="dv">40</span>                       <span class="co"># max degree of freedom (df)</span></span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb208-3"><a href="#cb208-3" aria-hidden="true" tabindex="-1"></a>tbl <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">df =</span> <span class="dv">2</span><span class="sc">:</span>max.df)   <span class="co"># data frame for writing errors</span></span>
<span id="cb208-4"><a href="#cb208-4" aria-hidden="true" tabindex="-1"></a>tbl<span class="sc">$</span>MSE.train <span class="ot">&lt;-</span> <span class="dv">0</span>                 <span class="co"># column 1: errors of train data</span></span>
<span id="cb208-5"><a href="#cb208-5" aria-hidden="true" tabindex="-1"></a>tbl<span class="sc">$</span>MSE.test <span class="ot">&lt;-</span> <span class="dv">0</span>                  <span class="co"># сcolumn 2: errors of test data</span></span>
<span id="cb208-6"><a href="#cb208-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-7"><a href="#cb208-7" aria-hidden="true" tabindex="-1"></a><span class="co"># generate models using for cycle</span></span>
<span id="cb208-8"><a href="#cb208-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>max.df) {</span>
<span id="cb208-9"><a href="#cb208-9" aria-hidden="true" tabindex="-1"></a>    mod <span class="ot">&lt;-</span> <span class="fu">smooth.spline</span>(<span class="at">x =</span> x.train, <span class="at">y =</span> y.train, <span class="at">df =</span> i)</span>
<span id="cb208-10"><a href="#cb208-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb208-11"><a href="#cb208-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># predicted values for train and test data using built model</span></span>
<span id="cb208-12"><a href="#cb208-12" aria-hidden="true" tabindex="-1"></a>    y.model.train <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod, <span class="fu">data.frame</span>(<span class="at">x =</span> x.train))<span class="sc">$</span>y[, <span class="dv">1</span>]</span>
<span id="cb208-13"><a href="#cb208-13" aria-hidden="true" tabindex="-1"></a>    y.model.test <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod, <span class="fu">data.frame</span>(<span class="at">x =</span> x.test))<span class="sc">$</span>y[, <span class="dv">1</span>]</span>
<span id="cb208-14"><a href="#cb208-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb208-15"><a href="#cb208-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># MSE errors for train and test data</span></span>
<span id="cb208-16"><a href="#cb208-16" aria-hidden="true" tabindex="-1"></a>    MSE <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">sum</span>((y.train <span class="sc">-</span> y.model.train)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> <span class="fu">length</span>(x.train),</span>
<span id="cb208-17"><a href="#cb208-17" aria-hidden="true" tabindex="-1"></a>             <span class="fu">sum</span>((y.test <span class="sc">-</span> y.model.test)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> <span class="fu">length</span>(x.test))</span>
<span id="cb208-18"><a href="#cb208-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb208-19"><a href="#cb208-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># write errors to the previously created data frame</span></span>
<span id="cb208-20"><a href="#cb208-20" aria-hidden="true" tabindex="-1"></a>    tbl[tbl<span class="sc">$</span>df <span class="sc">==</span> i, <span class="fu">c</span>(<span class="st">&#39;MSE.train&#39;</span>, <span class="st">&#39;MSE.test&#39;</span>)] <span class="ot">&lt;-</span> MSE</span>
<span id="cb208-21"><a href="#cb208-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb208-22"><a href="#cb208-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-23"><a href="#cb208-23" aria-hidden="true" tabindex="-1"></a><span class="co"># view first rows of the table</span></span>
<span id="cb208-24"><a href="#cb208-24" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tbl, <span class="dv">4</span>)</span></code></pre></div>
<pre><code>##   df MSE.train  MSE.test
## 1  2 3.6484333 3.3336892
## 2  3 1.5185881 1.1532857
## 3  4 0.8999800 0.8874002
## 4  5 0.7477105 0.9483290</code></pre>
</div>
<div id="diagram-of-mse-for-train-and-test-data" class="section level2" number="27.5">
<h2 number="27.5"><span class="header-section-number">27.5</span> Diagram of MSE for train and test data</h2>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot MSE from our table</span></span>
<span id="cb210-2"><a href="#cb210-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> tbl<span class="sc">$</span>df, <span class="at">y =</span> tbl<span class="sc">$</span>MSE.test,</span>
<span id="cb210-3"><a href="#cb210-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Changes of MSE from degrees of freedom&quot;</span>,</span>
<span id="cb210-4"><a href="#cb210-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">&#39;l&#39;</span>, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>, <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb210-5"><a href="#cb210-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&#39;spline degree of freedom&#39;</span>, <span class="at">ylab =</span> <span class="st">&#39;MSE&#39;</span>,</span>
<span id="cb210-6"><a href="#cb210-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fu">min</span>(tbl<span class="sc">$</span>MSE.train, tbl<span class="sc">$</span>MSE.test), </span>
<span id="cb210-7"><a href="#cb210-7" aria-hidden="true" tabindex="-1"></a>              <span class="fu">max</span>(tbl<span class="sc">$</span>MSE.train, tbl<span class="sc">$</span>MSE.test)),</span>
<span id="cb210-8"><a href="#cb210-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">1.2</span>, <span class="at">cex.lab =</span> <span class="fl">1.2</span>, <span class="at">cex.axis =</span> <span class="fl">1.2</span>)</span>
<span id="cb210-9"><a href="#cb210-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-10"><a href="#cb210-10" aria-hidden="true" tabindex="-1"></a><span class="co"># add </span></span>
<span id="cb210-11"><a href="#cb210-11" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="at">x =</span> tbl<span class="sc">$</span>df, <span class="at">y =</span> tbl<span class="sc">$</span>MSE.test,</span>
<span id="cb210-12"><a href="#cb210-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>, <span class="at">bg =</span> <span class="st">&#39;red&#39;</span>)</span>
<span id="cb210-13"><a href="#cb210-13" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> tbl<span class="sc">$</span>df, <span class="at">y =</span> tbl<span class="sc">$</span>MSE.train, <span class="at">col =</span> <span class="fu">grey</span>(<span class="fl">0.3</span>), <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb210-14"><a href="#cb210-14" aria-hidden="true" tabindex="-1"></a><span class="co"># minimal MSE</span></span>
<span id="cb210-15"><a href="#cb210-15" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> res.sd, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="fu">grey</span>(<span class="fl">0.4</span>), <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb210-16"><a href="#cb210-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-17"><a href="#cb210-17" aria-hidden="true" tabindex="-1"></a><span class="co"># add legend</span></span>
<span id="cb210-18"><a href="#cb210-18" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&#39;topright&#39;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&#39;train&#39;</span>, <span class="st">&#39;test&#39;</span>),</span>
<span id="cb210-19"><a href="#cb210-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">16</span>), </span>
<span id="cb210-20"><a href="#cb210-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="fu">grey</span>(<span class="fl">0.2</span>), <span class="st">&#39;red&#39;</span>),  </span>
<span id="cb210-21"><a href="#cb210-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>), <span class="at">lwd =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="at">cex =</span> <span class="fl">1.2</span>)</span>
<span id="cb210-22"><a href="#cb210-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-23"><a href="#cb210-23" aria-hidden="true" tabindex="-1"></a><span class="co"># df of minimal MSE for test data</span></span>
<span id="cb210-24"><a href="#cb210-24" aria-hidden="true" tabindex="-1"></a>min.MSE.test <span class="ot">&lt;-</span> <span class="fu">min</span>(tbl<span class="sc">$</span>MSE.test)</span>
<span id="cb210-25"><a href="#cb210-25" aria-hidden="true" tabindex="-1"></a>df.min.MSE.test <span class="ot">&lt;-</span> tbl[tbl<span class="sc">$</span>MSE.test <span class="sc">==</span> min.MSE.test, <span class="st">&#39;df&#39;</span>]</span>
<span id="cb210-26"><a href="#cb210-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-27"><a href="#cb210-27" aria-hidden="true" tabindex="-1"></a><span class="co"># optimal df for precise model and maximal simplicity</span></span>
<span id="cb210-28"><a href="#cb210-28" aria-hidden="true" tabindex="-1"></a>df.my.MSE.test <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb210-29"><a href="#cb210-29" aria-hidden="true" tabindex="-1"></a>my.MSE.test <span class="ot">&lt;-</span> tbl[tbl<span class="sc">$</span>df <span class="sc">==</span> df.my.MSE.test, <span class="st">&#39;MSE.test&#39;</span>]</span>
<span id="cb210-30"><a href="#cb210-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-31"><a href="#cb210-31" aria-hidden="true" tabindex="-1"></a><span class="co"># show the optimal solution</span></span>
<span id="cb210-32"><a href="#cb210-32" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> df.my.MSE.test, </span>
<span id="cb210-33"><a href="#cb210-33" aria-hidden="true" tabindex="-1"></a>       <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb210-34"><a href="#cb210-34" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="at">x =</span> df.my.MSE.test, <span class="at">y =</span> my.MSE.test, </span>
<span id="cb210-35"><a href="#cb210-35" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">15</span>, <span class="at">col =</span> <span class="st">&#39;blue&#39;</span>)</span>
<span id="cb210-36"><a href="#cb210-36" aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>(df.my.MSE.test, </span>
<span id="cb210-37"><a href="#cb210-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">side =</span> <span class="dv">1</span>, <span class="at">line =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">at =</span> df.my.MSE.test, <span class="at">col =</span> <span class="st">&#39;blue&#39;</span>, <span class="at">cex =</span> <span class="fl">1.2</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-70-1.png" width="672" /></p>
</div>
<div id="build-optimal-model-and-plot-for-the-model" class="section level2" number="27.6">
<h2 number="27.6"><span class="header-section-number">27.6</span> Build optimal model and plot for the model</h2>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a>mod.MSE.test <span class="ot">&lt;-</span> <span class="fu">smooth.spline</span>(<span class="at">x =</span> x.train, <span class="at">y =</span> y.train, <span class="at">df =</span> df.my.MSE.test)</span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3"><a href="#cb211-3" aria-hidden="true" tabindex="-1"></a><span class="co"># predict data for 250 x&#39;s to get smoothed curve</span></span>
<span id="cb211-4"><a href="#cb211-4" aria-hidden="true" tabindex="-1"></a>x.model.plot <span class="ot">&lt;-</span> <span class="fu">seq</span>(x.min, x.max, <span class="at">length =</span> <span class="dv">250</span>)</span>
<span id="cb211-5"><a href="#cb211-5" aria-hidden="true" tabindex="-1"></a>y.model.plot <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod.MSE.test, <span class="fu">data.frame</span>(<span class="at">x =</span> x.model.plot))<span class="sc">$</span>y[, <span class="dv">1</span>]</span>
<span id="cb211-6"><a href="#cb211-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-7"><a href="#cb211-7" aria-hidden="true" tabindex="-1"></a><span class="co"># plot train data</span></span>
<span id="cb211-8"><a href="#cb211-8" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb211-9"><a href="#cb211-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x.train, y.train,</span>
<span id="cb211-10"><a href="#cb211-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Initial data and the best fit model&quot;</span>,</span>
<span id="cb211-11"><a href="#cb211-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="fu">grey</span>(<span class="fl">0.2</span>), <span class="at">bg =</span> <span class="fu">grey</span>(<span class="fl">0.2</span>), <span class="at">pch =</span> <span class="dv">21</span>,</span>
<span id="cb211-12"><a href="#cb211-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&#39;X&#39;</span>, <span class="at">ylab =</span> <span class="st">&#39;Y&#39;</span>, </span>
<span id="cb211-13"><a href="#cb211-13" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim =</span> <span class="fu">c</span>(x.min, x.max),</span>
<span id="cb211-14"><a href="#cb211-14" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fu">min</span>(y), <span class="fu">max</span>(y)), </span>
<span id="cb211-15"><a href="#cb211-15" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">1.2</span>, <span class="at">cex.lab =</span> <span class="fl">1.2</span>, <span class="at">cex.axis =</span> <span class="fl">1.2</span>)</span>
<span id="cb211-16"><a href="#cb211-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-17"><a href="#cb211-17" aria-hidden="true" tabindex="-1"></a><span class="co"># add test data</span></span>
<span id="cb211-18"><a href="#cb211-18" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(x.test, y.test, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>, <span class="at">bg =</span> <span class="st">&#39;red&#39;</span>, <span class="at">pch =</span> <span class="dv">21</span>)</span>
<span id="cb211-19"><a href="#cb211-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-20"><a href="#cb211-20" aria-hidden="true" tabindex="-1"></a><span class="co"># function</span></span>
<span id="cb211-21"><a href="#cb211-21" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x.line, y.line,<span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb211-22"><a href="#cb211-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-23"><a href="#cb211-23" aria-hidden="true" tabindex="-1"></a><span class="co"># add model</span></span>
<span id="cb211-24"><a href="#cb211-24" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x.model.plot, y.model.plot, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&#39;blue&#39;</span>)</span>
<span id="cb211-25"><a href="#cb211-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-26"><a href="#cb211-26" aria-hidden="true" tabindex="-1"></a><span class="co"># legend</span></span>
<span id="cb211-27"><a href="#cb211-27" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&#39;topleft&#39;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&#39;train&#39;</span>, <span class="st">&#39;test&#39;</span>, <span class="st">&#39;f(X)&#39;</span>, <span class="st">&#39;model&#39;</span>),</span>
<span id="cb211-28"><a href="#cb211-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">16</span>, <span class="dv">16</span>, <span class="cn">NA</span>, <span class="cn">NA</span>), </span>
<span id="cb211-29"><a href="#cb211-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="fu">grey</span>(<span class="fl">0.2</span>), <span class="st">&#39;red&#39;</span>, <span class="st">&#39;black&#39;</span>, <span class="st">&#39;blue&#39;</span>),  </span>
<span id="cb211-30"><a href="#cb211-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">1</span>), <span class="at">lwd =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>), <span class="at">cex =</span> <span class="fl">1.2</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-71-1.png" width="672" /></p>
</div>
<div id="bibliograpy" class="section level2" number="27.7">
<h2 number="27.7"><span class="header-section-number">27.7</span> Bibliograpy</h2>
<p><a href="http://faculty.marshall.usc.edu/gareth-james/">An Introduction to Statistical Learning by Gareth James</a></p>
<!--chapter:end:27_spline_model.Rmd-->
</div>
</div>
<div id="logistic-regression" class="section level1" number="28">
<h1 number="28"><span class="header-section-number">28</span> Logistic Regression</h1>
<p>The <strong>logistic model</strong> (or <strong>logit model</strong>) is a statistical model with input (independent variable)
a continuous variable and output (dependent variable) a binary variable (discret choice, e.g. yes/no or 1/0).</p>
<div id="confusion-matrix" class="section level2" number="28.1">
<h2 number="28.1"><span class="header-section-number">28.1</span> Confusion matrix</h2>
<p>A confusion matrix is a table that is often used to describe the performance of a classification model (or “classifier”) on a set of test data for which the true values are known.</p>
<table>
<thead>
<tr class="header">
<th>n=165</th>
<th>Predicted: NO</th>
<th>Predicted: Yes-</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Actual: No</td>
<td>TN = 50</td>
<td>FP = 10</td>
</tr>
<tr class="even">
<td>Actual: Yes</td>
<td>FN = 5</td>
<td>TP = 100</td>
</tr>
</tbody>
</table>
<p>TN - true negatives<br />
TP - true positives<br />
FN - false negatives<br />
FP - false posistives</p>
<p><strong>Accuracy</strong> - Overall, how often is the classifier correct?<br />
(TP+TN)/total = (100+50)/165 = 0.91</p>
<p><strong>Misclassification Rate</strong> - Overall, how often is it wrong?<br />
(FP+FN)/total = (10+5)/165 = 0.09
equivalent to 1 - Accuracy
also known as “Error Rate”</p>
<p><strong>True Positive Rate</strong>: When it’s actually yes, how often does it predict yes?
TP/actual yes = 100/105 = 0.95
also known as “Sensitivity” or “Recall”</p>
<p><strong>False Positive Rate</strong>: When it’s actually no, how often does it predict yes?
FP/actual no = 10/60 = 0.17</p>
<p><strong>True Negative Rate</strong>: When it’s actually no, how often does it predict no?
TN/actual no = 50/60 = 0.83
equivalent to 1 minus False Positive Rate
also known as “Specificity”</p>
<p><strong>Precision</strong>: When it predicts yes, how often is it correct?
TP/predicted yes = 100/110 = 0.91</p>
<p><strong>Prevalence</strong>: How often does the yes condition actually occur in our sample?
actual yes/total = 105/165 = 0.64</p>
<p><strong>Null Error Rate</strong>: This is how often you would be wrong if you always predicted the majority class. (In our example, the null error rate would be 60/165=0.36 because if you always predicted yes, you would only be wrong for the 60 “no” cases.) This can be a useful baseline metric to compare your classifier against. However, the best classifier for a particular application will sometimes have a higher error rate than the null error rate, as demonstrated by the Accuracy Paradox.<br />
<strong>Cohen’s Kappa</strong>: This is essentially a measure of how well the classifier performed as compared to how well it would have performed simply by chance. In other words, a model will have a high Kappa score if there is a big difference between the accuracy and the null error rate. (More details about Cohen’s Kappa.)<br />
<strong>F Score</strong>: This is a weighted average of the true positive rate (recall) and precision. (More details about the F Score.)<br />
<strong>ROC Curve</strong>: This is a commonly used graph that summarizes the performance of a classifier over all possible thresholds. It is generated by plotting the True Positive Rate (y-axis) against the False Positive Rate (x-axis) as you vary the threshold for assigning observations to a given class. (More details about ROC Curves.)</p>
<p><strong>Example</strong>:<br />
A group of 20 students spend between 0 and 6 hours studying for an exam. How does the number of hours spent studying affect the probability that the student will pass the exam?</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a>hours <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="dv">1</span>, <span class="fl">1.25</span>, <span class="fl">1.5</span>, <span class="fl">1.75</span>, <span class="fl">1.75</span>, <span class="dv">2</span>, <span class="fl">2.25</span>, <span class="fl">2.5</span>, <span class="fl">2.75</span>, <span class="dv">3</span>, <span class="fl">3.25</span>, <span class="fl">3.5</span>, <span class="dv">4</span>, <span class="fl">4.25</span>, <span class="fl">4.5</span>, <span class="fl">4.75</span>, <span class="dv">5</span>, <span class="fl">5.5</span>)</span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a>pass <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb212-3"><a href="#cb212-3" aria-hidden="true" tabindex="-1"></a>model <span class="ot">=</span> <span class="fu">glm</span>(pass <span class="sc">~</span> hours, <span class="at">family =</span> binomial)</span>
<span id="cb212-4"><a href="#cb212-4" aria-hidden="true" tabindex="-1"></a>newdat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">hours=</span><span class="fu">seq</span>(<span class="fu">min</span>(hours), <span class="fu">max</span>(hours),<span class="at">len=</span><span class="dv">100</span>))</span>
<span id="cb212-5"><a href="#cb212-5" aria-hidden="true" tabindex="-1"></a>newdat<span class="sc">$</span>pass <span class="ot">=</span> <span class="fu">predict</span>(model, <span class="at">newdata=</span>newdat, <span class="at">type=</span><span class="st">&quot;response&quot;</span>)</span>
<span id="cb212-6"><a href="#cb212-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-7"><a href="#cb212-7" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb212-8"><a href="#cb212-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pass <span class="sc">~</span> hours)</span>
<span id="cb212-9"><a href="#cb212-9" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(pass <span class="sc">~</span> hours, newdat, <span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-72-1.png" width="672" /></p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="co"># data</span></span>
<span id="cb213-2"><a href="#cb213-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">hours=</span><span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="dv">1</span>, <span class="fl">1.25</span>, <span class="fl">1.5</span>, <span class="fl">1.75</span>, <span class="fl">1.75</span>, <span class="dv">2</span>, <span class="fl">2.25</span>, <span class="fl">2.5</span>,</span>
<span id="cb213-3"><a href="#cb213-3" aria-hidden="true" tabindex="-1"></a>                         <span class="fl">2.75</span>, <span class="dv">3</span>, <span class="fl">3.25</span>, <span class="fl">3.5</span>, <span class="dv">4</span>, <span class="fl">4.25</span>, <span class="fl">4.5</span>, <span class="fl">4.75</span>, <span class="dv">5</span>, <span class="fl">5.5</span>),</span>
<span id="cb213-4"><a href="#cb213-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">pass=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb213-5"><a href="#cb213-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">pass.predic =</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">20</span>), <span class="co"># slot for predicted pass</span></span>
<span id="cb213-6"><a href="#cb213-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">pass.logit =</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">20</span>))  <span class="co"># slot logit prediction</span></span>
<span id="cb213-7"><a href="#cb213-7" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb213-8"><a href="#cb213-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-9"><a href="#cb213-9" aria-hidden="true" tabindex="-1"></a><span class="co"># model</span></span>
<span id="cb213-10"><a href="#cb213-10" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">glm</span>(data<span class="sc">$</span>pass <span class="sc">~</span> data<span class="sc">$</span>hours, <span class="at">family =</span> binomial)</span>
<span id="cb213-11"><a href="#cb213-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-12"><a href="#cb213-12" aria-hidden="true" tabindex="-1"></a><span class="co"># predict values of logit function</span></span>
<span id="cb213-13"><a href="#cb213-13" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>pass.logit <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, <span class="at">newdata=</span>data, <span class="at">type=</span><span class="st">&#39;response&#39;</span>)</span>
<span id="cb213-14"><a href="#cb213-14" aria-hidden="true" tabindex="-1"></a><span class="co"># predict pass for threshold = 0.5</span></span>
<span id="cb213-15"><a href="#cb213-15" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>pass.predic <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data<span class="sc">$</span>pass.logit <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb213-16"><a href="#cb213-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-17"><a href="#cb213-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Confusion matrix</span></span>
<span id="cb213-18"><a href="#cb213-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb213-19"><a href="#cb213-19" aria-hidden="true" tabindex="-1"></a>caret<span class="sc">::</span><span class="fu">confusionMatrix</span>(<span class="at">data =</span>      <span class="fu">factor</span>(data<span class="sc">$</span>pass.predic),</span>
<span id="cb213-20"><a href="#cb213-20" aria-hidden="true" tabindex="-1"></a>                       <span class="at">reference =</span> <span class="fu">factor</span>(data<span class="sc">$</span>pass))</span></code></pre></div>
<pre><code>## Confusion Matrix and Statistics
## 
##           Reference
## Prediction 0 1
##          0 8 2
##          1 2 8
##                                           
##                Accuracy : 0.8             
##                  95% CI : (0.5634, 0.9427)
##     No Information Rate : 0.5             
##     P-Value [Acc &gt; NIR] : 0.005909        
##                                           
##                   Kappa : 0.6             
##                                           
##  Mcnemar&#39;s Test P-Value : 1.000000        
##                                           
##             Sensitivity : 0.8             
##             Specificity : 0.8             
##          Pos Pred Value : 0.8             
##          Neg Pred Value : 0.8             
##              Prevalence : 0.5             
##          Detection Rate : 0.4             
##    Detection Prevalence : 0.5             
##       Balanced Accuracy : 0.8             
##                                           
##        &#39;Positive&#39; Class : 0               
## </code></pre>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>, <span class="at">by=</span><span class="fl">0.05</span>)</span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">probability=</span>p, <span class="at">odds=</span>p<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>p))</span>
<span id="cb215-3"><a href="#cb215-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data)</span></code></pre></div>
<pre><code>##   probability       odds
## 1        0.00 0.00000000
## 2        0.05 0.05263158
## 3        0.10 0.11111111
## 4        0.15 0.17647059
## 5        0.20 0.25000000
## 6        0.25 0.33333333</code></pre>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(data<span class="sc">$</span>odds<span class="sc">~</span>data<span class="sc">$</span>probability, <span class="at">type=</span><span class="st">&#39;o&#39;</span>, <span class="at">pch=</span><span class="dv">19</span>, <span class="at">xlab=</span><span class="st">&#39;Probability&#39;</span>, <span class="at">ylab=</span><span class="st">&#39;Odds&#39;</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-73-1.png" width="672" /></p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">log</span>(data<span class="sc">$</span>odds)<span class="sc">~</span>data<span class="sc">$</span>odds, <span class="at">type=</span><span class="st">&#39;o&#39;</span>, <span class="at">pch=</span><span class="dv">19</span>, <span class="at">xlab=</span><span class="st">&#39;Odds&#39;</span>, <span class="at">ylab=</span><span class="st">&#39;log(odds)&#39;</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-73-2.png" width="672" /></p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(data<span class="sc">$</span>probability<span class="sc">~</span><span class="fu">log</span>(data<span class="sc">$</span>odds), <span class="at">type=</span><span class="st">&#39;o&#39;</span>, <span class="at">pch=</span><span class="dv">19</span>, <span class="at">xlab=</span><span class="st">&#39;log(odds)&#39;</span>, <span class="at">ylab=</span><span class="st">&#39;Probability&#39;</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-73-3.png" width="672" /></p>
</div>
<div id="next-part-2" class="section level2" number="28.2">
<h2 number="28.2"><span class="header-section-number">28.2</span> Next part</h2>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb220-2"><a href="#cb220-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">&#39;https://raw.githubusercontent.com/suvarzz/data/master/data_classification.csv&#39;</span>, <span class="at">header=</span>T, <span class="at">sep=</span><span class="st">&quot;,&quot;</span>)</span>
<span id="cb220-3"><a href="#cb220-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df)</span>
<span id="cb220-4"><a href="#cb220-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-5"><a href="#cb220-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(df[pass<span class="sc">==</span><span class="dv">1</span>][,<span class="sc">!</span><span class="dv">3</span>], <span class="at">col=</span><span class="st">&#39;red&#39;</span>)</span>
<span id="cb220-6"><a href="#cb220-6" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(df[pass<span class="sc">==</span><span class="dv">0</span>][,<span class="sc">!</span><span class="dv">3</span>], <span class="at">col=</span><span class="st">&#39;blue&#39;</span>)</span>
<span id="cb220-7"><a href="#cb220-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-8"><a href="#cb220-8" aria-hidden="true" tabindex="-1"></a>model.logit <span class="ot">&lt;-</span> <span class="fu">glm</span>(pass <span class="sc">~</span> studied <span class="sc">+</span> slept, <span class="at">data =</span> df, <span class="at">family =</span> <span class="st">&#39;binomial&#39;</span>)</span>
<span id="cb220-9"><a href="#cb220-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model.logit)</span>
<span id="cb220-10"><a href="#cb220-10" aria-hidden="true" tabindex="-1"></a>p.lda <span class="ot">&lt;-</span> <span class="fu">predict</span>(model.logit, df, <span class="at">type =</span> <span class="st">&#39;response&#39;</span>)</span>
<span id="cb220-11"><a href="#cb220-11" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>predicted <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(p.lda <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb220-12"><a href="#cb220-12" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df)</span>
<span id="cb220-13"><a href="#cb220-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-14"><a href="#cb220-14" aria-hidden="true" tabindex="-1"></a>a<span class="ot">=</span><span class="sc">-</span><span class="fu">coef</span>(model.logit)[<span class="dv">1</span>]<span class="sc">/</span><span class="fu">coef</span>(model.logit)[<span class="dv">2</span>],</span>
<span id="cb220-15"><a href="#cb220-15" aria-hidden="true" tabindex="-1"></a>b<span class="ot">=</span><span class="sc">-</span><span class="fu">coef</span>(model.logit)[<span class="dv">1</span>]<span class="sc">/</span><span class="fu">coef</span>(model.logit)[<span class="dv">3</span>]<span class="er">)</span></span>
<span id="cb220-16"><a href="#cb220-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-17"><a href="#cb220-17" aria-hidden="true" tabindex="-1"></a>b0 <span class="ot">=</span> <span class="fu">coef</span>(model.logit)[<span class="dv">1</span>]</span>
<span id="cb220-18"><a href="#cb220-18" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">=</span> mymodel<span class="sc">$</span>coefficients[[<span class="dv">2</span>]]</span>
<span id="cb220-19"><a href="#cb220-19" aria-hidden="true" tabindex="-1"></a>b2 <span class="ot">=</span> mymodel<span class="sc">$</span>coefficients[[<span class="dv">3</span>]]</span>
<span id="cb220-20"><a href="#cb220-20" aria-hidden="true" tabindex="-1"></a>z <span class="ot">=</span> b0 <span class="sc">+</span> (b1 <span class="sc">*</span> <span class="dv">1</span>) <span class="sc">+</span> (b2 <span class="sc">*</span> <span class="dv">4</span>)</span>
<span id="cb220-21"><a href="#cb220-21" aria-hidden="true" tabindex="-1"></a>p <span class="ot">=</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span>z))</span>
<span id="cb220-22"><a href="#cb220-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-23"><a href="#cb220-23" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> p<span class="ot">=</span><span class="fl">0.5</span> <span class="ot">=</span><span class="er">&gt;</span> z <span class="ot">=</span> <span class="dv">0</span> <span class="ot">=</span><span class="er">&gt;</span> b0 <span class="sc">+</span> b1<span class="sc">*</span>x <span class="sc">+</span> b2<span class="sc">*</span>y <span class="ot">=</span><span class="er">&gt;</span> </span>
<span id="cb220-24"><a href="#cb220-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb220-25"><a href="#cb220-25" aria-hidden="true" tabindex="-1"></a><span class="fu">segments</span>(<span class="dv">0</span>,<span class="fl">10.87</span>,<span class="fl">9.26</span>,<span class="dv">0</span>)</span>
<span id="cb220-26"><a href="#cb220-26" aria-hidden="true" tabindex="-1"></a>slept<span class="ot">=</span>(<span class="fl">3.77-0.474</span><span class="sc">*</span>studied)<span class="sc">/</span><span class="fl">0.338</span></span>
<span id="cb220-27"><a href="#cb220-27" aria-hidden="true" tabindex="-1"></a>(<span class="dv">0</span>, <span class="fl">3.77</span><span class="sc">/</span><span class="fl">0.474</span>) <span class="ot">=</span> (<span class="fl">9.2</span>, <span class="dv">0</span>)</span>
<span id="cb220-28"><a href="#cb220-28" aria-hidden="true" tabindex="-1"></a>(<span class="fl">3.77</span><span class="sc">/</span><span class="fl">0.474</span>,<span class="dv">0</span>) <span class="ot">=</span> (<span class="dv">0</span>, <span class="fl">10.87</span>)</span>
<span id="cb220-29"><a href="#cb220-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-30"><a href="#cb220-30" aria-hidden="true" tabindex="-1"></a><span class="fu">segments</span>(<span class="fl">9.2</span>,<span class="dv">0</span>, <span class="dv">0</span>,<span class="fl">10.87</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span></code></pre></div>
</div>
<div id="next-part-3" class="section level2" number="28.3">
<h2 number="28.3"><span class="header-section-number">28.3</span> NExt part</h2>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example of logistic regression</span></span>
<span id="cb221-2"><a href="#cb221-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Source: 17 - Анализ данных в R. Логистическая регрессия by Anatoliy Karpov</span></span>
<span id="cb221-3"><a href="#cb221-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-4"><a href="#cb221-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Read data set train.csv:</span></span>
<span id="cb221-5"><a href="#cb221-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Statistics of students in a school</span></span>
<span id="cb221-6"><a href="#cb221-6" aria-hidden="true" tabindex="-1"></a><span class="co"># gender - male/femail</span></span>
<span id="cb221-7"><a href="#cb221-7" aria-hidden="true" tabindex="-1"></a><span class="co"># read, write, math - points for subjects</span></span>
<span id="cb221-8"><a href="#cb221-8" aria-hidden="true" tabindex="-1"></a><span class="co"># hon - if honorary degree Y/N</span></span>
<span id="cb221-9"><a href="#cb221-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-10"><a href="#cb221-10" aria-hidden="true" tabindex="-1"></a><span class="co"># FIX combine train and test into one csv file. Split train and test inside this script</span></span>
<span id="cb221-11"><a href="#cb221-11" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">&quot;~/RData&quot;</span>)</span>
<span id="cb221-12"><a href="#cb221-12" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;train.csv&quot;</span>, <span class="at">sep=</span><span class="st">&quot;;&quot;</span>)</span>
<span id="cb221-13"><a href="#cb221-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-14"><a href="#cb221-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Visual inspection of the dataset</span></span>
<span id="cb221-15"><a href="#cb221-15" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df)</span>
<span id="cb221-16"><a href="#cb221-16" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(df)</span>
<span id="cb221-17"><a href="#cb221-17" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(df)</span>
<span id="cb221-18"><a href="#cb221-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-19"><a href="#cb221-19" aria-hidden="true" tabindex="-1"></a><span class="co"># N-not the best mark, Y-the best mark</span></span>
<span id="cb221-20"><a href="#cb221-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb221-21"><a href="#cb221-21" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(read,math,<span class="at">col=</span>gender))<span class="sc">+</span><span class="fu">geom_point</span>()<span class="sc">+</span><span class="fu">facet_grid</span>(.<span class="sc">~</span>hon)<span class="sc">+</span></span>
<span id="cb221-22"><a href="#cb221-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">25</span>), <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">25</span>, <span class="at">face=</span><span class="st">&#39;bold&#39;</span>))</span>
<span id="cb221-23"><a href="#cb221-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-24"><a href="#cb221-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply logistic regression</span></span>
<span id="cb221-25"><a href="#cb221-25" aria-hidden="true" tabindex="-1"></a><span class="co"># How hon depends on different variables: read, math, gender</span></span>
<span id="cb221-26"><a href="#cb221-26" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">glm</span>(hon <span class="sc">~</span> read <span class="sc">+</span> math <span class="sc">+</span> gender, df, <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb221-27"><a href="#cb221-27" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span>
<span id="cb221-28"><a href="#cb221-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-29"><a href="#cb221-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Meanings of coefficients:</span></span>
<span id="cb221-30"><a href="#cb221-30" aria-hidden="true" tabindex="-1"></a><span class="co"># read-estimate: 0.06677 - if female, math is fixed, if read change to 1, then ln(odds) will be changed to 0.06677</span></span>
<span id="cb221-31"><a href="#cb221-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-32"><a href="#cb221-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Get data from fit</span></span>
<span id="cb221-33"><a href="#cb221-33" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(fit<span class="sc">$</span>coefficients)</span>
<span id="cb221-34"><a href="#cb221-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-35"><a href="#cb221-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict model - ln(odds)</span></span>
<span id="cb221-36"><a href="#cb221-36" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">predict</span>(<span class="at">object=</span>fit))</span>
<span id="cb221-37"><a href="#cb221-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-38"><a href="#cb221-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict model - return probability to get the best mark for every person</span></span>
<span id="cb221-39"><a href="#cb221-39" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">predict</span>(<span class="at">object =</span> fit, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>))</span>
<span id="cb221-40"><a href="#cb221-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-41"><a href="#cb221-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Add probabilities to get the best mark for every person in df</span></span>
<span id="cb221-42"><a href="#cb221-42" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="at">object =</span> fit, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb221-43"><a href="#cb221-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-44"><a href="#cb221-44" aria-hidden="true" tabindex="-1"></a>df</span>
<span id="cb221-45"><a href="#cb221-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-46"><a href="#cb221-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Part 2</span></span>
<span id="cb221-47"><a href="#cb221-47" aria-hidden="true" tabindex="-1"></a><span class="co"># ROC-curve of predicted model</span></span>
<span id="cb221-48"><a href="#cb221-48" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ROCR)</span>
<span id="cb221-49"><a href="#cb221-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicted values and real values</span></span>
<span id="cb221-50"><a href="#cb221-50" aria-hidden="true" tabindex="-1"></a>pred_fit <span class="ot">&lt;-</span> <span class="fu">prediction</span>(df<span class="sc">$</span>prob, df<span class="sc">$</span>hon)</span>
<span id="cb221-51"><a href="#cb221-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-52"><a href="#cb221-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate tpr - true positive rate and fpr - false positive rate</span></span>
<span id="cb221-53"><a href="#cb221-53" aria-hidden="true" tabindex="-1"></a>perf_fit <span class="ot">&lt;-</span> <span class="fu">performance</span>(pred_fit, <span class="st">&quot;tpr&quot;</span>, <span class="st">&quot;fpr&quot;</span>)</span>
<span id="cb221-54"><a href="#cb221-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-55"><a href="#cb221-55" aria-hidden="true" tabindex="-1"></a><span class="co"># plot ROC-curve</span></span>
<span id="cb221-56"><a href="#cb221-56" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(perf_fit, <span class="at">colorize=</span>T, <span class="at">print.cutoffs.at =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>, <span class="at">by=</span><span class="fl">0.1</span>))</span>
<span id="cb221-57"><a href="#cb221-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-58"><a href="#cb221-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Area under the curve: 0.87</span></span>
<span id="cb221-59"><a href="#cb221-59" aria-hidden="true" tabindex="-1"></a>auc <span class="ot">&lt;-</span> <span class="fu">performance</span>(pred_fit, <span class="at">measure =</span> <span class="st">&quot;auc&quot;</span>)</span>
<span id="cb221-60"><a href="#cb221-60" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(auc)</span>
<span id="cb221-61"><a href="#cb221-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-62"><a href="#cb221-62" aria-hidden="true" tabindex="-1"></a><span class="co"># How to detect the border and make a decision if student will get honorary degree</span></span>
<span id="cb221-63"><a href="#cb221-63" aria-hidden="true" tabindex="-1"></a><span class="co"># Specificity - how good we can predict negative results</span></span>
<span id="cb221-64"><a href="#cb221-64" aria-hidden="true" tabindex="-1"></a>perf3 <span class="ot">&lt;-</span> <span class="fu">performance</span>(pred_fit, <span class="at">x.measure =</span> <span class="st">&quot;cutoff&quot;</span>, <span class="at">measure =</span> <span class="st">&quot;spec&quot;</span>)</span>
<span id="cb221-65"><a href="#cb221-65" aria-hidden="true" tabindex="-1"></a><span class="co"># Sencitivity - how good we can predict positive results</span></span>
<span id="cb221-66"><a href="#cb221-66" aria-hidden="true" tabindex="-1"></a>perf4 <span class="ot">&lt;-</span> <span class="fu">performance</span>(pred_fit, <span class="at">x.measure =</span> <span class="st">&quot;cutoff&quot;</span>, <span class="at">measure =</span> <span class="st">&quot;sens&quot;</span>)</span>
<span id="cb221-67"><a href="#cb221-67" aria-hidden="true" tabindex="-1"></a><span class="co"># Общая интенсивность классификатора</span></span>
<span id="cb221-68"><a href="#cb221-68" aria-hidden="true" tabindex="-1"></a>perf5 <span class="ot">&lt;-</span> <span class="fu">performance</span>(pred_fit, <span class="at">x.measure =</span> <span class="st">&quot;cutoff&quot;</span>, <span class="at">measure =</span> <span class="st">&quot;acc&quot;</span>)</span>
<span id="cb221-69"><a href="#cb221-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-70"><a href="#cb221-70" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(perf3, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb221-71"><a href="#cb221-71" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">add=</span>T, perf4, <span class="at">col =</span> <span class="st">&quot;green&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb221-72"><a href="#cb221-72" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">add=</span>T, perf5, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb221-73"><a href="#cb221-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-74"><a href="#cb221-74" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="at">x =</span> <span class="fl">0.6</span>, <span class="at">y =</span> <span class="fl">0.3</span>, <span class="fu">c</span>(<span class="st">&quot;spec&quot;</span>, <span class="st">&quot;sens&quot;</span>, <span class="st">&quot;accur&quot;</span>), <span class="at">lty=</span><span class="dv">1</span>, <span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;black&quot;</span>),</span>
<span id="cb221-75"><a href="#cb221-75" aria-hidden="true" tabindex="-1"></a>       <span class="at">bty=</span><span class="st">&#39;n&#39;</span>, <span class="at">cex=</span><span class="dv">1</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb221-76"><a href="#cb221-76" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fl">0.255</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb221-77"><a href="#cb221-77" aria-hidden="true" tabindex="-1"></a><span class="co"># The border is the intersection of all three curves</span></span>
<span id="cb221-78"><a href="#cb221-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-79"><a href="#cb221-79" aria-hidden="true" tabindex="-1"></a><span class="co"># Add column with prediced values Y/N</span></span>
<span id="cb221-80"><a href="#cb221-80" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>pred_resp <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(df<span class="sc">$</span>prob <span class="sc">&gt;</span> <span class="fl">0.255</span>, <span class="dv">1</span>, <span class="dv">0</span>), <span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;N&quot;</span>, <span class="st">&quot;Y&quot;</span>))</span>
<span id="cb221-81"><a href="#cb221-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-82"><a href="#cb221-82" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 if prediction is correct, 0 if not correct</span></span>
<span id="cb221-83"><a href="#cb221-83" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>correct <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(df<span class="sc">$</span>pred_resp <span class="sc">==</span> df<span class="sc">$</span>hon, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb221-84"><a href="#cb221-84" aria-hidden="true" tabindex="-1"></a>df</span>
<span id="cb221-85"><a href="#cb221-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-86"><a href="#cb221-86" aria-hidden="true" tabindex="-1"></a><span class="co"># blue - correct classified, red - incorrect classified</span></span>
<span id="cb221-87"><a href="#cb221-87" aria-hidden="true" tabindex="-1"></a><span class="co"># it is more difficult to predict positive result</span></span>
<span id="cb221-88"><a href="#cb221-88" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(prob, <span class="at">fill =</span> <span class="fu">factor</span>(correct)))<span class="sc">+</span></span>
<span id="cb221-89"><a href="#cb221-89" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_dotplot</span>()<span class="sc">+</span></span>
<span id="cb221-90"><a href="#cb221-90" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">25</span>),</span>
<span id="cb221-91"><a href="#cb221-91" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">25</span>, <span class="at">face=</span><span class="st">&quot;bold&quot;</span>))</span>
<span id="cb221-92"><a href="#cb221-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-93"><a href="#cb221-93" aria-hidden="true" tabindex="-1"></a><span class="co"># Percent of positive predictions</span></span>
<span id="cb221-94"><a href="#cb221-94" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(df<span class="sc">$</span>correct)</span>
<span id="cb221-95"><a href="#cb221-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-96"><a href="#cb221-96" aria-hidden="true" tabindex="-1"></a><span class="co"># Part 3 - Prediction using test data</span></span>
<span id="cb221-97"><a href="#cb221-97" aria-hidden="true" tabindex="-1"></a>test_df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;test.csv&quot;</span>, <span class="at">sep=</span><span class="st">&quot;;&quot;</span>)</span>
<span id="cb221-98"><a href="#cb221-98" aria-hidden="true" tabindex="-1"></a>test_df</span>
<span id="cb221-99"><a href="#cb221-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-100"><a href="#cb221-100" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict honorary members</span></span>
<span id="cb221-101"><a href="#cb221-101" aria-hidden="true" tabindex="-1"></a>test_df<span class="sc">$</span>prob_predict <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, <span class="at">newdata=</span>test_df, <span class="at">type=</span><span class="st">&quot;response&quot;</span>)</span>
<span id="cb221-102"><a href="#cb221-102" aria-hidden="true" tabindex="-1"></a>test_df<span class="sc">$</span>pred_resp <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(test_df<span class="sc">$</span>prob_predict <span class="sc">&gt;</span> <span class="fl">0.255</span>, <span class="dv">1</span>, <span class="dv">0</span>), <span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;N&quot;</span>, <span class="st">&quot;Y&quot;</span>))</span>
<span id="cb221-103"><a href="#cb221-103" aria-hidden="true" tabindex="-1"></a>test_df</span></code></pre></div>
<!--chapter:end:28_logistic_regression.Rmd-->
</div>
</div>
<div id="clustering" class="section level1" number="29">
<h1 number="29"><span class="header-section-number">29</span> Clustering</h1>
<p>5 classes of clustering methods:<br />
1. <strong>Partitioning methods</strong> - split into k-groups (k-means, k-dedoids (PAM), CLARA)<br />
2. <strong>Hierarchical clustering</strong><br />
3. <strong>Fuzzy clustering</strong><br />
4. <strong>Density-based clustering</strong><br />
5. <strong>Model-based clustering</strong></p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a>bv <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;./DATA/beverage.csv&quot;</span>, <span class="at">header=</span>T, <span class="at">sep=</span><span class="st">&quot;;&quot;</span>)  </span>
<span id="cb222-2"><a href="#cb222-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(bv)  </span>
<span id="cb222-3"><a href="#cb222-3" aria-hidden="true" tabindex="-1"></a><span class="co"># no needs to normalize because all data is binary (0,1)</span></span>
<span id="cb222-4"><a href="#cb222-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-5"><a href="#cb222-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Hierarchical clustering</span></span>
<span id="cb222-6"><a href="#cb222-6" aria-hidden="true" tabindex="-1"></a><span class="co"># dist - calculate distances</span></span>
<span id="cb222-7"><a href="#cb222-7" aria-hidden="true" tabindex="-1"></a><span class="co"># hclust - hierarchical clustering</span></span>
<span id="cb222-8"><a href="#cb222-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-9"><a href="#cb222-9" aria-hidden="true" tabindex="-1"></a>clust.bv <span class="ot">&lt;-</span> <span class="fu">hclust</span>(<span class="fu">dist</span>(bv[,<span class="dv">2</span><span class="sc">:</span><span class="dv">9</span>]), <span class="st">&quot;ward.D&quot;</span>)</span>
<span id="cb222-10"><a href="#cb222-10" aria-hidden="true" tabindex="-1"></a>clust.bv</span>
<span id="cb222-11"><a href="#cb222-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-12"><a href="#cb222-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot clusters</span></span>
<span id="cb222-13"><a href="#cb222-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(clust.bv)</span>
<span id="cb222-14"><a href="#cb222-14" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(clust.bv, <span class="at">hang =</span> <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb222-15"><a href="#cb222-15" aria-hidden="true" tabindex="-1"></a><span class="fu">rect.hclust</span>(clust.bv, <span class="at">k=</span><span class="dv">3</span>, <span class="at">border=</span><span class="st">&quot;red&quot;</span>) </span>
<span id="cb222-16"><a href="#cb222-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-17"><a href="#cb222-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Group data by clusters</span></span>
<span id="cb222-18"><a href="#cb222-18" aria-hidden="true" tabindex="-1"></a>groups <span class="ot">&lt;-</span> <span class="fu">cutree</span>(clust.bv, <span class="at">k=</span><span class="dv">3</span>)</span>
<span id="cb222-19"><a href="#cb222-19" aria-hidden="true" tabindex="-1"></a>groups</span>
<span id="cb222-20"><a href="#cb222-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-21"><a href="#cb222-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Percentage in broups by drinking different beverages</span></span>
<span id="cb222-22"><a href="#cb222-22" aria-hidden="true" tabindex="-1"></a><span class="fu">colMeans</span>(bv[groups<span class="sc">==</span><span class="dv">1</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">9</span>])<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb222-23"><a href="#cb222-23" aria-hidden="true" tabindex="-1"></a><span class="fu">colMeans</span>(bv[groups<span class="sc">==</span><span class="dv">2</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">9</span>])<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb222-24"><a href="#cb222-24" aria-hidden="true" tabindex="-1"></a><span class="fu">colMeans</span>(bv[groups<span class="sc">==</span><span class="dv">3</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">9</span>])<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb222-25"><a href="#cb222-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-26"><a href="#cb222-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Interpretation</span></span>
<span id="cb222-27"><a href="#cb222-27" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. People who does not have specific preference</span></span>
<span id="cb222-28"><a href="#cb222-28" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. People who prefers cola and pepsi</span></span>
<span id="cb222-29"><a href="#cb222-29" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Not clear (others)</span></span>
<span id="cb222-30"><a href="#cb222-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-31"><a href="#cb222-31" aria-hidden="true" tabindex="-1"></a><span class="co"># atributes of cluster analysis</span></span>
<span id="cb222-32"><a href="#cb222-32" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(clust.bv)</span>
<span id="cb222-33"><a href="#cb222-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-34"><a href="#cb222-34" aria-hidden="true" tabindex="-1"></a><span class="co"># chronic of combining</span></span>
<span id="cb222-35"><a href="#cb222-35" aria-hidden="true" tabindex="-1"></a>clust.bv<span class="sc">$</span>merge</span>
<span id="cb222-36"><a href="#cb222-36" aria-hidden="true" tabindex="-1"></a>clust.bv[<span class="dv">1</span>]</span>
<span id="cb222-37"><a href="#cb222-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-38"><a href="#cb222-38" aria-hidden="true" tabindex="-1"></a>clust.bv<span class="sc">$</span>height</span>
<span id="cb222-39"><a href="#cb222-39" aria-hidden="true" tabindex="-1"></a>clust.bv<span class="sc">$</span>order</span>
<span id="cb222-40"><a href="#cb222-40" aria-hidden="true" tabindex="-1"></a>clust.bv<span class="sc">$</span>labels</span>
<span id="cb222-41"><a href="#cb222-41" aria-hidden="true" tabindex="-1"></a>clust.bv<span class="sc">$</span>method</span>
<span id="cb222-42"><a href="#cb222-42" aria-hidden="true" tabindex="-1"></a>clust.bv<span class="sc">$</span>call</span>
<span id="cb222-43"><a href="#cb222-43" aria-hidden="true" tabindex="-1"></a>clust.bv<span class="sc">$</span>dist.method</span>
<span id="cb222-44"><a href="#cb222-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-45"><a href="#cb222-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Detect the best choice for number of cluster by elbow-plot</span></span>
<span id="cb222-46"><a href="#cb222-46" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">33</span>, clust.bv<span class="sc">$</span>height, <span class="at">type=</span><span class="st">&quot;l&quot;</span>)</span>
<span id="cb222-47"><a href="#cb222-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-48"><a href="#cb222-48" aria-hidden="true" tabindex="-1"></a><span class="do">### Task. Analyse data and find groups of people</span></span>
<span id="cb222-49"><a href="#cb222-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Scores (0,10) of 10 tests for candidates to get a job.</span></span>
<span id="cb222-50"><a href="#cb222-50" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Memorizing numbers</span></span>
<span id="cb222-51"><a href="#cb222-51" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Math task</span></span>
<span id="cb222-52"><a href="#cb222-52" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Solving tasks in dialoge</span></span>
<span id="cb222-53"><a href="#cb222-53" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Algorithms</span></span>
<span id="cb222-54"><a href="#cb222-54" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Self confidence</span></span>
<span id="cb222-55"><a href="#cb222-55" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. Work in group</span></span>
<span id="cb222-56"><a href="#cb222-56" aria-hidden="true" tabindex="-1"></a><span class="co"># 7. Find solution</span></span>
<span id="cb222-57"><a href="#cb222-57" aria-hidden="true" tabindex="-1"></a><span class="co"># 8. Collaboration</span></span>
<span id="cb222-58"><a href="#cb222-58" aria-hidden="true" tabindex="-1"></a><span class="co"># 9. Acceptance by others</span></span>
<span id="cb222-59"><a href="#cb222-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-60"><a href="#cb222-60" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">&quot;~/DataAnalysis&quot;</span>)</span>
<span id="cb222-61"><a href="#cb222-61" aria-hidden="true" tabindex="-1"></a>job <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;DATA/assess.dat&quot;</span>, <span class="at">header=</span>T, <span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb222-62"><a href="#cb222-62" aria-hidden="true" tabindex="-1"></a>job</span>
<span id="cb222-63"><a href="#cb222-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-64"><a href="#cb222-64" aria-hidden="true" tabindex="-1"></a><span class="co"># Clustering</span></span>
<span id="cb222-65"><a href="#cb222-65" aria-hidden="true" tabindex="-1"></a>clust.job <span class="ot">&lt;-</span> <span class="fu">hclust</span>(<span class="fu">dist</span>(job[,<span class="dv">3</span><span class="sc">:</span><span class="fu">ncol</span>(job)]), <span class="st">&quot;ward.D&quot;</span>)</span>
<span id="cb222-66"><a href="#cb222-66" aria-hidden="true" tabindex="-1"></a><span class="co"># no needs to normalize, because all numbers have the same min, max</span></span>
<span id="cb222-67"><a href="#cb222-67" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(clust.job)  <span class="co"># visual number of clusters is 4</span></span>
<span id="cb222-68"><a href="#cb222-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-69"><a href="#cb222-69" aria-hidden="true" tabindex="-1"></a><span class="co"># Group data by clusters</span></span>
<span id="cb222-70"><a href="#cb222-70" aria-hidden="true" tabindex="-1"></a>groups <span class="ot">&lt;-</span> <span class="fu">cutree</span>(clust.job, <span class="at">k=</span><span class="dv">4</span>)</span>
<span id="cb222-71"><a href="#cb222-71" aria-hidden="true" tabindex="-1"></a>groups</span>
<span id="cb222-72"><a href="#cb222-72" aria-hidden="true" tabindex="-1"></a><span class="fu">colMeans</span>(job[groups<span class="sc">==</span><span class="dv">1</span>, <span class="dv">3</span><span class="sc">:</span><span class="dv">12</span>])<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb222-73"><a href="#cb222-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-74"><a href="#cb222-74" aria-hidden="true" tabindex="-1"></a><span class="do">### Find clusters using k-means method</span></span>
<span id="cb222-75"><a href="#cb222-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-76"><a href="#cb222-76" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">&quot;~/DataAnalysis&quot;</span>)</span>
<span id="cb222-77"><a href="#cb222-77" aria-hidden="true" tabindex="-1"></a>bv <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;DATA/beverage.csv&quot;</span>, <span class="at">header=</span>T, <span class="at">sep=</span><span class="st">&quot;;&quot;</span>)</span>
<span id="cb222-78"><a href="#cb222-78" aria-hidden="true" tabindex="-1"></a>bv</span>
<span id="cb222-79"><a href="#cb222-79" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(bv)</span>
<span id="cb222-80"><a href="#cb222-80" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(bv)</span>
<span id="cb222-81"><a href="#cb222-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-82"><a href="#cb222-82" aria-hidden="true" tabindex="-1"></a><span class="co"># k-means clustering, with initial 3 clusters</span></span>
<span id="cb222-83"><a href="#cb222-83" aria-hidden="true" tabindex="-1"></a><span class="co"># nstart = x - run x times with different initial clusters</span></span>
<span id="cb222-84"><a href="#cb222-84" aria-hidden="true" tabindex="-1"></a>summ<span class="fl">.1</span> <span class="ot">=</span> <span class="fu">kmeans</span>(bv[,<span class="dv">2</span><span class="sc">:</span><span class="dv">9</span>], <span class="dv">3</span>, <span class="at">iter.max =</span> <span class="dv">100</span>)</span>
<span id="cb222-85"><a href="#cb222-85" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(summ<span class="fl">.1</span>)</span>
<span id="cb222-86"><a href="#cb222-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-87"><a href="#cb222-87" aria-hidden="true" tabindex="-1"></a><span class="co"># Objects by clusters</span></span>
<span id="cb222-88"><a href="#cb222-88" aria-hidden="true" tabindex="-1"></a>summ<span class="fl">.1</span><span class="sc">$</span>cluster</span>
<span id="cb222-89"><a href="#cb222-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-90"><a href="#cb222-90" aria-hidden="true" tabindex="-1"></a><span class="co"># Centers of clusters</span></span>
<span id="cb222-91"><a href="#cb222-91" aria-hidden="true" tabindex="-1"></a>summ<span class="fl">.1</span><span class="sc">$</span>centers</span>
<span id="cb222-92"><a href="#cb222-92" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 digits after point</span></span>
<span id="cb222-93"><a href="#cb222-93" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">digits=</span><span class="dv">2</span>)</span>
<span id="cb222-94"><a href="#cb222-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-95"><a href="#cb222-95" aria-hidden="true" tabindex="-1"></a><span class="fu">t</span>(summ<span class="fl">.1</span><span class="sc">$</span>centers)</span>
<span id="cb222-96"><a href="#cb222-96" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">digits=</span><span class="dv">7</span>)</span>
<span id="cb222-97"><a href="#cb222-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-98"><a href="#cb222-98" aria-hidden="true" tabindex="-1"></a><span class="co"># Square summs</span></span>
<span id="cb222-99"><a href="#cb222-99" aria-hidden="true" tabindex="-1"></a>summ<span class="fl">.1</span><span class="sc">$</span>withinss</span>
<span id="cb222-100"><a href="#cb222-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-101"><a href="#cb222-101" aria-hidden="true" tabindex="-1"></a><span class="co"># Summ of elements of vector</span></span>
<span id="cb222-102"><a href="#cb222-102" aria-hidden="true" tabindex="-1"></a>summ<span class="fl">.1</span><span class="sc">$</span>tot.withinss</span>
<span id="cb222-103"><a href="#cb222-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-104"><a href="#cb222-104" aria-hidden="true" tabindex="-1"></a><span class="co"># sum(33*(apply(bv[,2:9], 2, sd))^2)</span></span>
<span id="cb222-105"><a href="#cb222-105" aria-hidden="true" tabindex="-1"></a>summ<span class="fl">.1</span><span class="sc">$</span>totss</span>
<span id="cb222-106"><a href="#cb222-106" aria-hidden="true" tabindex="-1"></a>summ<span class="fl">.1</span><span class="sc">$</span>tot.betweenss</span>
<span id="cb222-107"><a href="#cb222-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-108"><a href="#cb222-108" aria-hidden="true" tabindex="-1"></a><span class="co"># Size of clusters</span></span>
<span id="cb222-109"><a href="#cb222-109" aria-hidden="true" tabindex="-1"></a>summ<span class="fl">.1</span><span class="sc">$</span>size</span>
<span id="cb222-110"><a href="#cb222-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-111"><a href="#cb222-111" aria-hidden="true" tabindex="-1"></a><span class="co"># Elbow plot to detect optimal number of clusters</span></span>
<span id="cb222-112"><a href="#cb222-112" aria-hidden="true" tabindex="-1"></a>wss <span class="ot">&lt;-</span> (<span class="fu">nrow</span>(bv[,<span class="dv">2</span><span class="sc">:</span><span class="dv">9</span>])<span class="sc">-</span><span class="dv">1</span>)<span class="sc">*</span><span class="fu">sum</span>(<span class="fu">apply</span>(bv[,<span class="dv">2</span><span class="sc">:</span><span class="dv">9</span>],<span class="dv">2</span>,var))</span>
<span id="cb222-113"><a href="#cb222-113" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">15</span>) { wss[i] <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(bv[,<span class="dv">2</span><span class="sc">:</span><span class="dv">9</span>],</span>
<span id="cb222-114"><a href="#cb222-114" aria-hidden="true" tabindex="-1"></a>                <span class="at">centers=</span>i)<span class="sc">$</span>tot.withinss }</span>
<span id="cb222-115"><a href="#cb222-115" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>, wss, <span class="at">type=</span><span class="st">&quot;b&quot;</span>, <span class="at">xlab=</span><span class="st">&quot;Number of Clusters&quot;</span>,</span>
<span id="cb222-116"><a href="#cb222-116" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">&quot;Within groups sum of squares&quot;</span>)</span>
<span id="cb222-117"><a href="#cb222-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-118"><a href="#cb222-118" aria-hidden="true" tabindex="-1"></a><span class="co"># We can see that diagram is rough. This is because clusters are not allways optimal</span></span>
<span id="cb222-119"><a href="#cb222-119" aria-hidden="true" tabindex="-1"></a><span class="co"># To improve situation, we have to run many initiall start coordinates and choose the best</span></span>
<span id="cb222-120"><a href="#cb222-120" aria-hidden="true" tabindex="-1"></a><span class="co"># option (add nstart=500):</span></span>
<span id="cb222-121"><a href="#cb222-121" aria-hidden="true" tabindex="-1"></a>wss <span class="ot">&lt;-</span> (<span class="fu">nrow</span>(bv[,<span class="dv">2</span><span class="sc">:</span><span class="dv">9</span>])<span class="sc">-</span><span class="dv">1</span>)<span class="sc">*</span><span class="fu">sum</span>(<span class="fu">apply</span>(bv[,<span class="dv">2</span><span class="sc">:</span><span class="dv">9</span>],<span class="dv">2</span>,var))</span>
<span id="cb222-122"><a href="#cb222-122" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">15</span>) { wss[i] <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(bv[,<span class="dv">2</span><span class="sc">:</span><span class="dv">9</span>],</span>
<span id="cb222-123"><a href="#cb222-123" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">centers=</span>i, <span class="at">nstart=</span><span class="dv">500</span>)<span class="sc">$</span>tot.withinss }</span>
<span id="cb222-124"><a href="#cb222-124" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>, wss, <span class="at">type=</span><span class="st">&quot;b&quot;</span>, <span class="at">xlab=</span><span class="st">&quot;Number of Clusters&quot;</span>,</span>
<span id="cb222-125"><a href="#cb222-125" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">&quot;Within groups sum of squares&quot;</span>)</span>
<span id="cb222-126"><a href="#cb222-126" aria-hidden="true" tabindex="-1"></a><span class="co"># Warnings means that iterations were not finished for some cases.</span></span>
<span id="cb222-127"><a href="#cb222-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-128"><a href="#cb222-128" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s compair results for 3 and 4 clusters</span></span>
<span id="cb222-129"><a href="#cb222-129" aria-hidden="true" tabindex="-1"></a>summ<span class="fl">.1</span> <span class="ot">=</span> <span class="fu">kmeans</span>(bv[,<span class="dv">2</span><span class="sc">:</span><span class="dv">9</span>], <span class="dv">3</span>, <span class="at">iter.max=</span><span class="dv">100</span>)</span>
<span id="cb222-130"><a href="#cb222-130" aria-hidden="true" tabindex="-1"></a>summ<span class="fl">.2</span> <span class="ot">=</span> <span class="fu">kmeans</span>(bv[,<span class="dv">2</span><span class="sc">:</span><span class="dv">9</span>], <span class="dv">4</span>, <span class="at">iter.max=</span><span class="dv">100</span>)</span>
<span id="cb222-131"><a href="#cb222-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-132"><a href="#cb222-132" aria-hidden="true" tabindex="-1"></a><span class="co"># Compair clusters. How many elements in each cluster</span></span>
<span id="cb222-133"><a href="#cb222-133" aria-hidden="true" tabindex="-1"></a><span class="co"># We can see how elements move if we take more clusters</span></span>
<span id="cb222-134"><a href="#cb222-134" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(summ<span class="fl">.1</span><span class="sc">$</span>cluster, summ<span class="fl">.2</span><span class="sc">$</span>cluster)</span>
<span id="cb222-135"><a href="#cb222-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-136"><a href="#cb222-136" aria-hidden="true" tabindex="-1"></a><span class="co"># Multidimentional scaling</span></span>
<span id="cb222-137"><a href="#cb222-137" aria-hidden="true" tabindex="-1"></a><span class="co"># Project multidimentional data to 2d</span></span>
<span id="cb222-138"><a href="#cb222-138" aria-hidden="true" tabindex="-1"></a>bv.dist <span class="ot">&lt;-</span> <span class="fu">dist</span>(bv[,<span class="dv">2</span><span class="sc">:</span><span class="dv">9</span>])</span>
<span id="cb222-139"><a href="#cb222-139" aria-hidden="true" tabindex="-1"></a>bv.mds <span class="ot">&lt;-</span> <span class="fu">cmdscale</span>(bv.dist)</span>
<span id="cb222-140"><a href="#cb222-140" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bv.mds, <span class="at">col =</span> summ<span class="fl">.1</span><span class="sc">$</span>cluster, <span class="at">xlab=</span><span class="st">&quot;Index&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb222-141"><a href="#cb222-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-142"><a href="#cb222-142" aria-hidden="true" tabindex="-1"></a><span class="co"># Detect optimal number of clusters</span></span>
<span id="cb222-143"><a href="#cb222-143" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;NbClust&quot;</span>)</span>
<span id="cb222-144"><a href="#cb222-144" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;NbClust&quot;</span>)</span>
<span id="cb222-145"><a href="#cb222-145" aria-hidden="true" tabindex="-1"></a>Best <span class="ot">&lt;-</span> <span class="fu">NbClust</span>(bv[,<span class="dv">2</span><span class="sc">:</span><span class="dv">9</span>],              <span class="co"># data </span></span>
<span id="cb222-146"><a href="#cb222-146" aria-hidden="true" tabindex="-1"></a>                <span class="at">distance=</span><span class="st">&quot;euclidean&quot;</span>,  <span class="co"># distance method</span></span>
<span id="cb222-147"><a href="#cb222-147" aria-hidden="true" tabindex="-1"></a>                <span class="at">min.nc=</span><span class="dv">2</span>,              <span class="co"># min number of clusters</span></span>
<span id="cb222-148"><a href="#cb222-148" aria-hidden="true" tabindex="-1"></a>                <span class="at">max.nc=</span><span class="dv">8</span>,             <span class="co"># max number of clusters</span></span>
<span id="cb222-149"><a href="#cb222-149" aria-hidden="true" tabindex="-1"></a>                <span class="at">method=</span><span class="st">&quot;ward.D&quot;</span>,       <span class="co"># ward methodes </span></span>
<span id="cb222-150"><a href="#cb222-150" aria-hidden="true" tabindex="-1"></a>                <span class="at">index =</span> <span class="st">&quot;alllong&quot;</span> )    <span class="co"># choose indices</span></span></code></pre></div>
<div id="next-part-4" class="section level2" number="29.1">
<h2 number="29.1"><span class="header-section-number">29.1</span> Next part</h2>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cluster)</span>
<span id="cb223-2"><a href="#cb223-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(factoextra)</span>
<span id="cb223-3"><a href="#cb223-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-4"><a href="#cb223-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-5"><a href="#cb223-5" aria-hidden="true" tabindex="-1"></a>Distances<span class="sc">:</span></span>
<span id="cb223-6"><a href="#cb223-6" aria-hidden="true" tabindex="-1"></a>stats<span class="sc">::</span><span class="fu">dist</span>()</span>
<span id="cb223-7"><a href="#cb223-7" aria-hidden="true" tabindex="-1"></a>factoextra<span class="sc">::</span><span class="fu">get_dist</span>()   <span class="co"># compute a distance matrix between the rows of a data matrix</span></span>
<span id="cb223-8"><a href="#cb223-8" aria-hidden="true" tabindex="-1"></a>factoextra<span class="sc">::</span><span class="fu">fviz_dist</span>()  <span class="co"># visualize distance matrix</span></span>
<span id="cb223-9"><a href="#cb223-9" aria-hidden="true" tabindex="-1"></a>cluster<span class="sc">::</span><span class="fu">daisy</span>()         <span class="co"># handle both numeric and not numeric (nominal, ordinal,...) data types</span></span>
<span id="cb223-10"><a href="#cb223-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-11"><a href="#cb223-11" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> factoextra<span class="sc">::</span><span class="fu">get_dist</span>(USArrests, <span class="at">stand =</span> <span class="cn">TRUE</span>, <span class="at">method =</span> <span class="st">&#39;pearson&#39;</span>)</span>
<span id="cb223-12"><a href="#cb223-12" aria-hidden="true" tabindex="-1"></a>factoextra<span class="sc">::</span><span class="fu">fviz_dist</span>(d, <span class="at">gradient =</span> <span class="fu">list</span>(<span class="at">low=</span><span class="st">&#39;blue&#39;</span>, <span class="at">mid=</span><span class="st">&#39;white&#39;</span>, <span class="at">high=</span><span class="st">&#39;red&#39;</span>))</span>
<span id="cb223-13"><a href="#cb223-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-14"><a href="#cb223-14" aria-hidden="true" tabindex="-1"></a><span class="do">#####</span></span>
<span id="cb223-15"><a href="#cb223-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb223-16"><a href="#cb223-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cluster)</span>
<span id="cb223-17"><a href="#cb223-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(factoextra)</span>
<span id="cb223-18"><a href="#cb223-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-19"><a href="#cb223-19" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> USArrests <span class="sc">%&gt;%</span> <span class="fu">na.omit</span>() <span class="sc">%&gt;%</span> <span class="fu">scale</span>()</span>
<span id="cb223-20"><a href="#cb223-20" aria-hidden="true" tabindex="-1"></a>data</span>
<span id="cb223-21"><a href="#cb223-21" aria-hidden="true" tabindex="-1"></a>factoextra<span class="sc">::</span><span class="fu">fviz_nbclust</span>(data, kmeans, <span class="at">method =</span> <span class="st">&#39;gap_stat&#39;</span>)</span>
<span id="cb223-22"><a href="#cb223-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-23"><a href="#cb223-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-24"><a href="#cb223-24" aria-hidden="true" tabindex="-1"></a>km.res <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(data, <span class="dv">3</span>, <span class="at">nstart =</span> <span class="dv">25</span>)</span>
<span id="cb223-25"><a href="#cb223-25" aria-hidden="true" tabindex="-1"></a>factoextra<span class="sc">::</span><span class="fu">fviz_cluster</span>(km.res, <span class="at">data =</span> data,</span>
<span id="cb223-26"><a href="#cb223-26" aria-hidden="true" tabindex="-1"></a>                         <span class="at">ellipse.type =</span> <span class="st">&#39;convex&#39;</span>,</span>
<span id="cb223-27"><a href="#cb223-27" aria-hidden="true" tabindex="-1"></a>                         <span class="at">palette =</span> <span class="st">&#39;jco&#39;</span>,</span>
<span id="cb223-28"><a href="#cb223-28" aria-hidden="true" tabindex="-1"></a>                         <span class="at">repel =</span> <span class="cn">TRUE</span>,</span>
<span id="cb223-29"><a href="#cb223-29" aria-hidden="true" tabindex="-1"></a>                         <span class="at">ggtheme =</span> <span class="fu">theme_minimal</span>())</span>
<span id="cb223-30"><a href="#cb223-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-31"><a href="#cb223-31" aria-hidden="true" tabindex="-1"></a><span class="co"># PAM clustering</span></span>
<span id="cb223-32"><a href="#cb223-32" aria-hidden="true" tabindex="-1"></a>pam.res <span class="ot">&lt;-</span> cluster<span class="sc">::</span><span class="fu">pam</span>(data, <span class="dv">4</span>)</span>
<span id="cb223-33"><a href="#cb223-33" aria-hidden="true" tabindex="-1"></a>factoextra<span class="sc">::</span><span class="fu">fviz_cluster</span>(pam.res)</span>
<span id="cb223-34"><a href="#cb223-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-35"><a href="#cb223-35" aria-hidden="true" tabindex="-1"></a><span class="co"># CLARA clustering</span></span>
<span id="cb223-36"><a href="#cb223-36" aria-hidden="true" tabindex="-1"></a>clara.res <span class="ot">&lt;-</span> <span class="fu">clara</span>(df, <span class="dv">2</span>, <span class="at">samples =</span> <span class="dv">50</span>, <span class="at">pamLike =</span> <span class="cn">TRUE</span>)</span>
<span id="cb223-37"><a href="#cb223-37" aria-hidden="true" tabindex="-1"></a>clara.res</span>
<span id="cb223-38"><a href="#cb223-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-39"><a href="#cb223-39" aria-hidden="true" tabindex="-1"></a>dd <span class="ot">&lt;-</span> <span class="fu">cbind</span>(df, <span class="at">cluster =</span> clara.res<span class="sc">$</span>cluster)</span>
<span id="cb223-40"><a href="#cb223-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-41"><a href="#cb223-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Medoids</span></span>
<span id="cb223-42"><a href="#cb223-42" aria-hidden="true" tabindex="-1"></a>clara.res<span class="sc">$</span>medoids</span>
<span id="cb223-43"><a href="#cb223-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-44"><a href="#cb223-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Clustering</span></span>
<span id="cb223-45"><a href="#cb223-45" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(clara.res<span class="sc">$</span>clustering,<span class="dv">10</span>)</span></code></pre></div>
</div>
<div id="example" class="section level2" number="29.2">
<h2 number="29.2"><span class="header-section-number">29.2</span> Example</h2>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(datasets)</span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(iris)</span></code></pre></div>
<pre><code>##   Sepal.Length Sepal.Width Petal.Length Petal.Width Species id
## 1          5.1         3.5          1.4         0.2  setosa  1
## 2          4.9         3.0          1.4         0.2  setosa  2
## 3          4.7         3.2          1.3         0.2  setosa  3
## 4          4.6         3.1          1.5         0.2  setosa  4
## 5          5.0         3.6          1.4         0.2  setosa  5
## 6          5.4         3.9          1.7         0.4  setosa  6</code></pre>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot Petal.Length ~ Petal.Width data</span></span>
<span id="cb226-2"><a href="#cb226-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(iris<span class="sc">$</span>Petal.Length <span class="sc">~</span> iris<span class="sc">$</span>Petal.Width)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/setup-1.png" width="672" /></p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">20</span>)</span>
<span id="cb227-2"><a href="#cb227-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-3"><a href="#cb227-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Find number of clusters using wss</span></span>
<span id="cb227-4"><a href="#cb227-4" aria-hidden="true" tabindex="-1"></a>wss <span class="ot">&lt;-</span> (<span class="fu">nrow</span>(iris[, <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>])<span class="sc">-</span><span class="dv">1</span>)<span class="sc">*</span><span class="fu">sum</span>(<span class="fu">apply</span>(iris[, <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>],<span class="dv">2</span>,var))</span>
<span id="cb227-5"><a href="#cb227-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">15</span>) wss[i] <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">kmeans</span>(iris[, <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>], i)<span class="sc">$</span>withinss)</span>
<span id="cb227-6"><a href="#cb227-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>, wss, <span class="at">type=</span><span class="st">&quot;b&quot;</span>, <span class="at">xlab=</span><span class="st">&quot;Number of Clusters&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;Within groups sum of squares&quot;</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/setup-2.png" width="672" /></p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="co">#More than 3 clusters give no obvious advantages</span></span>
<span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-3"><a href="#cb228-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Make k-means with 3 clasters</span></span>
<span id="cb228-4"><a href="#cb228-4" aria-hidden="true" tabindex="-1"></a>ncl <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb228-5"><a href="#cb228-5" aria-hidden="true" tabindex="-1"></a>irisCluster <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(iris[, <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>], ncl, <span class="at">nstart =</span> <span class="dv">20</span>)</span>
<span id="cb228-6"><a href="#cb228-6" aria-hidden="true" tabindex="-1"></a>irisCluster</span></code></pre></div>
<pre><code>## K-means clustering with 3 clusters of sizes 48, 50, 52
## 
## Cluster means:
##   Petal.Length Petal.Width
## 1     5.595833    2.037500
## 2     1.462000    0.246000
## 3     4.269231    1.342308
## 
## Clustering vector:
##   [1] 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 1 3 3 3 3 3 1
##  [85] 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 1 1 1 1 1 1 3 1 1 1 1 1 1 1 1 1 1 1 1 3 1 1 1 1 1 1 3 1 1 1 1 1 1 1 1 1 1 1 3 1 1 1 1 1 1 1 1 1 1 1
## 
## Within cluster sum of squares by cluster:
## [1] 16.29167  2.02200 13.05769
##  (between_SS / total_SS =  94.3 %)
## 
## Available components:
## 
## [1] &quot;cluster&quot;      &quot;centers&quot;      &quot;totss&quot;        &quot;withinss&quot;     &quot;tot.withinss&quot; &quot;betweenss&quot;    &quot;size&quot;         &quot;iter&quot;         &quot;ifault&quot;</code></pre>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compair result of clustering with real data (3 species of iris are in analysis)</span></span>
<span id="cb230-2"><a href="#cb230-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(irisCluster<span class="sc">$</span>cluster, iris<span class="sc">$</span>Species)</span></code></pre></div>
<pre><code>##    
##     setosa versicolor virginica
##   1      0          2        46
##   2     50          0         0
##   3      0         48         4</code></pre>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot data</span></span>
<span id="cb232-2"><a href="#cb232-2" aria-hidden="true" tabindex="-1"></a>clusters <span class="ot">&lt;-</span> <span class="fu">split.data.frame</span>(iris, irisCluster<span class="sc">$</span>cluster)</span>
<span id="cb232-3"><a href="#cb232-3" aria-hidden="true" tabindex="-1"></a>xlim <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">min</span>(iris<span class="sc">$</span>Petal.Width), <span class="fu">max</span>(iris<span class="sc">$</span>Petal.Width))</span>
<span id="cb232-4"><a href="#cb232-4" aria-hidden="true" tabindex="-1"></a>ylim <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">min</span>(iris<span class="sc">$</span>Petal.Length), <span class="fu">max</span>(iris<span class="sc">$</span>Petal.Length))</span>
<span id="cb232-5"><a href="#cb232-5" aria-hidden="true" tabindex="-1"></a>col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;red&#39;</span>, <span class="st">&#39;green&#39;</span>, <span class="st">&#39;blue&#39;</span>)</span>
<span id="cb232-6"><a href="#cb232-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">0</span>, <span class="at">xlab=</span><span class="st">&#39;Petal width&#39;</span>, <span class="at">ylab=</span><span class="st">&#39;Petal length&#39;</span>, <span class="at">xlim=</span>xlim, <span class="at">ylim=</span>ylim)</span>
<span id="cb232-7"><a href="#cb232-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>ncl ) {</span>
<span id="cb232-8"><a href="#cb232-8" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(clusters[[i]]<span class="sc">$</span>Petal.Length <span class="sc">~</span> clusters[[i]]<span class="sc">$</span>Petal.Width, <span class="at">col=</span>col[i], <span class="at">xlim=</span>xlim, <span class="at">ylim=</span>ylim)</span>
<span id="cb232-9"><a href="#cb232-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/setup-3.png" width="672" /></p>
</div>
<div id="next-part-5" class="section level2" number="29.3">
<h2 number="29.3"><span class="header-section-number">29.3</span> NEXT PART</h2>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="co"># K-Nearest Neighbors or KNN is a clustering algorithm</span></span>
<span id="cb233-2"><a href="#cb233-2" aria-hidden="true" tabindex="-1"></a><span class="co"># k is known number of clusters (usually sqrt(N), between 3-10, but may be different)</span></span>
<span id="cb233-3"><a href="#cb233-3" aria-hidden="true" tabindex="-1"></a><span class="co"># samples must be normalized x = (x - min(x))/(max(x)-min(x))</span></span>
<span id="cb233-4"><a href="#cb233-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-5"><a href="#cb233-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(iris)</span>
<span id="cb233-6"><a href="#cb233-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(iris)   <span class="co"># detailed view of the data set</span></span>
<span id="cb233-7"><a href="#cb233-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(iris)   <span class="co"># view data types, sample values, categorical values, etc</span></span>
<span id="cb233-8"><a href="#cb233-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(iris)</span>
<span id="cb233-9"><a href="#cb233-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-10"><a href="#cb233-10" aria-hidden="true" tabindex="-1"></a><span class="co">#normalization function</span></span>
<span id="cb233-11"><a href="#cb233-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-12"><a href="#cb233-12" aria-hidden="true" tabindex="-1"></a>min_max_normalizer <span class="ot">&lt;-</span> <span class="cf">function</span>(x)</span>
<span id="cb233-13"><a href="#cb233-13" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb233-14"><a href="#cb233-14" aria-hidden="true" tabindex="-1"></a>    num <span class="ot">&lt;-</span> x <span class="sc">-</span> <span class="fu">min</span>(x) </span>
<span id="cb233-15"><a href="#cb233-15" aria-hidden="true" tabindex="-1"></a>    denom <span class="ot">&lt;-</span> <span class="fu">max</span>(x) <span class="sc">-</span> <span class="fu">min</span>(x)</span>
<span id="cb233-16"><a href="#cb233-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span> (num<span class="sc">/</span>denom)</span>
<span id="cb233-17"><a href="#cb233-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb233-18"><a href="#cb233-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-19"><a href="#cb233-19" aria-hidden="true" tabindex="-1"></a><span class="co">#normalizing iris data set</span></span>
<span id="cb233-20"><a href="#cb233-20" aria-hidden="true" tabindex="-1"></a>normalized_iris <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">lapply</span>(iris[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], min_max_normalizer))</span>
<span id="cb233-21"><a href="#cb233-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-22"><a href="#cb233-22" aria-hidden="true" tabindex="-1"></a><span class="co">#viewing normalized data</span></span>
<span id="cb233-23"><a href="#cb233-23" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(normalized_iris)</span>
<span id="cb233-24"><a href="#cb233-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-25"><a href="#cb233-25" aria-hidden="true" tabindex="-1"></a><span class="co">#checking the data constituency</span></span>
<span id="cb233-26"><a href="#cb233-26" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(iris<span class="sc">$</span>Species)</span>
<span id="cb233-27"><a href="#cb233-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-28"><a href="#cb233-28" aria-hidden="true" tabindex="-1"></a><span class="co">#set seed for randomization</span></span>
<span id="cb233-29"><a href="#cb233-29" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb233-30"><a href="#cb233-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-31"><a href="#cb233-31" aria-hidden="true" tabindex="-1"></a><span class="co"># setting the training-test split to 67% and 33% respectively</span></span>
<span id="cb233-32"><a href="#cb233-32" aria-hidden="true" tabindex="-1"></a>random_samples <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">2</span>, <span class="fu">nrow</span>(iris), <span class="at">replace=</span><span class="cn">TRUE</span>, <span class="at">prob=</span><span class="fu">c</span>(<span class="fl">0.67</span>, <span class="fl">0.33</span>))</span>
<span id="cb233-33"><a href="#cb233-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-34"><a href="#cb233-34" aria-hidden="true" tabindex="-1"></a><span class="co"># training data set</span></span>
<span id="cb233-35"><a href="#cb233-35" aria-hidden="true" tabindex="-1"></a>iris.training <span class="ot">&lt;-</span> iris[</span>
<span id="cb233-36"><a href="#cb233-36" aria-hidden="true" tabindex="-1"></a>    random_samples <span class="sc">==</span><span class="dv">1</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>] </span>
<span id="cb233-37"><a href="#cb233-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-38"><a href="#cb233-38" aria-hidden="true" tabindex="-1"></a><span class="co">#training labels</span></span>
<span id="cb233-39"><a href="#cb233-39" aria-hidden="true" tabindex="-1"></a>iris.trainLabels <span class="ot">&lt;-</span> iris[</span>
<span id="cb233-40"><a href="#cb233-40" aria-hidden="true" tabindex="-1"></a>    random_samples <span class="sc">==</span><span class="dv">1</span>, <span class="dv">5</span>]</span>
<span id="cb233-41"><a href="#cb233-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-42"><a href="#cb233-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-43"><a href="#cb233-43" aria-hidden="true" tabindex="-1"></a><span class="co"># test data set</span></span>
<span id="cb233-44"><a href="#cb233-44" aria-hidden="true" tabindex="-1"></a>iris.test <span class="ot">&lt;-</span> iris[</span>
<span id="cb233-45"><a href="#cb233-45" aria-hidden="true" tabindex="-1"></a>    random_samples <span class="sc">==</span><span class="dv">2</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb233-46"><a href="#cb233-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-47"><a href="#cb233-47" aria-hidden="true" tabindex="-1"></a><span class="co">#testing labels</span></span>
<span id="cb233-48"><a href="#cb233-48" aria-hidden="true" tabindex="-1"></a>iris.testLabels <span class="ot">&lt;-</span> iris[</span>
<span id="cb233-49"><a href="#cb233-49" aria-hidden="true" tabindex="-1"></a>    random_samples <span class="sc">==</span><span class="dv">2</span>, <span class="dv">5</span>]</span>
<span id="cb233-50"><a href="#cb233-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-51"><a href="#cb233-51" aria-hidden="true" tabindex="-1"></a><span class="co">#setting library</span></span>
<span id="cb233-52"><a href="#cb233-52" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(class)</span>
<span id="cb233-53"><a href="#cb233-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-54"><a href="#cb233-54" aria-hidden="true" tabindex="-1"></a><span class="co">#executing knn for k=3</span></span>
<span id="cb233-55"><a href="#cb233-55" aria-hidden="true" tabindex="-1"></a>iris_model <span class="ot">&lt;-</span> <span class="fu">knn</span>(<span class="at">train =</span> iris.training, <span class="at">test =</span> iris.test, <span class="at">cl =</span> iris.trainLabels, <span class="at">k=</span><span class="dv">3</span>)</span>
<span id="cb233-56"><a href="#cb233-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-57"><a href="#cb233-57" aria-hidden="true" tabindex="-1"></a><span class="co">#summary of the model learnt</span></span>
<span id="cb233-58"><a href="#cb233-58" aria-hidden="true" tabindex="-1"></a>iris_model</span></code></pre></div>
<!--chapter:end:30_clustering.Rmd-->
</div>
</div>
<div id="learning-vector-quantization" class="section level1" number="30">
<h1 number="30"><span class="header-section-number">30</span> Learning Vector Quantization</h1>
<p>Learning Vector Quantiztion (LVQ) is a supervised classification algorithm for binary and multiclass problems. LVQ is a special case of a neural network.<br />
LVQ model creates codebook vectors by learning training dataset. Codebook vectors represent class regions. They contain elements that placed around the respective class according to their matching level. If the element matches, it comes closer to the target class, if it does not match, it moves farther from it. With this codebooks, the model classifies new data.
<a href="http://jsalatas.ictpro.gr/implementation-of-competitive-learning-networks-for-weka/">Here</a> is a nice explanation how it works.</p>
<p>There are several versions of <strong>LVQ</strong> function:<br />
<code>lvq1()</code>, <code>olvq1()</code>, <code>lvq2()</code>, <code>lvq3()</code>, <code>dlvq()</code>.</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(class) <span class="co"># olvq1()</span></span>
<span id="cb234-2"><a href="#cb234-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret) <span class="co"># to split data</span></span>
<span id="cb234-3"><a href="#cb234-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-4"><a href="#cb234-4" aria-hidden="true" tabindex="-1"></a><span class="co"># generate dataset</span></span>
<span id="cb234-5"><a href="#cb234-5" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> iris</span>
<span id="cb234-6"><a href="#cb234-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-7"><a href="#cb234-7" aria-hidden="true" tabindex="-1"></a>id <span class="ot">=</span> caret<span class="sc">::</span><span class="fu">createDataPartition</span>(df<span class="sc">$</span>Species, <span class="at">p =</span> .<span class="dv">8</span>, <span class="at">list =</span> F)</span>
<span id="cb234-8"><a href="#cb234-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-9"><a href="#cb234-9" aria-hidden="true" tabindex="-1"></a>train <span class="ot">=</span> df[id, ]</span>
<span id="cb234-10"><a href="#cb234-10" aria-hidden="true" tabindex="-1"></a>test <span class="ot">=</span> df[<span class="sc">-</span>id, ]</span>
<span id="cb234-11"><a href="#cb234-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-12"><a href="#cb234-12" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize an LVQ codebook</span></span>
<span id="cb234-13"><a href="#cb234-13" aria-hidden="true" tabindex="-1"></a>cb <span class="ot">=</span> class<span class="sc">::</span><span class="fu">lvqinit</span>(train[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], train<span class="sc">$</span>Species)</span>
<span id="cb234-14"><a href="#cb234-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-15"><a href="#cb234-15" aria-hidden="true" tabindex="-1"></a><span class="co"># training set in a codebook.</span></span>
<span id="cb234-16"><a href="#cb234-16" aria-hidden="true" tabindex="-1"></a>build.cb <span class="ot">=</span> class<span class="sc">::</span><span class="fu">olvq1</span>(train[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], train<span class="sc">$</span>Species, cb)</span>
<span id="cb234-17"><a href="#cb234-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-18"><a href="#cb234-18" aria-hidden="true" tabindex="-1"></a><span class="co"># classify test set from LVQ Codebook for test data</span></span>
<span id="cb234-19"><a href="#cb234-19" aria-hidden="true" tabindex="-1"></a>predict <span class="ot">=</span> class<span class="sc">::</span><span class="fu">lvqtest</span>(build.cb, test[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>])</span>
<span id="cb234-20"><a href="#cb234-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-21"><a href="#cb234-21" aria-hidden="true" tabindex="-1"></a><span class="co"># confusion matrix.</span></span>
<span id="cb234-22"><a href="#cb234-22" aria-hidden="true" tabindex="-1"></a>caret<span class="sc">::</span><span class="fu">confusionMatrix</span>(test<span class="sc">$</span>Species, predict)</span></code></pre></div>
<pre><code>## Confusion Matrix and Statistics
## 
##             Reference
## Prediction   setosa versicolor virginica
##   setosa         10          0         0
##   versicolor      0         10         0
##   virginica       0          1         9
## 
## Overall Statistics
##                                           
##                Accuracy : 0.9667          
##                  95% CI : (0.8278, 0.9992)
##     No Information Rate : 0.3667          
##     P-Value [Acc &gt; NIR] : 4.476e-12       
##                                           
##                   Kappa : 0.95            
##                                           
##  Mcnemar&#39;s Test P-Value : NA              
## 
## Statistics by Class:
## 
##                      Class: setosa Class: versicolor Class: virginica
## Sensitivity                 1.0000            0.9091           1.0000
## Specificity                 1.0000            1.0000           0.9524
## Pos Pred Value              1.0000            1.0000           0.9000
## Neg Pred Value              1.0000            0.9500           1.0000
## Prevalence                  0.3333            0.3667           0.3000
## Detection Rate              0.3333            0.3333           0.3000
## Detection Prevalence        0.3333            0.3333           0.3333
## Balanced Accuracy           1.0000            0.9545           0.9762</code></pre>
<!--chapter:end:41_learning_vector_quantization.Rmd-->
</div>
<div id="bayesian-inference" class="section level1" number="31">
<h1 number="31"><span class="header-section-number">31</span> Bayesian inference</h1>
<p><strong>Bayesian data analysis</strong> the use of Bayesian inference to learn from data.</p>
<p><strong>Bayesian inference</strong> is a method for figuring out unobservable quantities
given known facts that uses probability to describe the uncertainty over what
the values of the unknown quantities could be.</p>
<p><strong>Bayesian inference</strong> is conditioning on data, in order to learn about parameter values.</p>
<p><strong>Bayesian inference</strong> is a method of statistical inference in which Bayes’
theorem is used to update the probability for a hypothesis as more evidence or
information becomes available.</p>
<p><strong>Bayes’ theorem</strong><br />
<span class="math display">\[P( \theta | D ) = frac{P( D | \theta) \pdot P( \theta)}{\sum{P( D | \theta) \pdot P( \theta ) }}\]</span></p>
<p><span class="math inline">\(\theta\)</span> - Parameter values<br />
<span class="math inline">\(D\)</span> - New data<br />
<span class="math inline">\(P(D | \theta)\)</span> - Likelihood (the relative) probability of the data given different parameter value.<br />
<span class="math inline">\(P( \theta )\)</span> - Prior<br />
<span class="math inline">\(\sum{P( D | \theta) \pdot P( \theta ) }\)</span> - The total sum of the likelihod weighted by the prior.</p>
<ul>
<li>A <strong>prior</strong> is a probability distribution that represents what the model knows before seeing the data.<br />
</li>
<li>A <strong>posterior</strong> is a probability distribution that represents what the model knows after having seen the data.</li>
</ul>
<p><strong>Bayesian inference components</strong>:</p>
<ul>
<li>Data<br />
</li>
<li>Bayesian Model:<br />
</li>
<li>Generative model (<code>dbinom</code>, <code>dnorm</code>, <code>poisson</code> etc.)<br />
</li>
<li>Priors<br />
</li>
<li>Computational methods:<br />
</li>
<li>Rejection sampling<br />
</li>
<li>Grid approximation<br />
</li>
<li>Markov Chain Monte Carlo (MCMC)</li>
</ul>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualization function of Bayesian inference for binary data </span></span>
<span id="cb236-2"><a href="#cb236-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggjoy)</span>
<span id="cb236-3"><a href="#cb236-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggExtra)</span>
<span id="cb236-4"><a href="#cb236-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggjoy)</span>
<span id="cb236-5"><a href="#cb236-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb236-6"><a href="#cb236-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-7"><a href="#cb236-7" aria-hidden="true" tabindex="-1"></a><span class="co"># prop_model function to visualize bayesian posterior distributions</span></span>
<span id="cb236-8"><a href="#cb236-8" aria-hidden="true" tabindex="-1"></a>prop_model <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">data =</span> <span class="fu">c</span>(), <span class="at">prior_prop =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>), <span class="at">n_draws =</span> <span class="dv">10000</span>, <span class="at">show_plot =</span> <span class="cn">TRUE</span>) </span>
<span id="cb236-9"><a href="#cb236-9" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb236-10"><a href="#cb236-10" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">as.logical</span>(data)</span>
<span id="cb236-11"><a href="#cb236-11" aria-hidden="true" tabindex="-1"></a>    proportion_success <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length.out =</span> <span class="dv">100</span>), <span class="dv">1</span>)</span>
<span id="cb236-12"><a href="#cb236-12" aria-hidden="true" tabindex="-1"></a>    data_indices <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="fu">length</span>(data), <span class="at">length.out =</span> <span class="fu">min</span>(<span class="fu">length</span>(data) <span class="sc">+</span> </span>
<span id="cb236-13"><a href="#cb236-13" aria-hidden="true" tabindex="-1"></a>                                                                    <span class="dv">1</span>, <span class="dv">20</span>)))</span>
<span id="cb236-14"><a href="#cb236-14" aria-hidden="true" tabindex="-1"></a>    post_curves <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(data_indices, <span class="cf">function</span>(i) {</span>
<span id="cb236-15"><a href="#cb236-15" aria-hidden="true" tabindex="-1"></a>        value <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(i <span class="sc">==</span> <span class="dv">0</span>, <span class="st">&quot;Prior&quot;</span>, <span class="fu">ifelse</span>(data[i], <span class="st">&quot;Success&quot;</span>, <span class="st">&quot;Failure&quot;</span>))</span>
<span id="cb236-16"><a href="#cb236-16" aria-hidden="true" tabindex="-1"></a>        label <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;n=&quot;</span>, i)</span>
<span id="cb236-17"><a href="#cb236-17" aria-hidden="true" tabindex="-1"></a>        probability <span class="ot">&lt;-</span> <span class="fu">dbeta</span>(proportion_success, prior_prop[<span class="dv">1</span>] <span class="sc">+</span> </span>
<span id="cb236-18"><a href="#cb236-18" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">sum</span>(data[<span class="fu">seq_len</span>(i)]), prior_prop[<span class="dv">2</span>] <span class="sc">+</span> <span class="fu">sum</span>(<span class="sc">!</span>data[<span class="fu">seq_len</span>(i)]))</span>
<span id="cb236-19"><a href="#cb236-19" aria-hidden="true" tabindex="-1"></a>        probability <span class="ot">&lt;-</span> probability<span class="sc">/</span><span class="fu">max</span>(probability)</span>
<span id="cb236-20"><a href="#cb236-20" aria-hidden="true" tabindex="-1"></a>        <span class="fu">tibble</span>(value, label, proportion_success, probability)</span>
<span id="cb236-21"><a href="#cb236-21" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb236-22"><a href="#cb236-22" aria-hidden="true" tabindex="-1"></a>    post_curves<span class="sc">$</span>label <span class="ot">&lt;-</span> <span class="fu">fct_rev</span>(<span class="fu">factor</span>(post_curves<span class="sc">$</span>label, <span class="at">levels =</span> <span class="fu">paste0</span>(<span class="st">&quot;n=&quot;</span>, </span>
<span id="cb236-23"><a href="#cb236-23" aria-hidden="true" tabindex="-1"></a>                                                                           data_indices)))</span>
<span id="cb236-24"><a href="#cb236-24" aria-hidden="true" tabindex="-1"></a>    post_curves<span class="sc">$</span>value <span class="ot">&lt;-</span> <span class="fu">factor</span>(post_curves<span class="sc">$</span>value, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Prior&quot;</span>, </span>
<span id="cb236-25"><a href="#cb236-25" aria-hidden="true" tabindex="-1"></a>                                                              <span class="st">&quot;Success&quot;</span>, <span class="st">&quot;Failure&quot;</span>))</span>
<span id="cb236-26"><a href="#cb236-26" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(post_curves, <span class="fu">aes</span>(<span class="at">x =</span> proportion_success, <span class="at">y =</span> label, </span>
<span id="cb236-27"><a href="#cb236-27" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">height =</span> probability, <span class="at">fill =</span> value)) <span class="sc">+</span> <span class="fu">geom_joy</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, </span>
<span id="cb236-28"><a href="#cb236-28" aria-hidden="true" tabindex="-1"></a>                                                                                 <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">panel_scaling =</span> <span class="cn">TRUE</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb236-29"><a href="#cb236-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_y_discrete</span>(<span class="st">&quot;&quot;</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="fl">0.01</span>, <span class="dv">0</span>)) <span class="sc">+</span> <span class="fu">scale_x_continuous</span>(<span class="st">&quot;Underlying proportion of success&quot;</span>) <span class="sc">+</span> </span>
<span id="cb236-30"><a href="#cb236-30" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">hcl</span>(<span class="dv">120</span> <span class="sc">*</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">0</span> <span class="sc">+</span> <span class="dv">15</span>, <span class="dv">100</span>, <span class="dv">65</span>), </span>
<span id="cb236-31"><a href="#cb236-31" aria-hidden="true" tabindex="-1"></a>                          <span class="at">name =</span> <span class="st">&quot;&quot;</span>, <span class="at">drop =</span> <span class="cn">FALSE</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Prior   &quot;</span>, <span class="st">&quot;Success   &quot;</span>, </span>
<span id="cb236-32"><a href="#cb236-32" aria-hidden="true" tabindex="-1"></a>                                                              <span class="st">&quot;Failure   &quot;</span>)) <span class="sc">+</span> <span class="fu">theme_light</span>(<span class="at">base_size =</span> <span class="dv">18</span>) <span class="sc">+</span> </span>
<span id="cb236-33"><a href="#cb236-33" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>)</span>
<span id="cb236-34"><a href="#cb236-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (show_plot) {</span>
<span id="cb236-35"><a href="#cb236-35" aria-hidden="true" tabindex="-1"></a>        <span class="fu">print</span>(p)</span>
<span id="cb236-36"><a href="#cb236-36" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb236-37"><a href="#cb236-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">invisible</span>(<span class="fu">rbeta</span>(n_draws, prior_prop[<span class="dv">1</span>] <span class="sc">+</span> <span class="fu">sum</span>(data), prior_prop[<span class="dv">2</span>] <span class="sc">+</span> </span>
<span id="cb236-38"><a href="#cb236-38" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">sum</span>(<span class="sc">!</span>data)))</span>
<span id="cb236-39"><a href="#cb236-39" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div id="simple-model-with-one-binary-parameter" class="section level2" number="31.1">
<h2 number="31.1"><span class="header-section-number">31.1</span> Simple model with one binary parameter</h2>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate 50 random binary data with P(1)=0.75</span></span>
<span id="cb237-2"><a href="#cb237-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>), <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.75</span>, <span class="fl">0.25</span>), <span class="at">size =</span> <span class="dv">10</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb237-3"><a href="#cb237-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-4"><a href="#cb237-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize posteriors</span></span>
<span id="cb237-5"><a href="#cb237-5" aria-hidden="true" tabindex="-1"></a>posterior <span class="ot">&lt;-</span> <span class="fu">prop_model</span>(data)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-81-1.png" width="672" /></p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="co"># View posterior</span></span>
<span id="cb238-2"><a href="#cb238-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(posterior)</span></code></pre></div>
<pre><code>## [1] 0.6907880 0.6526425 0.4462395 0.6992505 0.5693596 0.5330336</code></pre>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Center of the posterior</span></span>
<span id="cb240-2"><a href="#cb240-2" aria-hidden="true" tabindex="-1"></a><span class="fu">median</span>(posterior)</span></code></pre></div>
<pre><code>## [1] 0.5882531</code></pre>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The credible interval (CI)</span></span>
<span id="cb242-2"><a href="#cb242-2" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(posterior, <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.95</span>))</span></code></pre></div>
<pre><code>##        5%       95% 
## 0.3505923 0.7977435</code></pre>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Probability of successes &gt; 0.3</span></span>
<span id="cb244-2"><a href="#cb244-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(posterior <span class="sc">&gt;</span> <span class="fl">0.3</span>) <span class="sc">/</span> <span class="fu">length</span>(posterior)</span></code></pre></div>
<pre><code>## [1] 0.977</code></pre>
<p><strong>Generate binomial data</strong></p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fl">0.42</span>     <span class="co"># probability of success</span></span>
<span id="cb246-2"><a href="#cb246-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span>      <span class="co"># number of observations</span></span>
<span id="cb246-3"><a href="#cb246-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create logical vector, TRUE if numeric value from uniform distribution &lt; p</span></span>
<span id="cb246-4"><a href="#cb246-4" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb246-5"><a href="#cb246-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb246-6"><a href="#cb246-6" aria-hidden="true" tabindex="-1"></a>    data[i] <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">1</span>) <span class="sc">&lt;</span> p</span>
<span id="cb246-7"><a href="#cb246-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb246-8"><a href="#cb246-8" aria-hidden="true" tabindex="-1"></a><span class="co"># convert logical to numeric 0/1</span></span>
<span id="cb246-9"><a href="#cb246-9" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(data)</span>
<span id="cb246-10"><a href="#cb246-10" aria-hidden="true" tabindex="-1"></a>data</span></code></pre></div>
<pre><code>##   [1] 0 0 1 0 1 1 0 0 0 0 1 1 0 0 0 0 1 1 0 1 1 1 0 1 1 1 1 0 1 0 0 1 0 0 0 0 0 1 1 1 1 0 0 0 0 1 1 1 0 1 0 1 0 1 0 1 0 1 0 0 1 1 0 1 1 0 1 1 0 1 0 0 0 1 1 1 0 0 0 0 0 0 1 1
##  [85] 0 1 0 1 1 0 0 0 1 1 0 0 1 0 0 0</code></pre>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the same vector using rbinom distribution</span></span>
<span id="cb248-2"><a href="#cb248-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="dv">100</span>      <span class="co"># number of observations</span></span>
<span id="cb248-3"><a href="#cb248-3" aria-hidden="true" tabindex="-1"></a>size <span class="ot">=</span> <span class="dv">1</span>     <span class="co"># 0 - fail, 1 - success, for 1 trial</span></span>
<span id="cb248-4"><a href="#cb248-4" aria-hidden="true" tabindex="-1"></a>p <span class="ot">=</span> <span class="fl">0.42</span>     <span class="co"># probability of success</span></span>
<span id="cb248-5"><a href="#cb248-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rbinom</span>(n, size, p)</span></code></pre></div>
<pre><code>##   [1] 1 0 1 0 1 0 1 0 0 1 1 0 1 0 0 0 1 1 0 1 0 0 1 0 0 1 0 0 0 1 1 1 0 0 0 1 0 1 0 1 1 0 1 1 1 0 1 1 1 0 1 0 1 0 1 1 0 0 0 0 0 1 0 0 0 1 0 0 1 0 1 1 0 0 0 1 1 1 1 1 0 0 1 1
##  [85] 0 1 0 0 0 0 0 0 1 1 0 0 0 0 0 1</code></pre>
</div>
<div id="grid-approximation" class="section level2" number="31.2">
<h2 number="31.2"><span class="header-section-number">31.2</span> Grid approximation</h2>
<p>To get more visitors to your website you are considering paying for an ad to be
<strong>shown 100 times</strong> on a popular social media site.<br />
According to the social media site, their ads get <strong>clicked on 10% of the time</strong>.
How many visitors could your site get?</p>
<p>We can fix % of clicks as 0.1 but we do not know exactly how many clicks people
do (uncertain). We suggest the % of clicks is uniformly distributed between 0 and 20.</p>
<p>Define model:<br />
<span class="math inline">\(n_{ads} = 100\)</span>
<span class="math inline">\(p_{clicks} ~ Uniform(0.0, 0.2)\)</span>
<span class="math inline">\(p_{visitors} ~ Binomial(n_{ads}, p_{clicks})\)</span></p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100000</span>          <span class="co"># number of simulations</span></span>
<span id="cb250-2"><a href="#cb250-2" aria-hidden="true" tabindex="-1"></a>n_ads_shown <span class="ot">&lt;-</span> <span class="dv">100</span>   <span class="co"># number of shown ads</span></span>
<span id="cb250-3"><a href="#cb250-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb250-4"><a href="#cb250-4" aria-hidden="true" tabindex="-1"></a><span class="co"># probability that add will be clicked (assume uniform [0,0.2])</span></span>
<span id="cb250-5"><a href="#cb250-5" aria-hidden="true" tabindex="-1"></a>p_clicks <span class="ot">&lt;-</span> <span class="fu">runif</span>(n, <span class="at">min =</span> <span class="fl">0.0</span>, <span class="at">max =</span> <span class="fl">0.2</span>)  </span>
<span id="cb250-6"><a href="#cb250-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb250-7"><a href="#cb250-7" aria-hidden="true" tabindex="-1"></a><span class="co"># MODEL: We assume that the binomial distribution is a reasonable generative model</span></span>
<span id="cb250-8"><a href="#cb250-8" aria-hidden="true" tabindex="-1"></a>n_visitors <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n =</span> n, </span>
<span id="cb250-9"><a href="#cb250-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">size =</span> n_ads_shown, </span>
<span id="cb250-10"><a href="#cb250-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">prob =</span> p_clicks)</span>
<span id="cb250-11"><a href="#cb250-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb250-12"><a href="#cb250-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize the prior model simulation</span></span>
<span id="cb250-13"><a href="#cb250-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb250-14"><a href="#cb250-14" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> n_visitors, <span class="at">y =</span> p_clicks)</span>
<span id="cb250-15"><a href="#cb250-15" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(n_visitors, p_clicks)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">theme_classic</span>()</span>
<span id="cb250-16"><a href="#cb250-16" aria-hidden="true" tabindex="-1"></a>ggExtra<span class="sc">::</span><span class="fu">ggMarginal</span>(p, <span class="at">type =</span> <span class="st">&quot;histogram&quot;</span>,  <span class="at">bins =</span> <span class="dv">18</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-83-1.png" width="672" /></p>
<p><strong>Generate posterior distribution</strong></p>
<p>After the first day of showing ads we registered that <strong>13 people</strong> clicked and
<strong>visited</strong> site when the ad was shown 100 times.</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prior distribution binomial model with uniform clicks</span></span>
<span id="cb251-2"><a href="#cb251-2" aria-hidden="true" tabindex="-1"></a>prior <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(p_clicks, n_visitors)</span>
<span id="cb251-3"><a href="#cb251-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-4"><a href="#cb251-4" aria-hidden="true" tabindex="-1"></a><span class="co"># To get posterior we subset from prior 13 visitors</span></span>
<span id="cb251-5"><a href="#cb251-5" aria-hidden="true" tabindex="-1"></a>posterior <span class="ot">&lt;-</span> prior[prior<span class="sc">$</span>n_visitors <span class="sc">==</span> <span class="dv">13</span>, ]</span>
<span id="cb251-6"><a href="#cb251-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(posterior)</span></code></pre></div>
<pre><code>##     p_clicks n_visitors
## 6  0.1650342         13
## 11 0.1480911         13
## 20 0.1011115         13
## 23 0.1511866         13
## 40 0.1314564         13
## 51 0.1263088         13</code></pre>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="#cb253-1" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize posterior</span></span>
<span id="cb253-2"><a href="#cb253-2" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(posterior, <span class="fu">aes</span>(n_visitors, p_clicks)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">theme_classic</span>()</span>
<span id="cb253-3"><a href="#cb253-3" aria-hidden="true" tabindex="-1"></a>ggExtra<span class="sc">::</span><span class="fu">ggMarginal</span>(p, <span class="at">type =</span> <span class="st">&quot;histogram&quot;</span>,  <span class="at">bins =</span> <span class="dv">18</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-84-1.png" width="672" /></p>
<p>For the next iteration we make <strong>prior from posterior</strong> and include new data for
subsetting from prior to get posterior.</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign posterior to prior for the next iteration</span></span>
<span id="cb254-2"><a href="#cb254-2" aria-hidden="true" tabindex="-1"></a>prior <span class="ot">&lt;-</span> posterior</span>
<span id="cb254-3"><a href="#cb254-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-4"><a href="#cb254-4" aria-hidden="true" tabindex="-1"></a><span class="co"># next iteration posterior ~ f(prior)</span></span>
<span id="cb254-5"><a href="#cb254-5" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span>  <span class="fu">nrow</span>(prior)</span>
<span id="cb254-6"><a href="#cb254-6" aria-hidden="true" tabindex="-1"></a>n_ads_shown <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb254-7"><a href="#cb254-7" aria-hidden="true" tabindex="-1"></a>prior<span class="sc">$</span>n_visitors <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, </span>
<span id="cb254-8"><a href="#cb254-8" aria-hidden="true" tabindex="-1"></a>                           <span class="at">size =</span> n_ads_shown, </span>
<span id="cb254-9"><a href="#cb254-9" aria-hidden="true" tabindex="-1"></a>                           <span class="at">prob =</span> prior<span class="sc">$</span>p_clicks)</span>
<span id="cb254-10"><a href="#cb254-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-11"><a href="#cb254-11" aria-hidden="true" tabindex="-1"></a><span class="co"># plot of prior distributions</span></span>
<span id="cb254-12"><a href="#cb254-12" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(prior, <span class="fu">aes</span>(n_visitors, p_clicks)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">theme_classic</span>()</span>
<span id="cb254-13"><a href="#cb254-13" aria-hidden="true" tabindex="-1"></a>ggExtra<span class="sc">::</span><span class="fu">ggMarginal</span>(p, <span class="at">type =</span> <span class="st">&quot;histogram&quot;</span>,  <span class="at">bins =</span> <span class="dv">18</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-85-1.png" width="672" /></p>
<p>Use result of the model for prediction:</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the probability that you will get 5 or more visitors.</span></span>
<span id="cb255-2"><a href="#cb255-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(prior<span class="sc">$</span>n_visitors <span class="sc">&gt;=</span> <span class="dv">5</span>) <span class="sc">/</span> <span class="fu">length</span>(prior<span class="sc">$</span>n_visitors)</span></code></pre></div>
<pre><code>## [1] 0.9863665</code></pre>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Median number of visitors</span></span>
<span id="cb257-2"><a href="#cb257-2" aria-hidden="true" tabindex="-1"></a><span class="fu">median</span>(prior<span class="sc">$</span>n_visitors)</span></code></pre></div>
<pre><code>## [1] 13</code></pre>
<p><strong>Updated model</strong>
We will change prior distribution with knowledge we learn from people that the
number of clicks are 5% and sometimes 2 or 8%.
We will use <strong>beta distribution</strong> to setup number of clicks to update prior in
our model.</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="#cb259-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100000</span></span>
<span id="cb259-2"><a href="#cb259-2" aria-hidden="true" tabindex="-1"></a>n_ads_shown <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb259-3"><a href="#cb259-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-4"><a href="#cb259-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Change the prior on proportion_clicks</span></span>
<span id="cb259-5"><a href="#cb259-5" aria-hidden="true" tabindex="-1"></a>p_clicks <span class="ot">&lt;-</span> <span class="fu">rbeta</span>(n, <span class="at">shape1 =</span> <span class="dv">5</span>, <span class="at">shape2 =</span> <span class="dv">95</span>)</span>
<span id="cb259-6"><a href="#cb259-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-7"><a href="#cb259-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Updated model</span></span>
<span id="cb259-8"><a href="#cb259-8" aria-hidden="true" tabindex="-1"></a>n_visitors <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n =</span> n,</span>
<span id="cb259-9"><a href="#cb259-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">size =</span> n_ads_shown, </span>
<span id="cb259-10"><a href="#cb259-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">prob =</span> p_clicks)</span>
<span id="cb259-11"><a href="#cb259-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-12"><a href="#cb259-12" aria-hidden="true" tabindex="-1"></a>prior <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(p_clicks, n_visitors)</span>
<span id="cb259-13"><a href="#cb259-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-14"><a href="#cb259-14" aria-hidden="true" tabindex="-1"></a>posterior <span class="ot">&lt;-</span> prior[prior<span class="sc">$</span>n_visitors <span class="sc">==</span> <span class="dv">13</span>, ]</span>
<span id="cb259-15"><a href="#cb259-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-16"><a href="#cb259-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots the prior and the posterior</span></span>
<span id="cb259-17"><a href="#cb259-17" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfcol =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb259-18"><a href="#cb259-18" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(prior<span class="sc">$</span>p_clicks, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.25</span>))</span>
<span id="cb259-19"><a href="#cb259-19" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(posterior<span class="sc">$</span>p_clicks, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.25</span>))</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-87-1.png" width="672" /></p>
<p>We tested for video banner and now we would like to compair distributions for:
- video ads (13 out of 100 clicked)<br />
- text ads (6 out of a 100 clicked).</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100000</span></span>
<span id="cb260-2"><a href="#cb260-2" aria-hidden="true" tabindex="-1"></a>n_ads_shown <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb260-3"><a href="#cb260-3" aria-hidden="true" tabindex="-1"></a>p_clicks <span class="ot">&lt;-</span> <span class="fu">runif</span>(n, <span class="at">min =</span> <span class="fl">0.0</span>, <span class="at">max =</span> <span class="fl">0.2</span>)</span>
<span id="cb260-4"><a href="#cb260-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-5"><a href="#cb260-5" aria-hidden="true" tabindex="-1"></a>n_visitors <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, </span>
<span id="cb260-6"><a href="#cb260-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">size =</span> n_ads_shown, </span>
<span id="cb260-7"><a href="#cb260-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">prob =</span> p_clicks)</span>
<span id="cb260-8"><a href="#cb260-8" aria-hidden="true" tabindex="-1"></a>prior <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(p_clicks, n_visitors)</span>
<span id="cb260-9"><a href="#cb260-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-10"><a href="#cb260-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the posteriors for video and text ads</span></span>
<span id="cb260-11"><a href="#cb260-11" aria-hidden="true" tabindex="-1"></a>posterior_video <span class="ot">&lt;-</span> prior[prior<span class="sc">$</span>n_visitors <span class="sc">==</span> <span class="dv">13</span>, ]</span>
<span id="cb260-12"><a href="#cb260-12" aria-hidden="true" tabindex="-1"></a>posterior_text <span class="ot">&lt;-</span> prior[prior<span class="sc">$</span>n_visitors <span class="sc">==</span> <span class="dv">6</span>, ]</span>
<span id="cb260-13"><a href="#cb260-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-14"><a href="#cb260-14" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb260-15"><a href="#cb260-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize the posteriors</span></span>
<span id="cb260-16"><a href="#cb260-16" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(posterior_video<span class="sc">$</span>p_clicks, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.25</span>))</span>
<span id="cb260-17"><a href="#cb260-17" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(posterior_text<span class="sc">$</span>p_clicks, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.25</span>))</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-88-1.png" width="672" /></p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="#cb261-1" aria-hidden="true" tabindex="-1"></a><span class="co"># combine data into dataframe</span></span>
<span id="cb261-2"><a href="#cb261-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Make sizes of distrib. the same (4000) to fit to dataframe</span></span>
<span id="cb261-3"><a href="#cb261-3" aria-hidden="true" tabindex="-1"></a>posterior <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">video_prop =</span> posterior_video<span class="sc">$</span>p_clicks[<span class="dv">1</span><span class="sc">:</span><span class="dv">4000</span>],</span>
<span id="cb261-4"><a href="#cb261-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">text_prop =</span> posterior_text<span class="sc">$</span>p_clicks[<span class="dv">1</span><span class="sc">:</span><span class="dv">4000</span>])</span>
<span id="cb261-5"><a href="#cb261-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-6"><a href="#cb261-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the posterior difference: video_prop - text_prop</span></span>
<span id="cb261-7"><a href="#cb261-7" aria-hidden="true" tabindex="-1"></a>posterior<span class="sc">$</span>prop_diff <span class="ot">&lt;-</span> posterior<span class="sc">$</span>video_prop <span class="sc">-</span> posterior<span class="sc">$</span>text_prop</span>
<span id="cb261-8"><a href="#cb261-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-9"><a href="#cb261-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the median of prop_diff</span></span>
<span id="cb261-10"><a href="#cb261-10" aria-hidden="true" tabindex="-1"></a><span class="fu">median</span>(posterior<span class="sc">$</span>prop_diff)</span></code></pre></div>
<pre><code>## [1] 0.06563094</code></pre>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the proportion</span></span>
<span id="cb263-2"><a href="#cb263-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(posterior<span class="sc">$</span>prop_diff <span class="sc">&gt;</span> <span class="fl">0.0</span>)</span></code></pre></div>
<pre><code>## [1] 0.94825</code></pre>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="#cb265-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize prop_diff</span></span>
<span id="cb265-2"><a href="#cb265-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(posterior<span class="sc">$</span>prop_diff)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-88-2.png" width="672" /></p>
<p><strong>Decision analysis</strong></p>
<p>Our analysis indicated that <em>the video ads are clicked more often</em>.<br />
We would like to estimate probable profit <em>video ads</em> vs <em>text ads</em> if we know:</p>
<ul>
<li>Each visitor spends $2.53 on average on our website.<br />
</li>
<li>Video ad costs us $0.25 per click.<br />
</li>
<li>Text ad costs us $0.05 per click.</li>
</ul>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a>visitor_spend <span class="ot">&lt;-</span> <span class="fl">2.53</span></span>
<span id="cb266-2"><a href="#cb266-2" aria-hidden="true" tabindex="-1"></a>video_cost <span class="ot">&lt;-</span> <span class="fl">0.25</span></span>
<span id="cb266-3"><a href="#cb266-3" aria-hidden="true" tabindex="-1"></a>text_cost <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb266-4"><a href="#cb266-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-5"><a href="#cb266-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the column posterior$video_profit</span></span>
<span id="cb266-6"><a href="#cb266-6" aria-hidden="true" tabindex="-1"></a>posterior<span class="sc">$</span>video_profit <span class="ot">&lt;-</span> posterior<span class="sc">$</span>video_prop <span class="sc">*</span> visitor_spend <span class="sc">-</span> video_cost</span>
<span id="cb266-7"><a href="#cb266-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-8"><a href="#cb266-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the column posterior$text_profit</span></span>
<span id="cb266-9"><a href="#cb266-9" aria-hidden="true" tabindex="-1"></a>posterior<span class="sc">$</span>text_profit <span class="ot">&lt;-</span> posterior<span class="sc">$</span>text_prop <span class="sc">*</span> visitor_spend <span class="sc">-</span> text_cost</span>
<span id="cb266-10"><a href="#cb266-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-11"><a href="#cb266-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(posterior)</span></code></pre></div>
<pre><code>##   video_prop  text_prop  prop_diff video_profit text_profit
## 1  0.1991635 0.03699197 0.16217154   0.25388368  0.04358969
## 2  0.1931784 0.09495372 0.09822467   0.23874133  0.19023292
## 3  0.1316657 0.05753025 0.07413544   0.08311420  0.09555153
## 4  0.1654641 0.06146723 0.10399688   0.16862420  0.10551210
## 5  0.1260397 0.07971197 0.04632772   0.06888041  0.15167129
## 6  0.1152924 0.05278979 0.06250263   0.04168981  0.08355816</code></pre>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize the video_profit and text_profit columns</span></span>
<span id="cb268-2"><a href="#cb268-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb268-3"><a href="#cb268-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(posterior<span class="sc">$</span>video_profit)</span>
<span id="cb268-4"><a href="#cb268-4" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(posterior<span class="sc">$</span>text_profit)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-89-1.png" width="672" /></p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="#cb269-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Difference between video and text ad profits</span></span>
<span id="cb269-2"><a href="#cb269-2" aria-hidden="true" tabindex="-1"></a>posterior<span class="sc">$</span>profit_diff <span class="ot">&lt;-</span> posterior<span class="sc">$</span>video_profit <span class="sc">-</span> posterior<span class="sc">$</span>text_profit</span>
<span id="cb269-3"><a href="#cb269-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb269-4"><a href="#cb269-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize posterior$profit_diff</span></span>
<span id="cb269-5"><a href="#cb269-5" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(posterior<span class="sc">$</span>profit_diff)</span>
<span id="cb269-6"><a href="#cb269-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb269-7"><a href="#cb269-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate a &quot;best guess&quot; for the difference in profits</span></span>
<span id="cb269-8"><a href="#cb269-8" aria-hidden="true" tabindex="-1"></a><span class="fu">median</span>(posterior<span class="sc">$</span>profit_diff)</span></code></pre></div>
<pre><code>## [1] -0.03395372</code></pre>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="#cb271-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the probability that text ads are better than video ads</span></span>
<span id="cb271-2"><a href="#cb271-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(posterior<span class="sc">$</span>profit_diff <span class="sc">&lt;</span> <span class="dv">0</span>)</span></code></pre></div>
<pre><code>## [1] 0.63125</code></pre>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-89-2.png" width="672" />
Our analysis showed that text ads will bring probably more profit but the result
is too uncertain and we need more data for making the correct decision.</p>
<p><strong>Another model for another case</strong></p>
<p>We would like to put up an ad on the site and pay for it per day.<br />
The site admin promise that we will get 19 clicks per day.<br />
How many daily clicks should we expect on average?<br />
We are going to use <strong>Poisson distribution</strong> for our new model which correspond
to <em>number of successes in a period of time</em>.</p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="#cb273-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100000</span></span>
<span id="cb273-2"><a href="#cb273-2" aria-hidden="true" tabindex="-1"></a>mean_clicks <span class="ot">&lt;-</span> <span class="fu">runif</span>(n, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">80</span>) <span class="co"># uniform dist between 0 and 80 clicks</span></span>
<span id="cb273-3"><a href="#cb273-3" aria-hidden="true" tabindex="-1"></a><span class="co"># model</span></span>
<span id="cb273-4"><a href="#cb273-4" aria-hidden="true" tabindex="-1"></a>n_visitors <span class="ot">&lt;-</span> <span class="fu">rpois</span>(<span class="at">n =</span> n, mean_clicks)</span>
<span id="cb273-5"><a href="#cb273-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb273-6"><a href="#cb273-6" aria-hidden="true" tabindex="-1"></a>prior <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(mean_clicks, n_visitors)</span>
<span id="cb273-7"><a href="#cb273-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb273-8"><a href="#cb273-8" aria-hidden="true" tabindex="-1"></a><span class="co"># first day trial showed 13 clicks</span></span>
<span id="cb273-9"><a href="#cb273-9" aria-hidden="true" tabindex="-1"></a>posterior <span class="ot">&lt;-</span> prior[prior<span class="sc">$</span>n_visitors <span class="sc">==</span> <span class="dv">13</span>, ]</span>
<span id="cb273-10"><a href="#cb273-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb273-11"><a href="#cb273-11" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize prior and posterior</span></span>
<span id="cb273-12"><a href="#cb273-12" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb273-13"><a href="#cb273-13" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(prior<span class="sc">$</span>mean_clicks)</span>
<span id="cb273-14"><a href="#cb273-14" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(posterior<span class="sc">$</span>mean_clicks)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-90-1.png" width="672" /></p>
</div>
<div id="grid-approximation-1" class="section level2" number="31.3">
<h2 number="31.3"><span class="header-section-number">31.3</span> Grid approximation</h2>
<p>The following example shows how we can build the previous model more effective.<br />
We calculating the <strong>distribution</strong> using <code>dbinom</code> instead of <strong>simulating</strong>
using <code>rbinom</code>.<br />
We can directly include condition in our model using <code>dbinom</code> instead of <code>rbinom</code>.</p>
<p>Instead of using resul of our trial <em>13 visitors after showing ads 100 times</em> we
can condition for all posible number of visitors <code>seq(0,100)</code>.</p>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="#cb274-1" aria-hidden="true" tabindex="-1"></a>n_ads_shown <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb274-2"><a href="#cb274-2" aria-hidden="true" tabindex="-1"></a>p_clicks <span class="ot">&lt;-</span> <span class="fl">0.1</span></span>
<span id="cb274-3"><a href="#cb274-3" aria-hidden="true" tabindex="-1"></a>n_visitors <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">100</span>) <span class="co"># instead of 13 we get for all possible n visitors</span></span>
<span id="cb274-4"><a href="#cb274-4" aria-hidden="true" tabindex="-1"></a><span class="co"># model</span></span>
<span id="cb274-5"><a href="#cb274-5" aria-hidden="true" tabindex="-1"></a>prob <span class="ot">&lt;-</span> <span class="fu">dbinom</span>(n_visitors,</span>
<span id="cb274-6"><a href="#cb274-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> n_ads_shown, </span>
<span id="cb274-7"><a href="#cb274-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">prob =</span> p_clicks)</span>
<span id="cb274-8"><a href="#cb274-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(prob)</span></code></pre></div>
<pre><code>## [1] 0.0000265614 0.0002951267 0.0016231966 0.0058916025 0.0158745955 0.0338658038</code></pre>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="#cb276-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the distribution</span></span>
<span id="cb276-2"><a href="#cb276-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(n_visitors, prob, <span class="at">type =</span> <span class="st">&quot;h&quot;</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-91-1.png" width="672" /></p>
<p><strong>Calculating a joint distribution</strong></p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="#cb277-1" aria-hidden="true" tabindex="-1"></a>n_ads_shown <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb277-2"><a href="#cb277-2" aria-hidden="true" tabindex="-1"></a>p_clicks <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.01</span>)</span>
<span id="cb277-3"><a href="#cb277-3" aria-hidden="true" tabindex="-1"></a>n_visitors <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="at">by =</span> <span class="dv">1</span>)</span>
<span id="cb277-4"><a href="#cb277-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb277-5"><a href="#cb277-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a grid over all the parameter combinations you need to evaluate</span></span>
<span id="cb277-6"><a href="#cb277-6" aria-hidden="true" tabindex="-1"></a>pars <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">proportion_clicks =</span> p_clicks,</span>
<span id="cb277-7"><a href="#cb277-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">n_visitors =</span> n_visitors)</span>
<span id="cb277-8"><a href="#cb277-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb277-9"><a href="#cb277-9" aria-hidden="true" tabindex="-1"></a>pars<span class="sc">$</span>prior <span class="ot">&lt;-</span> <span class="fu">dunif</span>(pars<span class="sc">$</span>proportion_clicks, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="fl">0.2</span>)</span>
<span id="cb277-10"><a href="#cb277-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb277-11"><a href="#cb277-11" aria-hidden="true" tabindex="-1"></a>pars<span class="sc">$</span>likelihood <span class="ot">&lt;-</span> <span class="fu">dbinom</span>(pars<span class="sc">$</span>n_visitors, </span>
<span id="cb277-12"><a href="#cb277-12" aria-hidden="true" tabindex="-1"></a>                          <span class="at">size =</span> n_ads_shown, </span>
<span id="cb277-13"><a href="#cb277-13" aria-hidden="true" tabindex="-1"></a>                          <span class="at">prob =</span> pars<span class="sc">$</span>proportion_clicks)</span>
<span id="cb277-14"><a href="#cb277-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb277-15"><a href="#cb277-15" aria-hidden="true" tabindex="-1"></a><span class="do">### According to Bayes&#39; theorem:</span></span>
<span id="cb277-16"><a href="#cb277-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Combined probability by the rule of probabilities multiplication</span></span>
<span id="cb277-17"><a href="#cb277-17" aria-hidden="true" tabindex="-1"></a>pars<span class="sc">$</span>probability <span class="ot">&lt;-</span> pars<span class="sc">$</span>likelihood <span class="sc">*</span> pars<span class="sc">$</span>prior</span>
<span id="cb277-18"><a href="#cb277-18" aria-hidden="true" tabindex="-1"></a><span class="co"># normalize to the total number to get sum of all probabilities eq 1</span></span>
<span id="cb277-19"><a href="#cb277-19" aria-hidden="true" tabindex="-1"></a>pars<span class="sc">$</span>probability <span class="ot">&lt;-</span> pars<span class="sc">$</span>probability <span class="sc">/</span> <span class="fu">sum</span>(pars<span class="sc">$</span>probability)</span>
<span id="cb277-20"><a href="#cb277-20" aria-hidden="true" tabindex="-1"></a><span class="do">###</span></span>
<span id="cb277-21"><a href="#cb277-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb277-22"><a href="#cb277-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Conditioning on the data for n_visitors == 6  </span></span>
<span id="cb277-23"><a href="#cb277-23" aria-hidden="true" tabindex="-1"></a>pars <span class="ot">&lt;-</span> pars[pars<span class="sc">$</span>n_visitors <span class="sc">==</span> <span class="dv">6</span>, ]</span>
<span id="cb277-24"><a href="#cb277-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb277-25"><a href="#cb277-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalize again to get sum of all probabilities eq 1</span></span>
<span id="cb277-26"><a href="#cb277-26" aria-hidden="true" tabindex="-1"></a>pars<span class="sc">$</span>probability <span class="ot">&lt;-</span> pars<span class="sc">$</span>probability <span class="sc">/</span> <span class="fu">sum</span>(pars<span class="sc">$</span>probability)</span>
<span id="cb277-27"><a href="#cb277-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb277-28"><a href="#cb277-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the posterior pars$probability</span></span>
<span id="cb277-29"><a href="#cb277-29" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pars<span class="sc">$</span>proportion_clicks, pars<span class="sc">$</span>probability, <span class="at">type =</span> <span class="st">&quot;h&quot;</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-92-1.png" width="672" /></p>
<p>We can directly condition and change <code>n_visitors &lt;- 6</code>. In this case we do not
need to subset by <code>pars[pars$n_visitors == 6, ]</code>. Result will be the same.</p>
</div>
<div id="model-of-birth-weights-using-normal-distribution" class="section level2" number="31.4">
<h2 number="31.4"><span class="header-section-number">31.4</span> Model of birth weights using normal distribution</h2>
<p>Let’s assume that the Normal distribution is a decent model of birth weight data.</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="#cb278-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign mu and sigma</span></span>
<span id="cb278-2"><a href="#cb278-2" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">3500</span>   <span class="co"># central value (mean weight)</span></span>
<span id="cb278-3"><a href="#cb278-3" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="dv">600</span>    <span class="co"># deviation</span></span>
<span id="cb278-4"><a href="#cb278-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-5"><a href="#cb278-5" aria-hidden="true" tabindex="-1"></a>weight_dist <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">100000</span>, <span class="at">mean =</span> m, <span class="at">sd =</span> s)</span>
<span id="cb278-6"><a href="#cb278-6" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(weight_dist, <span class="dv">60</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">6000</span>))</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-93-1.png" width="672" /></p>
<p>We calculating the <strong>distribution</strong> using <code>dnorm</code> instead of <strong>simulating</strong> using <code>rnorm</code>.</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="#cb279-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create weight</span></span>
<span id="cb279-2"><a href="#cb279-2" aria-hidden="true" tabindex="-1"></a>weight <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">6000</span>, <span class="at">by =</span> <span class="dv">100</span>)  <span class="co"># 100 g increment</span></span>
<span id="cb279-3"><a href="#cb279-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb279-4"><a href="#cb279-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate likelihood</span></span>
<span id="cb279-5"><a href="#cb279-5" aria-hidden="true" tabindex="-1"></a>likelihood <span class="ot">&lt;-</span> <span class="fu">dnorm</span>(weight, m, s)</span>
<span id="cb279-6"><a href="#cb279-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb279-7"><a href="#cb279-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the distribution of weight</span></span>
<span id="cb279-8"><a href="#cb279-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(weight, likelihood, <span class="at">type =</span> <span class="st">&quot;h&quot;</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-94-1.png" width="672" /></p>
<p>Here is a small data set with the birth weights of six newborn babies in grams.<br />
<code>c(3164, 3362, 4435, 3542, 3578, 4529)</code></p>
<p>Mark: What to do with the data? Should we condition it to get posterior?</p>
</div>
<div id="a-bayesian-model-of-zombie-iq" class="section level2" number="31.5">
<h2 number="31.5"><span class="header-section-number">31.5</span> A Bayesian model of Zombie IQ</h2>
<p>Check video</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="#cb280-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">19</span>, <span class="dv">23</span>, <span class="dv">20</span>, <span class="dv">17</span>, <span class="dv">23</span>)</span>
<span id="cb280-2"><a href="#cb280-2" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">8</span>, <span class="dv">30</span>, <span class="at">by =</span> <span class="fl">0.5</span>)</span>
<span id="cb280-3"><a href="#cb280-3" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="dv">10</span>, <span class="at">by =</span> <span class="fl">0.3</span>)</span>
<span id="cb280-4"><a href="#cb280-4" aria-hidden="true" tabindex="-1"></a>pars <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">mu =</span> mu, <span class="at">sigma =</span> sigma)</span>
<span id="cb280-5"><a href="#cb280-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb280-6"><a href="#cb280-6" aria-hidden="true" tabindex="-1"></a>pars<span class="sc">$</span>mu_prior    <span class="ot">&lt;-</span> <span class="fu">dnorm</span>(pars<span class="sc">$</span>mu,    <span class="at">mean =</span> <span class="dv">18</span>, <span class="at">sd =</span> <span class="dv">5</span>)</span>
<span id="cb280-7"><a href="#cb280-7" aria-hidden="true" tabindex="-1"></a>pars<span class="sc">$</span>sigma_prior <span class="ot">&lt;-</span> <span class="fu">dunif</span>(pars<span class="sc">$</span>sigma, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">10</span>)</span>
<span id="cb280-8"><a href="#cb280-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb280-9"><a href="#cb280-9" aria-hidden="true" tabindex="-1"></a>pars<span class="sc">$</span>prior <span class="ot">&lt;-</span> pars<span class="sc">$</span>mu_prior <span class="sc">*</span> pars<span class="sc">$</span>sigma_prior</span>
<span id="cb280-10"><a href="#cb280-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb280-11"><a href="#cb280-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(pars)) {</span>
<span id="cb280-12"><a href="#cb280-12" aria-hidden="true" tabindex="-1"></a>    likelihoods <span class="ot">&lt;-</span> <span class="fu">dnorm</span>(temp, pars<span class="sc">$</span>mu[i], pars<span class="sc">$</span>sigma[i])</span>
<span id="cb280-13"><a href="#cb280-13" aria-hidden="true" tabindex="-1"></a>    pars<span class="sc">$</span>likelihood[i] <span class="ot">&lt;-</span> <span class="fu">prod</span>(likelihoods)</span>
<span id="cb280-14"><a href="#cb280-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb280-15"><a href="#cb280-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb280-16"><a href="#cb280-16" aria-hidden="true" tabindex="-1"></a>pars<span class="sc">$</span>probability <span class="ot">&lt;-</span> pars<span class="sc">$</span>likelihood <span class="sc">*</span> pars<span class="sc">$</span>prior</span>
<span id="cb280-17"><a href="#cb280-17" aria-hidden="true" tabindex="-1"></a>pars<span class="sc">$</span>probability <span class="ot">&lt;-</span> pars<span class="sc">$</span>probability <span class="sc">/</span> <span class="fu">sum</span>(pars<span class="sc">$</span>probability)</span>
<span id="cb280-18"><a href="#cb280-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb280-19"><a href="#cb280-19" aria-hidden="true" tabindex="-1"></a>sample_indices <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(pars), <span class="at">size =</span> <span class="dv">10000</span>, </span>
<span id="cb280-20"><a href="#cb280-20" aria-hidden="true" tabindex="-1"></a>                         <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> pars<span class="sc">$</span>probability)</span>
<span id="cb280-21"><a href="#cb280-21" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sample_indices)</span></code></pre></div>
<pre><code>## [1] 655 434 839 386 745 471</code></pre>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="#cb282-1" aria-hidden="true" tabindex="-1"></a>pars_sample <span class="ot">&lt;-</span> pars[sample_indices, <span class="fu">c</span>(<span class="st">&quot;mu&quot;</span>, <span class="st">&quot;sigma&quot;</span>)]</span>
<span id="cb282-2"><a href="#cb282-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pars_sample)</span></code></pre></div>
<pre><code>##       mu sigma
## 655 20.0   4.3
## 434 22.0   2.8
## 839 22.0   5.5
## 386 20.5   2.5
## 745 20.0   4.9
## 471 18.0   3.1</code></pre>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="#cb284-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(pars_sample<span class="sc">$</span>mu, <span class="dv">30</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/bi-432-1.png" width="672" /></p>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="#cb285-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(pars_sample<span class="sc">$</span>mu, <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.95</span>))</span></code></pre></div>
<pre><code>##   5%  95% 
## 17.5 22.5</code></pre>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="#cb287-1" aria-hidden="true" tabindex="-1"></a>pred_temp <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>, <span class="at">mean =</span> pars_sample<span class="sc">$</span>mu, <span class="at">sd =</span> pars_sample<span class="sc">$</span>sigma)</span>
<span id="cb287-2"><a href="#cb287-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(pred_temp, <span class="dv">30</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/bi-432-2.png" width="672" /></p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="#cb288-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Probability of 18C</span></span>
<span id="cb288-2"><a href="#cb288-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(pred_temp <span class="sc">&gt;=</span> <span class="dv">18</span>) <span class="sc">/</span> <span class="fu">length</span>(pred_temp)</span></code></pre></div>
<pre><code>## [1] 0.7385</code></pre>
<p>for the model of temperature but use zombies IQs instead.
Define model:<br />
<span class="math inline">\(\mu = Normal(mean:18, sd:5)\)</span>
<span class="math inline">\(\sigma = Uniform(min:0, max:10)\)</span>
<span class="math inline">\(temp = 19,23,...\)</span>
How much we can learn about the mean zombie IQ from this data.
We need to calculate the probability of each parameter combination in pars.<br />
Use Bayes Theorem to calculate these probabilities and assign them to
<code>pars$probability</code> to complete the model.</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="#cb290-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The IQ of a bunch of zombies</span></span>
<span id="cb290-2"><a href="#cb290-2" aria-hidden="true" tabindex="-1"></a>iq <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">55</span>, <span class="dv">44</span>, <span class="dv">34</span>, <span class="dv">18</span>, <span class="dv">51</span>, <span class="dv">40</span>, <span class="dv">40</span>, <span class="dv">49</span>, <span class="dv">48</span>, <span class="dv">46</span>)</span>
<span id="cb290-3"><a href="#cb290-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb290-4"><a href="#cb290-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Defining the parameter grid</span></span>
<span id="cb290-5"><a href="#cb290-5" aria-hidden="true" tabindex="-1"></a>pars <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">mu =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">150</span>, <span class="at">length.out =</span> <span class="dv">100</span>), </span>
<span id="cb290-6"><a href="#cb290-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">sigma =</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="dv">50</span>, <span class="at">length.out =</span> <span class="dv">100</span>))</span>
<span id="cb290-7"><a href="#cb290-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb290-8"><a href="#cb290-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Defining and calculating the prior density for each parameter combination</span></span>
<span id="cb290-9"><a href="#cb290-9" aria-hidden="true" tabindex="-1"></a>pars<span class="sc">$</span>mu_prior <span class="ot">&lt;-</span> <span class="fu">dnorm</span>(pars<span class="sc">$</span>mu, <span class="at">mean =</span> <span class="dv">100</span>, <span class="at">sd =</span> <span class="dv">100</span>)</span>
<span id="cb290-10"><a href="#cb290-10" aria-hidden="true" tabindex="-1"></a>pars<span class="sc">$</span>sigma_prior <span class="ot">&lt;-</span> <span class="fu">dunif</span>(pars<span class="sc">$</span>sigma, <span class="at">min =</span> <span class="fl">0.1</span>, <span class="at">max =</span> <span class="dv">50</span>)</span>
<span id="cb290-11"><a href="#cb290-11" aria-hidden="true" tabindex="-1"></a>pars<span class="sc">$</span>prior <span class="ot">&lt;-</span> pars<span class="sc">$</span>mu_prior <span class="sc">*</span> pars<span class="sc">$</span>sigma_prior</span>
<span id="cb290-12"><a href="#cb290-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb290-13"><a href="#cb290-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the likelihood for each parameter combination</span></span>
<span id="cb290-14"><a href="#cb290-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(pars)) {</span>
<span id="cb290-15"><a href="#cb290-15" aria-hidden="true" tabindex="-1"></a>  likelihoods <span class="ot">&lt;-</span> <span class="fu">dnorm</span>(iq, pars<span class="sc">$</span>mu[i], pars<span class="sc">$</span>sigma[i])</span>
<span id="cb290-16"><a href="#cb290-16" aria-hidden="true" tabindex="-1"></a>  pars<span class="sc">$</span>likelihood[i] <span class="ot">&lt;-</span> <span class="fu">prod</span>(likelihoods)</span>
<span id="cb290-17"><a href="#cb290-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb290-18"><a href="#cb290-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb290-19"><a href="#cb290-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the probability of each parameter combination</span></span>
<span id="cb290-20"><a href="#cb290-20" aria-hidden="true" tabindex="-1"></a>pars<span class="sc">$</span>probability <span class="ot">&lt;-</span> pars<span class="sc">$</span>likelihood <span class="sc">*</span> pars<span class="sc">$</span>prior <span class="sc">/</span> <span class="fu">sum</span>(pars<span class="sc">$</span>likelihood <span class="sc">*</span> pars<span class="sc">$</span>prior)</span></code></pre></div>
<p>Calculate new parameters.</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="#cb291-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pars)</span></code></pre></div>
<pre><code>##         mu sigma    mu_prior sigma_prior        prior likelihood probability
## 1 0.000000   0.1 0.002419707  0.02004008 4.849113e-05          0           0
## 2 1.515152   0.1 0.002456367  0.02004008 4.922578e-05          0           0
## 3 3.030303   0.1 0.002493009  0.02004008 4.996010e-05          0           0
## 4 4.545455   0.1 0.002529617  0.02004008 5.069373e-05          0           0
## 5 6.060606   0.1 0.002566174  0.02004008 5.142633e-05          0           0
## 6 7.575758   0.1 0.002602661  0.02004008 5.215754e-05          0           0</code></pre>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="#cb293-1" aria-hidden="true" tabindex="-1"></a>sample_indices <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(pars), <span class="at">size =</span> <span class="dv">10000</span>,</span>
<span id="cb293-2"><a href="#cb293-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> pars<span class="sc">$</span>probability)</span>
<span id="cb293-3"><a href="#cb293-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sample_indices)</span></code></pre></div>
<pre><code>## [1] 3434 2627 5124 2934 2427 1528</code></pre>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="#cb295-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample from pars to calculate some new measures</span></span>
<span id="cb295-2"><a href="#cb295-2" aria-hidden="true" tabindex="-1"></a>pars_sample <span class="ot">&lt;-</span> pars[sample_indices, <span class="fu">c</span>(<span class="st">&quot;mu&quot;</span>, <span class="st">&quot;sigma&quot;</span>)]</span>
<span id="cb295-3"><a href="#cb295-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb295-4"><a href="#cb295-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate quantiles</span></span>
<span id="cb295-5"><a href="#cb295-5" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(pars_sample<span class="sc">$</span>mu, <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span>))</span></code></pre></div>
<pre><code>##     2.5%      50%    97.5% 
## 34.84848 42.42424 51.51515</code></pre>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="#cb297-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pars_sample)</span></code></pre></div>
<pre><code>##            mu     sigma
## 3434 50.00000 17.237374
## 2627 39.39394 13.205051
## 5124 34.84848 25.806061
## 2934 50.00000 14.717172
## 2427 39.39394 12.196970
## 1528 40.90909  7.660606</code></pre>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="#cb299-1" aria-hidden="true" tabindex="-1"></a>pred_iq <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>, </span>
<span id="cb299-2"><a href="#cb299-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">mean =</span> pars_sample<span class="sc">$</span>mu, </span>
<span id="cb299-3"><a href="#cb299-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">sd =</span> pars_sample<span class="sc">$</span>sigma)</span>
<span id="cb299-4"><a href="#cb299-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb299-5"><a href="#cb299-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the probability that zombi has IQ &gt; 60</span></span>
<span id="cb299-6"><a href="#cb299-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(pred_iq <span class="sc">&gt;=</span> <span class="dv">60</span>) <span class="sc">/</span> <span class="fu">length</span>(pred_iq)</span></code></pre></div>
<pre><code>## [1] 0.0867</code></pre>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="#cb301-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb301-2"><a href="#cb301-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize the mean IQ</span></span>
<span id="cb301-3"><a href="#cb301-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(pars_sample<span class="sc">$</span>mu, <span class="dv">100</span>)</span>
<span id="cb301-4"><a href="#cb301-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize pred_iq</span></span>
<span id="cb301-5"><a href="#cb301-5" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(pred_iq)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-95-1.png" width="672" /></p>
</div>
<div id="the-best-models" class="section level2" number="31.6">
<h2 number="31.6"><span class="header-section-number">31.6</span> The BEST models</h2>
<p>The t-test is a classical statistical procedure used to compare the
means of two data sets.</p>
<p>In 2013 John Kruschke developed a souped-up Bayesian version of the
t-test he named <strong>BEST</strong> (standing for <strong>B</strong>ayesian <strong>E</strong>stimation <strong>S</strong>upersedes
the <strong>t</strong>-test).</p>
<p>We would like to compair IQ of two groups of 10 patiens on different diets (a and b).</p>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="#cb302-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The IQ of patients.</span></span>
<span id="cb302-2"><a href="#cb302-2" aria-hidden="true" tabindex="-1"></a>iq_a <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">55</span>, <span class="dv">44</span>, <span class="dv">34</span>, <span class="dv">18</span>, <span class="dv">51</span>, <span class="dv">40</span>, <span class="dv">40</span>, <span class="dv">49</span>, <span class="dv">48</span>, <span class="dv">46</span>)</span>
<span id="cb302-3"><a href="#cb302-3" aria-hidden="true" tabindex="-1"></a>iq_b <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">44</span>, <span class="dv">52</span>, <span class="dv">42</span>, <span class="dv">66</span>, <span class="dv">53</span>, <span class="dv">42</span>, <span class="dv">55</span>, <span class="dv">57</span>, <span class="dv">56</span>, <span class="dv">51</span>)</span>
<span id="cb302-4"><a href="#cb302-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-5"><a href="#cb302-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the mean difference in IQ between the two groups</span></span>
<span id="cb302-6"><a href="#cb302-6" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(iq_b) <span class="sc">-</span> <span class="fu">mean</span>(iq_a)</span></code></pre></div>
<pre><code>## [1] 9.3</code></pre>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="#cb304-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(BEST)</span>
<span id="cb304-2"><a href="#cb304-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-3"><a href="#cb304-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the BEST model to the data from both groups</span></span>
<span id="cb304-4"><a href="#cb304-4" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(BEST)</span>
<span id="cb304-5"><a href="#cb304-5" aria-hidden="true" tabindex="-1"></a>best_posterior <span class="ot">&lt;-</span> BEST<span class="sc">::</span><span class="fu">BESTmcmc</span>(iq_b, iq_a)</span></code></pre></div>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="#cb305-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the model result</span></span>
<span id="cb305-2"><a href="#cb305-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(best_posterior)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-98-1.png" width="672" /></p>
<p>The Bayesian model behind BEST assumes that the generative model for
the data is a <strong>t-distribution</strong>; a more flexible distribution than the normal
distribution as it assumes that data points might be outliers to some degree.
This makes BEST’s estimate of the mean difference robust to outliers in the data.</p>
<p><strong>Sources</strong></p>
<p><a href="https://learn.datacamp.com/courses/fundamentals-of-bayesian-data-analysis-in-r">Fundamentals of Bayesian Data Analysis in R on Datacamp</a></p>
<!--chapter:end:42_bayesian_inference.Rmd-->
</div>
</div>
<div id="naive-bayes-classifiers" class="section level1" number="32">
<h1 number="32"><span class="header-section-number">32</span> Naive Bayes classifiers</h1>
<p><strong>Naive Bayes classifiers</strong> are a family of simple “probabilistic classifiers”
based on applying Bayes’ theorem with strong (naïve) independence assumptions
between the features.</p>
<p>They are among the simplest Bayesian network models, but coupled with kernel
density estimation, they can achieve higher accuracy levels.</p>
<p>Naïve Bayes classifiers are highly scalable, requiring a number of parameters
linear in the number of variables (features/predictors) in a learning problem.
Maximum-likelihood training can be done by evaluating a closed-form expression,
which takes linear time, rather than by expensive iterative approximation as
used for many other types of classifiers.</p>
<p><span class="math inline">\(P(c|x) = \frac{P(x|c)(P(c))}{P(x)}\)</span>, where<br />
<span class="math inline">\(P(c|x)\)</span> - posteriour probability<br />
<span class="math inline">\(P(x|c)\)</span> - Likelihood<br />
<span class="math inline">\(P(c)\)</span> - Class Prior Probbility<br />
<span class="math inline">\(P(x)\)</span> - Predictor Prior Probability</p>
<!--chapter:end:43_naive_bayes.Rmd-->
</div>
<div id="markov-chain-monte-carlo-mcmc" class="section level1" number="33">
<h1 number="33"><span class="header-section-number">33</span> Markov Chain Monte Carlo (MCMC)</h1>
<p>We have a seq of conditional probabilities:<br />
We know conditional probabilities for the weather tomorrow (t+1) depending of the weather today (t). R for raily day and S for sunny day.<br />
<span class="math inline">\(P(S_{t+1} | R_t) = 0.5\)</span><br />
<span class="math inline">\(P(R_{t+1} | R_t) = 0.5\)</span><br />
<span class="math inline">\(P(R_{t+1} | S_t) = 0.1\)</span><br />
<span class="math inline">\(P(S_{t+1} | S_t) = 0.9\)</span></p>
<p>What is the probability of sunny (S) or rainy (R) day?<br />
Simulate data using conditional probabilities:<br />
Markov Chain 1:<br />
S-S-R-R-S-S-S-S-R-R-R-S-S-S</p>
<p>Markov Chain 2:<br />
R-S-S-S-S-S-R-S-S-S-S-S-R-R</p>
<p>After simulation we calculate probabilities of sunny (S) and rainy (R) days:<br />
P(S) = 0.833
P(R) = 0.167</p>
<!--chapter:end:44_monte_carlo.Rmd-->
</div>
<div id="simple-markov-process" class="section level1" number="34">
<h1 number="34"><span class="header-section-number">34</span> Simple Markov process</h1>
<p>Here, we will consider a simple example of Markov process with implementation in R.<br />
The following example is taken from <a href="http://www.bodowinter.com">Bodo Winter website</a>.</p>
<p>A <strong>Markov process</strong> is characterized by (1) <strong>a finite set of states</strong> and (2) <strong>fixed transition probabilities between the states</strong>.</p>
<p>Let’s consider an example. Assume you have a classroom, with students who could be either in the state <strong>alert</strong> or in the state <strong>bored</strong>. And then, at any given time point, there’s a certain probability of an alert student becoming bored (say 0.2), and there’s a probability of a bored student becoming alert (say 0.25).</p>
<p>Let’s say there are 20 alert and 80 bored students in a particular class. This is your initial condition at time point <span class="math inline">\(t\)</span>. Given the transition probabilities above, what’s the number of alert and bored students at the next point in time, <span class="math inline">\(t+1\)</span>?<br />
Multiply 20 by 0.2 (=4) and these will be the alert students that turn bored.<br />
And then multiply 80 by 0.25 (=20) and these will be the bored students that turn alert.<br />
So, at <span class="math inline">\(t+1\)</span>, there’s going to be 20-4+20 alert students. And there’s going to be 80+4-20 bored students. Before, 80% of the students were bored and now, only 64% of the students are bored. Conversely, 36% are alert.</p>
<p>A handy way of representing this Markov process is by defining a transition probability matrix:</p>
<table>
<thead>
<tr class="header">
<th></th>
<th>A</th>
<th>B</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A<span class="math inline">\(_{t+1}\)</span></td>
<td>0.8</td>
<td>0.25</td>
</tr>
<tr class="even">
<td>B<span class="math inline">\(_{t+1}\)</span></td>
<td>0.2</td>
<td>0.75</td>
</tr>
</tbody>
</table>
<p>What this matrix says is: A proportion of 0.8 of the people who are in state A (alert) will also be at state A at time point <span class="math inline">\(t+1\)</span>. And, a proportion of 0.25 of the people who are in state B (bored) will switch to alert at t+1. This is what the first row says. The next row is simply one minus the probabilities of the first row, because probabilities (or proportions) have to add up to 1. Now think about multiplying this matrix with the initial proportions of alert and bored students that we had above. 0.8 are bored and 0.2 are alert. In linear algebra this would look the following way:</p>
<div>
<p><span class="math display">\[
\begin{bmatrix}
 0.8 &amp; 0.25 \\
 0.2 &amp; 0.75
\end{bmatrix}\times\begin{bmatrix}
 0.2 \\
 0.8
\end{bmatrix} = \begin{bmatrix}
 0.8\times0.2 + 0.25\times0.8 \\
 0.2\times0.2 + 0.75\times0.8
\end{bmatrix} = \begin{bmatrix}
0.36 \\
0.64
\end{bmatrix}
\]</span></p>
</div>
<p>The results of these calculations are exactly the proportions that we saw above: 36% alert student and 64% bored students.</p>
<p>Now, you might ask yourself: What happens if this process continues? What happens at <span class="math inline">\(t+2\)</span>, <span class="math inline">\(t+3\)</span> etc.? Will it be the case that at one point there are no bored students any more? Let’s simulate this in R and find out! Let’s call this <strong>tpm</strong> for <strong>transition probability matrix</strong>:</p>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="#cb306-1" aria-hidden="true" tabindex="-1"></a>tpm <span class="ot">=</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="fl">0.8</span>,<span class="fl">0.25</span>, <span class="fl">0.2</span>,<span class="fl">0.75</span>), <span class="at">nrow=</span><span class="dv">2</span>, <span class="at">byrow=</span><span class="cn">TRUE</span>)</span>
<span id="cb306-2"><a href="#cb306-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(tpm) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;A&#39;</span>,<span class="st">&#39;B&#39;</span>)</span>
<span id="cb306-3"><a href="#cb306-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(tpm) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;At+1&#39;</span>, <span class="st">&#39;Bt+1&#39;</span>)</span>
<span id="cb306-4"><a href="#cb306-4" aria-hidden="true" tabindex="-1"></a>tpm</span></code></pre></div>
<pre><code>##        A    B
## At+1 0.8 0.25
## Bt+1 0.2 0.75</code></pre>
<p>Again this matrix shows that 0.8 students who were in state A at time point t will still be in state A at <span class="math inline">\(t+1\)</span>. And 0.25 students who were in state B at time point t will be in state A at <span class="math inline">\(t+1\)</span>. The second row has a similar interpretation for alert and bored students becoming bored at <span class="math inline">\(t+1\)</span>. Remember that Markov processes assume fixed transition probabilities. This means that in the simulation that we’ll be doing, we leave the transition probability matrix unchanged. However, we will define a vector of the actual proportions – and these are allowed to change. In time, we expect more and more students to become alert, because the transition probability from B to A (which, to remind you, was 0.25) is higher than from A to B (which was 0.2).</p>
<p>Let’s start our simulation by setting the initial condition as 0.1 students are alert and 0.9 students are bored and define a matrix called <strong>sm</strong> (short for <strong>student matrix</strong>):</p>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="#cb308-1" aria-hidden="true" tabindex="-1"></a>sm <span class="ot">=</span> <span class="fu">as.matrix</span>(<span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>))</span>
<span id="cb308-2"><a href="#cb308-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(sm)<span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;A&#39;</span>, <span class="st">&#39;B&#39;</span>)</span>
<span id="cb308-3"><a href="#cb308-3" aria-hidden="true" tabindex="-1"></a>sm</span></code></pre></div>
<pre><code>##   [,1]
## A  0.1
## B  0.9</code></pre>
<p>Now let’s repeat by looping:</p>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="#cb310-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>){</span>
<span id="cb310-2"><a href="#cb310-2" aria-hidden="true" tabindex="-1"></a>    sm <span class="ot">=</span> tpm <span class="sc">%*%</span> sm</span>
<span id="cb310-3"><a href="#cb310-3" aria-hidden="true" tabindex="-1"></a>    }</span></code></pre></div>
<p>Here, we’re looping 10 times and on each iteration, we multiply the matrix <strong>tpm</strong> with the student matrix <strong>sm</strong>. We take this result and store it in <strong>sm</strong>. This means that at the next iteration, our fixed <strong>transition probability matrix</strong> will be multiplied by a different student matrix, allowing for the proportions to slowly change over time.<br />
R operator ’%*%’ is used for matrix multiplication</p>
<p>Outcome of our ten loop iterations:</p>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="#cb311-1" aria-hidden="true" tabindex="-1"></a>sm</span></code></pre></div>
<pre><code>##           [,1]
## At+1 0.5544017
## Bt+1 0.4455983</code></pre>
<p>So, after 10 iterations of the Markov process, we now have about 55% alert students and 45% bored ones. What is interesting to me is that even though 80% of the people who are alert at one time point remain alert at the next time point, the process only converged on 55% alert and 45% bored after 10 iterations.</p>
<p>Let’s reset our initial condition to (0.1 alert and 0.9 bored students) and run a thousand iterations.</p>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="#cb313-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>){</span>
<span id="cb313-2"><a href="#cb313-2" aria-hidden="true" tabindex="-1"></a>    sm <span class="ot">=</span> tpm <span class="sc">%*%</span> sm</span>
<span id="cb313-3"><a href="#cb313-3" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb313-4"><a href="#cb313-4" aria-hidden="true" tabindex="-1"></a>sm</span></code></pre></div>
<pre><code>##           [,1]
## At+1 0.5555556
## Bt+1 0.4444444</code></pre>
<p>A 1000 iterations, and we seem to be zoning in onto ~55% and ~44%. This phenomenon is called <strong>Markov convergence</strong>. You could run even more iterations, and your outcome would get closer and closer to 0.5555 (to infinity). So, the model converges on an equilibrium. However, this is not a fixed equilibrium. It’s not the case that the Markov process comes to a hold or that nobody changes states between alertness and boredness any more. The equilibrium that we’re dealing with here is a statistical equilibrium, where the proportions of alert and bored students remain the same. but there still is constant change (at each time step, 0.2 alert students become bored and 0.25 bored students become alert). Markov models always converge to a statistical equilibrium if the conditions (1) and (2) above are met, and if you can get from any state within your Markov model to any other state (in the case of just two states, that clearly is the case). What’s so cool about this is that it is, at first sight, fairly counterintuitive.</p>
<p>At least when I thought about the transition probabilities for the first time, I somehow expected all students to become alert but as we saw, that’s not the case. Moreover, this process is not sensitive to initial conditions. That means that when you start with any proportion of alert or bored students (even extreme ones such as 0.0001 alert students), the process will reach the statistical equilibrium – albeit sometimes a little faster or slower. You can play around with different values for the <strong>sm</strong> object to explore this property of Markov convergence. Another interesting thing is that the process is impervious to intervention: Say, you introduced something that made more students alert – the Markov model would quickly get back to equilibrium. So Markov processes are essentially ahistorical processes: history doesn’t matter. Even with extreme initial conditions or extreme interventions, the process quickly converges to the equilibrium defined by the transition probabilities. The only way to persistently change the system is to change the transition probabilities. Finally, what I find so cool about Markov processes is their computational simplicity.</p>
<div id="sources-2" class="section level3" number="34.0.1">
<h3 number="34.0.1"><span class="header-section-number">34.0.1</span> Sources</h3>
<p><a href="http://www.bodowinter.com">Bodo Winter website</a></p>
<!--chapter:end:45_simple_markov_process.Rmd-->
</div>
</div>
<div id="tree-based-models" class="section level1" number="35">
<h1 number="35"><span class="header-section-number">35</span> Tree-based models</h1>
<p>Classification and regression trees (CART) are a non-parametric decision tree learning technique that produces either classification or regression trees, depending on whether the dependent variable is categorical or numeric, respectively.</p>
<p>CART is both a generic term to describe tree algorithms and also a specific name for Breiman’s original algorithm for constructing classification and regression trees.</p>
<ul>
<li><strong>Decision Tree</strong>: A tree-shaped graph or model of decisions used to determine a course of action or show a statistical probability.<br />
</li>
<li><strong>Classification Tree</strong>: A decision tree that performs classification (predicts a categorical response).<br />
</li>
<li><strong>Regression Tree</strong>: A decision tree that performs regression (predicts a numeric response).<br />
</li>
<li><strong>Split Point</strong>: A split point occurs at each node of the tree where a decision is made (e.g. x &gt; 7 vs. x ≤ 7).<br />
</li>
<li><strong>Terminal Node</strong>: A terminal node is a node which has no descendants (child nodes). Also called a “leaf node.”</li>
</ul>
<p><strong>Properties of Trees</strong><br />
* Can handle huge datasets.<br />
* Can handle mixed predictors implicitly – numeric and categorical.<br />
* Easily ignore redundant variables.<br />
* Handle missing data elegantly through surrogate splits.<br />
* Small trees are easy to interpret.<br />
* Large trees are hard to interpret.<br />
* Prediction performance is often poor (high variance).</p>
<p><strong>Tree Algorithms</strong><br />
There are a handful of different tree algorithms in addition to Breiman’s original CART algorithm. Namely, ID3, C4.5 and C5.0, all created by Ross Quinlan. C5.0 is an improvement over C4.5, however, the C4.5 algorithm is still quite popular since the multi-threaded version of C5.0 is proprietary (although the single threaded is released as GPL).</p>
<p><strong>CART vs C4.5</strong><br />
Here are some of the differences between CART and C4.5:</p>
<ul>
<li>Tests in CART are always binary, but C4.5 allows two or more outcomes.<br />
</li>
<li>CART uses the Gini diversity index to rank tests, whereas C4.5 uses information-based criteria.<br />
</li>
<li>CART prunes trees using a cost-complexity model whose parameters are estimated by cross-validation; C4.5 uses a single-pass algorithm derived from binomial confidence limits.<br />
</li>
<li>With respect to missing data, CART looks for surrogate tests that approximate the outcomes when the tested attribute has an unknown value, but C4.5 apportions the case probabilistically among the outcomes.</li>
</ul>
<p>Decision trees are formed by a collection of rules based on variables in the modeling data set:</p>
<ol style="list-style-type: decimal">
<li>Rules based on variables’ values are selected to get the best split to differentiate observations based on the dependent variable.<br />
</li>
<li>Once a rule is selected and splits a node into two, the same process is applied to each “child” node (i.e. it is a recursive procedure).<br />
</li>
<li>Splitting stops when CART detects no further gain can be made, or some pre-set stopping rules are met. (Alternatively, the data are split as much as possible and then the tree is later pruned.)</li>
</ol>
<p>Each branch of the tree ends in a terminal node. Each observation falls into one and exactly one terminal node, and each terminal node is uniquely defined by a set of rules.</p>
<div id="classification-tree-example" class="section level2" number="35.1">
<h2 number="35.1"><span class="header-section-number">35.1</span> Classification Tree example</h2>
<p>Let’s use the data frame kyphosis to predict a type of deformation (kyphosis) after surgery, from age in months (Age), number of vertebrae involved (Number), and the highest vertebrae operated on (Start).</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="#cb315-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Classification Tree with rpart</span></span>
<span id="cb315-2"><a href="#cb315-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart)</span>
<span id="cb315-3"><a href="#cb315-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb315-4"><a href="#cb315-4" aria-hidden="true" tabindex="-1"></a><span class="co"># grow tree</span></span>
<span id="cb315-5"><a href="#cb315-5" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">rpart</span>(Kyphosis <span class="sc">~</span> Age <span class="sc">+</span> Number <span class="sc">+</span> Start,</span>
<span id="cb315-6"><a href="#cb315-6" aria-hidden="true" tabindex="-1"></a>   <span class="at">method=</span><span class="st">&quot;class&quot;</span>, <span class="at">data=</span>kyphosis)</span>
<span id="cb315-7"><a href="#cb315-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb315-8"><a href="#cb315-8" aria-hidden="true" tabindex="-1"></a><span class="fu">printcp</span>(fit) <span class="co"># display the results</span></span></code></pre></div>
<pre><code>## 
## Classification tree:
## rpart(formula = Kyphosis ~ Age + Number + Start, data = kyphosis, 
##     method = &quot;class&quot;)
## 
## Variables actually used in tree construction:
## [1] Age   Start
## 
## Root node error: 17/81 = 0.20988
## 
## n= 81 
## 
##         CP nsplit rel error xerror    xstd
## 1 0.176471      0   1.00000 1.0000 0.21559
## 2 0.019608      1   0.82353 1.3529 0.23872
## 3 0.010000      4   0.76471 1.3529 0.23872</code></pre>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="#cb317-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotcp</span>(fit) <span class="co"># visualize cross-validation results</span></span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-104-1.png" width="672" /></p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="#cb318-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit) <span class="co"># detailed summary of splits</span></span></code></pre></div>
<pre><code>## Call:
## rpart(formula = Kyphosis ~ Age + Number + Start, data = kyphosis, 
##     method = &quot;class&quot;)
##   n= 81 
## 
##           CP nsplit rel error   xerror      xstd
## 1 0.17647059      0 1.0000000 1.000000 0.2155872
## 2 0.01960784      1 0.8235294 1.352941 0.2387187
## 3 0.01000000      4 0.7647059 1.352941 0.2387187
## 
## Variable importance
##  Start    Age Number 
##     64     24     12 
## 
## Node number 1: 81 observations,    complexity param=0.1764706
##   predicted class=absent   expected loss=0.2098765  P(node) =1
##     class counts:    64    17
##    probabilities: 0.790 0.210 
##   left son=2 (62 obs) right son=3 (19 obs)
##   Primary splits:
##       Start  &lt; 8.5  to the right, improve=6.762330, (0 missing)
##       Number &lt; 5.5  to the left,  improve=2.866795, (0 missing)
##       Age    &lt; 39.5 to the left,  improve=2.250212, (0 missing)
##   Surrogate splits:
##       Number &lt; 6.5  to the left,  agree=0.802, adj=0.158, (0 split)
## 
## Node number 2: 62 observations,    complexity param=0.01960784
##   predicted class=absent   expected loss=0.09677419  P(node) =0.7654321
##     class counts:    56     6
##    probabilities: 0.903 0.097 
##   left son=4 (29 obs) right son=5 (33 obs)
##   Primary splits:
##       Start  &lt; 14.5 to the right, improve=1.0205280, (0 missing)
##       Age    &lt; 55   to the left,  improve=0.6848635, (0 missing)
##       Number &lt; 4.5  to the left,  improve=0.2975332, (0 missing)
##   Surrogate splits:
##       Number &lt; 3.5  to the left,  agree=0.645, adj=0.241, (0 split)
##       Age    &lt; 16   to the left,  agree=0.597, adj=0.138, (0 split)
## 
## Node number 3: 19 observations
##   predicted class=present  expected loss=0.4210526  P(node) =0.2345679
##     class counts:     8    11
##    probabilities: 0.421 0.579 
## 
## Node number 4: 29 observations
##   predicted class=absent   expected loss=0  P(node) =0.3580247
##     class counts:    29     0
##    probabilities: 1.000 0.000 
## 
## Node number 5: 33 observations,    complexity param=0.01960784
##   predicted class=absent   expected loss=0.1818182  P(node) =0.4074074
##     class counts:    27     6
##    probabilities: 0.818 0.182 
##   left son=10 (12 obs) right son=11 (21 obs)
##   Primary splits:
##       Age    &lt; 55   to the left,  improve=1.2467530, (0 missing)
##       Start  &lt; 12.5 to the right, improve=0.2887701, (0 missing)
##       Number &lt; 3.5  to the right, improve=0.1753247, (0 missing)
##   Surrogate splits:
##       Start  &lt; 9.5  to the left,  agree=0.758, adj=0.333, (0 split)
##       Number &lt; 5.5  to the right, agree=0.697, adj=0.167, (0 split)
## 
## Node number 10: 12 observations
##   predicted class=absent   expected loss=0  P(node) =0.1481481
##     class counts:    12     0
##    probabilities: 1.000 0.000 
## 
## Node number 11: 21 observations,    complexity param=0.01960784
##   predicted class=absent   expected loss=0.2857143  P(node) =0.2592593
##     class counts:    15     6
##    probabilities: 0.714 0.286 
##   left son=22 (14 obs) right son=23 (7 obs)
##   Primary splits:
##       Age    &lt; 111  to the right, improve=1.71428600, (0 missing)
##       Start  &lt; 12.5 to the right, improve=0.79365080, (0 missing)
##       Number &lt; 3.5  to the right, improve=0.07142857, (0 missing)
## 
## Node number 22: 14 observations
##   predicted class=absent   expected loss=0.1428571  P(node) =0.1728395
##     class counts:    12     2
##    probabilities: 0.857 0.143 
## 
## Node number 23: 7 observations
##   predicted class=present  expected loss=0.4285714  P(node) =0.08641975
##     class counts:     3     4
##    probabilities: 0.429 0.571</code></pre>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="#cb320-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot tree</span></span>
<span id="cb320-2"><a href="#cb320-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit, <span class="at">uniform=</span><span class="cn">TRUE</span>,</span>
<span id="cb320-3"><a href="#cb320-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">main=</span><span class="st">&quot;Classification Tree for Kyphosis&quot;</span>)</span>
<span id="cb320-4"><a href="#cb320-4" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(fit, <span class="at">use.n=</span><span class="cn">TRUE</span>, <span class="at">all=</span><span class="cn">TRUE</span>, <span class="at">cex=</span>.<span class="dv">8</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-104-2.png" width="672" /></p>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb321-1"><a href="#cb321-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create attractive postscript plot of tree</span></span>
<span id="cb321-2"><a href="#cb321-2" aria-hidden="true" tabindex="-1"></a><span class="fu">post</span>(fit, <span class="at">title =</span> <span class="st">&quot;Classification Tree for Kyphosis&quot;</span>)</span>
<span id="cb321-3"><a href="#cb321-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-4"><a href="#cb321-4" aria-hidden="true" tabindex="-1"></a><span class="co"># prune the tree</span></span>
<span id="cb321-5"><a href="#cb321-5" aria-hidden="true" tabindex="-1"></a>pfit<span class="ot">&lt;-</span> <span class="fu">prune</span>(fit, <span class="at">cp=</span>fit<span class="sc">$</span>cptable[<span class="fu">which.min</span>(fit<span class="sc">$</span>cptable[,<span class="st">&quot;xerror&quot;</span>]),<span class="st">&quot;CP&quot;</span>])</span>
<span id="cb321-6"><a href="#cb321-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-7"><a href="#cb321-7" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the pruned tree</span></span>
<span id="cb321-8"><a href="#cb321-8" aria-hidden="true" tabindex="-1"></a><span class="co">#FIXME: pfit is not a tree just a root error</span></span>
<span id="cb321-9"><a href="#cb321-9" aria-hidden="true" tabindex="-1"></a><span class="co">#plot(pfit, uniform=TRUE,</span></span>
<span id="cb321-10"><a href="#cb321-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   main=&quot;Pruned Classification Tree for Kyphosis&quot;)</span></span>
<span id="cb321-11"><a href="#cb321-11" aria-hidden="true" tabindex="-1"></a><span class="co">#text(pfit, use.n=TRUE, all=TRUE, cex=.8)</span></span>
<span id="cb321-12"><a href="#cb321-12" aria-hidden="true" tabindex="-1"></a><span class="co">#post(pfit, file = &quot;c:/ptree.ps&quot;,</span></span>
<span id="cb321-13"><a href="#cb321-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   title = &quot;Pruned Classification Tree for Kyphosis&quot;)</span></span></code></pre></div>
</div>
<div id="regression-tree-example" class="section level2" number="35.2">
<h2 number="35.2"><span class="header-section-number">35.2</span> Regression Tree example</h2>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="#cb322-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Regression Tree Example</span></span>
<span id="cb322-2"><a href="#cb322-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart)</span>
<span id="cb322-3"><a href="#cb322-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb322-4"><a href="#cb322-4" aria-hidden="true" tabindex="-1"></a><span class="co"># grow tree</span></span>
<span id="cb322-5"><a href="#cb322-5" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">rpart</span>(Mileage<span class="sc">~</span>Price <span class="sc">+</span> Country <span class="sc">+</span> Reliability <span class="sc">+</span> Type,</span>
<span id="cb322-6"><a href="#cb322-6" aria-hidden="true" tabindex="-1"></a>   <span class="at">method=</span><span class="st">&quot;anova&quot;</span>, <span class="at">data=</span>cu.summary)</span>
<span id="cb322-7"><a href="#cb322-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb322-8"><a href="#cb322-8" aria-hidden="true" tabindex="-1"></a><span class="fu">printcp</span>(fit) <span class="co"># display the results</span></span></code></pre></div>
<pre><code>## 
## Regression tree:
## rpart(formula = Mileage ~ Price + Country + Reliability + Type, 
##     data = cu.summary, method = &quot;anova&quot;)
## 
## Variables actually used in tree construction:
## [1] Price Type 
## 
## Root node error: 1354.6/60 = 22.576
## 
## n=60 (57 observations deleted due to missingness)
## 
##         CP nsplit rel error  xerror     xstd
## 1 0.622885      0   1.00000 1.06766 0.183445
## 2 0.132061      1   0.37711 0.55189 0.106967
## 3 0.025441      2   0.24505 0.38624 0.085277
## 4 0.011604      3   0.21961 0.38576 0.079206
## 5 0.010000      4   0.20801 0.42680 0.084753</code></pre>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="#cb324-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotcp</span>(fit) <span class="co"># visualize cross-validation results</span></span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-105-1.png" width="672" /></p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="#cb325-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit) <span class="co"># detailed summary of splits</span></span></code></pre></div>
<pre><code>## Call:
## rpart(formula = Mileage ~ Price + Country + Reliability + Type, 
##     data = cu.summary, method = &quot;anova&quot;)
##   n=60 (57 observations deleted due to missingness)
## 
##           CP nsplit rel error    xerror       xstd
## 1 0.62288527      0 1.0000000 1.0676647 0.18344526
## 2 0.13206061      1 0.3771147 0.5518870 0.10696736
## 3 0.02544094      2 0.2450541 0.3862402 0.08527743
## 4 0.01160389      3 0.2196132 0.3857621 0.07920566
## 5 0.01000000      4 0.2080093 0.4267977 0.08475255
## 
## Variable importance
##   Price    Type Country 
##      48      42      10 
## 
## Node number 1: 60 observations,    complexity param=0.6228853
##   mean=24.58333, MSE=22.57639 
##   left son=2 (48 obs) right son=3 (12 obs)
##   Primary splits:
##       Price       &lt; 9446.5  to the right, improve=0.6228853, (0 missing)
##       Type        splits as  LLLRLL,      improve=0.5044405, (0 missing)
##       Reliability splits as  LLLRR,       improve=0.1263005, (11 missing)
##       Country     splits as  --LRLRRRLL,  improve=0.1243525, (0 missing)
##   Surrogate splits:
##       Type    splits as  LLLRLL,     agree=0.950, adj=0.750, (0 split)
##       Country splits as  --LLLLRRLL, agree=0.833, adj=0.167, (0 split)
## 
## Node number 2: 48 observations,    complexity param=0.1320606
##   mean=22.70833, MSE=8.498264 
##   left son=4 (23 obs) right son=5 (25 obs)
##   Primary splits:
##       Type        splits as  RLLRRL,      improve=0.43853830, (0 missing)
##       Price       &lt; 12154.5 to the right, improve=0.25748500, (0 missing)
##       Country     splits as  --RRLRL-LL,  improve=0.13345700, (0 missing)
##       Reliability splits as  LLLRR,       improve=0.01637086, (10 missing)
##   Surrogate splits:
##       Price   &lt; 12215.5 to the right, agree=0.812, adj=0.609, (0 split)
##       Country splits as  --RRLRL-RL,  agree=0.646, adj=0.261, (0 split)
## 
## Node number 3: 12 observations
##   mean=32.08333, MSE=8.576389 
## 
## Node number 4: 23 observations,    complexity param=0.02544094
##   mean=20.69565, MSE=2.907372 
##   left son=8 (10 obs) right son=9 (13 obs)
##   Primary splits:
##       Type    splits as  -LR--L,      improve=0.515359600, (0 missing)
##       Price   &lt; 14962   to the left,  improve=0.131259400, (0 missing)
##       Country splits as  ----L-R--R,  improve=0.007022107, (0 missing)
##   Surrogate splits:
##       Price &lt; 13572   to the right, agree=0.609, adj=0.1, (0 split)
## 
## Node number 5: 25 observations,    complexity param=0.01160389
##   mean=24.56, MSE=6.4864 
##   left son=10 (14 obs) right son=11 (11 obs)
##   Primary splits:
##       Price       &lt; 11484.5 to the right, improve=0.09693168, (0 missing)
##       Reliability splits as  LLRRR,       improve=0.07767167, (4 missing)
##       Type        splits as  L--RR-,      improve=0.04209834, (0 missing)
##       Country     splits as  --LRRR--LL,  improve=0.02201687, (0 missing)
##   Surrogate splits:
##       Country splits as  --LLLL--LR, agree=0.80, adj=0.545, (0 split)
##       Type    splits as  L--RL-,     agree=0.64, adj=0.182, (0 split)
## 
## Node number 8: 10 observations
##   mean=19.3, MSE=2.21 
## 
## Node number 9: 13 observations
##   mean=21.76923, MSE=0.7928994 
## 
## Node number 10: 14 observations
##   mean=23.85714, MSE=7.693878 
## 
## Node number 11: 11 observations
##   mean=25.45455, MSE=3.520661</code></pre>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="#cb327-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create additional plots</span></span>
<span id="cb327-2"><a href="#cb327-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)) <span class="co"># two plots on one page</span></span>
<span id="cb327-3"><a href="#cb327-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rsq.rpart</span>(fit) <span class="co"># visualize cross-validation results  </span></span></code></pre></div>
<pre><code>## 
## Regression tree:
## rpart(formula = Mileage ~ Price + Country + Reliability + Type, 
##     data = cu.summary, method = &quot;anova&quot;)
## 
## Variables actually used in tree construction:
## [1] Price Type 
## 
## Root node error: 1354.6/60 = 22.576
## 
## n=60 (57 observations deleted due to missingness)
## 
##         CP nsplit rel error  xerror     xstd
## 1 0.622885      0   1.00000 1.06766 0.183445
## 2 0.132061      1   0.37711 0.55189 0.106967
## 3 0.025441      2   0.24505 0.38624 0.085277
## 4 0.011604      3   0.21961 0.38576 0.079206
## 5 0.010000      4   0.20801 0.42680 0.084753</code></pre>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-105-2.png" width="672" /></p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="#cb329-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot tree</span></span>
<span id="cb329-2"><a href="#cb329-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit, <span class="at">uniform=</span><span class="cn">TRUE</span>,</span>
<span id="cb329-3"><a href="#cb329-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">main=</span><span class="st">&quot;Regression Tree for Mileage &quot;</span>)</span>
<span id="cb329-4"><a href="#cb329-4" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(fit, <span class="at">use.n=</span><span class="cn">TRUE</span>, <span class="at">all=</span><span class="cn">TRUE</span>, <span class="at">cex=</span>.<span class="dv">8</span>)</span>
<span id="cb329-5"><a href="#cb329-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb329-6"><a href="#cb329-6" aria-hidden="true" tabindex="-1"></a><span class="co"># create attractive postcript plot of tree</span></span>
<span id="cb329-7"><a href="#cb329-7" aria-hidden="true" tabindex="-1"></a><span class="fu">post</span>(fit, <span class="at">file =</span> <span class="st">&quot;tree2.ps&quot;</span>,</span>
<span id="cb329-8"><a href="#cb329-8" aria-hidden="true" tabindex="-1"></a>   <span class="at">title =</span> <span class="st">&quot;Regression Tree for Mileage &quot;</span>)</span>
<span id="cb329-9"><a href="#cb329-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb329-10"><a href="#cb329-10" aria-hidden="true" tabindex="-1"></a><span class="co"># prune the tree</span></span>
<span id="cb329-11"><a href="#cb329-11" aria-hidden="true" tabindex="-1"></a>pfit<span class="ot">&lt;-</span> <span class="fu">prune</span>(fit, <span class="at">cp=</span><span class="fl">0.01160389</span>) <span class="co"># from cptable   </span></span>
<span id="cb329-12"><a href="#cb329-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb329-13"><a href="#cb329-13" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the pruned tree</span></span>
<span id="cb329-14"><a href="#cb329-14" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pfit, <span class="at">uniform=</span><span class="cn">TRUE</span>,</span>
<span id="cb329-15"><a href="#cb329-15" aria-hidden="true" tabindex="-1"></a>   <span class="at">main=</span><span class="st">&quot;Pruned Regression Tree for Mileage&quot;</span>)</span>
<span id="cb329-16"><a href="#cb329-16" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(pfit, <span class="at">use.n=</span><span class="cn">TRUE</span>, <span class="at">all=</span><span class="cn">TRUE</span>, <span class="at">cex=</span>.<span class="dv">8</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-105-3.png" width="672" /></p>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="#cb330-1" aria-hidden="true" tabindex="-1"></a><span class="fu">post</span>(pfit, <span class="at">file =</span> <span class="st">&quot;ptree2.ps&quot;</span>,</span>
<span id="cb330-2"><a href="#cb330-2" aria-hidden="true" tabindex="-1"></a>   <span class="at">title =</span> <span class="st">&quot;Pruned Regression Tree for Mileage&quot;</span>)</span></code></pre></div>
<p><strong>Sources</strong><br />
<a href="https://www.statmethods.net/advstats/cart.html">Tree-Based Models at Quick-R by datacamp</a><br />
<a href="https://koalaverse.github.io/machine-learning-in-R/decision-trees.html">UseR! Machine Learnign Turorial</a></p>
<!--chapter:end:46_tree-based_models.Rmd-->
</div>
</div>
<!--bookdown:body:end-->
            </section>

          </div>
        </div>
      </div>
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
    </div>
  </div>
<!--bookdown:config-->

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
